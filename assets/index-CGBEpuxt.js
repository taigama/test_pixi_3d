(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();var ar=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(ar||{}),la=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(la||{}),pn=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(pn||{}),at=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(at||{}),Jt=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Jt||{}),X=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(X||{}),He=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(He||{}),Q=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(Q||{}),mn=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(mn||{}),Zt=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Zt||{}),Wt=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(Wt||{}),ne=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(ne||{}),Vt=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(Vt||{}),Ae=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Ae||{}),Un=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(Un||{}),te=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(te||{}),Pt=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(Pt||{}),bc=(e=>(e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e))(bc||{}),Mt=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(Mt||{}),Ie=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Ie||{});const Tc={createCanvas:(e,t)=>{const r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},j={ADAPTER:Tc,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var cs=/iPhone/i,pl=/iPod/i,ml=/iPad/i,gl=/\biOS-universal(?:.+)Mac\b/i,us=/\bAndroid(?:.+)Mobile\b/i,_l=/Android/i,Br=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ui=/Silk/i,Be=/Windows Phone/i,vl=/\bWindows(?:.+)ARM\b/i,yl=/BlackBerry/i,xl=/BB10/i,bl=/Opera Mini/i,Tl=/\b(CriOS|Chrome)(?:.+)Mobile/i,wl=/Mobile(?:.+)Firefox\b/i,Al=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function ld(e){return function(t){return t.test(e)}}function El(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var r=t.userAgent,i=r.split("[FBAN");typeof i[1]<"u"&&(r=i[0]),i=r.split("Twitter"),typeof i[1]<"u"&&(r=i[0]);var n=ld(r),s={apple:{phone:n(cs)&&!n(Be),ipod:n(pl),tablet:!n(cs)&&(n(ml)||Al(t))&&!n(Be),universal:n(gl),device:(n(cs)||n(pl)||n(ml)||n(gl)||Al(t))&&!n(Be)},amazon:{phone:n(Br),tablet:!n(Br)&&n(Ui),device:n(Br)||n(Ui)},android:{phone:!n(Be)&&n(Br)||!n(Be)&&n(us),tablet:!n(Be)&&!n(Br)&&!n(us)&&(n(Ui)||n(_l)),device:!n(Be)&&(n(Br)||n(Ui)||n(us)||n(_l))||n(/\bokhttp\b/i)},windows:{phone:n(Be),tablet:n(vl),device:n(Be)||n(vl)},other:{blackberry:n(yl),blackberry10:n(xl),opera:n(bl),firefox:n(wl),chrome:n(Tl),device:n(yl)||n(xl)||n(bl)||n(wl)||n(Tl)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const hd=El.default??El,Se=hd(globalThis.navigator);j.RETINA_PREFIX=/@([0-9\.]+)x/;j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cd(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),r}var ds={exports:{}},Sl;function ud(){return Sl||(Sl=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function n(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function s(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new n(c,u||l,d),p=r?r+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)t.call(c,u)&&h.push(r?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=r?r+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(h){var c=r?r+h:h,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,c,u,d,f,p){var g=r?r+h:h;if(!this._events[g])return!1;var m=this._events[g],_=arguments.length,w,v;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),_){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,u),!0;case 4:return m.fn.call(m.context,c,u,d),!0;case 5:return m.fn.call(m.context,c,u,d,f),!0;case 6:return m.fn.call(m.context,c,u,d,f,p),!0}for(v=1,w=new Array(_-1);v<_;v++)w[v-1]=arguments[v];m.fn.apply(m.context,w)}else{var E=m.length,y;for(v=0;v<E;v++)switch(m[v].once&&this.removeListener(h,m[v].fn,void 0,!0),_){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,c);break;case 3:m[v].fn.call(m[v].context,c,u);break;case 4:m[v].fn.call(m[v].context,c,u,d);break;default:if(!w)for(y=1,w=new Array(_-1);y<_;y++)w[y-1]=arguments[y];m[v].fn.apply(m[v].context,w)}}return!0},a.prototype.on=function(h,c,u){return s(this,h,c,u,!1)},a.prototype.once=function(h,c,u){return s(this,h,c,u,!0)},a.prototype.removeListener=function(h,c,u,d){var f=r?r+h:h;if(!this._events[f])return this;if(!c)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&o(this,f);else{for(var g=0,m=[],_=p.length;g<_;g++)(p[g].fn!==c||d&&!p[g].once||u&&p[g].context!==u)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=r?r+h:h,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(ds)),ds.exports}var dd=ud();const lr=wc(dd);var Gi={exports:{}},Cl;function fd(){if(Cl)return Gi.exports;Cl=1,Gi.exports=e,Gi.exports.default=e;function e(T,A,b){b=b||2;var P=A&&A.length,S=P?A[0]*b:T.length,M=t(T,0,S,b,!0),B=[];if(!M||M.next===M.prev)return B;var D,H,V,Y,K,J,it;if(P&&(M=l(T,A,M,b)),T.length>80*b){D=V=T[0],H=Y=T[1];for(var z=b;z<S;z+=b)K=T[z],J=T[z+1],K<D&&(D=K),J<H&&(H=J),K>V&&(V=K),J>Y&&(Y=J);it=Math.max(V-D,Y-H),it=it!==0?32767/it:0}return i(M,B,b,D,H,it,0),B}function t(T,A,b,P,S){var M,B;if(S===W(T,A,b,P)>0)for(M=A;M<b;M+=P)B=I(M,T[M],T[M+1],B);else for(M=b-P;M>=A;M-=P)B=I(M,T[M],T[M+1],B);return B&&E(B,B.next)&&(L(B),B=B.next),B}function r(T,A){if(!T)return T;A||(A=T);var b=T,P;do if(P=!1,!b.steiner&&(E(b,b.next)||v(b.prev,b,b.next)===0)){if(L(b),b=A=b.prev,b===b.next)break;P=!0}else b=b.next;while(P||b!==A);return A}function i(T,A,b,P,S,M,B){if(T){!B&&M&&f(T,P,S,M);for(var D=T,H,V;T.prev!==T.next;){if(H=T.prev,V=T.next,M?s(T,P,S,M):n(T)){A.push(H.i/b|0),A.push(T.i/b|0),A.push(V.i/b|0),L(T),T=V.next,D=V.next;continue}if(T=V,T===D){B?B===1?(T=o(r(T),A,b),i(T,A,b,P,S,M,2)):B===2&&a(T,A,b,P,S,M):i(r(T),A,b,P,S,M,1);break}}}}function n(T){var A=T.prev,b=T,P=T.next;if(v(A,b,P)>=0)return!1;for(var S=A.x,M=b.x,B=P.x,D=A.y,H=b.y,V=P.y,Y=S<M?S<B?S:B:M<B?M:B,K=D<H?D<V?D:V:H<V?H:V,J=S>M?S>B?S:B:M>B?M:B,it=D>H?D>V?D:V:H>V?H:V,z=P.next;z!==A;){if(z.x>=Y&&z.x<=J&&z.y>=K&&z.y<=it&&_(S,D,M,H,B,V,z.x,z.y)&&v(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function s(T,A,b,P){var S=T.prev,M=T,B=T.next;if(v(S,M,B)>=0)return!1;for(var D=S.x,H=M.x,V=B.x,Y=S.y,K=M.y,J=B.y,it=D<H?D<V?D:V:H<V?H:V,z=Y<K?Y<J?Y:J:K<J?K:J,tt=D>H?D>V?D:V:H>V?H:V,nt=Y>K?Y>J?Y:J:K>J?K:J,ut=g(it,z,A,b,P),gt=g(tt,nt,A,b,P),et=T.prevZ,st=T.nextZ;et&&et.z>=ut&&st&&st.z<=gt;){if(et.x>=it&&et.x<=tt&&et.y>=z&&et.y<=nt&&et!==S&&et!==B&&_(D,Y,H,K,V,J,et.x,et.y)&&v(et.prev,et,et.next)>=0||(et=et.prevZ,st.x>=it&&st.x<=tt&&st.y>=z&&st.y<=nt&&st!==S&&st!==B&&_(D,Y,H,K,V,J,st.x,st.y)&&v(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;et&&et.z>=ut;){if(et.x>=it&&et.x<=tt&&et.y>=z&&et.y<=nt&&et!==S&&et!==B&&_(D,Y,H,K,V,J,et.x,et.y)&&v(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;st&&st.z<=gt;){if(st.x>=it&&st.x<=tt&&st.y>=z&&st.y<=nt&&st!==S&&st!==B&&_(D,Y,H,K,V,J,st.x,st.y)&&v(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function o(T,A,b){var P=T;do{var S=P.prev,M=P.next.next;!E(S,M)&&y(S,P,P.next,M)&&G(S,M)&&G(M,S)&&(A.push(S.i/b|0),A.push(P.i/b|0),A.push(M.i/b|0),L(P),L(P.next),P=T=M),P=P.next}while(P!==T);return r(P)}function a(T,A,b,P,S,M){var B=T;do{for(var D=B.next.next;D!==B.prev;){if(B.i!==D.i&&w(B,D)){var H=U(B,D);B=r(B,B.next),H=r(H,H.next),i(B,A,b,P,S,M,0),i(H,A,b,P,S,M,0);return}D=D.next}B=B.next}while(B!==T)}function l(T,A,b,P){var S=[],M,B,D,H,V;for(M=0,B=A.length;M<B;M++)D=A[M]*P,H=M<B-1?A[M+1]*P:T.length,V=t(T,D,H,P,!1),V===V.next&&(V.steiner=!0),S.push(m(V));for(S.sort(h),M=0;M<S.length;M++)b=c(S[M],b);return b}function h(T,A){return T.x-A.x}function c(T,A){var b=u(T,A);if(!b)return A;var P=U(b,T);return r(P,P.next),r(b,b.next)}function u(T,A){var b=A,P=T.x,S=T.y,M=-1/0,B;do{if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){var D=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(D<=P&&D>M&&(M=D,B=b.x<b.next.x?b:b.next,D===P))return B}b=b.next}while(b!==A);if(!B)return null;var H=B,V=B.x,Y=B.y,K=1/0,J;b=B;do P>=b.x&&b.x>=V&&P!==b.x&&_(S<Y?P:M,S,V,Y,S<Y?M:P,S,b.x,b.y)&&(J=Math.abs(S-b.y)/(P-b.x),G(b,T)&&(J<K||J===K&&(b.x>B.x||b.x===B.x&&d(B,b)))&&(B=b,K=J)),b=b.next;while(b!==H);return B}function d(T,A){return v(T.prev,T,A.prev)<0&&v(A.next,T,T.next)<0}function f(T,A,b,P){var S=T;do S.z===0&&(S.z=g(S.x,S.y,A,b,P)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==T);S.prevZ.nextZ=null,S.prevZ=null,p(S)}function p(T){var A,b,P,S,M,B,D,H,V=1;do{for(b=T,T=null,M=null,B=0;b;){for(B++,P=b,D=0,A=0;A<V&&(D++,P=P.nextZ,!!P);A++);for(H=V;D>0||H>0&&P;)D!==0&&(H===0||!P||b.z<=P.z)?(S=b,b=b.nextZ,D--):(S=P,P=P.nextZ,H--),M?M.nextZ=S:T=S,S.prevZ=M,M=S;b=P}M.nextZ=null,V*=2}while(B>1);return T}function g(T,A,b,P,S){return T=(T-b)*S|0,A=(A-P)*S|0,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,T|A<<1}function m(T){var A=T,b=T;do(A.x<b.x||A.x===b.x&&A.y<b.y)&&(b=A),A=A.next;while(A!==T);return b}function _(T,A,b,P,S,M,B,D){return(S-B)*(A-D)>=(T-B)*(M-D)&&(T-B)*(P-D)>=(b-B)*(A-D)&&(b-B)*(M-D)>=(S-B)*(P-D)}function w(T,A){return T.next.i!==A.i&&T.prev.i!==A.i&&!F(T,A)&&(G(T,A)&&G(A,T)&&k(T,A)&&(v(T.prev,T,A.prev)||v(T,A.prev,A))||E(T,A)&&v(T.prev,T,T.next)>0&&v(A.prev,A,A.next)>0)}function v(T,A,b){return(A.y-T.y)*(b.x-A.x)-(A.x-T.x)*(b.y-A.y)}function E(T,A){return T.x===A.x&&T.y===A.y}function y(T,A,b,P){var S=x(v(T,A,b)),M=x(v(T,A,P)),B=x(v(b,P,T)),D=x(v(b,P,A));return!!(S!==M&&B!==D||S===0&&C(T,b,A)||M===0&&C(T,P,A)||B===0&&C(b,T,P)||D===0&&C(b,A,P))}function C(T,A,b){return A.x<=Math.max(T.x,b.x)&&A.x>=Math.min(T.x,b.x)&&A.y<=Math.max(T.y,b.y)&&A.y>=Math.min(T.y,b.y)}function x(T){return T>0?1:T<0?-1:0}function F(T,A){var b=T;do{if(b.i!==T.i&&b.next.i!==T.i&&b.i!==A.i&&b.next.i!==A.i&&y(b,b.next,T,A))return!0;b=b.next}while(b!==T);return!1}function G(T,A){return v(T.prev,T,T.next)<0?v(T,A,T.next)>=0&&v(T,T.prev,A)>=0:v(T,A,T.prev)<0||v(T,T.next,A)<0}function k(T,A){var b=T,P=!1,S=(T.x+A.x)/2,M=(T.y+A.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&S<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(P=!P),b=b.next;while(b!==T);return P}function U(T,A){var b=new R(T.i,T.x,T.y),P=new R(A.i,A.x,A.y),S=T.next,M=A.prev;return T.next=A,A.prev=T,b.next=S,S.prev=b,P.next=b,b.prev=P,M.next=P,P.prev=M,P}function I(T,A,b,P){var S=new R(T,A,b);return P?(S.next=P.next,S.prev=P,P.next.prev=S,P.next=S):(S.prev=S,S.next=S),S}function L(T){T.next.prev=T.prev,T.prev.next=T.next,T.prevZ&&(T.prevZ.nextZ=T.nextZ),T.nextZ&&(T.nextZ.prevZ=T.prevZ)}function R(T,A,b){this.i=T,this.x=A,this.y=b,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}e.deviation=function(T,A,b,P){var S=A&&A.length,M=S?A[0]*b:T.length,B=Math.abs(W(T,0,M,b));if(S)for(var D=0,H=A.length;D<H;D++){var V=A[D]*b,Y=D<H-1?A[D+1]*b:T.length;B-=Math.abs(W(T,V,Y,b))}var K=0;for(D=0;D<P.length;D+=3){var J=P[D]*b,it=P[D+1]*b,z=P[D+2]*b;K+=Math.abs((T[J]-T[z])*(T[it+1]-T[J+1])-(T[J]-T[it])*(T[z+1]-T[J+1]))}return B===0&&K===0?0:Math.abs((K-B)/B)};function W(T,A,b,P){for(var S=0,M=A,B=b-P;M<b;M+=P)S+=(T[B]-T[M])*(T[M+1]+T[B+1]),B=M;return S}return e.flatten=function(T){for(var A=T[0][0].length,b={vertices:[],holes:[],dimensions:A},P=0,S=0;S<T.length;S++){for(var M=0;M<T[S].length;M++)for(var B=0;B<A;B++)b.vertices.push(T[S][M][B]);S>0&&(P+=T[S-1].length,b.holes.push(P))}return b},Gi.exports}var pd=fd();const Ac=wc(pd);var ur={},ci={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var md=ci.exports,Il;function gd(){return Il||(Il=1,function(e,t){(function(r){var i=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,s=typeof gn=="object"&&gn;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,l=36,h=1,c=26,u=38,d=700,f=72,p=128,g="-",m=/^xn--/,_=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,y=Math.floor,C=String.fromCharCode,x;function F(S){throw new RangeError(v[S])}function G(S,M){for(var B=S.length,D=[];B--;)D[B]=M(S[B]);return D}function k(S,M){var B=S.split("@"),D="";B.length>1&&(D=B[0]+"@",S=B[1]),S=S.replace(w,".");var H=S.split("."),V=G(H,M).join(".");return D+V}function U(S){for(var M=[],B=0,D=S.length,H,V;B<D;)H=S.charCodeAt(B++),H>=55296&&H<=56319&&B<D?(V=S.charCodeAt(B++),(V&64512)==56320?M.push(((H&1023)<<10)+(V&1023)+65536):(M.push(H),B--)):M.push(H);return M}function I(S){return G(S,function(M){var B="";return M>65535&&(M-=65536,B+=C(M>>>10&1023|55296),M=56320|M&1023),B+=C(M),B}).join("")}function L(S){return S-48<10?S-22:S-65<26?S-65:S-97<26?S-97:l}function R(S,M){return S+22+75*(S<26)-((M!=0)<<5)}function W(S,M,B){var D=0;for(S=B?y(S/d):S>>1,S+=y(S/M);S>E*c>>1;D+=l)S=y(S/E);return y(D+(E+1)*S/(S+u))}function T(S){var M=[],B=S.length,D,H=0,V=p,Y=f,K,J,it,z,tt,nt,ut,gt,et;for(K=S.lastIndexOf(g),K<0&&(K=0),J=0;J<K;++J)S.charCodeAt(J)>=128&&F("not-basic"),M.push(S.charCodeAt(J));for(it=K>0?K+1:0;it<B;){for(z=H,tt=1,nt=l;it>=B&&F("invalid-input"),ut=L(S.charCodeAt(it++)),(ut>=l||ut>y((a-H)/tt))&&F("overflow"),H+=ut*tt,gt=nt<=Y?h:nt>=Y+c?c:nt-Y,!(ut<gt);nt+=l)et=l-gt,tt>y(a/et)&&F("overflow"),tt*=et;D=M.length+1,Y=W(H-z,D,z==0),y(H/D)>a-V&&F("overflow"),V+=y(H/D),H%=D,M.splice(H++,0,V)}return I(M)}function A(S){var M,B,D,H,V,Y,K,J,it,z,tt,nt=[],ut,gt,et,st;for(S=U(S),ut=S.length,M=p,B=0,V=f,Y=0;Y<ut;++Y)tt=S[Y],tt<128&&nt.push(C(tt));for(D=H=nt.length,H&&nt.push(g);D<ut;){for(K=a,Y=0;Y<ut;++Y)tt=S[Y],tt>=M&&tt<K&&(K=tt);for(gt=D+1,K-M>y((a-B)/gt)&&F("overflow"),B+=(K-M)*gt,M=K,Y=0;Y<ut;++Y)if(tt=S[Y],tt<M&&++B>a&&F("overflow"),tt==M){for(J=B,it=l;z=it<=V?h:it>=V+c?c:it-V,!(J<z);it+=l)st=J-z,et=l-z,nt.push(C(R(z+st%et,0))),J=y(st/et);nt.push(C(R(J,0))),V=W(B,gt,D==H),B=0,++D}++B,++M}return nt.join("")}function b(S){return k(S,function(M){return m.test(M)?T(M.slice(4).toLowerCase()):M})}function P(S){return k(S,function(M){return _.test(M)?"xn--"+A(M):M})}if(o={version:"1.4.1",ucs2:{decode:U,encode:I},decode:T,encode:A,toASCII:P,toUnicode:b},i&&n)if(e.exports==i)n.exports=o;else for(x in o)o.hasOwnProperty(x)&&(i[x]=o[x]);else r.punycode=o})(md)}(ci,ci.exports)),ci.exports}var fs,Rl;function Qr(){return Rl||(Rl=1,fs=TypeError),fs}const _d={},vd=Object.freeze(Object.defineProperty({__proto__:null,default:_d},Symbol.toStringTag,{value:"Module"})),yd=cd(vd);var ps,Ml;function Gn(){if(Ml)return ps;Ml=1;var e=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=e&&t&&typeof t.get=="function"?t.get:null,i=e&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=n&&s&&typeof s.get=="function"?s.get:null,a=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,h=l?WeakMap.prototype.has:null,c=typeof WeakSet=="function"&&WeakSet.prototype,u=c?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,g=Object.prototype.toString,m=Function.prototype.toString,_=String.prototype.match,w=String.prototype.slice,v=String.prototype.replace,E=String.prototype.toUpperCase,y=String.prototype.toLowerCase,C=RegExp.prototype.test,x=Array.prototype.concat,F=Array.prototype.join,G=Array.prototype.slice,k=Math.floor,U=typeof BigInt=="function"?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,R=typeof Symbol=="function"&&typeof Symbol.iterator=="object",W=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===R||!0)?Symbol.toStringTag:null,T=Object.prototype.propertyIsEnumerable,A=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(N){return N.__proto__}:null);function b(N,O){if(N===1/0||N===-1/0||N!==N||N&&N>-1e3&&N<1e3||C.call(/e/,O))return O;var yt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof N=="number"){var bt=N<0?-k(-N):k(N);if(bt!==N){var At=String(bt),ft=w.call(O,At.length+1);return v.call(At,yt,"$&_")+"."+v.call(v.call(ft,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(O,yt,"$&_")}var P=yd,S=P.custom,M=gt(S)?S:null,B={__proto__:null,double:'"',single:"'"},D={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};ps=function N(O,yt,bt,At){var ft=yt||{};if(Rt(ft,"quoteStyle")&&!Rt(B,ft.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Rt(ft,"maxStringLength")&&(typeof ft.maxStringLength=="number"?ft.maxStringLength<0&&ft.maxStringLength!==1/0:ft.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Ye=Rt(ft,"customInspect")?ft.customInspect:!0;if(typeof Ye!="boolean"&&Ye!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Rt(ft,"indent")&&ft.indent!==null&&ft.indent!=="	"&&!(parseInt(ft.indent,10)===ft.indent&&ft.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Rt(ft,"numericSeparator")&&typeof ft.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var cr=ft.numericSeparator;if(typeof O>"u")return"undefined";if(O===null)return"null";if(typeof O=="boolean")return O?"true":"false";if(typeof O=="string")return nl(O,ft);if(typeof O=="number"){if(O===0)return 1/0/O>0?"0":"-0";var qt=String(O);return cr?b(O,qt):qt}if(typeof O=="bigint"){var Ke=String(O)+"n";return cr?b(O,Ke):Ke}var is=typeof ft.depth>"u"?5:ft.depth;if(typeof bt>"u"&&(bt=0),bt>=is&&is>0&&typeof O=="object")return K(O)?"[Array]":"[Object]";var Dr=sd(ft,bt);if(typeof At>"u")At=[];else if(qe(At,O)>=0)return"[Circular]";function ge(Nr,Li,ad){if(Li&&(At=G.call(At),At.push(Li)),ad){var fl={depth:ft.depth};return Rt(ft,"quoteStyle")&&(fl.quoteStyle=ft.quoteStyle),N(Nr,fl,bt+1,At)}return N(Nr,ft,bt+1,At)}if(typeof O=="function"&&!it(O)){var ol=Rr(O),al=Bi(O,ge);return"[Function"+(ol?": "+ol:" (anonymous)")+"]"+(al.length>0?" { "+F.call(al,", ")+" }":"")}if(gt(O)){var ll=R?v.call(String(O),/^(Symbol\(.*\))_[^)]*$/,"$1"):L.call(O);return typeof O=="object"&&!R?ei(ll):ll}if(rd(O)){for(var ri="<"+y.call(String(O.nodeName)),ns=O.attributes||[],Oi=0;Oi<ns.length;Oi++)ri+=" "+ns[Oi].name+"="+H(V(ns[Oi].value),"double",ft);return ri+=">",O.childNodes&&O.childNodes.length&&(ri+="..."),ri+="</"+y.call(String(O.nodeName))+">",ri}if(K(O)){if(O.length===0)return"[]";var ss=Bi(O,ge);return Dr&&!nd(ss)?"["+rs(ss,Dr)+"]":"[ "+F.call(ss,", ")+" ]"}if(z(O)){var os=Bi(O,ge);return!("cause"in Error.prototype)&&"cause"in O&&!T.call(O,"cause")?"{ ["+String(O)+"] "+F.call(x.call("[cause]: "+ge(O.cause),os),", ")+" }":os.length===0?"["+String(O)+"]":"{ ["+String(O)+"] "+F.call(os,", ")+" }"}if(typeof O=="object"&&Ye){if(M&&typeof O[M]=="function"&&P)return P(O,{depth:is-bt});if(Ye!=="symbol"&&typeof O.inspect=="function")return O.inspect()}if(me(O)){var hl=[];return i&&i.call(O,function(Nr,Li){hl.push(ge(Li,O,!0)+" => "+ge(Nr,O))}),sl("Map",r.call(O),hl,Dr)}if(Fr(O)){var cl=[];return a&&a.call(O,function(Nr){cl.push(ge(Nr,O))}),sl("Set",o.call(O),cl,Dr)}if(Mr(O))return es("WeakMap");if(ed(O))return es("WeakSet");if(Pr(O))return es("WeakRef");if(nt(O))return ei(ge(Number(O)));if(et(O))return ei(ge(U.call(O)));if(ut(O))return ei(p.call(O));if(tt(O))return ei(ge(String(O)));if(typeof window<"u"&&O===window)return"{ [object Window] }";if(typeof globalThis<"u"&&O===globalThis||typeof gn<"u"&&O===gn)return"{ [object globalThis] }";if(!J(O)&&!it(O)){var as=Bi(O,ge),ul=A?A(O)===Object.prototype:O instanceof Object||O.constructor===Object,ls=O instanceof Object?"":"null prototype",dl=!ul&&W&&Object(O)===O&&W in O?w.call(Dt(O),8,-1):ls?"Object":"",od=ul||typeof O.constructor!="function"?"":O.constructor.name?O.constructor.name+" ":"",hs=od+(dl||ls?"["+F.call(x.call([],dl||[],ls||[]),": ")+"] ":"");return as.length===0?hs+"{}":Dr?hs+"{"+rs(as,Dr)+"}":hs+"{ "+F.call(as,", ")+" }"}return String(O)};function H(N,O,yt){var bt=yt.quoteStyle||O,At=B[bt];return At+N+At}function V(N){return v.call(String(N),/"/g,"&quot;")}function Y(N){return!W||!(typeof N=="object"&&(W in N||typeof N[W]<"u"))}function K(N){return Dt(N)==="[object Array]"&&Y(N)}function J(N){return Dt(N)==="[object Date]"&&Y(N)}function it(N){return Dt(N)==="[object RegExp]"&&Y(N)}function z(N){return Dt(N)==="[object Error]"&&Y(N)}function tt(N){return Dt(N)==="[object String]"&&Y(N)}function nt(N){return Dt(N)==="[object Number]"&&Y(N)}function ut(N){return Dt(N)==="[object Boolean]"&&Y(N)}function gt(N){if(R)return N&&typeof N=="object"&&N instanceof Symbol;if(typeof N=="symbol")return!0;if(!N||typeof N!="object"||!L)return!1;try{return L.call(N),!0}catch{}return!1}function et(N){if(!N||typeof N!="object"||!U)return!1;try{return U.call(N),!0}catch{}return!1}var st=Object.prototype.hasOwnProperty||function(N){return N in this};function Rt(N,O){return st.call(N,O)}function Dt(N){return g.call(N)}function Rr(N){if(N.name)return N.name;var O=_.call(m.call(N),/^function\s*([\w$]+)/);return O?O[1]:null}function qe(N,O){if(N.indexOf)return N.indexOf(O);for(var yt=0,bt=N.length;yt<bt;yt++)if(N[yt]===O)return yt;return-1}function me(N){if(!r||!N||typeof N!="object")return!1;try{r.call(N);try{o.call(N)}catch{return!0}return N instanceof Map}catch{}return!1}function Mr(N){if(!h||!N||typeof N!="object")return!1;try{h.call(N,h);try{u.call(N,u)}catch{return!0}return N instanceof WeakMap}catch{}return!1}function Pr(N){if(!f||!N||typeof N!="object")return!1;try{return f.call(N),!0}catch{}return!1}function Fr(N){if(!o||!N||typeof N!="object")return!1;try{o.call(N);try{r.call(N)}catch{return!0}return N instanceof Set}catch{}return!1}function ed(N){if(!u||!N||typeof N!="object")return!1;try{u.call(N,u);try{h.call(N,h)}catch{return!0}return N instanceof WeakSet}catch{}return!1}function rd(N){return!N||typeof N!="object"?!1:typeof HTMLElement<"u"&&N instanceof HTMLElement?!0:typeof N.nodeName=="string"&&typeof N.getAttribute=="function"}function nl(N,O){if(N.length>O.maxStringLength){var yt=N.length-O.maxStringLength,bt="... "+yt+" more character"+(yt>1?"s":"");return nl(w.call(N,0,O.maxStringLength),O)+bt}var At=D[O.quoteStyle||"single"];At.lastIndex=0;var ft=v.call(v.call(N,At,"\\$1"),/[\x00-\x1f]/g,id);return H(ft,"single",O)}function id(N){var O=N.charCodeAt(0),yt={8:"b",9:"t",10:"n",12:"f",13:"r"}[O];return yt?"\\"+yt:"\\x"+(O<16?"0":"")+E.call(O.toString(16))}function ei(N){return"Object("+N+")"}function es(N){return N+" { ? }"}function sl(N,O,yt,bt){var At=bt?rs(yt,bt):F.call(yt,", ");return N+" ("+O+") {"+At+"}"}function nd(N){for(var O=0;O<N.length;O++)if(qe(N[O],`
`)>=0)return!1;return!0}function sd(N,O){var yt;if(N.indent==="	")yt="	";else if(typeof N.indent=="number"&&N.indent>0)yt=F.call(Array(N.indent+1)," ");else return null;return{base:yt,prev:F.call(Array(O+1),yt)}}function rs(N,O){if(N.length===0)return"";var yt=`
`+O.prev+O.base;return yt+F.call(N,","+yt)+`
`+O.prev}function Bi(N,O){var yt=K(N),bt=[];if(yt){bt.length=N.length;for(var At=0;At<N.length;At++)bt[At]=Rt(N,At)?O(N[At],N):""}var ft=typeof I=="function"?I(N):[],Ye;if(R){Ye={};for(var cr=0;cr<ft.length;cr++)Ye["$"+ft[cr]]=ft[cr]}for(var qt in N)Rt(N,qt)&&(yt&&String(Number(qt))===qt&&qt<N.length||R&&Ye["$"+qt]instanceof Symbol||(C.call(/[^\w$]/,qt)?bt.push(O(qt,N)+": "+O(N[qt],N)):bt.push(qt+": "+O(N[qt],N))));if(typeof I=="function")for(var Ke=0;Ke<ft.length;Ke++)T.call(N,ft[Ke])&&bt.push("["+O(ft[Ke])+"]: "+O(N[ft[Ke]],N));return bt}return ps}var ms,Pl;function xd(){if(Pl)return ms;Pl=1;var e=Gn(),t=Qr(),r=function(a,l,h){for(var c=a,u;(u=c.next)!=null;c=u)if(u.key===l)return c.next=u.next,h||(u.next=a.next,a.next=u),u},i=function(a,l){if(a){var h=r(a,l);return h&&h.value}},n=function(a,l,h){var c=r(a,l);c?c.value=h:a.next={key:l,next:a.next,value:h}},s=function(a,l){return a?!!r(a,l):!1},o=function(a,l){if(a)return r(a,l,!0)};return ms=function(){var l,h={assert:function(c){if(!h.has(c))throw new t("Side channel does not contain "+e(c))},delete:function(c){var u=l&&l.next,d=o(l,c);return d&&u&&u===d&&(l=void 0),!!d},get:function(c){return i(l,c)},has:function(c){return s(l,c)},set:function(c,u){l||(l={next:void 0}),n(l,c,u)}};return h},ms}var gs,Fl;function Ec(){return Fl||(Fl=1,gs=Object),gs}var _s,Dl;function bd(){return Dl||(Dl=1,_s=Error),_s}var vs,Nl;function Td(){return Nl||(Nl=1,vs=EvalError),vs}var ys,Bl;function wd(){return Bl||(Bl=1,ys=RangeError),ys}var xs,Ol;function Ad(){return Ol||(Ol=1,xs=ReferenceError),xs}var bs,Ll;function Ed(){return Ll||(Ll=1,bs=SyntaxError),bs}var Ts,Ul;function Sd(){return Ul||(Ul=1,Ts=URIError),Ts}var ws,Gl;function Cd(){return Gl||(Gl=1,ws=Math.abs),ws}var As,kl;function Id(){return kl||(kl=1,As=Math.floor),As}var Es,Hl;function Rd(){return Hl||(Hl=1,Es=Math.max),Es}var Ss,Vl;function Md(){return Vl||(Vl=1,Ss=Math.min),Ss}var Cs,zl;function Pd(){return zl||(zl=1,Cs=Math.pow),Cs}var Is,Xl;function Fd(){return Xl||(Xl=1,Is=Math.round),Is}var Rs,jl;function Dd(){return jl||(jl=1,Rs=Number.isNaN||function(t){return t!==t}),Rs}var Ms,Wl;function Nd(){if(Wl)return Ms;Wl=1;var e=Dd();return Ms=function(r){return e(r)||r===0?r:r<0?-1:1},Ms}var Ps,$l;function Bd(){return $l||($l=1,Ps=Object.getOwnPropertyDescriptor),Ps}var Fs,ql;function Sc(){if(ql)return Fs;ql=1;var e=Bd();if(e)try{e([],"length")}catch{e=null}return Fs=e,Fs}var Ds,Yl;function Od(){if(Yl)return Ds;Yl=1;var e=Object.defineProperty||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return Ds=e,Ds}var Ns,Kl;function Ld(){return Kl||(Kl=1,Ns=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[r]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),Ns}var Bs,Ql;function Ud(){if(Ql)return Bs;Ql=1;var e=typeof Symbol<"u"&&Symbol,t=Ld();return Bs=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Bs}var Os,Jl;function Cc(){return Jl||(Jl=1,Os=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Os}var Ls,Zl;function Ic(){if(Zl)return Ls;Zl=1;var e=Ec();return Ls=e.getPrototypeOf||null,Ls}var Us,th;function Gd(){if(th)return Us;th=1;var e="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,r=Math.max,i="[object Function]",n=function(l,h){for(var c=[],u=0;u<l.length;u+=1)c[u]=l[u];for(var d=0;d<h.length;d+=1)c[d+l.length]=h[d];return c},s=function(l,h){for(var c=[],u=h,d=0;u<l.length;u+=1,d+=1)c[d]=l[u];return c},o=function(a,l){for(var h="",c=0;c<a.length;c+=1)h+=a[c],c+1<a.length&&(h+=l);return h};return Us=function(l){var h=this;if(typeof h!="function"||t.apply(h)!==i)throw new TypeError(e+h);for(var c=s(arguments,1),u,d=function(){if(this instanceof u){var _=h.apply(this,n(c,arguments));return Object(_)===_?_:this}return h.apply(l,n(c,arguments))},f=r(0,h.length-c.length),p=[],g=0;g<f;g++)p[g]="$"+g;if(u=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(d),h.prototype){var m=function(){};m.prototype=h.prototype,u.prototype=new m,m.prototype=null}return u},Us}var Gs,eh;function kn(){if(eh)return Gs;eh=1;var e=Gd();return Gs=Function.prototype.bind||e,Gs}var ks,rh;function ha(){return rh||(rh=1,ks=Function.prototype.call),ks}var Hs,ih;function Rc(){return ih||(ih=1,Hs=Function.prototype.apply),Hs}var Vs,nh;function kd(){return nh||(nh=1,Vs=typeof Reflect<"u"&&Reflect&&Reflect.apply),Vs}var zs,sh;function Hd(){if(sh)return zs;sh=1;var e=kn(),t=Rc(),r=ha(),i=kd();return zs=i||e.call(r,t),zs}var Xs,oh;function Mc(){if(oh)return Xs;oh=1;var e=kn(),t=Qr(),r=ha(),i=Hd();return Xs=function(s){if(s.length<1||typeof s[0]!="function")throw new t("a function is required");return i(e,r,s)},Xs}var js,ah;function Vd(){if(ah)return js;ah=1;var e=Mc(),t=Sc(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!r&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return js=i&&typeof i.get=="function"?e([i.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,js}var Ws,lh;function zd(){if(lh)return Ws;lh=1;var e=Cc(),t=Ic(),r=Vd();return Ws=e?function(n){return e(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:r?function(n){return r(n)}:null,Ws}var $s,hh;function Xd(){if(hh)return $s;hh=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=kn();return $s=r.call(e,t),$s}var qs,ch;function ca(){if(ch)return qs;ch=1;var e,t=Ec(),r=bd(),i=Td(),n=wd(),s=Ad(),o=Ed(),a=Qr(),l=Sd(),h=Cd(),c=Id(),u=Rd(),d=Md(),f=Pd(),p=Fd(),g=Nd(),m=Function,_=function(it){try{return m('"use strict"; return ('+it+").constructor;")()}catch{}},w=Sc(),v=Od(),E=function(){throw new a},y=w?function(){try{return arguments.callee,E}catch{try{return w(arguments,"callee").get}catch{return E}}}():E,C=Ud()(),x=zd(),F=Ic(),G=Cc(),k=Rc(),U=ha(),I={},L=typeof Uint8Array>"u"||!x?e:x(Uint8Array),R={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?e:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?e:ArrayBuffer,"%ArrayIteratorPrototype%":C&&x?x([][Symbol.iterator]()):e,"%AsyncFromSyncIteratorPrototype%":e,"%AsyncFunction%":I,"%AsyncGenerator%":I,"%AsyncGeneratorFunction%":I,"%AsyncIteratorPrototype%":I,"%Atomics%":typeof Atomics>"u"?e:Atomics,"%BigInt%":typeof BigInt>"u"?e:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?e:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":i,"%Float16Array%":typeof Float16Array>"u"?e:Float16Array,"%Float32Array%":typeof Float32Array>"u"?e:Float32Array,"%Float64Array%":typeof Float64Array>"u"?e:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?e:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":I,"%Int8Array%":typeof Int8Array>"u"?e:Int8Array,"%Int16Array%":typeof Int16Array>"u"?e:Int16Array,"%Int32Array%":typeof Int32Array>"u"?e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":C&&x?x(x([][Symbol.iterator]())):e,"%JSON%":typeof JSON=="object"?JSON:e,"%Map%":typeof Map>"u"?e:Map,"%MapIteratorPrototype%":typeof Map>"u"||!C||!x?e:x(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":w,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?e:Promise,"%Proxy%":typeof Proxy>"u"?e:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?e:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?e:Set,"%SetIteratorPrototype%":typeof Set>"u"||!C||!x?e:x(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":C&&x?x(""[Symbol.iterator]()):e,"%Symbol%":C?Symbol:e,"%SyntaxError%":o,"%ThrowTypeError%":y,"%TypedArray%":L,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?e:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?e:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?e:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?e:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?e:WeakMap,"%WeakRef%":typeof WeakRef>"u"?e:WeakRef,"%WeakSet%":typeof WeakSet>"u"?e:WeakSet,"%Function.prototype.call%":U,"%Function.prototype.apply%":k,"%Object.defineProperty%":v,"%Object.getPrototypeOf%":F,"%Math.abs%":h,"%Math.floor%":c,"%Math.max%":u,"%Math.min%":d,"%Math.pow%":f,"%Math.round%":p,"%Math.sign%":g,"%Reflect.getPrototypeOf%":G};if(x)try{null.error}catch(it){var W=x(x(it));R["%Error.prototype%"]=W}var T=function it(z){var tt;if(z==="%AsyncFunction%")tt=_("async function () {}");else if(z==="%GeneratorFunction%")tt=_("function* () {}");else if(z==="%AsyncGeneratorFunction%")tt=_("async function* () {}");else if(z==="%AsyncGenerator%"){var nt=it("%AsyncGeneratorFunction%");nt&&(tt=nt.prototype)}else if(z==="%AsyncIteratorPrototype%"){var ut=it("%AsyncGenerator%");ut&&x&&(tt=x(ut.prototype))}return R[z]=tt,tt},A={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=kn(),P=Xd(),S=b.call(U,Array.prototype.concat),M=b.call(k,Array.prototype.splice),B=b.call(U,String.prototype.replace),D=b.call(U,String.prototype.slice),H=b.call(U,RegExp.prototype.exec),V=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,K=function(z){var tt=D(z,0,1),nt=D(z,-1);if(tt==="%"&&nt!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(nt==="%"&&tt!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var ut=[];return B(z,V,function(gt,et,st,Rt){ut[ut.length]=st?B(Rt,Y,"$1"):et||gt}),ut},J=function(z,tt){var nt=z,ut;if(P(A,nt)&&(ut=A[nt],nt="%"+ut[0]+"%"),P(R,nt)){var gt=R[nt];if(gt===I&&(gt=T(nt)),typeof gt>"u"&&!tt)throw new a("intrinsic "+z+" exists, but is not available. Please file an issue!");return{alias:ut,name:nt,value:gt}}throw new o("intrinsic "+z+" does not exist!")};return qs=function(z,tt){if(typeof z!="string"||z.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof tt!="boolean")throw new a('"allowMissing" argument must be a boolean');if(H(/^%?[^%]*%?$/,z)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var nt=K(z),ut=nt.length>0?nt[0]:"",gt=J("%"+ut+"%",tt),et=gt.name,st=gt.value,Rt=!1,Dt=gt.alias;Dt&&(ut=Dt[0],M(nt,S([0,1],Dt)));for(var Rr=1,qe=!0;Rr<nt.length;Rr+=1){var me=nt[Rr],Mr=D(me,0,1),Pr=D(me,-1);if((Mr==='"'||Mr==="'"||Mr==="`"||Pr==='"'||Pr==="'"||Pr==="`")&&Mr!==Pr)throw new o("property names with quotes must have matching quotes");if((me==="constructor"||!qe)&&(Rt=!0),ut+="."+me,et="%"+ut+"%",P(R,et))st=R[et];else if(st!=null){if(!(me in st)){if(!tt)throw new a("base intrinsic for "+z+" exists, but the property is not available.");return}if(w&&Rr+1>=nt.length){var Fr=w(st,me);qe=!!Fr,qe&&"get"in Fr&&!("originalValue"in Fr.get)?st=Fr.get:st=st[me]}else qe=P(st,me),st=st[me];qe&&!Rt&&(R[et]=st)}}return st},qs}var Ys,uh;function Pc(){if(uh)return Ys;uh=1;var e=ca(),t=Mc(),r=t([e("%String.prototype.indexOf%")]);return Ys=function(n,s){var o=e(n,!!s);return typeof o=="function"&&r(n,".prototype.")>-1?t([o]):o},Ys}var Ks,dh;function Fc(){if(dh)return Ks;dh=1;var e=ca(),t=Pc(),r=Gn(),i=Qr(),n=e("%Map%",!0),s=t("Map.prototype.get",!0),o=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),l=t("Map.prototype.delete",!0),h=t("Map.prototype.size",!0);return Ks=!!n&&function(){var u,d={assert:function(f){if(!d.has(f))throw new i("Side channel does not contain "+r(f))},delete:function(f){if(u){var p=l(u,f);return h(u)===0&&(u=void 0),p}return!1},get:function(f){if(u)return s(u,f)},has:function(f){return u?a(u,f):!1},set:function(f,p){u||(u=new n),o(u,f,p)}};return d},Ks}var Qs,fh;function jd(){if(fh)return Qs;fh=1;var e=ca(),t=Pc(),r=Gn(),i=Fc(),n=Qr(),s=e("%WeakMap%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),l=t("WeakMap.prototype.has",!0),h=t("WeakMap.prototype.delete",!0);return Qs=s?function(){var u,d,f={assert:function(p){if(!f.has(p))throw new n("Side channel does not contain "+r(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(u)return h(u,p)}else if(i&&d)return d.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&u?o(u,p):d&&d.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&u?l(u,p):!!d&&d.has(p)},set:function(p,g){s&&p&&(typeof p=="object"||typeof p=="function")?(u||(u=new s),a(u,p,g)):i&&(d||(d=i()),d.set(p,g))}};return f}:i,Qs}var Js,ph;function Wd(){if(ph)return Js;ph=1;var e=Qr(),t=Gn(),r=xd(),i=Fc(),n=jd(),s=n||i||r;return Js=function(){var a,l={assert:function(h){if(!l.has(h))throw new e("Side channel does not contain "+t(h))},delete:function(h){return!!a&&a.delete(h)},get:function(h){return a&&a.get(h)},has:function(h){return!!a&&a.has(h)},set:function(h,c){a||(a=s()),a.set(h,c)}};return l},Js}var Zs,mh;function ua(){if(mh)return Zs;mh=1;var e=String.prototype.replace,t=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Zs={default:r.RFC3986,formatters:{RFC1738:function(i){return e.call(i,t,"+")},RFC3986:function(i){return String(i)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},Zs}var to,gh;function Dc(){if(gh)return to;gh=1;var e=ua(),t=Object.prototype.hasOwnProperty,r=Array.isArray,i=function(){for(var m=[],_=0;_<256;++_)m.push("%"+((_<16?"0":"")+_.toString(16)).toUpperCase());return m}(),n=function(_){for(;_.length>1;){var w=_.pop(),v=w.obj[w.prop];if(r(v)){for(var E=[],y=0;y<v.length;++y)typeof v[y]<"u"&&E.push(v[y]);w.obj[w.prop]=E}}},s=function(_,w){for(var v=w&&w.plainObjects?{__proto__:null}:{},E=0;E<_.length;++E)typeof _[E]<"u"&&(v[E]=_[E]);return v},o=function m(_,w,v){if(!w)return _;if(typeof w!="object"&&typeof w!="function"){if(r(_))_.push(w);else if(_&&typeof _=="object")(v&&(v.plainObjects||v.allowPrototypes)||!t.call(Object.prototype,w))&&(_[w]=!0);else return[_,w];return _}if(!_||typeof _!="object")return[_].concat(w);var E=_;return r(_)&&!r(w)&&(E=s(_,v)),r(_)&&r(w)?(w.forEach(function(y,C){if(t.call(_,C)){var x=_[C];x&&typeof x=="object"&&y&&typeof y=="object"?_[C]=m(x,y,v):_.push(y)}else _[C]=y}),_):Object.keys(w).reduce(function(y,C){var x=w[C];return t.call(y,C)?y[C]=m(y[C],x,v):y[C]=x,y},E)},a=function(_,w){return Object.keys(w).reduce(function(v,E){return v[E]=w[E],v},_)},l=function(m,_,w){var v=m.replace(/\+/g," ");if(w==="iso-8859-1")return v.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(v)}catch{return v}},h=1024,c=function(_,w,v,E,y){if(_.length===0)return _;var C=_;if(typeof _=="symbol"?C=Symbol.prototype.toString.call(_):typeof _!="string"&&(C=String(_)),v==="iso-8859-1")return escape(C).replace(/%u[0-9a-f]{4}/gi,function(L){return"%26%23"+parseInt(L.slice(2),16)+"%3B"});for(var x="",F=0;F<C.length;F+=h){for(var G=C.length>=h?C.slice(F,F+h):C,k=[],U=0;U<G.length;++U){var I=G.charCodeAt(U);if(I===45||I===46||I===95||I===126||I>=48&&I<=57||I>=65&&I<=90||I>=97&&I<=122||y===e.RFC1738&&(I===40||I===41)){k[k.length]=G.charAt(U);continue}if(I<128){k[k.length]=i[I];continue}if(I<2048){k[k.length]=i[192|I>>6]+i[128|I&63];continue}if(I<55296||I>=57344){k[k.length]=i[224|I>>12]+i[128|I>>6&63]+i[128|I&63];continue}U+=1,I=65536+((I&1023)<<10|G.charCodeAt(U)&1023),k[k.length]=i[240|I>>18]+i[128|I>>12&63]+i[128|I>>6&63]+i[128|I&63]}x+=k.join("")}return x},u=function(_){for(var w=[{obj:{o:_},prop:"o"}],v=[],E=0;E<w.length;++E)for(var y=w[E],C=y.obj[y.prop],x=Object.keys(C),F=0;F<x.length;++F){var G=x[F],k=C[G];typeof k=="object"&&k!==null&&v.indexOf(k)===-1&&(w.push({obj:C,prop:G}),v.push(k))}return n(w),_},d=function(_){return Object.prototype.toString.call(_)==="[object RegExp]"},f=function(_){return!_||typeof _!="object"?!1:!!(_.constructor&&_.constructor.isBuffer&&_.constructor.isBuffer(_))},p=function(_,w){return[].concat(_,w)},g=function(_,w){if(r(_)){for(var v=[],E=0;E<_.length;E+=1)v.push(w(_[E]));return v}return w(_)};return to={arrayToObject:s,assign:a,combine:p,compact:u,decode:l,encode:c,isBuffer:f,isRegExp:d,maybeMap:g,merge:o},to}var eo,_h;function $d(){if(_h)return eo;_h=1;var e=Wd(),t=Dc(),r=ua(),i=Object.prototype.hasOwnProperty,n={brackets:function(m){return m+"[]"},comma:"comma",indices:function(m,_){return m+"["+_+"]"},repeat:function(m){return m}},s=Array.isArray,o=Array.prototype.push,a=function(g,m){o.apply(g,s(m)?m:[m])},l=Date.prototype.toISOString,h=r.default,c={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:h,formatter:r.formatters[h],indices:!1,serializeDate:function(m){return l.call(m)},skipNulls:!1,strictNullHandling:!1},u=function(m){return typeof m=="string"||typeof m=="number"||typeof m=="boolean"||typeof m=="symbol"||typeof m=="bigint"},d={},f=function g(m,_,w,v,E,y,C,x,F,G,k,U,I,L,R,W,T,A){for(var b=m,P=A,S=0,M=!1;(P=P.get(d))!==void 0&&!M;){var B=P.get(m);if(S+=1,typeof B<"u"){if(B===S)throw new RangeError("Cyclic object value");M=!0}typeof P.get(d)>"u"&&(S=0)}if(typeof G=="function"?b=G(_,b):b instanceof Date?b=I(b):w==="comma"&&s(b)&&(b=t.maybeMap(b,function(et){return et instanceof Date?I(et):et})),b===null){if(y)return F&&!W?F(_,c.encoder,T,"key",L):_;b=""}if(u(b)||t.isBuffer(b)){if(F){var D=W?_:F(_,c.encoder,T,"key",L);return[R(D)+"="+R(F(b,c.encoder,T,"value",L))]}return[R(_)+"="+R(String(b))]}var H=[];if(typeof b>"u")return H;var V;if(w==="comma"&&s(b))W&&F&&(b=t.maybeMap(b,F)),V=[{value:b.length>0?b.join(",")||null:void 0}];else if(s(G))V=G;else{var Y=Object.keys(b);V=k?Y.sort(k):Y}var K=x?String(_).replace(/\./g,"%2E"):String(_),J=v&&s(b)&&b.length===1?K+"[]":K;if(E&&s(b)&&b.length===0)return J+"[]";for(var it=0;it<V.length;++it){var z=V[it],tt=typeof z=="object"&&z&&typeof z.value<"u"?z.value:b[z];if(!(C&&tt===null)){var nt=U&&x?String(z).replace(/\./g,"%2E"):String(z),ut=s(b)?typeof w=="function"?w(J,nt):J:J+(U?"."+nt:"["+nt+"]");A.set(m,S);var gt=e();gt.set(d,A),a(H,g(tt,ut,w,v,E,y,C,x,w==="comma"&&W&&s(b)?null:F,G,k,U,I,L,R,W,T,gt))}}return H},p=function(m){if(!m)return c;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.encodeDotInKeys<"u"&&typeof m.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(m.encoder!==null&&typeof m.encoder<"u"&&typeof m.encoder!="function")throw new TypeError("Encoder has to be a function.");var _=m.charset||c.charset;if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var w=r.default;if(typeof m.format<"u"){if(!i.call(r.formatters,m.format))throw new TypeError("Unknown format option provided.");w=m.format}var v=r.formatters[w],E=c.filter;(typeof m.filter=="function"||s(m.filter))&&(E=m.filter);var y;if(m.arrayFormat in n?y=m.arrayFormat:"indices"in m?y=m.indices?"indices":"repeat":y=c.arrayFormat,"commaRoundTrip"in m&&typeof m.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var C=typeof m.allowDots>"u"?m.encodeDotInKeys===!0?!0:c.allowDots:!!m.allowDots;return{addQueryPrefix:typeof m.addQueryPrefix=="boolean"?m.addQueryPrefix:c.addQueryPrefix,allowDots:C,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:c.allowEmptyArrays,arrayFormat:y,charset:_,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:c.charsetSentinel,commaRoundTrip:!!m.commaRoundTrip,delimiter:typeof m.delimiter>"u"?c.delimiter:m.delimiter,encode:typeof m.encode=="boolean"?m.encode:c.encode,encodeDotInKeys:typeof m.encodeDotInKeys=="boolean"?m.encodeDotInKeys:c.encodeDotInKeys,encoder:typeof m.encoder=="function"?m.encoder:c.encoder,encodeValuesOnly:typeof m.encodeValuesOnly=="boolean"?m.encodeValuesOnly:c.encodeValuesOnly,filter:E,format:w,formatter:v,serializeDate:typeof m.serializeDate=="function"?m.serializeDate:c.serializeDate,skipNulls:typeof m.skipNulls=="boolean"?m.skipNulls:c.skipNulls,sort:typeof m.sort=="function"?m.sort:null,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:c.strictNullHandling}};return eo=function(g,m){var _=g,w=p(m),v,E;typeof w.filter=="function"?(E=w.filter,_=E("",_)):s(w.filter)&&(E=w.filter,v=E);var y=[];if(typeof _!="object"||_===null)return"";var C=n[w.arrayFormat],x=C==="comma"&&w.commaRoundTrip;v||(v=Object.keys(_)),w.sort&&v.sort(w.sort);for(var F=e(),G=0;G<v.length;++G){var k=v[G],U=_[k];w.skipNulls&&U===null||a(y,f(U,k,C,x,w.allowEmptyArrays,w.strictNullHandling,w.skipNulls,w.encodeDotInKeys,w.encode?w.encoder:null,w.filter,w.sort,w.allowDots,w.serializeDate,w.format,w.formatter,w.encodeValuesOnly,w.charset,F))}var I=y.join(w.delimiter),L=w.addQueryPrefix===!0?"?":"";return w.charsetSentinel&&(w.charset==="iso-8859-1"?L+="utf8=%26%2310003%3B&":L+="utf8=%E2%9C%93&"),I.length>0?L+I:""},eo}var ro,vh;function qd(){if(vh)return ro;vh=1;var e=Dc(),t=Object.prototype.hasOwnProperty,r=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(d){return d.replace(/&#(\d+);/g,function(f,p){return String.fromCharCode(parseInt(p,10))})},s=function(d,f,p){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&p>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",l=function(f,p){var g={__proto__:null},m=p.ignoreQueryPrefix?f.replace(/^\?/,""):f;m=m.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var _=p.parameterLimit===1/0?void 0:p.parameterLimit,w=m.split(p.delimiter,p.throwOnLimitExceeded?_+1:_);if(p.throwOnLimitExceeded&&w.length>_)throw new RangeError("Parameter limit exceeded. Only "+_+" parameter"+(_===1?"":"s")+" allowed.");var v=-1,E,y=p.charset;if(p.charsetSentinel)for(E=0;E<w.length;++E)w[E].indexOf("utf8=")===0&&(w[E]===a?y="utf-8":w[E]===o&&(y="iso-8859-1"),v=E,E=w.length);for(E=0;E<w.length;++E)if(E!==v){var C=w[E],x=C.indexOf("]="),F=x===-1?C.indexOf("="):x+1,G,k;F===-1?(G=p.decoder(C,i.decoder,y,"key"),k=p.strictNullHandling?null:""):(G=p.decoder(C.slice(0,F),i.decoder,y,"key"),k=e.maybeMap(s(C.slice(F+1),p,r(g[G])?g[G].length:0),function(I){return p.decoder(I,i.decoder,y,"value")})),k&&p.interpretNumericEntities&&y==="iso-8859-1"&&(k=n(String(k))),C.indexOf("[]=")>-1&&(k=r(k)?[k]:k);var U=t.call(g,G);U&&p.duplicates==="combine"?g[G]=e.combine(g[G],k):(!U||p.duplicates==="last")&&(g[G]=k)}return g},h=function(d,f,p,g){var m=0;if(d.length>0&&d[d.length-1]==="[]"){var _=d.slice(0,-1).join("");m=Array.isArray(f)&&f[_]?f[_].length:0}for(var w=g?f:s(f,p,m),v=d.length-1;v>=0;--v){var E,y=d[v];if(y==="[]"&&p.parseArrays)E=p.allowEmptyArrays&&(w===""||p.strictNullHandling&&w===null)?[]:e.combine([],w);else{E=p.plainObjects?{__proto__:null}:{};var C=y.charAt(0)==="["&&y.charAt(y.length-1)==="]"?y.slice(1,-1):y,x=p.decodeDotInKeys?C.replace(/%2E/g,"."):C,F=parseInt(x,10);!p.parseArrays&&x===""?E={0:w}:!isNaN(F)&&y!==x&&String(F)===x&&F>=0&&p.parseArrays&&F<=p.arrayLimit?(E=[],E[F]=w):x!=="__proto__"&&(E[x]=w)}w=E}return w},c=function(f,p,g,m){if(f){var _=g.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,w=/(\[[^[\]]*])/,v=/(\[[^[\]]*])/g,E=g.depth>0&&w.exec(_),y=E?_.slice(0,E.index):_,C=[];if(y){if(!g.plainObjects&&t.call(Object.prototype,y)&&!g.allowPrototypes)return;C.push(y)}for(var x=0;g.depth>0&&(E=v.exec(_))!==null&&x<g.depth;){if(x+=1,!g.plainObjects&&t.call(Object.prototype,E[1].slice(1,-1))&&!g.allowPrototypes)return;C.push(E[1])}if(E){if(g.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+g.depth+" and strictDepth is true");C.push("["+_.slice(E.index)+"]")}return h(C,p,g,m)}},u=function(f){if(!f)return i;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof f.charset>"u"?i.charset:f.charset,g=typeof f.duplicates>"u"?i.duplicates:f.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var m=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:i.allowDots:!!f.allowDots;return{allowDots:m,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:i.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:i.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:i.arrayLimit,charset:p,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:i.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:i.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:i.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:i.decoder,delimiter:typeof f.delimiter=="string"||e.isRegExp(f.delimiter)?f.delimiter:i.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:i.depth,duplicates:g,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:i.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:i.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:i.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:i.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return ro=function(d,f){var p=u(f);if(d===""||d===null||typeof d>"u")return p.plainObjects?{__proto__:null}:{};for(var g=typeof d=="string"?l(d,p):d,m=p.plainObjects?{__proto__:null}:{},_=Object.keys(g),w=0;w<_.length;++w){var v=_[w],E=c(v,g[v],p,typeof d=="string");m=e.merge(m,E,p)}return p.allowSparse===!0?m:e.compact(m)},ro}var io,yh;function Yd(){if(yh)return io;yh=1;var e=$d(),t=qd(),r=ua();return io={formats:r,parse:t,stringify:e},io}var xh;function Kd(){if(xh)return ur;xh=1;var e=gd();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),l=["%","/","?",";","#"].concat(a),h=["/","?","#"],c=255,u=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=Yd();function _(y,C,x){if(y&&typeof y=="object"&&y instanceof t)return y;var F=new t;return F.parse(y,C,x),F}t.prototype.parse=function(y,C,x){if(typeof y!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof y);var F=y.indexOf("?"),G=F!==-1&&F<y.indexOf("#")?"?":"#",k=y.split(G),U=/\\/g;k[0]=k[0].replace(U,"/"),y=k.join(G);var I=y;if(I=I.trim(),!x&&y.split("#").length===1){var L=n.exec(I);if(L)return this.path=I,this.href=I,this.pathname=L[1],L[2]?(this.search=L[2],C?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):C&&(this.search="",this.query={}),this}var R=r.exec(I);if(R){R=R[0];var W=R.toLowerCase();this.protocol=W,I=I.substr(R.length)}if(x||R||I.match(/^\/\/[^@/]+@[^@/]+/)){var T=I.substr(0,2)==="//";T&&!(R&&p[R])&&(I=I.substr(2),this.slashes=!0)}if(!p[R]&&(T||R&&!g[R])){for(var A=-1,b=0;b<h.length;b++){var P=I.indexOf(h[b]);P!==-1&&(A===-1||P<A)&&(A=P)}var S,M;A===-1?M=I.lastIndexOf("@"):M=I.lastIndexOf("@",A),M!==-1&&(S=I.slice(0,M),I=I.slice(M+1),this.auth=decodeURIComponent(S)),A=-1;for(var b=0;b<l.length;b++){var P=I.indexOf(l[b]);P!==-1&&(A===-1||P<A)&&(A=P)}A===-1&&(A=I.length),this.host=I.slice(0,A),I=I.slice(A),this.parseHost(),this.hostname=this.hostname||"";var B=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!B)for(var D=this.hostname.split(/\./),b=0,H=D.length;b<H;b++){var V=D[b];if(V&&!V.match(u)){for(var Y="",K=0,J=V.length;K<J;K++)V.charCodeAt(K)>127?Y+="x":Y+=V[K];if(!Y.match(u)){var it=D.slice(0,b),z=D.slice(b+1),tt=V.match(d);tt&&(it.push(tt[1]),z.unshift(tt[2])),z.length&&(I="/"+z.join(".")+I),this.hostname=it.join(".");break}}}this.hostname.length>c?this.hostname="":this.hostname=this.hostname.toLowerCase(),B||(this.hostname=e.toASCII(this.hostname));var nt=this.port?":"+this.port:"",ut=this.hostname||"";this.host=ut+nt,this.href+=this.host,B&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!f[W])for(var b=0,H=a.length;b<H;b++){var gt=a[b];if(I.indexOf(gt)!==-1){var et=encodeURIComponent(gt);et===gt&&(et=escape(gt)),I=I.split(gt).join(et)}}var st=I.indexOf("#");st!==-1&&(this.hash=I.substr(st),I=I.slice(0,st));var Rt=I.indexOf("?");if(Rt!==-1?(this.search=I.substr(Rt),this.query=I.substr(Rt+1),C&&(this.query=m.parse(this.query)),I=I.slice(0,Rt)):C&&(this.search="",this.query={}),I&&(this.pathname=I),g[W]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var nt=this.pathname||"",Dt=this.search||"";this.path=nt+Dt}return this.href=this.format(),this};function w(y){return typeof y=="string"&&(y=_(y)),y instanceof t?y.format():t.prototype.format.call(y)}t.prototype.format=function(){var y=this.auth||"";y&&(y=encodeURIComponent(y),y=y.replace(/%3A/i,":"),y+="@");var C=this.protocol||"",x=this.pathname||"",F=this.hash||"",G=!1,k="";this.host?G=y+this.host:this.hostname&&(G=y+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(G+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(k=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var U=this.search||k&&"?"+k||"";return C&&C.substr(-1)!==":"&&(C+=":"),this.slashes||(!C||g[C])&&G!==!1?(G="//"+(G||""),x&&x.charAt(0)!=="/"&&(x="/"+x)):G||(G=""),F&&F.charAt(0)!=="#"&&(F="#"+F),U&&U.charAt(0)!=="?"&&(U="?"+U),x=x.replace(/[?#]/g,function(I){return encodeURIComponent(I)}),U=U.replace("#","%23"),C+G+x+U+F};function v(y,C){return _(y,!1,!0).resolve(C)}t.prototype.resolve=function(y){return this.resolveObject(_(y,!1,!0)).format()};function E(y,C){return y?_(y,!1,!0).resolveObject(C):C}return t.prototype.resolveObject=function(y){if(typeof y=="string"){var C=new t;C.parse(y,!1,!0),y=C}for(var x=new t,F=Object.keys(this),G=0;G<F.length;G++){var k=F[G];x[k]=this[k]}if(x.hash=y.hash,y.href==="")return x.href=x.format(),x;if(y.slashes&&!y.protocol){for(var U=Object.keys(y),I=0;I<U.length;I++){var L=U[I];L!=="protocol"&&(x[L]=y[L])}return g[x.protocol]&&x.hostname&&!x.pathname&&(x.pathname="/",x.path=x.pathname),x.href=x.format(),x}if(y.protocol&&y.protocol!==x.protocol){if(!g[y.protocol]){for(var R=Object.keys(y),W=0;W<R.length;W++){var T=R[W];x[T]=y[T]}return x.href=x.format(),x}if(x.protocol=y.protocol,!y.host&&!p[y.protocol]){for(var H=(y.pathname||"").split("/");H.length&&!(y.host=H.shift()););y.host||(y.host=""),y.hostname||(y.hostname=""),H[0]!==""&&H.unshift(""),H.length<2&&H.unshift(""),x.pathname=H.join("/")}else x.pathname=y.pathname;if(x.search=y.search,x.query=y.query,x.host=y.host||"",x.auth=y.auth,x.hostname=y.hostname||y.host,x.port=y.port,x.pathname||x.search){var A=x.pathname||"",b=x.search||"";x.path=A+b}return x.slashes=x.slashes||y.slashes,x.href=x.format(),x}var P=x.pathname&&x.pathname.charAt(0)==="/",S=y.host||y.pathname&&y.pathname.charAt(0)==="/",M=S||P||x.host&&y.pathname,B=M,D=x.pathname&&x.pathname.split("/")||[],H=y.pathname&&y.pathname.split("/")||[],V=x.protocol&&!g[x.protocol];if(V&&(x.hostname="",x.port=null,x.host&&(D[0]===""?D[0]=x.host:D.unshift(x.host)),x.host="",y.protocol&&(y.hostname=null,y.port=null,y.host&&(H[0]===""?H[0]=y.host:H.unshift(y.host)),y.host=null),M=M&&(H[0]===""||D[0]==="")),S)x.host=y.host||y.host===""?y.host:x.host,x.hostname=y.hostname||y.hostname===""?y.hostname:x.hostname,x.search=y.search,x.query=y.query,D=H;else if(H.length)D||(D=[]),D.pop(),D=D.concat(H),x.search=y.search,x.query=y.query;else if(y.search!=null){if(V){x.host=D.shift(),x.hostname=x.host;var Y=x.host&&x.host.indexOf("@")>0?x.host.split("@"):!1;Y&&(x.auth=Y.shift(),x.hostname=Y.shift(),x.host=x.hostname)}return x.search=y.search,x.query=y.query,(x.pathname!==null||x.search!==null)&&(x.path=(x.pathname?x.pathname:"")+(x.search?x.search:"")),x.href=x.format(),x}if(!D.length)return x.pathname=null,x.search?x.path="/"+x.search:x.path=null,x.href=x.format(),x;for(var K=D.slice(-1)[0],J=(x.host||y.host||D.length>1)&&(K==="."||K==="..")||K==="",it=0,z=D.length;z>=0;z--)K=D[z],K==="."?D.splice(z,1):K===".."?(D.splice(z,1),it++):it&&(D.splice(z,1),it--);if(!M&&!B)for(;it--;it)D.unshift("..");M&&D[0]!==""&&(!D[0]||D[0].charAt(0)!=="/")&&D.unshift(""),J&&D.join("/").substr(-1)!=="/"&&D.push("");var tt=D[0]===""||D[0]&&D[0].charAt(0)==="/";if(V){x.hostname=tt?"":D.length?D.shift():"",x.host=x.hostname;var Y=x.host&&x.host.indexOf("@")>0?x.host.split("@"):!1;Y&&(x.auth=Y.shift(),x.hostname=Y.shift(),x.host=x.hostname)}return M=M||x.host&&D.length,M&&!tt&&D.unshift(""),D.length>0?x.pathname=D.join("/"):(x.pathname=null,x.path=null),(x.pathname!==null||x.search!==null)&&(x.path=(x.pathname?x.pathname:"")+(x.search?x.search:"")),x.auth=y.auth||x.auth,x.slashes=x.slashes||y.slashes,x.href=x.format(),x},t.prototype.parseHost=function(){var y=this.host,C=i.exec(y);C&&(C=C[0],C!==":"&&(this.port=C.substr(1)),y=y.substr(0,y.length-C.length)),y&&(this.hostname=y)},ur.parse=_,ur.resolve=v,ur.resolveObject=E,ur.format=w,ur.Url=t,ur}var no=Kd();const Nc={parse:no.parse,format:no.format,resolve:no.resolve};function _e(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function ii(e){return e.split("?")[0].split("#")[0]}function Qd(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Jd(e,t,r){return e.replace(new RegExp(Qd(t),"g"),r)}function Zd(e,t){let r="",i=0,n=-1,s=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(r.length<2||i!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const l=r.lastIndexOf("/");if(l!==r.length-1){l===-1?(r="",i=0):(r=r.slice(0,l),i=r.length-1-r.lastIndexOf("/")),n=a,s=0;continue}}else if(r.length===2||r.length===1){r="",i=0,n=a,s=0;continue}}}else r.length>0?r+=`/${e.slice(n+1,a)}`:r=e.slice(n+1,a),i=a-n-1;n=a,s=0}else o===46&&s!==-1?++s:s=-1}return r}const kt={toPosix(e){return Jd(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){_e(e),e=this.toPosix(e);let t="";const r=/^file:\/\/\//.exec(e),i=/^[^/:]+:\/\//.exec(e),n=/^[^/:]+:\//.exec(e);if(r||i||n){const s=(r==null?void 0:r[0])||(i==null?void 0:i[0])||(n==null?void 0:n[0]);t=s,e=e.slice(s.length)}return t},toAbsolute(e,t,r){if(this.isDataUrl(e))return e;const i=ii(this.toPosix(t??j.ADAPTER.getBaseUrl())),n=ii(this.toPosix(r??this.rootname(i)));return _e(e),e=this.toPosix(e),e.startsWith("/")?kt.join(n,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(e=this.toPosix(e),_e(e),e.length===0)return".";let t="";const r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith("/");return e=Zd(e),e.length>0&&i&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return _e(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let r=0;r<e.length;++r){const i=e[r];if(_e(i),i.length>0)if(t===void 0)t=i;else{const n=e[r-1]??"";this.extname(n)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(_e(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const r=t===47;let i=-1,n=!0;const s=this.getProtocol(e),o=e;e=e.slice(s.length);for(let a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?r?"/":this.isUrl(o)?s+e:s:r&&i===1?"//":s+e.slice(0,i)},rootname(e){_e(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const r=e.indexOf("/",t.length);r!==-1?t=e.slice(0,r):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){_e(e),t&&_e(t),e=ii(this.toPosix(e));let r=0,i=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(s=e.length-1;s>=0;--s){const l=e.charCodeAt(s);if(l===47){if(!n){r=s+1;break}}else a===-1&&(n=!1,a=s+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(i=s):(o=-1,i=a))}return r===i?i=a:i===-1&&(i=e.length),e.slice(r,i)}for(s=e.length-1;s>=0;--s)if(e.charCodeAt(s)===47){if(!n){r=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":e.slice(r,i)},extname(e){_e(e),e=ii(this.toPosix(e));let t=-1,r=0,i=-1,n=!0,s=0;for(let o=e.length-1;o>=0;--o){const a=e.charCodeAt(o);if(a===47){if(!n){r=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===r+1?"":e.slice(t,i)},parse(e){_e(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=ii(this.toPosix(e));let r=e.charCodeAt(0);const i=this.isAbsolute(e);let n;t.root=this.rootname(e),i||this.hasProtocol(e)?n=1:n=0;let s=-1,o=0,a=-1,l=!0,h=e.length-1,c=0;for(;h>=n;--h){if(r=e.charCodeAt(h),r===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),r===46?s===-1?s=h:c!==1&&(c=1):s!==-1&&(c=-1)}return s===-1||a===-1||c===0||c===1&&s===a-1&&s===o+1?a!==-1&&(o===0&&i?t.base=t.name=e.slice(1,a):t.base=t.name=e.slice(o,a)):(o===0&&i?(t.name=e.slice(1,s),t.base=e.slice(1,a)):(t.name=e.slice(o,s),t.base=e.slice(o,a)),t.ext=e.slice(s,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},bh={};function dt(e,t,r=3){if(bh[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),bh[t]=!0}function tf(){dt("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function ef(){dt("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let so;function Bc(){return typeof so>"u"&&(so=function(){var r;const t={stencil:!0,failIfMajorPerformanceCaveat:j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!j.ADAPTER.getWebGLRenderingContext())return!1;const i=j.ADAPTER.createCanvas();let n=i.getContext("webgl",t)||i.getContext("experimental-webgl",t);const s=!!((r=n==null?void 0:n.getContextAttributes())!=null&&r.stencil);if(n){const o=n.getExtension("WEBGL_lose_context");o&&o.loseContext()}return n=null,s}catch{return!1}}()),so}var rf={grad:.9,turn:360,rad:360/(2*Math.PI)},Oe=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},Bt=function(e,t,r){return t===void 0&&(t=0),r===void 0&&(r=Math.pow(10,t)),Math.round(r*e)/r+0},ue=function(e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),e>r?r:e>t?e:t},Oc=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},Th=function(e){return{r:ue(e.r,0,255),g:ue(e.g,0,255),b:ue(e.b,0,255),a:ue(e.a)}},oo=function(e){return{r:Bt(e.r),g:Bt(e.g),b:Bt(e.b),a:Bt(e.a,3)}},nf=/^#([0-9a-f]{3,8})$/i,ki=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Lc=function(e){var t=e.r,r=e.g,i=e.b,n=e.a,s=Math.max(t,r,i),o=s-Math.min(t,r,i),a=o?s===t?(r-i)/o:s===r?2+(i-t)/o:4+(t-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},Uc=function(e){var t=e.h,r=e.s,i=e.v,n=e.a;t=t/360*6,r/=100,i/=100;var s=Math.floor(t),o=i*(1-r),a=i*(1-(t-s)*r),l=i*(1-(1-t+s)*r),h=s%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:n}},wh=function(e){return{h:Oc(e.h),s:ue(e.s,0,100),l:ue(e.l,0,100),a:ue(e.a)}},Ah=function(e){return{h:Bt(e.h),s:Bt(e.s),l:Bt(e.l),a:Bt(e.a,3)}},Eh=function(e){return Uc((r=(t=e).s,{h:t.h,s:(r*=((i=t.l)<50?i:100-i)/100)>0?2*r/(i+r)*100:0,v:i+r,a:t.a}));var t,r,i},gi=function(e){return{h:(t=Lc(e)).h,s:(n=(200-(r=t.s))*(i=t.v)/100)>0&&n<200?r*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,r,i,n},sf=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,of=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,af=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,lf=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Do={string:[[function(e){var t=nf.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?Bt(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?Bt(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=af.exec(e)||lf.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:Th({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=sf.exec(e)||of.exec(e);if(!t)return null;var r,i,n=wh({h:(r=t[1],i=t[2],i===void 0&&(i="deg"),Number(r)*(rf[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Eh(n)},"hsl"]],object:[[function(e){var t=e.r,r=e.g,i=e.b,n=e.a,s=n===void 0?1:n;return Oe(t)&&Oe(r)&&Oe(i)?Th({r:Number(t),g:Number(r),b:Number(i),a:Number(s)}):null},"rgb"],[function(e){var t=e.h,r=e.s,i=e.l,n=e.a,s=n===void 0?1:n;if(!Oe(t)||!Oe(r)||!Oe(i))return null;var o=wh({h:Number(t),s:Number(r),l:Number(i),a:Number(s)});return Eh(o)},"hsl"],[function(e){var t=e.h,r=e.s,i=e.v,n=e.a,s=n===void 0?1:n;if(!Oe(t)||!Oe(r)||!Oe(i))return null;var o=function(a){return{h:Oc(a.h),s:ue(a.s,0,100),v:ue(a.v,0,100),a:ue(a.a)}}({h:Number(t),s:Number(r),v:Number(i),a:Number(s)});return Uc(o)},"hsv"]]},Sh=function(e,t){for(var r=0;r<t.length;r++){var i=t[r][0](e);if(i)return[i,t[r][1]]}return[null,void 0]},hf=function(e){return typeof e=="string"?Sh(e.trim(),Do.string):typeof e=="object"&&e!==null?Sh(e,Do.object):[null,void 0]},ao=function(e,t){var r=gi(e);return{h:r.h,s:ue(r.s+100*t,0,100),l:r.l,a:r.a}},lo=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},Ch=function(e,t){var r=gi(e);return{h:r.h,s:r.s,l:ue(r.l+100*t,0,100),a:r.a}},No=function(){function e(t){this.parsed=hf(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return Bt(lo(this.rgba),2)},e.prototype.isDark=function(){return lo(this.rgba)<.5},e.prototype.isLight=function(){return lo(this.rgba)>=.5},e.prototype.toHex=function(){return t=oo(this.rgba),r=t.r,i=t.g,n=t.b,o=(s=t.a)<1?ki(Bt(255*s)):"","#"+ki(r)+ki(i)+ki(n)+o;var t,r,i,n,s,o},e.prototype.toRgb=function(){return oo(this.rgba)},e.prototype.toRgbString=function(){return t=oo(this.rgba),r=t.r,i=t.g,n=t.b,(s=t.a)<1?"rgba("+r+", "+i+", "+n+", "+s+")":"rgb("+r+", "+i+", "+n+")";var t,r,i,n,s},e.prototype.toHsl=function(){return Ah(gi(this.rgba))},e.prototype.toHslString=function(){return t=Ah(gi(this.rgba)),r=t.h,i=t.s,n=t.l,(s=t.a)<1?"hsla("+r+", "+i+"%, "+n+"%, "+s+")":"hsl("+r+", "+i+"%, "+n+"%)";var t,r,i,n,s},e.prototype.toHsv=function(){return t=Lc(this.rgba),{h:Bt(t.h),s:Bt(t.s),v:Bt(t.v),a:Bt(t.a,3)};var t},e.prototype.invert=function(){return Pe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Pe(ao(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Pe(ao(this.rgba,-t))},e.prototype.grayscale=function(){return Pe(ao(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Pe(Ch(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Pe(Ch(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Pe({r:(r=this.rgba).r,g:r.g,b:r.b,a:t}):Bt(this.rgba.a,3);var r},e.prototype.hue=function(t){var r=gi(this.rgba);return typeof t=="number"?Pe({h:t,s:r.s,l:r.l,a:r.a}):Bt(r.h)},e.prototype.isEqual=function(t){return this.toHex()===Pe(t).toHex()},e}(),Pe=function(e){return e instanceof No?e:new No(e)},Ih=[],cf=function(e){e.forEach(function(t){Ih.indexOf(t)<0&&(t(No,Do),Ih.push(t))})};function uf(e,t){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in r)i[r[n]]=n;var s={};e.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=i[this.toHex()];if(h)return h;if(o!=null&&o.closest){var c=this.toRgb(),u=1/0,d="black";if(!s.length)for(var f in r)s[f]=new e(r[f]).toRgb();for(var p in r){var g=(a=c,l=s[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));g<u&&(u=g,d=p)}return d}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new e(l).toRgb():null},"name"])}cf([uf]);const Xr=class{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Xr)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((n,s)=>n===t[s]);if(e!==null&&t!==null){const n=Object.keys(e),s=Object.keys(t);return n.length!==s.length?!1:n.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,r,i]=this._components;return{r:e,g:t,b:r,a:i}}toRgb(){const[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){const[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){const[t,r,i]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(i*255),e}toRgbArray(e){e=e??[];const[t,r,i]=this._components;return e[0]=t,e[1]=r,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,r,i,n]=Xr.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return t&&(r=r*e+.5|0,i=i*e+.5|0,n=n*e+.5|0),(e*255<<24)+(r<<16)+(i<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,r,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,r,i,n]=this._components;return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}normalize(e){let t,r,i,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const s=e;t=(s>>16&255)/255,r=(s>>8&255)/255,i=(s&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,i,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,i,n=255]=e,t/=255,r/=255,i/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=Xr.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const s=Pe(e);s.isValid()&&({r:t,g:r,b:i,a:n}=s.rgba,t/=255,r/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=i,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((i,n)=>{e[n]=Math.min(Math.max(i,t),r)}),e)}};let vt=Xr;vt.shared=new Xr;vt.temp=new Xr;vt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function df(e,t=[]){return dt("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),vt.shared.setValue(e).toRgbArray(t)}function Gc(e){return dt("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),vt.shared.setValue(e).toHex()}function ff(e){return dt("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),vt.shared.setValue(e).toNumber()}function kc(e){return dt("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),vt.shared.setValue(e).toNumber()}function pf(){const e=[],t=[];for(let i=0;i<32;i++)e[i]=i,t[i]=i;e[at.NORMAL_NPM]=at.NORMAL,e[at.ADD_NPM]=at.ADD,e[at.SCREEN_NPM]=at.SCREEN,t[at.NORMAL]=at.NORMAL_NPM,t[at.ADD]=at.ADD_NPM,t[at.SCREEN]=at.SCREEN_NPM;const r=[];return r.push(t),r.push(e),r}const da=pf();function fa(e,t){return da[t?1:0][e]}function mf(e,t,r,i=!0){return dt("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),vt.shared.setValue(e).premultiply(t,i).toArray(r??new Float32Array(4))}function Hc(e,t){return dt("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),vt.shared.setValue(e).toPremultiplied(t)}function gf(e,t,r,i=!0){return dt("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),vt.shared.setValue(e).premultiply(t,i).toArray(r??new Float32Array(4))}const Vc=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function zc(e,t=null){const r=e*6;if(t=t||new Uint16Array(r),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let i=0,n=0;i<r;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function Hn(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}const _f={Float32Array,Uint32Array,Int32Array,Uint8Array};function vf(e,t){let r=0,i=0;const n={};for(let l=0;l<e.length;l++)i+=t[l],r+=e[l].length;const s=new ArrayBuffer(r*4);let o=null,a=0;for(let l=0;l<e.length;l++){const h=t[l],c=e[l],u=Hn(c);n[u]||(n[u]=new _f[u](s)),o=n[u];for(let d=0;d<c.length;d++){const f=(d/h|0)*i+a,p=d%h;o[f+p]=c[d]}a+=h}return new Float32Array(s)}function yi(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Bo(e){return!(e&e-1)&&!!e}function Oo(e){let t=(e>65535?1:0)<<4;e>>>=t;let r=(e>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,t|=r,t|e>>1}function Tr(e,t,r){const i=e.length;let n;if(t>=i||r===0)return;r=t+r>i?i-t:r;const s=i-r;for(n=t;n<s;++n)e[n]=e[n+r];e.length=s}function Ge(e){return e===0?0:e<0?-1:1}let yf=0;function nr(){return++yf}const Xc=class{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let _n=Xc;_n.EMPTY=new Xc(0,0,0,0);const Lo={},zt=Object.create(null),Qt=Object.create(null);function xf(){let e;for(e in zt)zt[e].destroy();for(e in Qt)Qt[e].destroy()}function bf(){let e;for(e in zt)delete zt[e];for(e in Qt)delete Qt[e]}class jc{constructor(t,r,i){this._canvas=j.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||j.RESOLUTION,this.resize(t,r)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,r){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(r*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Rh(e,t,r){for(let i=0,n=4*r*t;i<t;++i,n+=4)if(e[n+3]!==0)return!1;return!0}function Mh(e,t,r,i,n){const s=4*t;for(let o=i,a=i*s+4*r;o<=n;++o,a+=s)if(e[a+3]!==0)return!1;return!0}function Wc(e){const{width:t,height:r}=e,i=e.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,t,r).data;let o=0,a=0,l=t-1,h=r-1;for(;a<r&&Rh(s,t,a);)++a;if(a===r)return _n.EMPTY;for(;Rh(s,t,h);)--h;for(;Mh(s,t,o,a,h);)++o;for(;Mh(s,t,l,a,h);)--l;return++l,++h,new _n(o,a,l,h)}function $c(e){const t=Wc(e),{width:r,height:i}=t;let n=null;if(!t.isEmpty()){const s=e.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,r,i)}return{width:r,height:i,data:n}}function Tf(e){const t=Vc.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}let Hi;function qc(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Hi||(Hi=document.createElement("a")),Hi.href=e;const r=Nc.parse(Hi.href),i=!r.port&&t.port===""||r.port===t.port;return r.hostname!==t.hostname||!i||r.protocol!==t.protocol?"anonymous":""}function Xe(e,t=1){var i;const r=(i=j.RETINA_PREFIX)==null?void 0:i.exec(e);return r?parseFloat(r[1]):t}const wf=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:Qt,BoundingBox:_n,CanvasRenderTarget:jc,DATA_URI:Vc,EventEmitter:lr,ProgramCache:Lo,TextureCache:zt,clearTextureCache:bf,correctBlendMode:fa,createIndicesForQuads:zc,decomposeDataUri:Tf,deprecation:dt,destroyTextureCache:xf,determineCrossOrigin:qc,earcut:Ac,getBufferType:Hn,getCanvasBoundingBox:Wc,getResolutionOfUrl:Xe,hex2rgb:df,hex2string:Gc,interleaveTypedArrays:vf,isMobile:Se,isPow2:Bo,isWebGLSupported:Bc,log2:Oo,nextPow2:yi,path:kt,premultiplyBlendMode:da,premultiplyRgba:mf,premultiplyTint:Hc,premultiplyTintToRgba:gf,removeItems:Tr,rgb2hex:kc,sayHello:ef,sign:Ge,skipHello:tf,string2hex:ff,trimCanvas:$c,uid:nr,url:Nc},Symbol.toStringTag,{value:"Module"}));var q=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(q||{});const Uo=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Ph=(e,t)=>Uo(e).priority??t,rt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Uo).forEach(t=>{t.type.forEach(r=>{var i,n;return(n=(i=this._removeHandlers)[r])==null?void 0:n.call(i,t)})}),this},add(...e){return e.map(Uo).forEach(t=>{t.type.forEach(r=>{const i=this._addHandlers,n=this._queue;i[r]?i[r](t):(n[r]=n[r]||[],n[r].push(t))})}),this},handle(e,t,r){const i=this._addHandlers,n=this._removeHandlers;if(i[e]||n[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,n[e]=r;const s=this._queue;return s[e]&&(s[e].forEach(o=>t(o)),delete s[e]),this},handleByMap(e,t){return this.handle(e,r=>{t[r.name]=r.ref},r=>{delete t[r.name]})},handleByList(e,t,r=-1){return this.handle(e,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,s)=>Ph(s,r)-Ph(n,r)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})}};class vn{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Af=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Ef(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}function Yc(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=Af.replace(/%forloop%/gi,Ef(e));if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))e=e/2|0;else break}return e}const ho=0,co=1,uo=2,fo=3,po=4,mo=5;class $t{constructor(){this.data=0,this.blendMode=at.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ho)}set blend(t){!!(this.data&1<<ho)!==t&&(this.data^=1<<ho)}get offsets(){return!!(this.data&1<<co)}set offsets(t){!!(this.data&1<<co)!==t&&(this.data^=1<<co)}get culling(){return!!(this.data&1<<uo)}set culling(t){!!(this.data&1<<uo)!==t&&(this.data^=1<<uo)}get depthTest(){return!!(this.data&1<<fo)}set depthTest(t){!!(this.data&1<<fo)!==t&&(this.data^=1<<fo)}get depthMask(){return!!(this.data&1<<mo)}set depthMask(t){!!(this.data&1<<mo)!==t&&(this.data^=1<<mo)}get clockwiseFrontFace(){return!!(this.data&1<<po)}set clockwiseFrontFace(t){!!(this.data&1<<po)!==t&&(this.data^=1<<po)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==at.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new $t;return t.depthTest=!1,t.blend=!0,t}}const yn=[];function pa(e,t){if(!e)return null;let r="";if(typeof e=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);i&&(r=i[1].toLowerCase())}for(let i=yn.length-1;i>=0;--i){const n=yn[i];if(n.test&&n.test(e,r))return new n(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class re{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,r,i,n,s,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](t,r,i,n,s,o,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const r=this.items.indexOf(t);return r!==-1&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(re.prototype,{dispatch:{value:re.prototype.emit},run:{value:re.prototype.emit}});class Wr{constructor(t=0,r=0){this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new re("setRealSize"),this.onUpdate=new re("update"),this.onError=new re("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,r){(t!==this._width||r!==this._height)&&(this._width=t,this._height=r,this.onResize.emit(t,r))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,r,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,r){return!1}}let Jr=class extends Wr{constructor(t,r){const{width:i,height:n}=r||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t}upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===Vt.UNPACK);const s=r.realWidth,o=r.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(r.target,0,0,0,s,o,r.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(r.target,0,i.internalFormat,s,o,0,r.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}};const Sf={scaleMode:Zt.NEAREST,format:X.RGBA,alphaMode:Vt.NPM},Ur=class extends lr{constructor(e=null,t=null){super(),t=Object.assign({},Ur.defaultOptions,t);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:s,width:o,height:a,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:f}=t;e&&!(e instanceof Wr)&&(e=pa(e,f),e.internal=!0),this.resolution=d||j.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=s,this.format=h,this.type=c,this.target=u,this.alphaMode=r,this.uid=nr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Bo(this.realWidth)&&Bo(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Qt[this.cacheId],delete zt[this.cacheId],this.cacheId=null),this.dispose(),Ur.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,r=j.STRICT_TEXTURE_CACHE){const i=typeof e=="string";let n=null;if(i)n=e;else{if(!e._pixiId){const o=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${o}_${nr()}`}n=e._pixiId}let s=Qt[n];if(i&&r&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new Ur(e,t),s.cacheId=n,Ur.addToCache(s,n)),s}static fromBuffer(e,t,r,i){e=e||new Float32Array(t*r*4);const n=new Jr(e,{width:t,height:r}),s=e instanceof Float32Array?Q.FLOAT:Q.UNSIGNED_BYTE;return new Ur(n,Object.assign({},Sf,{type:s},i))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Qt[t]&&Qt[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Qt[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Qt[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete Qt[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Qt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let ht=Ur;ht.defaultOptions={mipmap:ne.POW2,anisotropicLevel:0,scaleMode:Zt.LINEAR,wrapMode:Wt.CLAMP,alphaMode:Vt.UNPACK,target:He.TEXTURE_2D,format:X.RGBA,type:Q.UNSIGNED_BYTE};ht._globalBatch=0;class xn{constructor(){this.texArray=null,this.blend=0,this.type=Jt.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Cf=0;class ot{constructor(t,r=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=r,this.id=Cf++,this.disposeRunner=new re("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Ie.ELEMENT_ARRAY_BUFFER:Ie.ARRAY_BUFFER}get index(){return this.type===Ie.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ot(t)}}class xi{constructor(t,r=0,i=!1,n=Q.FLOAT,s,o,a,l=1){this.buffer=t,this.size=r,this.normalized=i,this.type=n,this.stride=s,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(t,r,i,n,s){return new xi(t,r,i,n,s)}}const If={Float32Array,Uint32Array,Int32Array,Uint8Array};function Rf(e,t){let r=0,i=0;const n={};for(let l=0;l<e.length;l++)i+=t[l],r+=e[l].length;const s=new ArrayBuffer(r*4);let o=null,a=0;for(let l=0;l<e.length;l++){const h=t[l],c=e[l],u=Hn(c);n[u]||(n[u]=new If[u](s)),o=n[u];for(let d=0;d<c.length;d++){const f=(d/h|0)*i+a,p=d%h;o[f+p]=c[d]}a+=h}return new Float32Array(s)}const Fh={5126:4,5123:2,5121:1};let Mf=0;const Pf={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Me{constructor(t=[],r={}){this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=Mf++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new re("disposeGeometry"),this.refCount=0}addAttribute(t,r,i=0,n=!1,s,o,a,l=!1){if(!r)throw new Error("You must pass a buffer when creating an attribute");r instanceof ot||(r instanceof Array&&(r=new Float32Array(r)),r=new ot(r));const h=t.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],r,i,n,s);return this}let c=this.buffers.indexOf(r);return c===-1&&(this.buffers.push(r),c=this.buffers.length-1),this.attributes[t]=new xi(c,i,n,s,o,a,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ot||(t instanceof Array&&(t=new Uint16Array(t)),t=new ot(t)),t.type=Ie.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],r=[],i=new ot;let n;for(n in this.attributes){const s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),r.push(s.size*Fh[s.type]/4),s.buffer=0}for(i.data=Rf(t,r),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Me;for(let r=0;r<this.buffers.length;r++)t.buffers[r]=new ot(this.buffers[r].data.slice(0));for(const r in this.attributes){const i=this.attributes[r];t.attributes[r]=new xi(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ie.ELEMENT_ARRAY_BUFFER),t}static merge(t){const r=new Me,i=[],n=[],s=[];let o;for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)n[l]=n[l]||0,n[l]+=o.buffers[l].data.length,s[l]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new Pf[Hn(o.buffers[a].data)](n[a]),r.buffers[a]=new ot(i[a]);for(let a=0;a<t.length;a++){o=t[a];for(let l=0;l<o.buffers.length;l++)i[l].set(o.buffers[l].data,s[l]),s[l]+=o.buffers[l].data.length}if(r.attributes=o.attributes,o.indexBuffer){r.indexBuffer=r.buffers[o.buffers.indexOf(o.indexBuffer)],r.indexBuffer.type=Ie.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(l+=d.size*Fh[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)r.indexBuffer.data[f+h]+=a;a+=t[u].buffers[c].data.length/l,h+=d.length}}return r}}class Vn extends Me{constructor(t=!1){super(),this._buffer=new ot(null,t,!1),this._indexBuffer=new ot(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Q.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Q.FLOAT).addAttribute("aColor",this._buffer,4,!0,Q.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Q.FLOAT).addIndex(this._indexBuffer)}}const bi=Math.PI*2,Kc=180/Math.PI,Sr=Math.PI/180;var Ot=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(Ot||{});class _t{constructor(t=0,r=0){this.x=0,this.y=0,this.x=t,this.y=r}clone(){return new _t(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,r=t){return this.x=t,this.y=r,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Vi=[new _t,new _t,new _t,new _t];class pt{constructor(t=0,r=0,i=0,n=0){this.x=Number(t),this.y=Number(r),this.width=Number(i),this.height=Number(n),this.type=Ot.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new pt(0,0,0,0)}clone(){return new pt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,r){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(t,r){if(!r){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const k=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>k}const i=this.left,n=this.right,s=this.top,o=this.bottom;if(n<=i||o<=s)return!1;const a=Vi[0].set(t.left,t.top),l=Vi[1].set(t.left,t.bottom),h=Vi[2].set(t.right,t.top),c=Vi[3].set(t.right,t.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(r.a*r.d-r.b*r.c);if(u===0||(r.apply(a,a),r.apply(l,l),r.apply(h,h),r.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=i||Math.min(a.x,l.x,h.x,c.x)>=n||Math.max(a.y,l.y,h.y,c.y)<=s||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const d=u*(l.y-a.y),f=u*(a.x-l.x),p=d*i+f*s,g=d*n+f*s,m=d*i+f*o,_=d*n+f*o;if(Math.max(p,g,m,_)<=d*a.x+f*a.y||Math.min(p,g,m,_)>=d*c.x+f*c.y)return!1;const w=u*(a.y-h.y),v=u*(h.x-a.x),E=w*i+v*s,y=w*n+v*s,C=w*i+v*o,x=w*n+v*o;return!(Math.max(E,y,C,x)<=w*a.x+v*a.y||Math.min(E,y,C,x)>=w*c.x+v*c.y)}pad(t=0,r=t){return this.x-=t,this.y-=r,this.width+=t*2,this.height+=r*2,this}fit(t){const r=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(i-r,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,r=.001){const i=Math.ceil((this.x+this.width-r)*t)/t,n=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const r=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=i-r,this.y=n,this.height=s-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class zn{constructor(t=0,r=0,i=0){this.x=t,this.y=r,this.radius=i,this.type=Ot.CIRC}clone(){return new zn(this.x,this.y,this.radius)}contains(t,r){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-r;return n*=n,s*=s,n+s<=i}getBounds(){return new pt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Xn{constructor(t=0,r=0,i=0,n=0){this.x=t,this.y=r,this.width=i,this.height=n,this.type=Ot.ELIP}clone(){return new Xn(this.x,this.y,this.width,this.height)}contains(t,r){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(r-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new pt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class wr{constructor(...t){let r=Array.isArray(t[0])?t[0]:t;if(typeof r[0]!="number"){const i=[];for(let n=0,s=r.length;n<s;n++)i.push(r[n].x,r[n].y);r=i}this.points=r,this.type=Ot.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),r=new wr(t);return r.closeStroke=this.closeStroke,r}contains(t,r){let i=!1;const n=this.points.length/2;for(let s=0,o=n-1;s<n;o=s++){const a=this.points[s*2],l=this.points[s*2+1],h=this.points[o*2],c=this.points[o*2+1];l>r!=c>r&&t<(h-a)*((r-l)/(c-l))+a&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,r)=>`${t}, ${r}`,"")}]`}}class jn{constructor(t=0,r=0,i=0,n=0,s=20){this.x=t,this.y=r,this.width=i,this.height=n,this.radius=s,this.type=Ot.RREC}clone(){return new jn(this.x,this.y,this.width,this.height,this.radius)}contains(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+i&&r<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=r-(this.y+i);const o=i*i;if(n*n+s*s<=o||(n=t-(this.x+this.width-i),n*n+s*s<=o)||(s=r-(this.y+this.height-i),n*n+s*s<=o)||(n=t-(this.x+i),n*n+s*s<=o))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class wt{constructor(t=1,r=0,i=0,n=1,s=0,o=0){this.array=null,this.a=t,this.b=r,this.c=i,this.d=n,this.tx=s,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,r,i,n,s,o){return this.a=t,this.b=r,this.c=i,this.d=n,this.tx=s,this.ty=o,this}toArray(t,r){this.array||(this.array=new Float32Array(9));const i=r||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,r){r=r||new _t;const i=t.x,n=t.y;return r.x=this.a*i+this.c*n+this.tx,r.y=this.b*i+this.d*n+this.ty,r}applyInverse(t,r){r=r||new _t;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return r.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,r.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,r}translate(t,r){return this.tx+=t,this.ty+=r,this}scale(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this}rotate(t){const r=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*r-this.b*i,this.b=n*i+this.b*r,this.c=s*r-this.d*i,this.d=s*i+this.d*r,this.tx=o*r-this.ty*i,this.ty=o*i+this.ty*r,this}append(t){const r=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*r+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*r+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*r+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,r,i,n,s,o,a,l,h){return this.a=Math.cos(a+h)*s,this.b=Math.sin(a+h)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+n*this.c),this.ty=r-(i*this.b+n*this.d),this}prepend(t){const r=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this}decompose(t){const r=this.a,i=this.b,n=this.c,s=this.d,o=t.pivot,a=-Math.atan2(-n,s),l=Math.atan2(i,r),h=Math.abs(a+l);return h<1e-5||Math.abs(bi-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(r*r+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(o.x*r+o.y*n),t.position.y=this.ty+(o.x*i+o.y*s),t}invert(){const t=this.a,r=this.b,i=this.c,n=this.d,s=this.tx,o=t*n-r*i;return this.a=n/o,this.b=-r/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*s)/o,this.ty=-(t*this.ty-r*s)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new wt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new wt}static get TEMP_MATRIX(){return new wt}}const mr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],gr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],_r=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Go=[],Qc=[],zi=Math.sign;function Ff(){for(let e=0;e<16;e++){const t=[];Go.push(t);for(let r=0;r<16;r++){const i=zi(mr[e]*mr[r]+_r[e]*gr[r]),n=zi(gr[e]*mr[r]+vr[e]*gr[r]),s=zi(mr[e]*_r[r]+_r[e]*vr[r]),o=zi(gr[e]*_r[r]+vr[e]*vr[r]);for(let a=0;a<16;a++)if(mr[a]===i&&gr[a]===n&&_r[a]===s&&vr[a]===o){t.push(a);break}}}for(let e=0;e<16;e++){const t=new wt;t.set(mr[e],gr[e],_r[e],vr[e],0,0),Qc.push(t)}}Ff();const Et={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>mr[e],uY:e=>gr[e],vX:e=>_r[e],vY:e=>vr[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Go[e][t],sub:(e,t)=>Go[e][Et.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?Et.S:Et.N:Math.abs(t)*2<=Math.abs(e)?e>0?Et.E:Et.W:t>0?e>0?Et.SE:Et.SW:e>0?Et.NE:Et.NW,matrixAppendRotationInv:(e,t,r=0,i=0)=>{const n=Qc[Et.inv(t)];n.tx=r,n.ty=i,e.append(n)}};class Xt{constructor(t,r,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=r}clone(t=this.cb,r=this.scope){return new Xt(t,r,this._x,this._y)}set(t=0,r=t){return(this._x!==t||this._y!==r)&&(this._x=t,this._y=r,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Jc=class{constructor(){this.worldTransform=new wt,this.localTransform=new wt,this.position=new Xt(this.onChange,this,0,0),this.scale=new Xt(this.onChange,this,1,1),this.pivot=new Xt(this.onChange,this,0,0),this.skew=new Xt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const r=e.worldTransform,i=this.worldTransform;i.a=t.a*r.a+t.b*r.c,i.b=t.a*r.b+t.b*r.d,i.c=t.c*r.a+t.d*r.c,i.d=t.c*r.b+t.d*r.d,i.tx=t.tx*r.a+t.ty*r.c+r.tx,i.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Si=Jc;Si.IDENTITY=new Jc;var Df=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Nf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Dh(e,t,r){const i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}function go(e){const t=new Array(e);for(let r=0;r<t.length;r++)t[r]=!1;return t}function Zc(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return go(2*t);case"bvec3":return go(3*t);case"bvec4":return go(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ar=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>e.type==="vec3"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],Bf={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Of={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Lf(e,t){var i;const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in e.uniforms){const s=t[n];if(!s){(i=e.uniforms[n])!=null&&i.group&&(e.uniforms[n].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const o=e.uniforms[n];let a=!1;for(let l=0;l<Ar.length;l++)if(Ar[l].test(s,o)){r.push(Ar[l].code(n,o)),a=!0;break}if(!a){const h=(s.size===1&&!s.isArray?Bf:Of)[s.type].replace("location",`ud["${n}"].location`);r.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}const tu={};let Or=tu;function eu(){if(Or===tu||Or!=null&&Or.isContextLost()){const e=j.ADAPTER.createCanvas();let t;j.PREFER_ENV>=ar.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Or=t}return Or}let Xi;function Uf(){if(!Xi){Xi=te.MEDIUM;const e=eu();e&&e.getShaderPrecisionFormat&&(Xi=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?te.HIGH:te.MEDIUM)}return Xi}function Nh(e,t){const r=e.getShaderSource(t).split(`
`).map((h,c)=>`${c}: ${h}`),i=e.getShaderInfoLog(t),n=i.split(`
`),s={},o=n.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!s[h]?(s[h]=!0,!0):!1),a=[""];o.forEach(h=>{r[h-1]=`%c${r[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=r.join(`
`);a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Gf(e,t,r,i){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||Nh(e,r),e.getShaderParameter(i,e.COMPILE_STATUS)||Nh(e,i),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const kf={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function ru(e){return kf[e]}let ji=null;const Bh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function iu(e,t){if(!ji){const r=Object.keys(Bh);ji={};for(let i=0;i<r.length;++i){const n=r[i];ji[e[n]]=Bh[n]}}return ji[t]}function Oh(e,t,r){if(e.substring(0,9)!=="precision"){let i=t;return t===te.HIGH&&r!==te.HIGH&&(i=te.MEDIUM),`precision ${i} float;
${e}`}else if(r!==te.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let ni;function nu(){if(typeof ni=="boolean")return ni;try{ni=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ni=!1}return ni}let Hf=0;const Wi={},Gr=class{constructor(e,t,r="pixi-shader",i={}){this.extra={},this.id=Hf++,this.vertexSrc=e||Gr.defaultVertexSrc,this.fragmentSrc=t||Gr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Wi[r]?(Wi[r]++,r+=`-${Wi[r]}`):Wi[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Oh(this.vertexSrc,Gr.defaultVertexPrecision,te.HIGH),this.fragmentSrc=Oh(this.fragmentSrc,Gr.defaultFragmentPrecision,Uf())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Nf}static get defaultFragmentSrc(){return Df}static from(e,t,r){const i=e+t;let n=Lo[i];return n||(Lo[i]=n=new Gr(e,t,r)),n}};let Gt=Gr;Gt.defaultVertexPrecision=te.HIGH;Gt.defaultFragmentPrecision=Se.apple.device?te.HIGH:te.MEDIUM;let Vf=0;class fe{constructor(t,r,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Vf++,this.static=!!r,this.ubo=!!i,t instanceof ot?(this.buffer=t,this.buffer.type=Ie.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ot(new Float32Array(1)),this.buffer.type=Ie.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,r,i){if(!this.ubo)this.uniforms[t]=new fe(r,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,r,i){return new fe(t,r,i)}static uboFrom(t,r){return new fe(t,r??!0,!0)}}let Fe=class su{constructor(t,r){this.uniformBindCount=0,this.program=t,r?r instanceof fe?this.uniformGroup=r:this.uniformGroup=new fe(r):this.uniformGroup=new fe({}),this.disposeRunner=new re("disposeShader")}checkUniformExists(t,r){if(r.uniforms[t])return!0;for(const i in r.uniforms){const n=r.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,r,i){const n=Gt.from(t,r);return new su(n,i)}};class ma{constructor(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},!r.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!r.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=s;this.defaultGroupCache[t]=fe.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Gt(this.vertexSrc,n)}const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new wt,default:this.defaultGroupCache[t]};return new Fe(this.programCache[t],r)}generateSampleSrc(t){let r="";r+=`
`,r+=`
`;for(let i=0;i<t;i++)i>0&&(r+=`
else `),i<t-1&&(r+=`if(vTextureId < ${i}.5)`),r+=`
{`,r+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,r+=`
}`;return r+=`
`,r+=`
`,r}}class bn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function zf(){return!Se.apple.device}function Xf(e){let t=!0;const r=j.ADAPTER.getNavigator();if(Se.tablet||Se.phone){if(Se.apple.device){const i=r.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(Se.android.device){const i=r.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?e:4}class Zr{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var jf=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Wf=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const xe=class extends Zr{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Vn,this.vertexSize=6,this.state=$t.for2d(),this.size=xe.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Xf(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??zf(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return dt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Wf}static get defaultFragmentTemplate(){return jf}setShaderGenerator({vertex:e=xe.defaultVertexSrc,fragment:t=xe.defaultFragmentTemplate}={}){this.shaderGenerator=new ma(e,t)}contextChange(){const e=this.renderer.gl;j.PREFER_ENV===ar.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),xe.defaultMaxTextures),this.maxTextures=Yc(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=xe,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;e.length<r;)e.push(new xn);for(;t.length<i;)t.push(new bn);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,r=xe._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++ht._globalBatch,a=0,l=r[0],h=0;i.copyBoundTextures(n,t);for(let c=0;c<this._bufferSize;++c){const u=e[c];e[c]=null,u._batchEnabled!==o&&(l.count>=t&&(i.boundArray(l,n,o,t),this.buildDrawCalls(l,h,c),h=c,l=r[++a],++o),u._batchEnabled=o,u.touched=s,l.elements[l.count++]=u)}l.count>0&&(i.boundArray(l,n,o,t),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let c=0;c<n.length;c++)n[c]=null;ht._globalBatch=o}buildDrawCalls(e,t,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:s,vertexSize:o}=this,a=xe._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=e;for(let d=t;d<r;++d){const f=i[d],p=f._texture.baseTexture,g=da[p.alphaMode?1:0][f.blendMode];i[d]=null,t<d&&u.blend!==g&&(u.size=c-u.start,t=d,u=a[++l],u.texArray=e,u.start=c),this.packInterleavedGeometry(f,n,s,h,c),h+=f.vertexData.length/2*o,c+=f.indices.length,u.blend=g}t<r&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:r}=this;xe.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:r}=this.renderer,i=xe._drawCallPool;let n=null;for(let s=0;s<e;s++){const{texArray:o,type:a,size:l,start:h,blend:c}=i[s];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,r.set(this.state),t.drawElements(a,l,t.UNSIGNED_SHORT,h*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),xe.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=yi(Math.ceil(e/8)),r=Oo(t),i=t*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new vn(i*this.vertexSize*4)),n}getIndexBuffer(e){const t=yi(Math.ceil(e/12)),r=Oo(t),i=t*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(e,t,r,i,n){const{uint32View:s,float32View:o}=t,a=i/this.vertexSize,l=e.uvs,h=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),f=vt.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let p=0;p<c.length;p+=2)o[i++]=c[p],o[i++]=c[p+1],o[i++]=l[p],o[i++]=l[p+1],s[i++]=f,o[i++]=u;for(let p=0;p<h.length;p++)r[n++]=a+h[p]}};let he=xe;he.defaultBatchSize=4096;he.extension={name:"batch",type:q.RendererPlugin};he._drawCallPool=[];he._textureArrayPool=[];rt.add(he);var $f=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,qf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const ui=class extends Fe{constructor(e,t,r){const i=Gt.from(e||ui.defaultVertexSrc,t||ui.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=ui.defaultResolution,this.multisample=ui.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new $t}apply(e,t,r,i,n){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return qf}static get defaultFragmentSrc(){return $f}};let Lt=ui;Lt.defaultResolution=1;Lt.defaultMultisample=Mt.NONE;class Ci{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new vt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:r,background:i,backgroundAlpha:n}=t,s=i??r;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Ci.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};Ci.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"background"};rt.add(Ci);class ga{constructor(t){this.renderer=t,this.emptyRenderer=new Zr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,r){const{boundTextures:i}=this.renderer.texture;for(let n=r-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,r,i,n){const{elements:s,ids:o,count:a}=t;let l=0;for(let h=0;h<a;h++){const c=s[h],u=c._batchLocation;if(u>=0&&u<n&&r[u]===c){o[h]=u;continue}for(;l<n;){const d=r[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue}o[h]=l,c._batchLocation=l,r[l]=c;break}}}destroy(){this.renderer=null}}ga.extension={type:q.RendererSystem,name:"batch"};rt.add(ga);let Lh=0;class Ii{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Lh++}init(t){if(t.context)this.initFromContext(t.context);else{const r=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Lh++,this.renderer.runners.contextChange.emit(t);const r=this.renderer.view;r.addEventListener!==void 0&&(r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const r=this.createContext(this.renderer.view,t);this.initFromContext(r)}createContext(t,r){let i;if(j.PREFER_ENV>=ar.WEBGL2&&(i=t.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,r={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,r,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,r,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const r=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),r&&!r.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ii.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};Ii.extension={type:q.RendererSystem,name:"context"};rt.add(Ii);class Yf extends Jr{upload(t,r,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===Vt.UNPACK);const s=r.realWidth,o=r.realHeight;return i.width===s&&i.height===o?n.texSubImage2D(r.target,0,0,0,s,o,r.format,i.type,this.data):(i.width=s,i.height=o,n.texImage2D(r.target,0,i.internalFormat,s,o,0,r.format,i.type,this.data)),!0}}class Tn{constructor(t,r){this.width=Math.round(t||100),this.height=Math.round(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new re("disposeFramebuffer"),this.multisample=Mt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,r){return this.colorTextures[t]=r||new ht(null,{scaleMode:Zt.NEAREST,resolution:1,mipmap:ne.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ht(new Yf(null,{width:this.width,height:this.height}),{scaleMode:Zt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ne.OFF,format:X.DEPTH_COMPONENT,type:Q.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,r){if(t=Math.round(t),r=Math.round(r),!(t===this.width&&r===this.height)){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,r/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,r/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class _a extends ht{constructor(t={}){if(typeof t=="number"){const r=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];t={width:r,height:i,scaleMode:n,resolution:s}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=Mt.NONE),super(null,t),this.mipmap=ne.OFF,this.valid=!0,this._clear=new vt([0,0,0,0]),this.framebuffer=new Tn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,r){this.framebuffer.resize(t*this.resolution,r*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}let je=class extends Wr{constructor(t){const r=t,i=r.naturalWidth||r.videoWidth||r.width,n=r.naturalHeight||r.videoHeight||r.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,r,i){i===void 0&&!r.startsWith("data:")?t.crossOrigin=qc(r):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,r,i,n){const s=t.gl,o=r.realWidth,a=r.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===Vt.UNPACK),!this.noSubImage&&r.target===s.TEXTURE_2D&&i.width===o&&i.height===a?s.texSubImage2D(s.TEXTURE_2D,0,0,0,r.format,i.type,n):(i.width=o,i.height=a,s.texImage2D(r.target,0,i.internalFormat,r.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,r=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(r,i),super.update()}dispose(){this.source=null}};class va extends je{constructor(t,r){if(r=r||{},typeof t=="string"){const i=new Image;je.crossOrigin(i,t,r.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(r.createBitmap??j.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this.bitmap=null,this._load=null,r.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((r,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?r(this.process()):r(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const r=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>r(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Vt.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,r,i){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,r,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,r,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=r._glTextures;for(const o in s){const a=s[o];if(a!==i&&a.dirtyId!==r.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class ya{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,r,i){const n=r.width,s=r.height;if(i){const o=t.width/2/n,a=t.height/2/s,l=t.x/n+o,h=t.y/s+a;i=Et.add(i,Et.NW),this.x0=l+o*Et.uX(i),this.y0=h+a*Et.uY(i),i=Et.add(i,2),this.x1=l+o*Et.uX(i),this.y1=h+a*Et.uY(i),i=Et.add(i,2),this.x2=l+o*Et.uX(i),this.y2=h+a*Et.uY(i),i=Et.add(i,2),this.x3=l+o*Et.uX(i),this.y3=h+a*Et.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Uh=new ya;function $i(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class $ extends lr{constructor(t,r,i,n,s,o,a){if(super(),this.noFrame=!1,r||(this.noFrame=!0,r=new pt(0,0,1,1)),t instanceof $&&(t=t.baseTexture),this.baseTexture=t,this._frame=r,this.trim=n,this.valid=!1,this._uvs=Uh,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new _t(o.x,o.y):new _t(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=r:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:r}=this.baseTexture;r!=null&&r.url&&zt[r.url]&&$.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,$.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),r=this._frame===this.orig?t:this.orig.clone(),i=new $(this.baseTexture,!this.noFrame&&t,r,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Uh&&(this._uvs=new ya),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,r={},i=j.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof ht){if(!t.cacheId){const a=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${nr()}`,ht.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const a=(r==null?void 0:r.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${nr()}`}s=t._pixiId}let o=zt[s];if(n&&i&&!o)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!o&&!(t instanceof ht)?(r.resolution||(r.resolution=Xe(t)),o=new $(new ht(t,r)),o.baseTexture.cacheId=s,ht.addToCache(o.baseTexture,s),$.addToCache(o,s)):!o&&t instanceof ht&&(o=new $(t),$.addToCache(o,s)),o}static fromURL(t,r){const i=Object.assign({autoLoad:!1},r==null?void 0:r.resourceOptions),n=$.from(t,Object.assign({resourceOptions:i},r),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,r,i,n){return new $(ht.fromBuffer(t,r,i,n))}static fromLoader(t,r,i,n){const s=new ht(t,Object.assign({scaleMode:ht.defaultOptions.scaleMode,resolution:Xe(r)},n)),{resource:o}=s;o instanceof va&&(o.url=r);const a=new $(s);return i||(i=r),ht.addToCache(a.baseTexture,i),$.addToCache(a,i),i!==r&&(ht.addToCache(a.baseTexture,r),$.addToCache(a,r)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(t,r){r&&(t.textureCacheIds.includes(r)||t.textureCacheIds.push(r),zt[r]&&zt[r]!==t&&console.warn(`Texture added to the cache with an id [${r}] that already had an entry`),zt[r]=t)}static removeFromCache(t){if(typeof t=="string"){const r=zt[t];if(r){const i=r.textureCacheIds.indexOf(t);return i>-1&&r.textureCacheIds.splice(i,1),delete zt[t],r}}else if(t!=null&&t.textureCacheIds){for(let r=0;r<t.textureCacheIds.length;++r)zt[t.textureCacheIds[r]]===t&&delete zt[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:r,y:i,width:n,height:s}=t,o=r+n>this.baseTexture.width,a=i+s>this.baseTexture.height;if(o||a){const l=o&&a?"and":"or",h=`X: ${r} + ${n} = ${r+n} > ${this.baseTexture.width}`,c=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${c}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return $._EMPTY||($._EMPTY=new $(new ht),$i($._EMPTY),$i($._EMPTY.baseTexture)),$._EMPTY}static get WHITE(){if(!$._WHITE){const t=j.ADAPTER.createCanvas(16,16),r=t.getContext("2d");t.width=16,t.height=16,r.fillStyle="white",r.fillRect(0,0,16,16),$._WHITE=new $(ht.from(t)),$i($._WHITE),$i($._WHITE.baseTexture)}return $._WHITE}}class De extends ${constructor(t,r){super(t,r),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,r,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,o=Math.round(r*n)/n;this.valid=s>0&&o>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(s,o),this.updateUvs()}setResolution(t){const{baseTexture:r}=this;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))}static create(t){return new De(new _a(t))}}class xa{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,r,i=Mt.NONE){const n=new _a(Object.assign({width:t,height:r,resolution:1,multisample:i},this.textureOptions));return new De(n)}getOptimalTexture(t,r,i=1,n=Mt.NONE){let s;t=Math.ceil(t*i-1e-6),r=Math.ceil(r*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||r!==this._pixelsHeight?(t=yi(t),r=yi(r),s=((t&65535)<<16|r&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let o=this.texturePool[s].pop();return o||(o=this.createTexture(t,r,n)),o.filterPoolKey=s,o.setResolution(i),o}getFilterTexture(t,r,i){const n=this.getOptimalTexture(t.width,t.height,r||t.resolution,i||Mt.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const r in this.texturePool){const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const r in this.texturePool){if(!(Number(r)<0))continue;const i=this.texturePool[r];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[r]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}xa.SCREEN_KEY=-1;class ou extends Me{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class ba extends Me{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ot(this.vertices),this.uvBuffer=new ot(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,r){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+r.width/t.width,this.uvs[3]=n,this.uvs[4]=i+r.width/t.width,this.uvs[5]=n+r.height/t.height,this.uvs[6]=i,this.uvs[7]=n+r.height/t.height,i=r.x,n=r.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+r.width,this.vertices[3]=n,this.vertices[4]=i+r.width,this.vertices[5]=n+r.height,this.vertices[6]=i,this.vertices[7]=n+r.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class au{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Mt.NONE,this.sourceFrame=new pt,this.destinationFrame=new pt,this.bindingSourceFrame=new pt,this.bindingDestinationFrame=new pt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const qi=[new _t,new _t,new _t,new _t],_o=new wt;class Ta{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new xa,this.statePool=[],this.quad=new ou,this.quadUv=new ba,this.tempRect=new pt,this.activeState={},this.globalUniforms=new fe({outputFrame:new pt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,r){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new au,o=this.renderer.renderTexture;let a=r[0].resolution,l=r[0].multisample,h=r[0].padding,c=r[0].autoFit,u=r[0].legacy??!0;for(let p=1;p<r.length;p++){const g=r[p];a=Math.min(a,g.resolution),l=Math.min(l,g.multisample),h=this.useMaxPadding?Math.max(h,g.padding):h+g.padding,c=c&&g.autoFit,u=u||(g.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),n.push(s),s.resolution=a,s.multisample=l,s.legacy=u,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(h);const d=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(_o.copyFrom(i.projection.transform).invert(),d),c?(s.sourceFrame.fit(d),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(d)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,a,l),s.filters=r,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=s.sourceFrame.width,f.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(o.sourceFrame),s.bindingDestinationFrame.copyFrom(o.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,o.bind(s.renderTexture,s.sourceFrame,f),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,r=t.pop(),i=r.filters;this.activeState=r;const n=this.globalUniforms.uniforms;n.outputFrame=r.sourceFrame,n.resolution=r.resolution;const s=n.inputSize,o=n.inputPixel,a=n.inputClamp;if(s[0]=r.destinationFrame.width,s[1]=r.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],o[0]=Math.round(s[0]*r.resolution),o[1]=Math.round(s[1]*r.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=r.sourceFrame.width*s[2]-.5*o[2],a[3]=r.sourceFrame.height*s[3]-.5*o[3],r.legacy){const h=n.filterArea;h[0]=r.destinationFrame.width,h[1]=r.destinationFrame.height,h[2]=r.sourceFrame.x,h[3]=r.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,r.renderTexture,l.renderTexture,Ae.BLEND,r),this.returnFilterTexture(r.renderTexture);else{let h=r.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,r.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&r.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,r.resolution),c.filterFrame=h.filterFrame),i[u].apply(this,h,c,Ae.CLEAR,r);const d=h;h=c,c=d}i[u].apply(this,h,l.renderTexture,Ae.BLEND,r),u>1&&r.multisample>1&&this.returnFilterTexture(r.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}r.clear(),this.statePool.push(r)}bindAndClear(t,r=Ae.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(r===Ae.CLEAR||r===Ae.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,r,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(r._frame,r.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Jt.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Jt.TRIANGLE_STRIP))}calculateSpriteMatrix(t,r){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=r._texture,o=t.set(n.width,0,0,n.height,i.x,i.y),a=r.worldTransform.copyTo(wt.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(r.anchor.x,r.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,r,i=1,n=Mt.NONE){return this.texturePool.getOptimalTexture(t,r,i,n)}getFilterTexture(t,r,i){if(typeof t=="number"){const s=t;t=r,r=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution,i||Mt.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,r){const i=qi[0],n=qi[1],s=qi[2],o=qi[3];i.set(r.left,r.top),n.set(r.left,r.bottom),s.set(r.right,r.top),o.set(r.right,r.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(o,o);const a=Math.min(i.x,n.x,s.x,o.x),l=Math.min(i.y,n.y,s.y,o.y),h=Math.max(i.x,n.x,s.x,o.x),c=Math.max(i.y,n.y,s.y,o.y);r.x=a,r.y=l,r.width=h-a,r.height=c-l}roundFrame(t,r,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a:o,b:a,c:l,d:h}=s;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}s=s?_o.copyFrom(s):_o.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(r),this.transformAABB(s.invert(),t)}}}Ta.extension={type:q.RendererSystem,name:"filter"};rt.add(Ta);class lu{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Mt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Kf=new pt;class wa{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Tn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new pt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;j.PREFER_ENV===ar.WEBGL_LEGACY&&(r=null,i=null),r?t.drawBuffers=n=>r.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,r,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r){const o=r.width>>i,a=r.height>>i,l=o/r.width;this.setViewport(r.x*l,r.y*l,o,a)}else{const o=t.width>>i,a=t.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,r,i,n){const s=this.viewport;t=Math.round(t),r=Math.round(r),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==r)&&(s.x=t,s.y=r,s.width=i,s.height=n,this.gl.viewport(t,r,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,r,i,n,s=pn.COLOR|pn.DEPTH){const{gl:o}=this;o.clearColor(t,r,i,n),o.clear(s)}initFramebuffer(t){const{gl:r}=this,i=new lu(r.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let s=n.length;r.drawBuffers||(s=Math.min(s,1));for(let o=0;o<s;o++){const a=n[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&i.msaaBuffer&&(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,r){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let o=s.length;i.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=s[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),l===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,r),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,r)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:r}=this;let i=Mt.NONE;if(t<=1||r===null)return i;for(let n=0;n<r.length;n++)if(r[n]<=t){i=r[n];break}return i===1&&(i=Mt.NONE),i}blit(t,r,i){const{current:n,renderer:s,gl:o,CONTEXT_UID:a}=this;if(s.context.webGLVersion!==2||!n)return;const l=n.glFramebuffers[a];if(!l)return;if(!t){if(!l.msaaBuffer)return;const c=n.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Tn(n.width,n.height),l.blitFramebuffer.addColorTexture(0,c)),t=l.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}r||(r=Kf,r.width=n.width,r.height=n.height),i||(i=r);const h=r.width===i.width&&r.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(r.left,r.top,r.right,r.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,r){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),r||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,r)}disposeAll(t){const r=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<r.length;i++)this.disposeFramebuffer(r[i],t)}forceStencil(){const t=this.current;if(!t)return;const r=t.glFramebuffers[this.CONTEXT_UID];if(!r||r.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),r.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),r.stencil=o,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new pt}destroy(){this.renderer=null}}wa.extension={type:q.RendererSystem,name:"framebuffer"};rt.add(wa);const vo={5126:4,5123:2,5121:1};class Aa{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;j.PREFER_ENV===ar.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(r.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,o,a,l)=>i.drawElementsInstancedANGLE(n,s,o,a,l),t.drawArraysInstanced=(n,s,o,a)=>i.drawArraysInstancedANGLE(n,s,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex}bind(t,r){r=r||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const o=n[r.program.id]||this.initGeometryVao(t,r,s);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,r.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,r=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];r.update(n)}}checkCompatibility(t,r){const i=t.attributes,n=r.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,r){const i=t.attributes,n=r.attributeData,s=["g",t.id];for(const o in i)n[o]&&s.push(o,n[o].location);return s.join("-")}initGeometryVao(t,r,i=!0){const n=this.gl,s=this.CONTEXT_UID,o=this.renderer.buffer,a=r.program;a.glPrograms[s]||this.renderer.shader.generateProgram(r),this.checkCompatibility(t,a);const l=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[a.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const g in u)f[g]=0,p[g]=0;for(const g in d)!d[g].size&&a.attributeData[g]?d[g].size=a.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[g].buffer]+=d[g].size*vo[d[g].type];for(const g in d){const m=d[g],_=m.size;m.stride===void 0&&(f[m.buffer]===_*vo[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=_*vo[m.type])}c=n.createVertexArray(),n.bindVertexArray(c);for(let g=0;g<u.length;g++){const m=u[g];o.bind(m),i&&m._glBuffers[s].refCount++}return this.activateVao(t,a),h[a.id]=c,h[l]=c,n.bindVertexArray(null),o.unbind(Ie.ARRAY_BUFFER),c}disposeGeometry(t,r){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let l=0;l<s.length;l++){const h=s[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!r&&o.dispose(s[l],r))}if(!r){for(const l in i)if(l[0]==="g"){const h=i[l];this._activeVao===h&&this.unbind(),n.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const r=Object.keys(this.managedGeometries);for(let i=0;i<r.length;i++)this.disposeGeometry(this.managedGeometries[r[i]],t)}activateVao(t,r){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=t.buffers,a=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let l=null;for(const h in a){const c=a[h],u=o[c.buffer],d=u._glBuffers[n];if(r.attributeData[h]){l!==d&&(s.bind(u),l=d);const f=r.attributeData[h].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,r,i,n){const{gl:s}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?s.drawElementsInstanced(t,r||o.indexBuffer.data.length,l,(i||0)*a,n||1):s.drawElements(t,r||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?s.drawArraysInstanced(t,i,r||o.getSize(),n||1):s.drawArrays(t,i,r||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Aa.extension={type:q.RendererSystem,name:"geometry"};rt.add(Aa);const Gh=new wt;class Ea{constructor(t,r){this._texture=t,this.mapCoord=new wt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r>"u"?.5:r,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,r){r===void 0&&(r=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],o=t[n+1];r[n]=s*i.a+o*i.c+i.tx,r[n+1]=s*i.b+o*i.d+i.ty}return r}update(t){const r=this._texture;if(!r||!r.valid||!t&&this._textureID===r._updateID)return!1;this._textureID=r._updateID,this._updateID++;const i=r._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=r.orig,s=r.trim;s&&(Gh.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Gh));const o=r.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(r._frame.x+l+h)/o.width,a[1]=(r._frame.y+l+h)/o.height,a[2]=(r._frame.x+r._frame.width-l+h)/o.width,a[3]=(r._frame.y+r._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=r._frame.width===o.width&&r._frame.height===o.height&&r.rotate===0,!0}}var Qf=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Jf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class hu extends Lt{constructor(t,r,i){let n=null;typeof t!="string"&&r===void 0&&i===void 0&&(n=t,t=void 0,r=void 0,i=void 0),super(t||Jf,r||Qf,i),this.maskSprite=n,this.maskMatrix=new wt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,r,i,n){const s=this._maskSprite,o=s._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Ea(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,r,i,n))}}class cu{constructor(t=null){this.type=Pt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Lt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Pt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Sa{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,r){let i=r;if(!i.isMaskData){const s=this.maskDataPool.pop()||new cu;s.pooled=!0,s.maskObject=r,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Pt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Pt.SCISSOR:this.renderer.scissor.push(i);break;case Pt.STENCIL:this.renderer.stencil.push(i);break;case Pt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Pt.COLOR:this.pushColorMask(i);break}i.type===Pt.SPRITE&&this.maskStack.push(i)}pop(t){const r=this.maskStack.pop();if(!(!r||r._target!==t)){if(r.enabled)switch(r.type){case Pt.SCISSOR:this.renderer.scissor.pop(r);break;case Pt.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case Pt.SPRITE:this.popSpriteMask(r);break;case Pt.COLOR:this.popColorMask(r);break}if(r.reset(),r.pooled&&this.maskDataPool.push(r),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===Pt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const r=t.maskObject;r?r.isSprite?t.type=Pt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Pt.SCISSOR:t.type=Pt.STENCIL:t.type=Pt.COLOR}pushSpriteMask(t){const{maskObject:r}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new hu]));const s=this.renderer,o=s.renderTexture;let a,l;if(o.current){const c=o.current;a=t.resolution||c.resolution,l=t.multisample??c.multisample}else a=t.resolution||s.resolution,l=t.multisample??s.multisample;n[0].resolution=a,n[0].multisample=l,n[0].maskSprite=r;const h=i.filterArea;i.filterArea=r.getBounds(!0),s.filter.push(i,n),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const r=t._colorMask,i=t._colorMask=r&t.colorMask;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const r=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==r&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Sa.extension={type:q.RendererSystem,name:"mask"};rt.add(Sa);class uu{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:r}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const kh=new wt,Hh=[],sn=class extends uu{constructor(e){super(e),this.glConst=j.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,n=i.renderTexture,s=r.getBounds(!0,Hh.pop()??new pt);this.roundFrameToPixels(s,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&s.fit(t),e._scissorRectLocal=s}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:r,c:i,d:n}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||sn.isMatrixRotated(t.worldTransform)||sn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const r=e._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(e,t,r,i,n){sn.isMatrixRotated(n)||(n=n?kh.copyFrom(n):kh.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,e),e.fit(i),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Hh.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Ca=sn;Ca.extension={type:q.RendererSystem,name:"scissor"};rt.add(Ca);class Ia extends uu{constructor(t){super(t),this.glConst=j.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const r=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,s!==0&&(t._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const r=this.renderer.gl;if(this.getStackLength()===0)r.disable(r.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ia.extension={type:q.RendererSystem,name:"stencil"};rt.add(Ia);class Ra{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return dt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return dt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return dt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const r in t)this.plugins[r]=new t[r](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Ra.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_plugin"};rt.add(Ra);class Ma{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new wt,this.transform=null}update(t,r,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,r,i,n){const s=this.projectionMatrix,o=n?-1:1;s.identity(),s.a=1/r.width*2,s.d=o*(1/r.height*2),s.tx=-1-r.x*s.a,s.ty=-o-r.y*s.d}setTransform(t){}destroy(){this.renderer=null}}Ma.extension={type:q.RendererSystem,name:"projection"};rt.add(Ma);const Zf=new Si;class Pa{constructor(t){this.renderer=t,this._tempMatrix=new wt}generateTexture(t,r){const{region:i,...n}=r||{},s=i||t.getLocalBounds(null,!0);s.width===0&&(s.width=1),s.height===0&&(s.height=1);const o=De.create({width:s.width,height:s.height,...n});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const a=t.transform;return t.transform=Zf,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,o}destroy(){}}Pa.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"textureGenerator"};rt.add(Pa);const dr=new pt,si=new pt;class Fa{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new pt,this.destinationFrame=new pt,this.viewportFrame=new pt}contextChange(){var r;const t=(r=this.renderer)==null?void 0:r.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,r,i){const n=this.renderer;this.current=t;let s,o,a;t?(s=t.baseTexture,a=s.resolution,r||(dr.width=t.frame.width,dr.height=t.frame.height,r=dr),i||(si.x=t.frame.x,si.y=t.frame.y,si.width=r.width,si.height=r.height,i=si),o=s.framebuffer):(a=n.resolution,r||(dr.width=n._view.screen.width,dr.height=n._view.screen.height,r=dr),i||(i=dr,i.width=r.width,i.height=r.height));const l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,t||(l.y=n.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,r,a,!o),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(i)}clear(t,r){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=vt.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=s.width!==o.width||s.height!==o.height;if(a){let{x:l,y:h,width:c,height:u}=this.viewportFrame;l=Math.round(l),h=Math.round(h),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,c,u)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,r),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Fa.extension={type:q.RendererSystem,name:"renderTexture"};rt.add(Fa);class tp{}class du{constructor(t,r){this.program=t,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ep(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=t.getActiveAttrib(e,n);if(s.name.startsWith("gl_"))continue;const o=iu(t,s.type),a={type:o,name:s.name,size:ru(o),location:t.getAttribLocation(e,s.name)};r[s.name]=a}return r}function rp(e,t){const r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=t.getActiveUniform(e,n),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=iu(t,s.type);r[o]={name:o,index:n,type:l,size:s.size,isArray:a,value:Zc(l,s.size)}}return r}function fu(e,t){var l;const r=Dh(e,e.VERTEX_SHADER,t.vertexSrc),i=Dh(e,e.FRAGMENT_SHADER,t.fragmentSrc),n=e.createProgram();e.attachShader(n,r),e.attachShader(n,i);const s=(l=t.extra)==null?void 0:l.transformFeedbackVaryings;if(s&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||Gf(e,n,r,i),t.attributeData=ep(n,e),t.uniformData=rp(n,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((c,u)=>c>u?1:-1);for(let c=0;c<h.length;c++)t.attributeData[h[c]].location=c,e.bindAttribLocation(n,c,h[c]);e.linkProgram(n)}e.deleteShader(r),e.deleteShader(i);const o={};for(const h in t.uniformData){const c=t.uniformData[h];o[h]={location:e.getUniformLocation(n,h),value:Zc(c.type,c.size)}}return new du(n,o)}function ip(e,t,r,i,n){r.buffer.update(n)}const np={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},pu={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function mu(e){const t=e.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let r=0,i=0,n=0;for(let s=0;s<t.length;s++){const o=t[s];if(r=pu[o.data.type],o.data.size>1&&(r=Math.max(r,16)*o.data.size),o.dataLen=r,i%r!==0&&i<16){const a=i%r%16;i+=a,n+=a}i+r>16?(n=Math.ceil(n/16)*16,o.offset=n,n+=r,i=r):(o.offset=n,i+=r,n+=r)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function gu(e,t){const r=[];for(const i in e)t[i]&&r.push(t[i]);return r.sort((i,n)=>i.index-n.index),r}function _u(e,t){if(!e.autoManage)return{size:0,syncFunc:ip};const r=gu(e.uniforms,t),{uboElements:i,size:n}=mu(r),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],l=e.uniforms[a.data.name],h=a.data.name;let c=!1;for(let u=0;u<Ar.length;u++){const d=Ar[u];if(d.codeUbo&&d.test(a.data,l)){s.push(`offset = ${a.offset/4};`,Ar[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){const u=ru(a.data.type),d=Math.max(pu[a.data.type]/16,1),f=u/d,p=(4-f%4)%4;s.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=np[a.data.type];s.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${u};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let sp=0;const Yi={textureCount:0,uboCount:0};class Da{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=sp++}systemCheck(){if(!nu())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,r){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),r||(Yi.textureCount=0,Yi.uboCount=0,this.syncUniformGroup(t.uniformGroup,Yi)),n}setUniforms(t){const r=this.shader.program,i=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,r){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,r))}syncUniforms(t,r,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const r=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[r]||(this.cache[r]=Lf(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,r){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,r);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Yi,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[r])}createSyncBufferGroup(t,r,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(r.program,i);r.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(r.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=_u(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(a.size/4);t.buffer.update(l)}return r.uniformGroups[t.id]=a.syncFunc,r.uniformGroups[t.id]}getSignature(t,r,i){const n=t.uniforms,s=[`${i}-`];for(const o in n)s.push(o),r[o]&&s.push(r[o].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const r=this.gl,i=t.program,n=fu(r,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Da.extension={type:q.RendererSystem,name:"shader"};rt.add(Da);class Ri{constructor(t){this.renderer=t}run(t){const{renderer:r}=this;r.runners.init.emit(r.options),t.hello&&console.log(`PixiJS 7.2.4 - ${r.rendererLogId} - https://pixijs.com`),r.resize(r.screen.width,r.screen.height)}destroy(){}}Ri.defaultOptions={hello:!1};Ri.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"startup"};rt.add(Ri);function op(e,t=[]){return t[at.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.ADD]=[e.ONE,e.ONE],t[at.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.NONE]=[0,0],t[at.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[at.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[at.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[at.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[at.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[at.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[at.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[at.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[at.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[at.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[at.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const ap=0,lp=1,hp=2,cp=3,up=4,dp=5,ko=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=at.NONE,this._blendEq=!1,this.map=[],this.map[ap]=this.setBlend,this.map[lp]=this.setOffset,this.map[hp]=this.setCullFace,this.map[cp]=this.setDepthTest,this.map[up]=this.setFrontFace,this.map[dp]=this.setDepthMask,this.checks=[],this.defaultState=new $t,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=op(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t=t>>1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(ko.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(ko.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Na=ko;Na.extension={type:q.RendererSystem,name:"state"};rt.add(Na);class vu extends lr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const r=(t.priority??[]).filter(n=>t.systems[n]),i=[...r,...Object.keys(t.systems).filter(n=>!r.includes(n))];for(const n of i)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(r=>{this.runners[r]=new re(r)})}addSystem(t,r){const i=new t(this);if(this[r])throw new Error(`Whoops! The name "${r}" is already in use`);this[r]=i,this._systemsHash[r]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,r){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=i.find(o=>this._systemsHash[o]===n);n[t.name](r[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const on=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=on.defaultMaxIdle,this.checkCountMax=on.defaultCheckCountMax,this.mode=on.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Un.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let i=0;i<t.length;i++){const n=t[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[i++]=t[n]);t.length=i}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let i=e.children.length-1;i>=0;i--)this.unload(e.children[i])}destroy(){this.renderer=null}};let ce=on;ce.defaultMode=Un.AUTO;ce.defaultMaxIdle=60*60;ce.defaultCheckCountMax=60*10;ce.extension={type:q.RendererSystem,name:"textureGC"};rt.add(ce);class an{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Q.UNSIGNED_BYTE,this.internalFormat=X.RGBA,this.samplerType=0}}function fp(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[Q.UNSIGNED_BYTE]:{[X.RGBA]:e.RGBA8,[X.RGB]:e.RGB8,[X.RG]:e.RG8,[X.RED]:e.R8,[X.RGBA_INTEGER]:e.RGBA8UI,[X.RGB_INTEGER]:e.RGB8UI,[X.RG_INTEGER]:e.RG8UI,[X.RED_INTEGER]:e.R8UI,[X.ALPHA]:e.ALPHA,[X.LUMINANCE]:e.LUMINANCE,[X.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[Q.BYTE]:{[X.RGBA]:e.RGBA8_SNORM,[X.RGB]:e.RGB8_SNORM,[X.RG]:e.RG8_SNORM,[X.RED]:e.R8_SNORM,[X.RGBA_INTEGER]:e.RGBA8I,[X.RGB_INTEGER]:e.RGB8I,[X.RG_INTEGER]:e.RG8I,[X.RED_INTEGER]:e.R8I},[Q.UNSIGNED_SHORT]:{[X.RGBA_INTEGER]:e.RGBA16UI,[X.RGB_INTEGER]:e.RGB16UI,[X.RG_INTEGER]:e.RG16UI,[X.RED_INTEGER]:e.R16UI,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[Q.SHORT]:{[X.RGBA_INTEGER]:e.RGBA16I,[X.RGB_INTEGER]:e.RGB16I,[X.RG_INTEGER]:e.RG16I,[X.RED_INTEGER]:e.R16I},[Q.UNSIGNED_INT]:{[X.RGBA_INTEGER]:e.RGBA32UI,[X.RGB_INTEGER]:e.RGB32UI,[X.RG_INTEGER]:e.RG32UI,[X.RED_INTEGER]:e.R32UI,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[Q.INT]:{[X.RGBA_INTEGER]:e.RGBA32I,[X.RGB_INTEGER]:e.RGB32I,[X.RG_INTEGER]:e.RG32I,[X.RED_INTEGER]:e.R32I},[Q.FLOAT]:{[X.RGBA]:e.RGBA32F,[X.RGB]:e.RGB32F,[X.RG]:e.RG32F,[X.RED]:e.R32F,[X.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[Q.HALF_FLOAT]:{[X.RGBA]:e.RGBA16F,[X.RGB]:e.RGB16F,[X.RG]:e.RG16F,[X.RED]:e.R16F},[Q.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:e.RGB565},[Q.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:e.RGBA4},[Q.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:e.RGB5_A1},[Q.UNSIGNED_INT_2_10_10_10_REV]:{[X.RGBA]:e.RGB10_A2,[X.RGBA_INTEGER]:e.RGB10_A2UI},[Q.UNSIGNED_INT_10F_11F_11F_REV]:{[X.RGB]:e.R11F_G11F_B10F},[Q.UNSIGNED_INT_5_9_9_9_REV]:{[X.RGB]:e.RGB9_E5},[Q.UNSIGNED_INT_24_8]:{[X.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[Q.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[X.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[Q.UNSIGNED_BYTE]:{[X.RGBA]:e.RGBA,[X.RGB]:e.RGB,[X.ALPHA]:e.ALPHA,[X.LUMINANCE]:e.LUMINANCE,[X.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[Q.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:e.RGB},[Q.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:e.RGBA},[Q.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:e.RGBA}},t}class Ba{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ht,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=fp(t);const r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(let n=0;n<r;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new an(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new an(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,r=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[r]=t}else this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[r]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:r,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(r.activeTexture(r.TEXTURE0+n),this.currentLocation=n),r.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:r,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=t-1;s>=0;--s){const o=r[s];o&&o._glTextures[n].samplerType!==mn.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const r=new an(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r}initTextureType(t,r){var i;r.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,this.webGLVersion===2&&t.type===Q.HALF_FLOAT?r.type=this.gl.HALF_FLOAT:r.type=t.type}updateTexture(t){var n;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const i=this.renderer;if(this.initTextureType(t,r),(n=t.resource)!=null&&n.upload(i,t,r))r.samplerType!==mn.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,o=t.realHeight,a=i.gl;(r.width!==s||r.height!==o||r.dirtyId<0)&&(r.width=s,r.height=o,a.texImage2D(t.target,0,r.internalFormat,s,o,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,r){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){const n=this.managedTextures.indexOf(t);n!==-1&&Tr(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===ne.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=Wt.CLAMP:r.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,r){const i=this.gl;if(r.mipmap&&t.mipmap!==ne.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Zt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Zt.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===Zt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===Zt.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Ba.extension={type:q.RendererSystem,name:"texture"};rt.add(Ba);class Oa{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,r){const{gl:i,renderer:n}=this;r&&n.shader.bind(r),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:r,renderer:i,CONTEXT_UID:n}=this,s=r.createTransformFeedback();t._glTransformFeedbacks[n]=s,r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,s);for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];a&&(i.buffer.update(a),a._glBuffers[n].refCount++,r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[n].buffer||null))}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,r){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let o=0;o<t.buffers.length;o++){const a=t.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!r&&s.dispose(a,r))}i&&(r||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Oa.extension={type:q.RendererSystem,name:"transformFeedback"};rt.add(Oa);class Mi{constructor(t){this.renderer=t}init(t){this.screen=new pt(0,0,t.width,t.height),this.element=t.view||j.ADAPTER.createCanvas(),this.resolution=t.resolution||j.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,r){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(r*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var r;t&&((r=this.element.parentNode)==null||r.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Mi.defaultOptions={width:800,height:600,resolution:j.RESOLUTION,autoDensity:!1};Mi.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_view"};rt.add(Mi);j.PREFER_ENV=ar.WEBGL2;j.STRICT_TEXTURE_CACHE=!1;j.RENDER_OPTIONS={...Ii.defaultOptions,...Ci.defaultOptions,...Mi.defaultOptions,...Ri.defaultOptions};Object.defineProperties(j,{WRAP_MODE:{get(){return ht.defaultOptions.wrapMode},set(e){dt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ht.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return ht.defaultOptions.scaleMode},set(e){dt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ht.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return ht.defaultOptions.mipmap},set(e){dt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ht.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return ht.defaultOptions.anisotropicLevel},set(e){dt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ht.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return dt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Lt.defaultResolution},set(e){Lt.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return dt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Lt.defaultMultisample},set(e){Lt.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return he.defaultMaxTextures},set(e){dt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),he.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return he.defaultBatchSize},set(e){dt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),he.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return he.canUploadSameBuffer},set(e){dt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),he.canUploadSameBuffer=e}},GC_MODE:{get(){return ce.defaultMode},set(e){dt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ce.defaultMode=e}},GC_MAX_IDLE:{get(){return ce.defaultMaxIdle},set(e){dt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ce.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return ce.defaultCheckCountMax},set(e){dt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ce.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return Gt.defaultVertexPrecision},set(e){dt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Gt.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return Gt.defaultFragmentPrecision},set(e){dt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Gt.defaultFragmentPrecision=e}}});var We=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(We||{});class yo{constructor(t,r=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=r,this.priority=i,this.once=n}match(t,r=null){return this.fn===t&&this.context===r}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=t?null:r,this.previous=null,r}}const Yt=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new yo(null,null,1/0),this.deltaMS=1/Yt.targetFPMS,this.elapsedMS=1/Yt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=We.NORMAL){return this._addListener(new yo(e,t,r))}addOnce(e,t,r=We.NORMAL){return this._addListener(new yo(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Yt.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,Yt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Yt._shared){const e=Yt._shared=new Yt;e.autoStart=!0,e._protected=!0}return Yt._shared}static get system(){if(!Yt._system){const e=Yt._system=new Yt;e.autoStart=!0,e._protected=!0}return Yt._system}};let Ft=Yt;Ft.targetFPMS=.06;Object.defineProperties(j,{TARGET_FPMS:{get(){return Ft.targetFPMS},set(e){dt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ft.targetFPMS=e}}});class La{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,We.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ft.shared:new Ft,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}La.extension=q.Application;rt.add(La);const yu=[];rt.handleByList(q.Renderer,yu);function xu(e){for(const t of yu)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var pp=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,mp=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const bu=pp,Ua=mp;class Ga{constructor(t){this.renderer=t}contextChange(t){let r;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),r=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}r>=Mt.HIGH?this.multisample=Mt.HIGH:r>=Mt.MEDIUM?this.multisample=Mt.MEDIUM:r>=Mt.LOW?this.multisample=Mt.LOW:this.multisample=Mt.NONE}destroy(){}}Ga.extension={type:q.RendererSystem,name:"_multisample"};rt.add(Ga);class gp{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class ka{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);r.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:r}=this;r.bindBuffer(t,null)}bindBufferBase(t,r){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[r]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[r]=t,i.bindBufferBase(i.UNIFORM_BUFFER,r,s.buffer)}}bindBufferRange(t,r,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const o=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,r||0,o.buffer,i*256,256)}update(t){const{gl:r,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,r.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)r.bufferSubData(t.type,0,t.data);else{const s=t.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,r.bufferData(t.type,t.data,s)}}dispose(t,r){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(r||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const r=Object.keys(this.managedBuffers);for(let i=0;i<r.length;i++)this.dispose(this.managedBuffers[r[i]],t)}createGLBuffer(t){const{CONTEXT_UID:r,gl:i}=this;return t._glBuffers[r]=new gp(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[r]}}ka.extension={type:q.RendererSystem,name:"buffer"};rt.add(ka);class Ha{constructor(t){this.renderer=t}render(t,r){const i=this.renderer;let n,s,o,a;if(r&&(n=r.renderTexture,s=r.clear,o=r.transform,a=r.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(n||(this.lastObjectRendered=t),!a){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(r.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Ha.extension={type:q.RendererSystem,name:"objectRenderer"};rt.add(Ha);const Ho=class extends vu{constructor(e){super(),this.type=la.WEBGL,e=Object.assign({},j.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new fe({projectionMatrix:new wt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ho.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(dt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Ho.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:Bc()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return dt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return dt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return dt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return dt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){dt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return dt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){dt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return dt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let hr=Ho;hr.extension={type:q.Renderer,priority:1};hr.__plugins={};hr.__systems={};rt.handleByMap(q.RendererPlugin,hr.__plugins);rt.handleByMap(q.RendererSystem,hr.__systems);rt.add(hr);class Va extends Wr{constructor(t,r){const{width:i,height:n}=r||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const o=new ht;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,r){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Wr?this.addResourceAt(t[i],i):this.addResourceAt(pa(t[i],r),i))}dispose(){for(let t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,r){if(!this.items[r])throw new Error(`Index ${r} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)}unbind(t){super.unbind(t);for(let r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)}load(){if(this._load)return this._load;const r=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(r).then(()=>{const{realWidth:i,realHeight:n}=this.items[0];return this.resize(i,n),Promise.resolve(this)}),this._load}}let Tu=class extends Va{constructor(t,r){const{width:i,height:n}=r||{};let s,o;Array.isArray(t)?(s=t,o=t.length):o=t,super(o,{width:i,height:n}),s&&this.initFromArray(s,r)}addBaseTextureAt(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=He.TEXTURE_2D_ARRAY}upload(t,r,i){const{length:n,itemDirtyIds:s,items:o}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,r.format,i.type,null);for(let l=0;l<n;l++){const h=o[l];s[l]<h.dirtyId&&(s[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,r.format,i.type,h.resource.source))}return!0}};class wu extends je{constructor(t){super(t)}static test(t){const{OffscreenCanvas:r}=globalThis;return r&&t instanceof r?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const di=class extends Va{constructor(e,t){const{width:r,height:i,autoLoad:n,linkBaseTexture:s}=t||{};if(e&&e.length!==di.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:r,height:i});for(let o=0;o<di.SIDES;o++)this.items[o].target=He.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=s!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=He.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=He.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,r){const i=this.itemDirtyIds;for(let n=0;n<di.SIDES;n++){const s=this.items[n];(i[n]<s.dirtyId||r.dirtyId<t.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(e,s,r),i[n]=s.dirtyId):i[n]<-1&&(e.gl.texImage2D(s.target,0,r.internalFormat,t.realWidth,t.realHeight,0,t.format,r.type,null),i[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===di.SIDES}};let za=di;za.SIDES=6;class yr extends je{constructor(t,r){r=r||{};let i,n;typeof t=="string"?(i=yr.EMPTY,n=t):(i=t,n=null),super(i),this.url=n,this.crossOrigin=r.crossOrigin??!0,this.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,this._load=null,r.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,r)=>{if(this.url===null){t(this);return}try{const i=await j.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Vt.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(i){if(this.destroyed)return;r(i),this.onError.emit(i)}}),this._load)}upload(t,r,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),super.upload(t,r,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return yr._EMPTY=yr._EMPTY??j.ADAPTER.createCanvas(0,0),yr._EMPTY}}const ln=class extends je{constructor(e,t){t=t||{},super(j.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},ln.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;je.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,r=e.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,n=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),n=Math.round(n);const s=this.source;s.width=i,s.height=n,s._pixiId=`canvas_${nr()}`,s.getContext("2d").drawImage(e,0,0,t,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(e){const t=ln.SVG_SIZE.exec(e),r={};return t&&(r[t[1]]=Math.round(parseFloat(t[3])),r[t[5]]=Math.round(parseFloat(t[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&ln.SVG_XML.test(e)}};let $r=ln;$r.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;$r.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Vo=class extends je{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const i=e[0].src||e[0];je.crossOrigin(r,i,t.crossorigin);for(let n=0;n<e.length;++n){const s=document.createElement("source");let{src:o,mime:a}=e[n];o=o||e[n];const l=o.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);a=a||Vo.MIME_TYPES[h]||`video/${h}`,s.src=o,s.type=a,r.appendChild(s)}e=r}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Ft.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ft.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ft.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Ft.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Ft.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ft.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Vo.TYPES.includes(t)}};let Wn=Vo;Wn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Wn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};yn.push(yr,va,wu,Wn,$r,Jr,za,Tu);class _p{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new re("disposeTransformFeedback")}bindBuffer(t,r){this.buffers[t]=r}destroy(){this.disposeRunner.emit(this,!1)}}const vp="7.2.4",St=Object.freeze(Object.defineProperty({__proto__:null,ALPHA_MODES:Vt,AbstractMultiResource:Va,ArrayResource:Tu,Attribute:xi,BLEND_MODES:at,BUFFER_BITS:pn,BUFFER_TYPE:Ie,BackgroundSystem:Ci,BaseImageResource:je,BaseRenderTexture:_a,BaseTexture:ht,BatchDrawCall:xn,BatchGeometry:Vn,BatchRenderer:he,BatchShaderGenerator:ma,BatchSystem:ga,BatchTextureArray:bn,BrowserAdapter:Tc,Buffer:ot,BufferResource:Jr,BufferSystem:ka,CLEAR_MODES:Ae,COLOR_MASK_BITS:bc,CanvasResource:wu,Circle:zn,Color:vt,ContextSystem:Ii,CubeResource:za,DEG_TO_RAD:Sr,DRAW_MODES:Jt,ENV:ar,Ellipse:Xn,ExtensionType:q,FORMATS:X,Filter:Lt,FilterState:au,FilterSystem:Ta,Framebuffer:Tn,FramebufferSystem:wa,GC_MODES:Un,GLFramebuffer:lu,GLProgram:du,GLTexture:an,GenerateTextureSystem:Pa,Geometry:Me,GeometrySystem:Aa,IGLUniformData:tp,INSTALLED:yn,ImageBitmapResource:yr,ImageResource:va,MASK_TYPES:Pt,MIPMAP_MODES:ne,MSAA_QUALITY:Mt,MaskData:cu,MaskSystem:Sa,Matrix:wt,MultisampleSystem:Ga,ObjectRenderer:Zr,ObjectRendererSystem:Ha,ObservablePoint:Xt,PI_2:bi,PRECISION:te,PluginSystem:Ra,Point:_t,Polygon:wr,Program:Gt,ProjectionSystem:Ma,Quad:ou,QuadUv:ba,RAD_TO_DEG:Kc,RENDERER_TYPE:la,Rectangle:pt,RenderTexture:De,RenderTexturePool:xa,RenderTextureSystem:Fa,Renderer:hr,Resource:Wr,RoundedRectangle:jn,Runner:re,SAMPLER_TYPES:mn,SCALE_MODES:Zt,SHAPES:Ot,SVGResource:$r,ScissorSystem:Ca,Shader:Fe,ShaderSystem:Da,SpriteMaskFilter:hu,StartupSystem:Ri,State:$t,StateSystem:Na,StencilSystem:Ia,SystemManager:vu,TARGETS:He,TYPES:Q,Texture:$,TextureGCSystem:ce,TextureMatrix:Ea,TextureSystem:Ba,TextureUvs:ya,Ticker:Ft,TickerPlugin:La,Transform:Si,TransformFeedback:_p,TransformFeedbackSystem:Oa,UPDATE_PRIORITY:We,UniformGroup:fe,VERSION:vp,VideoResource:Wn,ViewSystem:Mi,ViewableBuffer:vn,WRAP_MODES:Wt,autoDetectRenderer:xu,autoDetectResource:pa,checkMaxIfStatementsInShader:Yc,createUBOElements:mu,defaultFilterVertex:Ua,defaultVertex:bu,extensions:rt,generateProgram:fu,generateUniformBufferSync:_u,getTestContext:eu,getUBOData:gu,groupD8:Et,isMobile:Se,settings:j,uniformParsers:Ar,unsafeEvalSupported:nu,utils:wf},Symbol.toStringTag,{value:"Module"}));class wn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?pt.EMPTY:(t=t||new pt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,r){const{a:i,b:n,c:s,d:o,tx:a,ty:l}=t,h=i*r.x+s*r.y+a,c=n*r.x+o*r.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let r=this.minX,i=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];r=o<r?o:r,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],r=o<r?o:r,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],r=o<r?o:r,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],r=o<r?o:r,i=a<i?a:i,n=o>n?o:n,s=a>s?a:s,this.minX=r,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,r,i,n,s){this.addFrameMatrix(t.worldTransform,r,i,n,s)}addFrameMatrix(t,r,i,n,s){const o=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,g=this.maxY,m=o*r+l*i+c,_=a*r+h*i+u;d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*n+l*i+c,_=a*n+h*i+u,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*r+l*s+c,_=a*r+h*s+u,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,m=o*n+l*s+c,_=a*n+h*s+u,d=m<d?m:d,f=_<f?_:f,p=m>p?m:p,g=_>g?_:g,this.minX=d,this.minY=f,this.maxX=p,this.maxY=g}addVertexData(t,r,i){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;for(let l=r;l<i;l+=2){const h=t[l],c=t[l+1];n=h<n?h:n,s=c<s?c:s,o=h>o?h:o,a=c>a?c:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}addVertices(t,r,i,n){this.addVerticesMatrix(t.worldTransform,r,i,n)}addVerticesMatrix(t,r,i,n,s=0,o=s){const a=t.a,l=t.b,h=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,g=this.maxX,m=this.maxY;for(let _=i;_<n;_+=2){const w=r[_],v=r[_+1],E=a*w+h*v+u,y=c*v+l*w+d;f=Math.min(f,E-s),g=Math.max(g,E+s),p=Math.min(p,y-o),m=Math.max(m,y+o)}this.minX=f,this.minY=p,this.maxX=g,this.maxY=m}addBounds(t){const r=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,r){const i=t.minX>r.minX?t.minX:r.minX,n=t.minY>r.minY?t.minY:r.minY,s=t.maxX<r.maxX?t.maxX:r.maxX,o=t.maxY<r.maxY?t.maxY:r.maxY;if(i<=s&&n<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=o>c?o:c}}addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,r){const i=t.minX>r.x?t.minX:r.x,n=t.minY>r.y?t.minY:r.y,s=t.maxX<r.x+r.width?t.maxX:r.x+r.width,o=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(i<=s&&n<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=i<a?i:a,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=o>c?o:c}}pad(t=0,r=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)}addFramePad(t,r,i,n,s,o){t-=s,r-=o,i+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>n?this.maxY:n}}class Ct extends lr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Si,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new wn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const r=Object.keys(t);for(let i=0;i<r.length;++i){const n=r[i];Object.defineProperty(Ct.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new pt),r=this._boundsRect),this._bounds.getRectangle(r)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new pt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new wn);const r=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=r,this._bounds=n,this._bounds.updateID+=this._boundsID-s,o}toGlobal(t,r,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)}toLocal(t,r,i,n){return r&&(t=r.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,r=0,i=1,n=1,s=0,o=0,a=0,l=0,h=0){return this.position.x=t,this.position.y=r,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new yp),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Kc}set angle(t){this.transform.rotation=t*Sr}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount--,r._maskRefCount===0&&(r.renderable=!0,r.isMask=!1))}if(this._mask=t,this._mask){const r=this._mask.isMaskData?this._mask.maskObject:this._mask;r&&(r._maskRefCount===0&&(r.renderable=!1,r.isMask=!0),r._maskRefCount++)}}}}class yp extends Ct{constructor(){super(...arguments),this.sortDirty=null}}Ct.prototype.displayObjectUpdateTransform=Ct.prototype.updateTransform;const xp=new wt;function bp(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const zo=class extends Ct{constructor(){super(),this.children=[],this.sortableChildren=zo.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);Tr(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,Tr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Tr(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,i=t,n=i-r;let s;if(n>0&&n<=i){s=this.children.splice(r,n);for(let o=0;o<s.length;++o)s[o].parent=null,s[o].transform&&(s[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<s.length;++o)s[o].emit("removed",this),this.emit("childRemoved",s[o],this,o);return s}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const i=this.children[t];i._lastSortedIndex=t,!e&&i.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(bp),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let i=0,n=this.children.length;i<n;++i){const s=this.children[i];s.visible&&s.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==zo.prototype._render&&(r=this.getBounds(!0));const n=e.projection.transform;if(n&&(i?(i=xp.copyFrom(i),i.prepend(n)):i=n),r&&t.intersects(r,i))this._render(e);else if(this.cullArea)return;for(let s=0,o=this.children.length;s<o;++s){const a=this.children[s],l=a.cullable;a.cullable=l||!this.cullArea,a.render(e),a.cullable=l}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,i=this.children.length;r<i;++r)this.children[r].render(e)}}renderAdvanced(e){var n,s,o;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let a=0;a<t.length;a++)t[a].enabled&&this._enabledFilters.push(t[a])}const i=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Pt.NONE));if(i&&e.batch.flush(),t&&((s=this._enabledFilters)!=null&&s.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let a=0,l=this.children.length;a<l;++a)this.children[a].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&((o=this._enabledFilters)!=null&&o.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let i=0;i<r.length;++i)r[i].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let se=zo;se.defaultSortableChildren=!1;se.prototype.containerUpdateTransform=se.prototype.updateTransform;Object.defineProperties(j,{SORTABLE_CHILDREN:{get(){return se.defaultSortableChildren},set(e){dt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),se.defaultSortableChildren=e}}});const oi=new _t,Tp=new Uint16Array([0,1,2,0,2,3]);class ti extends se{constructor(t){super(),this._anchor=new Xt(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new vt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=at.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||$.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Tp,this.pluginName="batch",this.isSprite=!0,this._roundPixels=j.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ge(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ge(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const r=this.transform.worldTransform,i=r.a,n=r.b,s=r.c,o=r.d,a=r.tx,l=r.ty,h=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,g=0,m=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,m=c.y-d._y*u.height,g=m+c.height):(p=-d._x*u.width,f=p+u.width,m=-d._y*u.height,g=m+u.height),h[0]=i*p+s*m+a,h[1]=o*m+n*p+l,h[2]=i*f+s*m+a,h[3]=o*m+n*f+l,h[4]=i*f+s*g+a,h[5]=o*g+n*f+l,h[6]=i*p+s*g+a,h[7]=o*g+n*p+l,this._roundPixels){const _=j.RESOLUTION;for(let w=0;w<h.length;++w)h[w]=Math.round(h[w]*_)/_}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,r=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,o=s.a,a=s.b,l=s.c,h=s.d,c=s.tx,u=s.ty,d=-n._x*i.width,f=d+i.width,p=-n._y*i.height,g=p+i.height;r[0]=o*d+l*p+c,r[1]=h*p+a*d+u,r[2]=o*f+l*p+c,r[3]=h*p+a*f+u,r[4]=o*f+l*g+c,r[5]=h*g+a*f+u,r[6]=o*d+l*g+c,r[7]=h*g+a*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new wn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new pt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,oi);const r=this._texture.orig.width,i=this._texture.orig.height,n=-r*this.anchor.x;let s=0;return oi.x>=n&&oi.x<n+r&&(s=-i*this.anchor.y,oi.y>=s&&oi.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(t,r){const i=t instanceof $?t:$.from(t,r);return new ti(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const r=Ge(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const r=Ge(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||$.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Au=new wt;Ct.prototype._cacheAsBitmap=!1;Ct.prototype._cacheData=null;Ct.prototype._cacheAsBitmapResolution=null;Ct.prototype._cacheAsBitmapMultisample=null;class wp{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ct.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new wp),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Ct.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Ct.prototype._initCachedDisplayObject=function(t){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;i.pad(p)}i.ceil(j.RESOLUTION);const n=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=De.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${nr()}`;this._cacheData.textureCacheId=h,ht.addToCache(l.baseTexture,h),$.addToCache(l,h);const c=this.transform.localTransform.copyTo(Au).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(n,s,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const u=new ti(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(i.x/i.width),u.anchor.y=-(i.y/i.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};Ct.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Ct.prototype._initCachedDisplayObjectCanvas=function(t){var c;if((c=this._cacheData)!=null&&c.sprite)return;const r=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform;r.ceil(j.RESOLUTION);const o=De.create({width:r.width,height:r.height}),a=`cacheAsBitmap_${nr()}`;this._cacheData.textureCacheId=a,ht.addToCache(o.baseTexture,a),$.addToCache(o,a);const l=Au;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=r.x,l.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new ti(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(r.x/r.width),h.anchor.y=-(r.y/r.height),h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};Ct.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ct.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ct.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ht.removeFromCache(this._cacheData.textureCacheId),$.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ct.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Ct.prototype.name=null;se.prototype.getChildByName=function(t,r){for(let i=0,n=this.children.length;i<n;i++)if(this.children[i].name===t)return this.children[i];if(r)for(let i=0,n=this.children.length;i<n;i++){const s=this.children[i];if(!s.getChildByName)continue;const o=s.getChildByName(t,!0);if(o)return o}return null};Ct.prototype.getGlobalPosition=function(t=new _t,r=!1){return this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var Ap=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class Ep extends Lt{constructor(t=1){super(bu,Ap,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const Sp={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Cp=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Ip(e){const t=Sp[e],r=t.length;let i=Cp,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<e;a++){let l=s.replace("%index%",a.toString());o=a,a>=r&&(o=e-a-1),l=l.replace("%value%",t[o].toString()),n+=l,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}const Rp=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Mp(e,t){const r=Math.ceil(e/2);let i=Rp,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<e;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(r-1)}.0`),n+=a,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",e.toString()),i}class Xo extends Lt{constructor(t,r=8,i=4,n=Lt.defaultResolution,s=5){const o=Mp(s,t),a=Ip(s);super(o,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=r}apply(t,r,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/r.width):this.uniforms.strength=1/i.height*(i.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,i,n);else{const s=t.getFilterTexture(),o=t.renderer;let a=r,l=s;this.state.blend=!1,t.applyFilter(this,a,l,Ae.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,Ae.BLIT),this.uniforms.uSampler=l;const c=l;l=a,a=c,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,l,i,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class Pp extends Lt{constructor(t=8,r=4,i=Lt.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Xo(!0,t,r,i,n),this.blurYFilter=new Xo(!1,t,r,i,n),this.resolution=i,this.quality=r,this.blur=t,this.repeatEdgePixels=!1}apply(t,r,i,n){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=t.getFilterTexture();this.blurXFilter.apply(t,r,a,Ae.CLEAR),this.blurYFilter.apply(t,a,i,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,r,i,n):this.blurXFilter.apply(t,r,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var Fp=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class jo extends Lt{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Ua,Fp,t),this.alpha=1}_loadMatrix(t,r=!1){let i=t;r&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,r,i){return t[0]=r[0]*i[0]+r[1]*i[5]+r[2]*i[10]+r[3]*i[15],t[1]=r[0]*i[1]+r[1]*i[6]+r[2]*i[11]+r[3]*i[16],t[2]=r[0]*i[2]+r[1]*i[7]+r[2]*i[12]+r[3]*i[17],t[3]=r[0]*i[3]+r[1]*i[8]+r[2]*i[13]+r[3]*i[18],t[4]=r[0]*i[4]+r[1]*i[9]+r[2]*i[14]+r[3]*i[19]+r[4],t[5]=r[5]*i[0]+r[6]*i[5]+r[7]*i[10]+r[8]*i[15],t[6]=r[5]*i[1]+r[6]*i[6]+r[7]*i[11]+r[8]*i[16],t[7]=r[5]*i[2]+r[6]*i[7]+r[7]*i[12]+r[8]*i[17],t[8]=r[5]*i[3]+r[6]*i[8]+r[7]*i[13]+r[8]*i[18],t[9]=r[5]*i[4]+r[6]*i[9]+r[7]*i[14]+r[8]*i[19]+r[9],t[10]=r[10]*i[0]+r[11]*i[5]+r[12]*i[10]+r[13]*i[15],t[11]=r[10]*i[1]+r[11]*i[6]+r[12]*i[11]+r[13]*i[16],t[12]=r[10]*i[2]+r[11]*i[7]+r[12]*i[12]+r[13]*i[17],t[13]=r[10]*i[3]+r[11]*i[8]+r[12]*i[13]+r[13]*i[18],t[14]=r[10]*i[4]+r[11]*i[9]+r[12]*i[14]+r[13]*i[19]+r[14],t[15]=r[15]*i[0]+r[16]*i[5]+r[17]*i[10]+r[18]*i[15],t[16]=r[15]*i[1]+r[16]*i[6]+r[17]*i[11]+r[18]*i[16],t[17]=r[15]*i[2]+r[16]*i[7]+r[17]*i[12]+r[18]*i[17],t[18]=r[15]*i[3]+r[16]*i[8]+r[17]*i[13]+r[18]*i[18],t[19]=r[15]*i[4]+r[16]*i[9]+r[17]*i[14]+r[18]*i[19]+r[19],t}_colorMatrix(t){const r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(t,r){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}tint(t,r){const[i,n,s]=vt.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,r)}greyscale(t,r){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)}blackAndWhite(t){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)}hue(t,r){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=Math.sqrt,o=1/3,a=s(o),l=i+(1-i)*o,h=o*(1-i)-a*n,c=o*(1-i)+a*n,u=o*(1-i)+a*n,d=i+o*(1-i),f=o*(1-i)-a*n,p=o*(1-i)-a*n,g=o*(1-i)+a*n,m=i+o*(1-i),_=[l,h,c,0,0,u,d,f,0,0,p,g,m,0,0,0,0,0,1,0];this._loadMatrix(_,r)}contrast(t,r){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,r)}saturate(t=0,r){const i=t*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,r)}desaturate(){this.saturate(-1)}negative(t){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)}sepia(t){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)}technicolor(t){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)}polaroid(t){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)}toBGR(t){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)}kodachrome(t){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)}browni(t){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)}vintage(t){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)}colorTone(t,r,i,n,s){t=t||.2,r=r||.15,i=i||16770432,n=n||3375104;const o=vt.shared,[a,l,h]=o.setValue(i).toArray(),[c,u,d]=o.setValue(n).toArray(),f=[.3,.59,.11,0,0,a,l,h,t,0,c,u,d,r,0,a-c,l-u,h-d,0,0];this._loadMatrix(f,s)}night(t,r){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,r)}predator(t,r){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,r)}lsd(t){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}jo.prototype.grayscale=jo.prototype.greyscale;var Dp=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,Np=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class Bp extends Lt{constructor(t,r){const i=new wt;t.renderable=!1,super(Np,Dp,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,r==null&&(r=20),this.scale=new _t(r,r)}apply(t,r,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,o=Math.sqrt(s.a*s.a+s.b*s.b),a=Math.sqrt(s.c*s.c+s.d*s.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=s.a/o,this.uniforms.rotation[1]=s.b/o,this.uniforms.rotation[2]=s.c/a,this.uniforms.rotation[3]=s.d/a),t.applyFilter(this,r,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var Op=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Lp=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class Up extends Lt{constructor(){super(Lp,Op)}}var Gp=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class kp extends Lt{constructor(t=.5,r=Math.random()){super(Ua,Gp,{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Vh={AlphaFilter:Ep,BlurFilter:Pp,BlurFilterPass:Xo,ColorMatrixFilter:jo,DisplacementFilter:Bp,FXAAFilter:Up,NoiseFilter:kp};Object.entries(Vh).forEach(([e,t])=>{Object.defineProperty(Vh,e,{get(){return dt("7.1.0",`filters.${e} has moved to ${e}`),t}})});class Hp{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Ft.system.add(this.tickerUpdate,this,We.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ft.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Ze=new Hp;class Pi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Pi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new _t,this.page=new _t,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,r,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,r,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class An extends Pi{constructor(){super(...arguments),this.client=new _t,this.movement=new _t,this.offset=new _t,this.global=new _t,this.screen=new _t}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,r,i){return t.worldTransform.applyInverse(i||this.global,r)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,r,i,n,s,o,a,l,h,c,u,d,f,p,g){throw new Error("Method not implemented.")}}class be extends An{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class qr extends An{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}qr.DOM_DELTA_PIXEL=0;qr.DOM_DELTA_LINE=1;qr.DOM_DELTA_PAGE=2;const Vp=2048,zp=new _t,xo=new _t;class Xp{constructor(t){this.dispatch=new lr,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,r){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r),this.dispatch.emit(r||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const r=this.mappingTable[t.type];if(r)for(let i=0,n=r.length;i<n;i++)r[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,r){Ze.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[n](this.rootTarget,this.rootTarget.eventMode,zp.set(t,r),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,r){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,r,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(r)?r:[r];for(let s=i.length-1;s>=0;s--)n.forEach(o=>{t.currentTarget=i[s],this.notifyTarget(t,o)})}propagationPath(t){const r=[t];for(let i=0;i<Vp&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(t.parent),t=t.parent}return r.reverse(),r}hitTestMoveRecursive(t,r,i,n,s,o=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||r==="dynamic")&&(Ze.pauseUpdate=!1),t.interactiveChildren&&t.children){const c=t.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(r)?r:d.eventMode,i,n,s,o||s(t,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=t.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(t),f.push(t)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const l=this._isInteractive(r),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:a?this._hitElements:l&&!s(t,i)&&n(t,i)?h?[t]:[]:null}hitTestRecursive(t,r,i,n,s){if(this._interactivePrune(t)||s(t,i))return null;if((t.eventMode==="dynamic"||r==="dynamic")&&(Ze.pauseUpdate=!1),t.interactiveChildren&&t.children){const l=t.children;for(let h=l.length-1;h>=0;h--){const c=l[h],u=this.hitTestRecursive(c,this._isInteractive(r)?r:c.eventMode,i,n,s);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=t.isInteractive();return(u.length>0||d)&&u.push(t),u}}}const o=this._isInteractive(r),a=t.isInteractive();return o&&n(t,i)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,r){var i;if(t.hitArea&&(t.worldTransform.applyInverse(r,xo),!t.hitArea.contains(xo.x,xo.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,r)))return!0}return!1}hitTestFn(t,r){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(r):!1}notifyTarget(t,r){var s,o;r=r??t.type;const i=`on${r}`;(o=(s=t.currentTarget)[i])==null||o.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${r}capture`:r;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)}mapPointerDown(t){if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const n=r.button===2;this.dispatchEvent(r,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(t){var l,h;if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const r=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=r.pointerType==="mouse"||r.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((l=n.overTargets)==null?void 0:l.length)>0&&s!==r.target){const c=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,c,s);if(this.dispatchEvent(u,"pointerout"),i&&this.dispatchEvent(u,"mouseout"),!r.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),i&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(s!==r.target){const c=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(r,c);this.dispatchEvent(u,"pointerover"),i&&this.dispatchEvent(u,"mouseover");let d=s==null?void 0:s.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const p=this.clonePointerEvent(r,"pointerenter");for(p.eventPhase=p.AT_TARGET;p.target&&p.target!==s&&p.target!==this.rootTarget.parent;)p.currentTarget=p.target,this.notifyTarget(p),i&&this.notifyTarget(p,"mouseenter"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(u)}const o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(r,"pointermove"),a&&o.push("globalpointermove"),r.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(r,"touchmove"),a&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(r,"mousemove"),a&&o.push("globalmousemove"),this.cursor=(h=r.target)==null?void 0:h.cursor),o.length>0&&this.all(r,o),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var o;if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;r.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId);if(r.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(r.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(t,"pointerleave",n);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;r.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let o=s;if(s&&!i.composedPath().includes(s)){let a=s;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:r});const l=n.clicksByButton[t.button];if(l.target===a.target&&r-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=r,a.detail=l.clickCount,a.pointerType==="mouse"){const h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof be)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete r.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof qr)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const r=this.createWheelEvent(t);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(t){if(!t)return null;let r=t[0];for(let i=1;i<t.length&&t[i].parent===r;i++)r=t[i];return r}createPointerEvent(t,r,i){const n=this.allocateEvent(be);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof r=="string"&&(n.type=r),n}createWheelEvent(t){const r=this.allocateEvent(qr);return this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(t,r){const i=this.allocateEvent(be);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=r??i.type,i}copyWheelData(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ}copyPointerData(t,r){t instanceof be&&r instanceof be&&(r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist)}copyMouseData(t,r){t instanceof An&&r instanceof An&&(r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.client.copyFrom(t.client),r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.movement.copyFrom(t.movement),r.screen.copyFrom(t.screen),r.shiftKey=t.shiftKey,r.global.copyFrom(t.global))}copyData(t,r){r.isTrusted=t.isTrusted,r.srcElement=t.srcElement,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.which=t.which,r.layer.copyFrom(t.layer),r.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)}notifyListeners(t,r){const i=t.currentTarget._events[r];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(r,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(r,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const jp=1,Wp={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Wo=class{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Xp(null),Ze.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new be(null),this.rootWheelEvent=new qr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Wo.defaultEventFeatures},{set:(t,r,i)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[r]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r,Wo._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,i=t.length;r<i;r++){const n=t[r],s=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;Ze.pointerMoved();const t=this.normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const r=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(e);for(let n=0,s=i.length;n<s;n++){const o=this.bootstrapEvent(this.rootPointerEvent,i[n]);o.type+=r,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch"))return;const t=this.normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Ze.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Ze.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Ze.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){let i;this.domElement.parentElement?i=this.domElement.getBoundingClientRect():i={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*n,e.y=(r-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,i=e.changedTouches.length;r<i;r++){const n=e.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=jp),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Wp[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};let Ti=Wo;Ti.extension={name:"events",type:[q.RendererSystem,q.CanvasRendererSystem]};Ti.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};rt.add(Ti);function zh(e){return e==="dynamic"||e==="static"}const $p={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??zh(Ti.defaultEventMode)},set interactive(e){dt("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ti.defaultEventMode},set eventMode(e){this._internalInteractive=zh(e),this._internalEventMode=e},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,n)},removeEventListener(e,t,r){const i=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,n=typeof t=="function"?void 0:t;e=i?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,n)},dispatchEvent(e){if(!(e instanceof Pi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};Ct.mixin($p);const qp={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ct.mixin(qp);const Yp=9,Ki=100,Kp=0,Qp=0,Xh=2,jh=1,Jp=-1e3,Zp=-1e3,tm=2;class Eu{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Se.tablet||Se.phone)&&this.createTouchHook();const r=document.createElement("div");r.style.width=`${Ki}px`,r.style.height=`${Ki}px`,r.style.position="absolute",r.style.top=`${Kp}px`,r.style.left=`${Qp}px`,r.style.zIndex=Xh.toString(),this.div=r,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${jh}px`,t.style.height=`${jh}px`,t.style.position="absolute",t.style.top=`${Jp}px`,t.style.left=`${Zp}px`,t.style.zIndex=tm.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const r=t.children;if(r)for(let i=0;i<r.length;i++)this.updateAccessibleObjects(r[i])}update(){const t=performance.now();if(Se.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=n/o*l,c=s/a*l;let u=this.div;u.style.left=`${r}px`,u.style.top=`${i}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,Tr(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const g=f.worldTransform;f.hitArea?(u.style.left=`${(g.tx+p.x*g.a)*h}px`,u.style.top=`${(g.ty+p.y*g.d)*c}px`,u.style.width=`${p.width*g.a*h}px`,u.style.height=`${p.height*g.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*h}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*h}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:r,height:i}=this.renderer;t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let r=this.pool.pop();r||(r=document.createElement("button"),r.style.width=`${Ki}px`,r.style.height=`${Ki}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=Xh.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?r.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(r.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,r){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Pi(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,r.forEach(o=>n.dispatchEvent(s,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Yp&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Eu.extension={name:"accessibility",type:[q.RendererPlugin,q.CanvasRendererPlugin]};rt.add(Eu);const $o=class{constructor(e){this.stage=new se,e=Object.assign({forceCanvas:!1},e),this.renderer=xu(e),$o._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const r=$o._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let Xa=$o;Xa._plugins=[];rt.handleByList(q.Application,Xa._plugins);class Su{static init(t){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let r,i;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;r=n,i=s}this.renderer.resize(r,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Su.extension=q.Application;rt.add(Su);const Wh={loader:q.LoadParser,resolver:q.ResolveParser,cache:q.CacheParser,detection:q.DetectionParser};rt.handle(q.Asset,e=>{const t=e.ref;Object.entries(Wh).filter(([r])=>!!t[r]).forEach(([r,i])=>rt.add(Object.assign(t[r],{extension:t[r].extension??i})))},e=>{const t=e.ref;Object.keys(Wh).filter(r=>!!t[r]).forEach(r=>rt.remove(t[r]))});class em{constructor(t,r=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(t){t.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<r;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Fi(e,t){if(Array.isArray(t)){for(const r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Cr(e,t){const r=e.split("?")[0],i=kt.extname(r).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Ve=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(r=>typeof r=="string"?t(r):r):e),qo=(e,t)=>{const r=t.split("?")[1];return r&&(e+=`?${r}`),e};function Cu(e,t,r,i,n){const s=t[r];for(let o=0;o<s.length;o++){const a=s[o];r<t.length-1?Cu(e.replace(i[r],a),t,r+1,i,n):n.push(e.replace(i[r],a))}}function rm(e){const t=/\{(.*?)\}/g,r=e.match(t),i=[];if(r){const n=[];r.forEach(s=>{const o=s.substring(1,s.length-1).split(",");n.push(o)}),Cu(e,n,0,r,i)}else i.push(e);return i}const En=e=>!Array.isArray(e);class im{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const r=this._cache.get(t);return r||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),r}set(t,r){const i=Ve(t);let n;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(r)){n=l.getCacheableAssets(i,r);break}}n||(n={},i.forEach(a=>{n[a]=r}));const s=Object.keys(n),o={cacheKeys:s,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),s.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==r&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),r instanceof $){const a=r;i.forEach(l=>{a.baseTexture!==$.EMPTY.baseTexture&&ht.addToCache(a.baseTexture,l),$.addToCache(a,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const r=this._cacheMap.get(t);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const ai=new im;let nm=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,r,i)=>(this._parsersValidated=!1,t[r]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,r){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,s=null;if(r.loadParser&&(s=this._parserHash[r.loadParser],s||console.warn(`[Assets] specified load parser "${r.loadParser}" not found while loading ${t}`)),!s){for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.load&&((o=h.test)!=null&&o.call(h,t,r,this))){s=h;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,r,this),i.parser=s;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];h.parse&&h.parse&&await((a=h.testParse)==null?void 0:a.call(h,n,r,this))&&(n=await h.parse(n,r,this)||n,i.parser=h)}return n})(),i}async load(t,r){this._parsersValidated||this._validateParsers();let i=0;const n={},s=En(t),o=Ve(t,h=>({src:h})),a=o.length,l=o.map(async h=>{const c=kt.toAbsolute(h.src);if(!n[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),n[h.src]=await this.promiseCache[c].promise,r&&r(++i/a)}catch(u){throw delete this.promiseCache[c],delete n[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),s?n[o[0].src]:n}async unload(t){const i=Ve(t,n=>({src:n})).map(async n=>{var a,l;const s=kt.toAbsolute(n.src),o=this.promiseCache[s];if(o){const h=await o.promise;(l=(a=o.parser)==null?void 0:a.unload)==null||l.call(a,h,n,this),delete this.promiseCache[s]}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,r)=>(t[r.name]&&console.warn(`[Assets] loadParser name conflict "${r.name}"`),{...t,[r.name]:r}),{})}};var Ne=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Ne||{});const sm=".json",om="application/json",am={extension:{type:q.LoadParser,priority:Ne.Low},name:"loadJson",test(e){return Fi(e,om)||Cr(e,sm)},async load(e){return await(await j.ADAPTER.fetch(e)).json()}};rt.add(am);const lm=".txt",hm="text/plain",cm={name:"loadTxt",extension:{type:q.LoadParser,priority:Ne.Low},test(e){return Fi(e,hm)||Cr(e,lm)},async load(e){return await(await j.ADAPTER.fetch(e)).text()}};rt.add(cm);const um=["normal","bold","100","200","300","400","500","600","700","800","900"],dm=[".ttf",".otf",".woff",".woff2"],fm=["font/ttf","font/otf","font/woff","font/woff2"],pm=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function mm(e){const t=kt.extname(e),n=kt.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let s=n.length>0;for(const a of n)if(!a.match(pm)){s=!1;break}let o=n.join(" ");return s||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const gm={extension:{type:q.LoadParser,priority:Ne.Low},name:"loadWebFont",test(e){return Fi(e,fm)||Cr(e,dm)},async load(e,t){var i,n,s;const r=j.ADAPTER.getFontFaceSet();if(r){const o=[],a=((i=t.data)==null?void 0:i.family)??mm(e),l=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(c=>um.includes(c)))??["normal"],h=t.data??{};for(let c=0;c<l.length;c++){const u=l[c],d=new FontFace(a,`url(${encodeURI(e)})`,{...h,weight:u});await d.load(),r.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>j.ADAPTER.getFontFaceSet().delete(t))}};rt.add(gm);let $h=0,bo;const _m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",vm={code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${_m}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},ym={code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let To;class xm{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const r=URL.createObjectURL(new Blob([vm.code],{type:"application/javascript"})),i=new Worker(r);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(r),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){bo===void 0&&(bo=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<bo&&(To||(To=URL.createObjectURL(new Blob([ym.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(To),t.addEventListener("message",r=>{this.complete(r.data),this.returnWorker(r.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,r){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:t,arguments:r,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const r=this.queue.pop(),i=r.id;this.resolveHash[$h]={resolve:r.resolve,reject:r.reject},t.postMessage({data:r.arguments,uuid:$h++,id:i})}}const qh=new xm;function $n(e,t,r){const i=new $(e);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[r]}),i}const bm=[".jpeg",".jpg",".png",".webp",".avif"],Tm=["image/jpeg","image/png","image/webp","image/avif"];async function wm(e){const t=await j.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const r=await t.blob();return await createImageBitmap(r)}const qn={name:"loadTextures",extension:{type:q.LoadParser,priority:Ne.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return Fi(e,Tm)||Cr(e,bm)},async load(e,t,r){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await qh.isImageBitmapSupported()?i=await qh.loadImageBitmap(e):i=await wm(e):i=await new Promise(s=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?s(i):i.onload=()=>{s(i)}});const n=new ht(i,{resolution:Xe(e),...t.data});return n.resource.src=e,$n(n,r,e)},unload(e){e.destroy(!0)}};rt.add(qn);const Am=".svg",Em="image/svg+xml",Sm={extension:{type:q.LoadParser,priority:Ne.High},name:"loadSVG",test(e){return Fi(e,Em)||Cr(e,Am)},async testParse(e){return $r.test(e)},async parse(e,t,r){var o;const i=new $r(e,(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions);await i.load();const n=new ht(i,{resolution:Xe(e),...t==null?void 0:t.data});return n.resource.src=e,$n(n,r,e)},async load(e,t){return(await j.ADAPTER.fetch(e)).text()},unload:qn.unload};rt.add(Sm);class Cm{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,r)=>`${t}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(t,r)=>r.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const r=t;this._defaultSearchParams=Object.keys(r).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(r[i])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(t,r){const i=[];Array.isArray(r)?r.forEach(n=>{if(typeof n.name=="string"){const s=this._createBundleAssetId(t,n.name);i.push(s),this.add([n.name,s],n.srcs,n.data)}else{const s=n.name.map(o=>this._createBundleAssetId(t,o));s.forEach(o=>{i.push(o)}),this.add([...n.name,...s],n.srcs)}}):Object.keys(r).forEach(n=>{i.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],r[n])}),this._bundles[t]=i}add(t,r,i){const n=Ve(t);n.forEach(o=>{this.hasKey(o)&&console.warn(`[Resolver] already has key: ${o} overwriting`)}),Array.isArray(r)||(typeof r=="string"?r=rm(r):r=[r]);const s=r.map(o=>{let a=o;if(typeof o=="string"){let l=!1;for(let h=0;h<this._parsers.length;h++){const c=this._parsers[h];if(c.test(o)){a=c.parse(o),l=!0;break}}l||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=n),(this._basePath||this._rootPath)&&(a.src=kt.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??i,a});n.forEach(o=>{this._assetMap[o]=s})}resolveBundle(t){const r=En(t);t=Ve(t);const i={};return t.forEach(n=>{const s=this._bundles[n];if(s){const o=this.resolve(s),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(n,l)]=h}i[n]=a}}),r?i[t[0]]:i}resolveUrl(t){const r=this.resolve(t);if(typeof t!="string"){const i={};for(const n in r)i[n]=r[n].src;return i}return r.src}resolve(t){const r=En(t);t=Ve(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const o=this._getPreferredOrder(s),a=s[0];o==null||o.priority.forEach(l=>{o.params[l].forEach(h=>{const c=s.filter(u=>u[l]?u[l]===h:!1);c.length&&(s=c)})}),this._resolverHash[n]=s[0]??a}else{let s=n;(this._basePath||this._rootPath)&&(s=kt.toAbsolute(s,this._basePath,this._rootPath)),s=this._appendDefaultSearchParams(s),this._resolverHash[n]={src:s}}i[n]=this._resolverHash[n]}),r?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let r=0;r<t.length;r++){const i=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const r=/\?/.test(t)?"&":"?";return`${t}${r}${this._defaultSearchParams}`}}class Im{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Cm,this.loader=new nm,this.cache=ai,this._backgroundLoader=new em(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,o,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let l=t.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const r=((s=t.texturePreference)==null?void 0:s.resolution)??1,i=typeof r=="number"?[r]:r;let n=[];if((o=t.texturePreference)!=null&&o.format){const l=(a=t.texturePreference)==null?void 0:a.format;n=typeof l=="string"?[l]:l;for(const h of this._detections)await h.test()||(n=await h.remove(n))}else for(const l of this._detections)await l.test()&&(n=await l.add(n));this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,r,i){this.resolver.add(t,r,i)}async load(t,r){this._initialized||await this.init();const i=En(t),n=Ve(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),s=this.resolver.resolve(n),o=await this._mapLoadToResolve(s,r);return i?o[n[0]]:o}addBundle(t,r){this.resolver.addBundle(t,r)}async loadBundle(t,r){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},o=Object.keys(n);let a=0,l=0;const h=()=>{r==null||r(++a/l)},c=o.map(u=>{const d=n[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{s[u]=f})});return await Promise.all(c),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const r=this.resolver.resolveBundle(t);Object.values(r).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return ai.get(t);const r={};for(let i=0;i<t.length;i++)r[i]=ai.get(t[i]);return r}async _mapLoadToResolve(t,r){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,r);this._backgroundLoader.active=!0;const o={};return i.forEach((a,l)=>{const h=s[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[n[l]]=h,ai.set(c,h)}),o}async unload(t){this._initialized||await this.init();const r=Ve(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(r);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Ve(t);const r=this.resolver.resolveBundle(t),i=Object.keys(r).map(n=>this._unloadFromResolved(r[n]));await Promise.all(i)}async _unloadFromResolved(t){const r=Object.values(t);r.forEach(i=>{ai.remove(i.src)}),await this.loader.unload(r)}get detections(){return this._detections}get preferWorkers(){return qn.config.preferWorkers}set preferWorkers(t){dt("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(r=>{r.config&&Object.keys(r.config).filter(i=>i in t).forEach(i=>{r.config[i]=t[i]})})}}const er=new Im;rt.handleByList(q.LoadParser,er.loader.parsers).handleByList(q.ResolveParser,er.resolver.parsers).handleByList(q.CacheParser,er.cache.parsers).handleByList(q.DetectionParser,er.detections);const Rm={extension:q.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof $),getCacheableAssets:(e,t)=>{const r={};return e.forEach(i=>{t.forEach((n,s)=>{r[i+(s===0?"":s+1)]=n})}),r}};rt.add(Rm);const Mm={extension:{type:q.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await j.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};rt.add(Mm);const Pm={extension:{type:q.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await j.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(r=>r.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};rt.add(Pm);const Yh=["png","jpg","jpeg"],Fm={extension:{type:q.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...Yh],remove:async e=>e.filter(t=>!Yh.includes(t))};rt.add(Fm);const Dm={extension:q.ResolveParser,test:qn.test,parse:e=>{var t;return{resolution:parseFloat(((t=j.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};rt.add(Dm);var Kt=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(Kt||{});const Sn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Le,kr;function Kh(){kr={s3tc:Le.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Le.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Le.getExtension("WEBGL_compressed_texture_etc"),etc1:Le.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Le.getExtension("WEBGL_compressed_texture_pvrtc")||Le.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Le.getExtension("WEBGL_compressed_texture_atc"),astc:Le.getExtension("WEBGL_compressed_texture_astc")}}const Nm={extension:{type:q.DetectionParser,priority:2},test:async()=>{const t=j.ADAPTER.createCanvas().getContext("webgl");return t?(Le=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{kr||Kh();const t=[];for(const r in kr)kr[r]&&t.push(r);return[...t,...e]},remove:async e=>(kr||Kh(),e.filter(t=>!(t in kr)))};rt.add(Nm);class Bm extends Jr{constructor(t,r={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,r),this.origin=i,this.buffer=n?new vn(n):null,this._load=null,this.loaded=!1,this.origin!==null&&r.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new vn(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Er extends Bm{constructor(t,r){super(t,r),this.format=r.format,this.levels=r.levels||1,this._width=r.width,this._height=r.height,this._extension=Er._formatToExtension(this.format),(r.levelBuffers||this.buffer)&&(this._levelBuffers=r.levelBuffers||Er._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,r,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:h,levelHeight:c,levelBuffer:u}=this._levelBuffers[o];n.compressedTexImage2D(n.TEXTURE_2D,l,this.format,h,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Er._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,r,i,n,s,o,a){const l=new Array(i);let h=t.byteOffset,c=o,u=a,d=c+n-1&~(n-1),f=u+s-1&~(s-1),p=d*f*Sn[r];for(let g=0;g<i;g++)l[g]={levelID:g,levelWidth:i>1?c:d,levelHeight:i>1?u:f,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,c=c>>1||1,u=u>>1||1,d=c+n-1&~(n-1),f=u+s-1&~(s-1),p=d*f*Sn[r];return l}}const wo=4,Qi=124,Om=32,Qh=20,Lm=542327876,Ji={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Um={FOURCC:2},Zi={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},Gm=1,km=2,Hm=4,Vm=64,zm=512,Xm=131072,jm=827611204,Wm=861165636,$m=894720068,qm=808540228,Ym=4,Km={[jm]:Kt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Wm]:Kt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[$m]:Kt.COMPRESSED_RGBA_S3TC_DXT5_EXT},Qm={70:Kt.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Kt.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Kt.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Kt.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Kt.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Kt.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Kt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Kt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Kt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function Jm(e){const t=new Uint32Array(e);if(t[0]!==Lm)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(e,0,Qi/Uint32Array.BYTES_PER_ELEMENT),n=i[Ji.HEIGHT],s=i[Ji.WIDTH],o=i[Ji.MIPMAP_COUNT],a=new Uint32Array(e,Ji.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Om/Uint32Array.BYTES_PER_ELEMENT),l=a[Gm];if(l&Hm){const h=a[Um.FOURCC];if(h!==qm){const v=Km[h],E=wo+Qi,y=new Uint8Array(e,E);return[new Er(y,{format:v,width:s,height:n,levels:o})]}const c=wo+Qi,u=new Uint32Array(t.buffer,c,Qh/Uint32Array.BYTES_PER_ELEMENT),d=u[Zi.DXGI_FORMAT],f=u[Zi.RESOURCE_DIMENSION],p=u[Zi.MISC_FLAG],g=u[Zi.ARRAY_SIZE],m=Qm[d];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===Ym)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const _=new Array,w=wo+Qi+Qh;if(g===1)_.push(new Uint8Array(e,w));else{const v=Sn[m];let E=0,y=s,C=n;for(let F=0;F<o;F++){const G=Math.max(1,y+3&-4),k=Math.max(1,C+3&-4),U=G*k*v;E+=U,y=y>>>1,C=C>>>1}let x=w;for(let F=0;F<g;F++)_.push(new Uint8Array(e,x,E)),x+=E}return _.map(v=>new Er(v,{format:m,width:s,height:n,levels:o}))}throw l&Vm?new Error("DDSParser does not support uncompressed texture data."):l&zm?new Error("DDSParser does not supported YUV uncompressed texture data."):l&Xm?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&km?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Jh=[171,75,84,88,32,49,49,187,13,10,26,10],Zm=67305985,ve={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Yo=64,Zh={[Q.UNSIGNED_BYTE]:1,[Q.UNSIGNED_SHORT]:2,[Q.INT]:4,[Q.UNSIGNED_INT]:4,[Q.FLOAT]:4,[Q.HALF_FLOAT]:8},tg={[X.RGBA]:4,[X.RGB]:3,[X.RG]:2,[X.RED]:1,[X.LUMINANCE]:1,[X.LUMINANCE_ALPHA]:2,[X.ALPHA]:1},eg={[Q.UNSIGNED_SHORT_4_4_4_4]:2,[Q.UNSIGNED_SHORT_5_5_5_1]:2,[Q.UNSIGNED_SHORT_5_6_5]:2};function rg(e,t,r=!1){const i=new DataView(t);if(!ig(e,i))return null;const n=i.getUint32(ve.ENDIANNESS,!0)===Zm,s=i.getUint32(ve.GL_TYPE,n),o=i.getUint32(ve.GL_FORMAT,n),a=i.getUint32(ve.GL_INTERNAL_FORMAT,n),l=i.getUint32(ve.PIXEL_WIDTH,n),h=i.getUint32(ve.PIXEL_HEIGHT,n)||1,c=i.getUint32(ve.PIXEL_DEPTH,n)||1,u=i.getUint32(ve.NUMBER_OF_ARRAY_ELEMENTS,n)||1,d=i.getUint32(ve.NUMBER_OF_FACES,n),f=i.getUint32(ve.NUMBER_OF_MIPMAP_LEVELS,n),p=i.getUint32(ve.BYTES_OF_KEY_VALUE_DATA,n);if(h===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const g=4,m=4,_=l+3&-4,w=h+3&-4,v=new Array(u);let E=l*h;s===0&&(E=_*w);let y;if(s!==0?Zh[s]?y=Zh[s]*tg[o]:y=eg[s]:y=Sn[a],y===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=r?sg(i,p,n):null;let F=E*y,G=l,k=h,U=_,I=w,L=Yo+p;for(let R=0;R<f;R++){const W=i.getUint32(L,n);let T=L+4;for(let A=0;A<u;A++){let b=v[A];b||(b=v[A]=new Array(f)),b[R]={levelID:R,levelWidth:f>1||s!==0?G:U,levelHeight:f>1||s!==0?k:I,levelBuffer:new Uint8Array(t,T,F)},T+=F}L+=W+4,L=L%4!==0?L+4-L%4:L,G=G>>1||1,k=k>>1||1,U=G+g-1&-4,I=k+m-1&-4,F=U*I*y}return s!==0?{uncompressed:v.map(R=>{let W=R[0].levelBuffer,T=!1;return s===Q.FLOAT?W=new Float32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4):s===Q.UNSIGNED_INT?(T=!0,W=new Uint32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)):s===Q.INT&&(T=!0,W=new Int32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)),{resource:new Jr(W,{width:R[0].levelWidth,height:R[0].levelHeight}),type:s,format:T?ng(o):o}}),kvData:C}:{compressed:v.map(R=>new Er(null,{format:a,width:l,height:h,levels:f,levelBuffers:R})),kvData:C}}function ig(e,t){for(let r=0;r<Jh.length;r++)if(t.getUint8(r)!==Jh[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function ng(e){switch(e){case X.RGBA:return X.RGBA_INTEGER;case X.RGB:return X.RGB_INTEGER;case X.RG:return X.RG_INTEGER;case X.RED:return X.RED_INTEGER;default:return e}}function sg(e,t,r){const i=new Map;let n=0;for(;n<t;){const s=e.getUint32(Yo+n,r),o=Yo+n+4,a=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<s&&e.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(e.buffer,o,l)),c=new DataView(e.buffer,o+l+1,s-l-1);i.set(h,c),n+=4+s+a}return i}const og={extension:{type:q.LoadParser,priority:Ne.High},name:"loadDDS",test(e){return Cr(e,".dds")},async load(e,t,r){const n=await(await j.ADAPTER.fetch(e)).arrayBuffer(),o=Jm(n).map(a=>{const l=new ht(a,{mipmap:ne.OFF,alphaMode:Vt.NO_PREMULTIPLIED_ALPHA,resolution:Xe(e),...t.data});return $n(l,r,e)});return o.length===1?o[0]:o},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};rt.add(og);const ag={extension:{type:q.LoadParser,priority:Ne.High},name:"loadKTX",test(e){return Cr(e,".ktx")},async load(e,t,r){const n=await(await j.ADAPTER.fetch(e)).arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=rg(e,n),l=s??o,h={mipmap:ne.OFF,alphaMode:Vt.NO_PREMULTIPLIED_ALPHA,resolution:Xe(e),...t.data},c=l.map(u=>{l===o&&Object.assign(h,{type:u.type,format:u.format});const d=new ht(u,h);return d.ktxKeyValueData=a,$n(d,r,e)});return c.length===1?c[0]:c},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};rt.add(ag);const lg={extension:q.ResolveParser,test:e=>{const r=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(r)},parse:e=>{var i,n;if(e.split("?")[0].split(".").pop()==="ktx"){const s=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(s.some(o=>e.endsWith(o)))return{resolution:parseFloat(((i=j.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:s.find(o=>e.endsWith(o)),src:e}}return{resolution:parseFloat(((n=j.RETINA_PREFIX.exec(e))==null?void 0:n[1])??"1"),format:e.split(".").pop(),src:e}}};rt.add(lg);const hg=new pt,cg=4,fi=class{constructor(e){this.renderer=e}async image(e,t,r){const i=new Image;return i.src=await this.base64(e,t,r),i}async base64(e,t,r){const i=this.canvas(e);if(i.toBlob!==void 0)return new Promise((n,s)=>{i.toBlob(o=>{if(!o){s(new Error("ICanvas.toBlob failed!"));return}const a=new FileReader;a.onload=()=>n(a.result),a.onerror=s,a.readAsDataURL(o)},t,r)});if(i.toDataURL!==void 0)return i.toDataURL(t,r);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:t,quality:r});return new Promise((s,o)=>{const a=new FileReader;a.onload=()=>s(a.result),a.onerror=o,a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:r,width:i,height:n,flipY:s}=this._rawPixels(e,t);s&&fi._flipY(r,i,n),fi._unpremultiplyAlpha(r);const o=new jc(i,n,1),a=new ImageData(new Uint8ClampedArray(r.buffer),i,n);return o.context.putImageData(a,0,0),o.canvas}pixels(e,t){const{pixels:r,width:i,height:n,flipY:s}=this._rawPixels(e,t);return s&&fi._flipY(r,i,n),fi._unpremultiplyAlpha(r),r}_rawPixels(e,t){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let i,n=!1,s,o=!1;if(e&&(e instanceof De?s=e:(s=r.generateTexture(e,{resolution:r.resolution,multisample:r.multisample}),o=!0)),s){if(i=s.baseTexture.resolution,t=t??s.frame,n=!1,!o){r.renderTexture.bind(s);const u=s.framebuffer.glFramebuffers[r.CONTEXT_UID];u.blitFramebuffer&&r.framebuffer.bind(u.blitFramebuffer)}}else i=r.resolution,t||(t=hg,t.width=r.width/i,t.height=r.height/i),n=!0,r.renderTexture.bind();const a=Math.round(t.width*i),l=Math.round(t.height*i),h=new Uint8Array(cg*a*l),c=r.gl;return c.readPixels(Math.round(t.x*i),Math.round(t.y*i),a,l,c.RGBA,c.UNSIGNED_BYTE,h),o&&(s==null||s.destroy(!0)),{pixels:h,width:a,height:l,flipY:n}}destroy(){this.renderer=null}static _flipY(e,t,r){const i=t<<2,n=r>>1,s=new Uint8Array(i);for(let o=0;o<n;o++){const a=o*i,l=(r-o-1)*i;s.set(e.subarray(a,a+i)),e.copyWithin(a,l,l+i),e.set(s,l)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let r=0;r<t;r+=4){const i=e[r+3];if(i!==0){const n=255.001/i;e[r]=e[r]*n+.5,e[r+1]=e[r+1]*n+.5,e[r+2]=e[r+2]*n+.5}}}};let Iu=fi;Iu.extension={name:"extract",type:q.RendererSystem};rt.add(Iu);const Cn={build(e){const t=e.points;let r,i,n,s,o,a;if(e.type===Ot.CIRC){const p=e.shape;r=p.x,i=p.y,o=a=p.radius,n=s=0}else if(e.type===Ot.ELIP){const p=e.shape;r=p.x,i=p.y,o=p.width,a=p.height,n=s=0}else{const p=e.shape,g=p.width/2,m=p.height/2;r=p.x+g,i=p.y+m,o=a=Math.max(0,Math.min(p.radius,Math.min(g,m))),n=g-o,s=m-a}if(!(o>=0&&a>=0&&n>=0&&s>=0)){t.length=0;return}const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(n?4:0)+(s?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=r+n,t[1]=t[3]=i+s,t[2]=t[4]=r-n,t[5]=t[7]=i-s;return}let c=0,u=l*4+(n?2:0)+2,d=u,f=h;{const p=n+o,g=s,m=r+p,_=r-p,w=i+g;if(t[c++]=m,t[c++]=w,t[--u]=w,t[--u]=_,s){const v=i-g;t[d++]=_,t[d++]=v,t[--f]=v,t[--f]=m}}for(let p=1;p<l;p++){const g=Math.PI/2*(p/l),m=n+Math.cos(g)*o,_=s+Math.sin(g)*a,w=r+m,v=r-m,E=i+_,y=i-_;t[c++]=w,t[c++]=E,t[--u]=E,t[--u]=v,t[d++]=v,t[d++]=y,t[--f]=y,t[--f]=w}{const p=n,g=s+a,m=r+p,_=r-p,w=i+g,v=i-g;t[c++]=m,t[c++]=w,t[--f]=v,t[--f]=m,n&&(t[c++]=_,t[c++]=w,t[--f]=v,t[--f]=_)}},triangulate(e,t){const r=e.points,i=t.points,n=t.indices;if(r.length===0)return;let s=i.length/2;const o=s;let a,l;if(e.type!==Ot.RREC){const c=e.shape;a=c.x,l=c.y}else{const c=e.shape;a=c.x+c.width/2,l=c.y+c.height/2}const h=e.matrix;i.push(e.matrix?h.a*a+h.c*l+h.tx:a,e.matrix?h.b*a+h.d*l+h.ty:l),s++,i.push(r[0],r[1]);for(let c=2;c<r.length;c+=2)i.push(r[c],r[c+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function tc(e,t=!1){const r=e.length;if(r<6)return;let i=0;for(let n=0,s=e[r-2],o=e[r-1];n<r;n+=2){const a=e[n],l=e[n+1];i+=(a-s)*(l+o),s=a,o=l}if(!t&&i>0||t&&i<=0){const n=r/2;for(let s=n+n%2;s<r;s+=2){const o=r-s-2,a=r-s-1,l=s,h=s+1;[e[o],e[l]]=[e[l],e[o]],[e[a],e[h]]=[e[h],e[a]]}}}const Ru={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points;const i=e.holes,n=t.points,s=t.indices;if(r.length>=6){tc(r,!1);const o=[];for(let h=0;h<i.length;h++){const c=i[h];tc(c.points,!0),o.push(r.length/2),r=r.concat(c.points)}const a=Ac(r,o,2);if(!a)return;const l=n.length/2;for(let h=0;h<a.length;h+=3)s.push(a[h]+l),s.push(a[h+1]+l),s.push(a[h+2]+l);for(let h=0;h<r.length;h++)n.push(r[h])}}},ug={build(e){const t=e.shape,r=t.x,i=t.y,n=t.width,s=t.height,o=e.points;o.length=0,n>=0&&s>=0&&o.push(r,i,r+n,i,r+n,i+s,r,i+s)},triangulate(e,t){const r=e.points,i=t.points;if(r.length===0)return;const n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},dg={build(e){Cn.build(e)},triangulate(e,t){Cn.triangulate(e,t)}};var we=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(we||{}),xr=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(xr||{});const Yr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class ec{static curveTo(t,r,i,n,s,o){const a=o[o.length-2],h=o[o.length-1]-r,c=a-t,u=n-r,d=i-t,f=Math.abs(h*d-c*u);if(f<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==r)&&o.push(t,r),null;const p=h*h+c*c,g=u*u+d*d,m=h*u+c*d,_=s*Math.sqrt(p)/f,w=s*Math.sqrt(g)/f,v=_*m/p,E=w*m/g,y=_*d+w*c,C=_*u+w*h,x=c*(w+v),F=h*(w+v),G=d*(_+E),k=u*(_+E),U=Math.atan2(F-C,x-y),I=Math.atan2(k-C,G-y);return{cx:y+t,cy:C+r,radius:s,startAngle:U,endAngle:I,anticlockwise:c*u>d*h}}static arc(t,r,i,n,s,o,a,l,h){const c=a-o,u=Yr._segmentsCount(Math.abs(c)*s,Math.ceil(Math.abs(c)/bi)*40),d=c/(u*2),f=d*2,p=Math.cos(d),g=Math.sin(d),m=u-1,_=m%1/m;for(let w=0;w<=m;++w){const v=w+_*w,E=d+o+f*v,y=Math.cos(E),C=-Math.sin(E);h.push((p*y+g*C)*s+i,(p*-C+g*y)*s+n)}}}class fg{constructor(){this.reset()}begin(t,r,i){this.reset(),this.style=t,this.start=r,this.attribStart=i}end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class ja{static curveLength(t,r,i,n,s,o,a,l){let c=0,u=0,d=0,f=0,p=0,g=0,m=0,_=0,w=0,v=0,E=0,y=t,C=r;for(let x=1;x<=10;++x)u=x/10,d=u*u,f=d*u,p=1-u,g=p*p,m=g*p,_=m*t+3*g*u*i+3*p*d*s+f*a,w=m*r+3*g*u*n+3*p*d*o+f*l,v=y-_,E=C-w,y=_,C=w,c+=Math.sqrt(v*v+E*E);return c}static curveTo(t,r,i,n,s,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const c=Yr._segmentsCount(ja.curveLength(l,h,t,r,i,n,s,o));let u=0,d=0,f=0,p=0,g=0;a.push(l,h);for(let m=1,_=0;m<=c;++m)_=m/c,u=1-_,d=u*u,f=d*u,p=_*_,g=p*_,a.push(f*l+3*d*_*t+3*u*p*i+g*s,f*h+3*d*_*r+3*u*p*n+g*o)}}function rc(e,t,r,i,n,s,o,a){const l=e-r*n,h=t-i*n,c=e+r*s,u=t+i*s;let d,f;o?(d=i,f=-r):(d=-i,f=r);const p=l+d,g=h+f,m=c+d,_=u+f;return a.push(p,g,m,_),2}function fr(e,t,r,i,n,s,o,a){const l=r-e,h=i-t;let c=Math.atan2(l,h),u=Math.atan2(n-e,s-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),g=Math.sqrt(l*l+h*h),m=(15*p*Math.sqrt(g)/Math.PI>>0)+1,_=f/m;if(d+=_,a){o.push(e,t,r,i);for(let w=1,v=d;w<m;w++,v+=_)o.push(e,t,e+Math.sin(v)*g,t+Math.cos(v)*g);o.push(e,t,n,s)}else{o.push(r,i,e,t);for(let w=1,v=d;w<m;w++,v+=_)o.push(e+Math.sin(v)*g,t+Math.cos(v)*g,e,t);o.push(n,s,e,t)}return m*2}function pg(e,t){const r=e.shape;let i=e.points||r.points.slice();const n=t.closePointEps;if(i.length===0)return;const s=e.lineStyle,o=new _t(i[0],i[1]),a=new _t(i[i.length-2],i[i.length-1]),l=r.type!==Ot.POLY||r.closeStroke,h=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const A=(o.x+a.x)*.5,b=(a.y+o.y)*.5;i.unshift(A,b),i.push(A,b)}const c=t.points,u=i.length/2;let d=i.length;const f=c.length/2,p=s.width/2,g=p*p,m=s.miterLimit*s.miterLimit;let _=i[0],w=i[1],v=i[2],E=i[3],y=0,C=0,x=-(w-E),F=_-v,G=0,k=0,U=Math.sqrt(x*x+F*F);x/=U,F/=U,x*=p,F*=p;const I=s.alignment,L=(1-I)*2,R=I*2;l||(s.cap===xr.ROUND?d+=fr(_-x*(L-R)*.5,w-F*(L-R)*.5,_-x*L,w-F*L,_+x*R,w+F*R,c,!0)+2:s.cap===xr.SQUARE&&(d+=rc(_,w,x,F,L,R,!0,c))),c.push(_-x*L,w-F*L,_+x*R,w+F*R);for(let A=1;A<u-1;++A){_=i[(A-1)*2],w=i[(A-1)*2+1],v=i[A*2],E=i[A*2+1],y=i[(A+1)*2],C=i[(A+1)*2+1],x=-(w-E),F=_-v,U=Math.sqrt(x*x+F*F),x/=U,F/=U,x*=p,F*=p,G=-(E-C),k=v-y,U=Math.sqrt(G*G+k*k),G/=U,k/=U,G*=p,k*=p;const b=v-_,P=w-E,S=v-y,M=C-E,B=b*S+P*M,D=P*S-M*b,H=D<0;if(Math.abs(D)<.001*Math.abs(B)){c.push(v-x*L,E-F*L,v+x*R,E+F*R),B>=0&&(s.join===we.ROUND?d+=fr(v,E,v-x*L,E-F*L,v-G*L,E-k*L,c,!1)+4:d+=2,c.push(v-G*R,E-k*R,v+G*L,E+k*L));continue}const V=(-x+_)*(-F+E)-(-x+v)*(-F+w),Y=(-G+y)*(-k+E)-(-G+v)*(-k+C),K=(b*Y-S*V)/D,J=(M*V-P*Y)/D,it=(K-v)*(K-v)+(J-E)*(J-E),z=v+(K-v)*L,tt=E+(J-E)*L,nt=v-(K-v)*R,ut=E-(J-E)*R,gt=Math.min(b*b+P*P,S*S+M*M),et=H?L:R,st=gt+et*et*g,Rt=it<=st;let Dt=s.join;if(Dt===we.MITER&&it/g>m&&(Dt=we.BEVEL),Rt)switch(Dt){case we.MITER:{c.push(z,tt,nt,ut);break}case we.BEVEL:{H?c.push(z,tt,v+x*R,E+F*R,z,tt,v+G*R,E+k*R):c.push(v-x*L,E-F*L,nt,ut,v-G*L,E-k*L,nt,ut),d+=2;break}case we.ROUND:{H?(c.push(z,tt,v+x*R,E+F*R),d+=fr(v,E,v+x*R,E+F*R,v+G*R,E+k*R,c,!0)+4,c.push(z,tt,v+G*R,E+k*R)):(c.push(v-x*L,E-F*L,nt,ut),d+=fr(v,E,v-x*L,E-F*L,v-G*L,E-k*L,c,!1)+4,c.push(v-G*L,E-k*L,nt,ut));break}}else{switch(c.push(v-x*L,E-F*L,v+x*R,E+F*R),Dt){case we.MITER:{H?c.push(nt,ut,nt,ut):c.push(z,tt,z,tt),d+=2;break}case we.ROUND:{H?d+=fr(v,E,v+x*R,E+F*R,v+G*R,E+k*R,c,!0)+2:d+=fr(v,E,v-x*L,E-F*L,v-G*L,E-k*L,c,!1)+2;break}}c.push(v-G*L,E-k*L,v+G*R,E+k*R),d+=2}}_=i[(u-2)*2],w=i[(u-2)*2+1],v=i[(u-1)*2],E=i[(u-1)*2+1],x=-(w-E),F=_-v,U=Math.sqrt(x*x+F*F),x/=U,F/=U,x*=p,F*=p,c.push(v-x*L,E-F*L,v+x*R,E+F*R),l||(s.cap===xr.ROUND?d+=fr(v-x*(L-R)*.5,E-F*(L-R)*.5,v-x*L,E-F*L,v+x*R,E+F*R,c,!1)+2:s.cap===xr.SQUARE&&(d+=rc(v,E,x,F,L,R,!1,c)));const W=t.indices,T=Yr.epsilon*Yr.epsilon;for(let A=f;A<d+f-2;++A)_=c[A*2],w=c[A*2+1],v=c[(A+1)*2],E=c[(A+1)*2+1],y=c[(A+2)*2],C=c[(A+2)*2+1],!(Math.abs(_*(E-C)+v*(C-w)+y*(w-E))<T)&&W.push(A,A+1,A+2)}function mg(e,t){let r=0;const i=e.shape,n=e.points||i.points,s=i.type!==Ot.POLY||i.closeStroke;if(n.length===0)return;const o=t.points,a=t.indices,l=n.length/2,h=o.length/2;let c=h;for(o.push(n[0],n[1]),r=1;r<l;r++)o.push(n[r*2],n[r*2+1]),a.push(c,c+1),c++;s&&a.push(c,h)}function ic(e,t){e.lineStyle.native?mg(e,t):pg(e,t)}class Wa{static curveLength(t,r,i,n,s,o){const a=t-2*i+s,l=r-2*n+o,h=2*i-2*t,c=2*n-2*r,u=4*(a*a+l*l),d=4*(a*h+l*c),f=h*h+c*c,p=2*Math.sqrt(u+d+f),g=Math.sqrt(u),m=2*u*g,_=2*Math.sqrt(f),w=d/g;return(m*p+g*d*(p-_)+(4*f*u-d*d)*Math.log((2*g+w+p)/(w+_)))/(4*m)}static curveTo(t,r,i,n,s){const o=s[s.length-2],a=s[s.length-1],l=Yr._segmentsCount(Wa.curveLength(o,a,t,r,i,n));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=o+(t-o)*d,c=a+(r-a)*d,s.push(h+(t+(i-t)*d-h)*d,c+(r+(n-r)*d-c)*d)}}}const Ao={[Ot.POLY]:Ru,[Ot.CIRC]:Cn,[Ot.ELIP]:Cn,[Ot.RECT]:ug,[Ot.RREC]:dg},nc=[],tn=[];class In{constructor(t,r=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=r,this.matrix=n,this.type=t.type}clone(){return new In(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Lr=new _t,Mu=class extends Vn{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new wn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),tn.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),nc.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,i=null){const n=new In(e,t,r,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const r=new In(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let r=0;r<t.length;++r){const i=t[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,Lr):Lr.copyFrom(e),i.shape.contains(Lr.x,Lr.y))){let n=!1;if(i.holes){for(let s=0;s<i.holes.length;s++)if(i.holes[s].shape.contains(Lr.x,Lr.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const l=t[a],h=l.fillStyle,c=l.lineStyle;Ao[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?h:c;if(!f.visible)continue;const p=f.texture.baseTexture,g=this.indices.length,m=this.points.length/2;p.wrapMode=Wt.REPEAT,d===0?this.processFill(l):this.processLine(l);const _=this.points.length/2-m;_!==0&&(r&&!this._compareStyles(i,f)&&(r.end(g,m),r=null),r||(r=nc.pop()||new fg,r.begin(f,g,m),this.batches.push(r),i=f),this.addUvs(this.points,e,f.texture,m,_,f.matrix))}}const n=this.indices.length,s=this.points.length/2;if(r&&r.end(n,s),this.batches.length===0){this.batchable=!0;return}const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const r=this.graphicsData[e],i=r.fillStyle,n=r.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,r=e.length;t<r;t++){const i=e[t];for(let n=0;n<i.size;n++){const s=i.start+n;this.indicesUint16[s]=this.indicesUint16[s]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Mu.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++ht._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),tn.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,r=this.textureIds;let i=tn.pop();i||(i=new xn,i.texArray=new bn),i.texArray.count=0,i.start=0,i.size=0,i.type=Jt.TRIANGLES;let n=0,s=null,o=0,a=!1,l=Jt.TRIANGLES,h=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?Jt.LINES:Jt.TRIANGLES,s=null,n=d,e++),s!==p&&(s=p,p._batchEnabled!==e&&(n===d&&(e++,n=0,i.size>0&&(i=tn.pop(),i||(i=new xn,i.texArray=new bn),this.drawCalls.push(i)),i.start=h,i.size=0,i.texArray.count=0,i.type=l),p.touched=1,p._batchEnabled=e,p._batchLocation=n,p.wrapMode=Wt.REPEAT,i.texArray.elements[i.texArray.count++]=p,n++)),i.size+=u.size,h+=u.size,o=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(r,o,u.attribSize,u.attribStart)}ht._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(e.length*3*4),s=new Float32Array(n),o=new Uint32Array(n);let a=0;for(let l=0;l<e.length/2;l++)s[a++]=e[l*2],s[a++]=e[l*2+1],s[a++]=t[l*2],s[a++]=t[l*2+1],o[a++]=r[l],s[a++]=i[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Ru.triangulate(e,this):Ao[e.type].triangulate(e,this)}processLine(e){ic(e,this);for(let t=0;t<e.holes.length;t++)ic(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const r=e[t];Ao[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){const i=e[r*2],n=e[r*2+1];e[r*2]=t.a*i+t.c*n+t.tx,e[r*2+1]=t.b*i+t.d*n+t.ty}}addColors(e,t,r,i,n=0){const s=vt.shared.setValue(t).toLittleEndianNumber(),o=vt.shared.setValue(s).toPremultiplied(r);e.length=Math.max(e.length,n+i);for(let a=0;a<i;a++)e[n+a]=o}addTextureIds(e,t,r,i=0){e.length=Math.max(e.length,i+r);for(let n=0;n<r;n++)e[i+n]=t}addUvs(e,t,r,i,n,s=null){let o=0;const a=t.length,l=r.frame;for(;o<n;){let c=e[(i+o)*2],u=e[(i+o)*2+1];if(s){const d=s.a*c+s.c*u+s.tx;u=s.b*c+s.d*u+s.ty,c=d}o++,t.push(c/l.width,u/l.height)}const h=r.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,r,a,n)}adjustUvs(e,t,r,i){const n=t.baseTexture,s=1e-6,o=r+i*2,a=t.frame,l=a.width/n.width,h=a.height/n.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(e[r]+s),f=Math.floor(e[r+1]+s);for(let p=r+2;p<o;p+=2)d=Math.min(d,Math.floor(e[p]+s)),f=Math.min(f,Math.floor(e[p+1]+s));c-=d,u-=f;for(let p=r;p<o;p+=2)e[p]=(e[p]+c)*l,e[p+1]=(e[p+1]+u)*h}};let Pu=Mu;Pu.BATCHABLE_SIZE=100;class Yn{constructor(){this.color=16777215,this.alpha=1,this.texture=$.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Yn;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=$.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class $a extends Yn{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=xr.BUTT,this.join=we.MITER,this.miterLimit=10}clone(){const t=new $a;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Eo={},hn=class extends se{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Yn,this._lineStyle=new $a,this._matrix=null,this._holeMode=!1,this.state=$t.for2d(),this._geometry=e||new Pu,this._geometry.refCount++,this._transformID=-1,this._tintColor=new vt(16777215),this.blendMode=at.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new hn(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r,i=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:r,alignment:i,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:$.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:xr.BUTT,join:we.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new wr,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new wr,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return(i!==e||n!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Wa.curveTo(e,t,r,i,n),this}bezierCurveTo(e,t,r,i,n,s){return this._initCurve(),ja.curveTo(e,t,r,i,n,s,this.currentPath.points),this}arcTo(e,t,r,i,n){this._initCurve(e,t);const s=this.currentPath.points,o=ec.curveTo(e,t,r,i,n,s);if(o){const{cx:a,cy:l,radius:h,startAngle:c,endAngle:u,anticlockwise:d}=o;this.arc(a,l,h,c,u,d)}return this}arc(e,t,r,i,n,s=!1){if(i===n)return this;if(!s&&n<=i?n+=bi:s&&i<=n&&(i+=bi),n-i===0)return this;const a=e+Math.cos(i)*r,l=t+Math.sin(i)*r,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return ec.arc(a,l,e,t,r,i,n,s,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:$.WHITE,color:e,alpha:t})}normalizeColor(e){const t=vt.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:$.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const r=e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:r},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,i){return this.drawShape(new pt(e,t,r,i))}drawRoundedRect(e,t,r,i,n){return this.drawShape(new jn(e,t,r,i,n))}drawCircle(e,t,r){return this.drawShape(new zn(e,t,r))}drawEllipse(e,t,r,i){return this.drawShape(new Xn(e,t,r,i))}drawPolygon(...e){let t,r=!0;const i=e[0];i.points?(r=i.closeStroke,t=i.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new wr(t);return n.closeStroke=r,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Ot.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let i=0;i<r;i++){const n=e.batches[i],s=n.style.color,o=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),a=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),h={vertexData:o,blendMode:t,indices:l,uvs:a,_batchRGB:vt.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=h}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,e.plugins[this.pluginName].render(i)}}}_renderDirect(e){const t=this._resolveDirectShader(e),r=this._geometry,i=this.worldAlpha,n=t.uniforms,s=r.drawCalls;n.translationMatrix=this.transform.worldTransform,vt.shared.setValue(this._tintColor).premultiply(i).toArray(n.tint),e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let o=0,a=s.length;o<a;o++)this._renderDrawCallDirect(e,r.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:r,type:i,size:n,start:s}=t,o=r.count;for(let a=0;a<o;a++)e.texture.bind(r.elements[a],a);e.geometry.draw(i,n,s)}_resolveDirectShader(e){let t=this.shader;const r=this.pluginName;if(!t){if(!Eo[r]){const{maxTextures:i}=e.plugins[r],n=new Int32Array(i);for(let a=0;a<i;a++)n[a]=a;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new wt,default:fe.from({uSamplers:n},!0)},o=e.plugins[r]._shader.program;Eo[r]=new Fe(o,s)}t=Eo[r]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:r,maxX:i,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,r,i,n)}containsPoint(e){return this.worldTransform.applyInverse(e,hn._TEMP_POINT),this._geometry.containsPoint(hn._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=vt.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,r=t.a,i=t.b,n=t.c,s=t.d,o=t.tx,a=t.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let u=0;u<l.length;u+=2){const d=l[u],f=l[u+1];h[c++]=r*d+n*f+o,h[c++]=s*f+i*d+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Di=hn;Di.curves=Yr;Di._TEMP_POINT=new _t;class gg{constructor(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const r=this.uvBuffer.data;(!this.data||this.data.length!==r.length)&&(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}}const So=new _t,sc=new wr,Fu=class extends se{constructor(e,t,r,i=Jt.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||$t.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=j.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Jt.TRIANGLES&&t.length<Fu.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],r=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));const n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,l=n.d,h=n.tx,c=n.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=r[d*2],p=r[d*2+1];u[d*2]=s*f+a*p+h,u[d*2+1]=o*f+l*p+c}if(this._roundPixels){const d=j.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new gg(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,So);const t=this.geometry.getBuffer("aVertexPosition").data,r=sc.points,i=this.geometry.getIndex().data,n=i.length,s=this.drawMode===4?3:1;for(let o=0;o+2<n;o+=s){const a=i[o]*2,l=i[o+1]*2,h=i[o+2]*2;if(r[0]=t[a],r[1]=t[a+1],r[2]=t[l],r[3]=t[l+1],r[4]=t[h],r[5]=t[h+1],sc.contains(So.x,So.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Ko=Fu;Ko.BATCHABLE_SIZE=100;class _g extends Me{constructor(t,r,i){super();const n=new ot(t),s=new ot(r,!0),o=new ot(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,Q.FLOAT).addAttribute("aTextureCoord",s,2,!1,Q.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var vg=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,yg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class oc extends Fe{constructor(t,r){const i={uSampler:t,alpha:1,uTextureMatrix:wt.IDENTITY,uColor:new Float32Array([1,1,1,1])};r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(i,r.uniforms),super(r.program||Gt.from(yg,vg),i),this._colorDirty=!1,this.uvMatrix=new Ea(t),this.batchable=r.program===void 0,this.pluginName=r.pluginName,this._tintColor=new vt(r.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=r.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const r=this.texture.baseTexture.alphaMode;vt.shared.setValue(this._tintColor).premultiply(this._alpha,r).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ac{constructor(t,r,i){this.geometry=new Me,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||Q.FLOAT,offset:s.offset},r[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let r=0;this.indexBuffer=new ot(zc(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=r,r+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ot(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=n,n+=a.size,this.staticStride+=a.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new ot(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Q.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Q.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,r,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,r,i,s.type===Q.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,r,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,r,i,s.type===Q.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var xg=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,bg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Du extends Zr{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new wt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Q.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Fe.from(bg,xg,{}),this.state=$t.for2d()}render(t){const r=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let o=r.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const l=r[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=fa(t.blendMode,h),s.state.set(this.state);const c=s.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=vt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=n,p+=1){let g=o-f;g>n&&(g=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));const m=a[p];m.uploadDynamic(r,f,g);const _=t._bufferUpdateIDs[p]||0;d=d||m._updateID<_,d&&(m._updateID=t._updateID,m.uploadStatic(r,f,g)),s.geometry.bind(m.geometry),c.drawElements(c.TRIANGLES,g*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const r=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let o=0;o<i;o+=n)r.push(new ac(this.properties,s,n));return r}_generateOneMoreBuffer(t){const r=t._batchSize,i=t._properties;return new ac(this.properties,i,r)}uploadVertices(t,r,i,n,s,o){let a=0,l=0,h=0,c=0;for(let u=0;u<i;++u){const d=t[r+u],f=d._texture,p=d.scale.x,g=d.scale.y,m=f.trim,_=f.orig;m?(l=m.x-d.anchor.x*_.width,a=l+m.width,c=m.y-d.anchor.y*_.height,h=c+m.height):(a=_.width*(1-d.anchor.x),l=_.width*-d.anchor.x,h=_.height*(1-d.anchor.y),c=_.height*-d.anchor.y),n[o]=l*p,n[o+1]=c*g,n[o+s]=a*p,n[o+s+1]=c*g,n[o+s*2]=a*p,n[o+s*2+1]=h*g,n[o+s*3]=l*p,n[o+s*3+1]=h*g,o+=s*4}}uploadPosition(t,r,i,n,s,o){for(let a=0;a<i;a++){const l=t[r+a].position;n[o]=l.x,n[o+1]=l.y,n[o+s]=l.x,n[o+s+1]=l.y,n[o+s*2]=l.x,n[o+s*2+1]=l.y,n[o+s*3]=l.x,n[o+s*3+1]=l.y,o+=s*4}}uploadRotation(t,r,i,n,s,o){for(let a=0;a<i;a++){const l=t[r+a].rotation;n[o]=l,n[o+s]=l,n[o+s*2]=l,n[o+s*3]=l,o+=s*4}}uploadUvs(t,r,i,n,s,o){for(let a=0;a<i;++a){const l=t[r+a]._texture._uvs;l?(n[o]=l.x0,n[o+1]=l.y0,n[o+s]=l.x1,n[o+s+1]=l.y1,n[o+s*2]=l.x2,n[o+s*2+1]=l.y2,n[o+s*3]=l.x3,n[o+s*3+1]=l.y3,o+=s*4):(n[o]=0,n[o+1]=0,n[o+s]=0,n[o+s+1]=0,n[o+s*2]=0,n[o+s*2+1]=0,n[o+s*3]=0,n[o+s*3+1]=0,o+=s*4)}}uploadTint(t,r,i,n,s,o){for(let a=0;a<i;++a){const l=t[r+a],h=vt.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);n[o]=h,n[o+s]=h,n[o+s*2]=h,n[o+s*3]=h,o+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Du.extension={name:"particle",type:q.RendererPlugin};rt.add(Du);var Kn=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Kn||{});const en={willReadFrequently:!0},Z=class{static get experimentalLetterSpacingSupported(){let e=Z._experimentalLetterSpacingSupported;if(e!==void 0){const t=j.ADAPTER.getCanvasRenderingContext2D().prototype;e=Z._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,i,n,s,o,a,l){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(e,t,r,i=Z._canvas){r=r??t.wordWrap;const n=t.toFontString(),s=Z.measureFont(n);s.fontSize===0&&(s.fontSize=t.fontSize,s.ascent=t.fontSize);const o=i.getContext("2d",en);o.font=n;const l=(r?Z.wordWrap(e,t,i):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let c=0;for(let p=0;p<l.length;p++){const g=Z._measureText(l[p],t.letterSpacing,o);h[p]=g,c=Math.max(c,g)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||s.fontSize+t.strokeThickness;let f=Math.max(d,s.fontSize+t.strokeThickness*2)+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new Z(e,t,u,f,l,h,d+t.leading,c,s)}static _measureText(e,t,r){let i=!1;Z.experimentalLetterSpacingSupported&&(Z.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(e).width;return n>0&&(i?n-=t:n+=(Z.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,r=Z._canvas){const i=r.getContext("2d",en);let n=0,s="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:h}=t,c=Z.collapseSpaces(h),u=Z.collapseNewlines(h);let d=!c;const f=t.wordWrapWidth+l,p=Z.tokenize(e);for(let g=0;g<p.length;g++){let m=p[g];if(Z.isNewline(m)){if(!u){o+=Z.addLine(s),d=!c,s="",n=0;continue}m=" "}if(c){const w=Z.isBreakingSpace(m),v=Z.isBreakingSpace(s[s.length-1]);if(w&&v)continue}const _=Z.getFromCache(m,l,a,i);if(_>f)if(s!==""&&(o+=Z.addLine(s),s="",n=0),Z.canBreakWords(m,t.breakWords)){const w=Z.wordWrapSplit(m);for(let v=0;v<w.length;v++){let E=w[v],y=E,C=1;for(;w[v+C];){const F=w[v+C];if(!Z.canBreakChars(y,F,m,v,t.breakWords))E+=F;else break;y=F,C++}v+=C-1;const x=Z.getFromCache(E,l,a,i);x+n>f&&(o+=Z.addLine(s),d=!1,s="",n=0),s+=E,n+=x}}else{s.length>0&&(o+=Z.addLine(s),s="",n=0);const w=g===p.length-1;o+=Z.addLine(m,!w),d=!1,s="",n=0}else _+n>f&&(d=!1,o+=Z.addLine(s),s="",n=0),(s.length>0||!Z.isBreakingSpace(m)||d)&&(s+=m,n+=_)}return o+=Z.addLine(s,!1),o}static addLine(e,t=!0){return e=Z.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,i){let n=r[e];return typeof n!="number"&&(n=Z._measureText(e,t,i)+t,r[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!Z.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:Z._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:Z._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const n=e[i],s=e[i+1];if(Z.isBreakingSpace(n,s)||Z.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,n){return!0}static wordWrapSplit(e){return Z.graphemeSegmenter(e)}static measureFont(e){if(Z._fonts[e])return Z._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=Z._canvas,i=Z._context;i.font=e;const n=Z.METRICS_STRING+Z.BASELINE_SYMBOL,s=Math.ceil(i.measureText(n).width);let o=Math.ceil(i.measureText(Z.BASELINE_SYMBOL).width);const a=Math.ceil(Z.HEIGHT_MULTIPLIER*o);if(o=o*Z.BASELINE_MULTIPLIER|0,s===0||a===0)return Z._fonts[e]=t,t;r.width=s,r.height=a,i.fillStyle="#f00",i.fillRect(0,0,s,a),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,o);const l=i.getImageData(0,0,s,a).data,h=l.length,c=s*4;let u=0,d=0,f=!1;for(u=0;u<o;++u){for(let p=0;p<c;p+=4)if(l[d+p]!==255){f=!0;break}if(!f)d+=c;else break}for(t.ascent=o-u,d=h-c,f=!1,u=a;u>o;--u){for(let p=0;p<c;p+=4)if(l[d+p]!==255){f=!0;break}if(!f)d-=c;else break}return t.descent=u-o,t.fontSize=t.ascent+t.descent,Z._fonts[e]=t,t}static clearMetrics(e=""){e?delete Z._fonts[e]:Z._fonts={}}static get _canvas(){if(!Z.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",en);if(r!=null&&r.measureText)return Z.__canvas=t,t;e=j.ADAPTER.createCanvas()}catch{e=j.ADAPTER.createCanvas()}e.width=e.height=10,Z.__canvas=e}return Z.__canvas}static get _context(){return Z.__context||(Z.__context=Z._canvas.getContext("2d",en)),Z.__context}};let Ut=Z;Ut.METRICS_STRING="|q";Ut.BASELINE_SYMBOL="M";Ut.BASELINE_MULTIPLIER=1.4;Ut.HEIGHT_MULTIPLIER=2;Ut.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(r=>r.segment)}return e=>[...e]})();Ut.experimentalLetterSpacing=!1;Ut._fonts={};Ut._newlines=[10,13];Ut._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Tg=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],pi=class{constructor(e){this.styleID=0,this.reset(),Io(this,e,e)}clone(){const e={};return Io(e,this,pi.defaultStyle),new pi(e)}reset(){Io(this,pi.defaultStyle,pi.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Co(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Co(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){wg(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Co(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let i=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Tg.includes(i)&&(i=`"${i}"`),t[r]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let $e=pi;$e.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Kn.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Co(e){const t=vt.shared;return Array.isArray(e)?e.map(r=>t.setValue(r).toHex()):t.setValue(e).toHex()}function wg(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function Io(e,t,r){for(const i in r)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const Ag={texture:!0,children:!1,baseTexture:!0},Qo=class extends ti{constructor(e,t,r){let i=!1;r||(r=j.ADAPTER.createCanvas(),i=!0),r.width=3,r.height=3;const n=$.from(r);n.orig=new pt,n.trim=new pt,super(n),this._ownCanvas=i,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Qo.defaultResolution??j.RESOLUTION,this._autoResolution=Qo.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ut.experimentalLetterSpacing}static set experimentalLetterSpacing(e){dt("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ut.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const r=this.context,i=Ut.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,s=i.height,o=i.lines,a=i.lineHeight,l=i.lineWidths,h=i.maxLineWidth,c=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=t.strokeThickness,r.textBaseline=t.textBaseline,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit;let u,d;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const g=t.dropShadow&&p===0,m=g?Math.ceil(Math.max(1,s)+t.padding*2):0,_=m*this._resolution;if(g){r.fillStyle="black",r.strokeStyle="black";const v=t.dropShadowColor,E=t.dropShadowBlur*this._resolution,y=t.dropShadowDistance*this._resolution;r.shadowColor=vt.shared.setValue(v).setAlpha(t.dropShadowAlpha).toRgbaString(),r.shadowBlur=E,r.shadowOffsetX=Math.cos(t.dropShadowAngle)*y,r.shadowOffsetY=Math.sin(t.dropShadowAngle)*y+_}else r.fillStyle=this._generateFillStyle(t,o,i),r.strokeStyle=t.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let w=(a-c.fontSize)/2;a-c.fontSize<0&&(w=0);for(let v=0;v<o.length;v++)u=t.strokeThickness/2,d=t.strokeThickness/2+v*a+c.ascent+w,t.align==="right"?u+=h-l[v]:t.align==="center"&&(u+=(h-l[v])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[v],u+t.padding,d+t.padding-m,!0),t.fill&&this.drawLetterSpacing(o[v],u+t.padding,d+t.padding-m)}this.updateTexture()}drawLetterSpacing(e,t,r,i=!1){const s=this._style.letterSpacing;let o=!1;if(Ut.experimentalLetterSpacingSupported&&(Ut.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||o){i?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let a=t;const l=Ut.graphemeSegmenter(e);let h=this.context.measureText(e).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];i?this.context.strokeText(d,a,r):this.context.fillText(d,a,r);let f="";for(let p=u+1;p<l.length;++p)f+=l[p];c=this.context.measureText(f).width,a+=h-c+s,h=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const s=$c(e);s.data&&(e.width=s.width,e.height=s.height,this.context.putImageData(s.data,0,0))}const t=this._texture,r=this._style,i=r.trim?0:r.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){const i=e.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const s=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-s-o*2,l=this.canvas.height/this._resolution-s-o*2,h=i.slice(),c=e.fillGradientStops.slice();if(!c.length){const u=h.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(h.unshift(i[0]),c.unshift(0),h.push(i[i.length-1]),c.push(1),e.fillGradientType===Kn.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,o,a/2,l+o);const u=r.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const f=r.lineHeight*(d-1)+u,p=r.lineHeight*d;let g=p;d>0&&f>p&&(g=(p+f)/2);const m=p+u,_=r.lineHeight*(d+1);let w=m;d+1<t.length&&_<m&&(w=(m+_)/2);const v=(w-g)/l;for(let E=0;E<h.length;E++){let y=0;typeof c[E]=="number"?y=c[E]:y=E/h.length;let C=Math.min(1,Math.max(0,g/l+y*v));C=Number(C.toFixed(5)),n.addColorStop(C,h[E])}}}else{n=this.context.createLinearGradient(o,l/2,a+o,l/2);const u=h.length+1;let d=1;for(let f=0;f<h.length;f++){let p;typeof c[f]=="number"?p=c[f]:p=d/u,n.addColorStop(p,h[f]),d++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Ag,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Ge(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Ge(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof $e?this._style=e:this._style=new $e(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let wi=Qo;wi.defaultAutoResolution=!0;class Eg{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Sg(e,t){var i;let r=!1;if((i=e==null?void 0:e._textures)!=null&&i.length){for(let n=0;n<e._textures.length;n++)if(e._textures[n]instanceof $){const s=e._textures[n].baseTexture;t.includes(s)||(t.push(s),r=!0)}}return r}function Cg(e,t){if(e.baseTexture instanceof ht){const r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function Ig(e,t){if(e._texture&&e._texture instanceof $){const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function Rg(e,t){return t instanceof wi?(t.updateText(!0),!0):!1}function Mg(e,t){if(t instanceof $e){const r=t.toFontString();return Ut.measureFont(r),!0}return!1}function Pg(e,t){if(e instanceof wi){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function Fg(e,t){return e instanceof $e?(t.includes(e)||t.push(e),!0):!1}const Nu=class{constructor(e){this.limiter=new Eg(Nu.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Pg),this.registerFindHook(Fg),this.registerFindHook(Sg),this.registerFindHook(Cg),this.registerFindHook(Ig),this.registerUploadHook(Rg),this.registerUploadHook(Mg)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ft.system.addOnce(this.tick,this,We.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ft.system.addOnce(this.tick,this,We.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof se)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Ft.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Rn=Nu;Rn.uploadsPerFrame=4;Object.defineProperties(j,{UPLOADS_PER_FRAME:{get(){return Rn.uploadsPerFrame},set(e){dt("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Rn.uploadsPerFrame=e}}});function Bu(e,t){return t instanceof ht?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function Dg(e,t){if(!(t instanceof Di))return!1;const{geometry:r}=t;t.finishPoly(),r.updateBatches();const{batches:i}=r;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&Bu(e,s.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function Ng(e,t){return e instanceof Di?(t.push(e),!0):!1}class Ou extends Rn{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Ng),this.registerUploadHook(Bu),this.registerUploadHook(Dg)}}Ou.extension={name:"prepare",type:q.RendererSystem};rt.add(Ou);var Bg=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Og=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Lg=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,lc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Ug=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const rn=new wt;class Lu extends Zr{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new ba,this.state=$t.for2d()}contextChange(){const t=this.renderer,r={globals:t.globalUniforms};this.simpleShader=Fe.from(lc,Ug,r),this.shader=t.context.webGLVersion>1?Fe.from(Og,Bg,r):Fe.from(lc,Lg,r)}render(t){const r=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-o,n[2]=n[4]=1-s,n[5]=n[7]=1-o,i.invalidate();const a=t._texture,l=a.baseTexture,h=l.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[r.CONTEXT_UID]?d=l.wrapMode!==Wt.CLAMP:l.wrapMode===Wt.CLAMP&&(l.wrapMode=Wt.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,g=a.height,m=t._width,_=t._height;rn.set(c.a*p/m,c.b*p/_,c.c*g/m,c.d*g/_,c.tx/m,c.ty/_),rn.invert(),d?rn.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=rn.toArray(!0),f.uniforms.uColor=vt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,r.shader.bind(f),r.geometry.bind(i),this.state.blendMode=fa(t.blendMode,h),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Lu.extension={name:"tilingSprite",type:q.RendererPlugin};rt.add(Lu);const mi=class{constructor(e,t,r=null){this.linkedSheets=[],this._texture=e instanceof $?e:null,this.baseTexture=e instanceof ht?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let r=Xe(e,null);return r===null&&(r=parseFloat(t??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=mi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const r=mi.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],s=n.frame;if(s){let o=null,a=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,h=new pt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?o=new pt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):o=new pt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(a=new pt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[i]=new $(this.baseTexture,o,h,a,n.rotated?2:0,n.anchor,n.borders),$.addToCache(this.textures[i],i)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){const i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*mi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*mi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Jo=mi;Jo.BATCH_SIZE=1e3;const Gg=["jpg","png","jpeg","avif","webp"];function Uu(e,t,r){const i={};if(e.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!r){const n=kt.dirname(e[0]);t.linkedSheets.forEach((s,o)=>{const a=Uu([`${n}/${t.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(i,a)})}return i}const kg={extension:q.Asset,cache:{test:e=>e instanceof Jo,getCacheableAssets:(e,t)=>Uu(e,t,!1)},resolver:{test:e=>{const r=e.split("?")[0].split("."),i=r.pop(),n=r.pop();return i==="json"&&Gg.includes(n)},parse:e=>{var r;const t=e.split(".");return{resolution:parseFloat(((r=j.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:q.LoadParser,priority:Ne.Normal},async testParse(e,t){return kt.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,r){var h,c;let i=kt.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+e.meta.image;n=qo(n,t.src);const o=(await r.load([n]))[n],a=new Jo(o.baseTexture,e,t.src);await a.parse();const l=(h=e==null?void 0:e.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(l)){const u=[];for(const f of l){if(typeof f!="string")continue;let p=i+f;(c=t.data)!=null&&c.ignoreMultiPack||(p=qo(p,t.src),u.push(r.load({src:p,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);a.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[a].concat(a.linkedSheets.filter(p=>p!==f))})}return a},unload(e){e.destroy(!0)}}};rt.add(kg);class Mn{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class cn{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const r=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in r){const o=r[s].match(/^[a-z]+/gm)[0],a=r[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[u]=p}i[o].push(l)}const n=new Mn;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class Zo{static test(t){const r=t;return"getElementsByTagName"in r&&r.getElementsByTagName("page").length&&r.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const r=new Mn,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)r.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<n.length;h++)r.common.push({lineHeight:parseInt(n[h].getAttribute("lineHeight"),10)});for(let h=0;h<s.length;h++)r.page.push({id:parseInt(s[h].getAttribute("id"),10)||0,file:s[h].getAttribute("file")});for(let h=0;h<o.length;h++){const c=o[h];r.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)r.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)r.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return r}}class ta{static test(t){return typeof t=="string"&&t.includes("<font>")?Zo.test(j.ADAPTER.parseXML(t)):!1}static parse(t){return Zo.parse(j.ADAPTER.parseXML(t))}}const Ro=[cn,Zo,ta];function Hg(e){for(let t=0;t<Ro.length;t++)if(Ro[t].test(e))return Ro[t];return null}function Vg(e,t,r,i,n,s){const o=r.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const l=r.dropShadow?r.dropShadowDistance:0,h=r.padding||0,c=e.width/i-l-h*2,u=e.height/i-l-h*2,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let g=1;g<p;++g)f.push(g/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===Kn.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,h,c/2,u+h);let p=0;const m=(s.fontProperties.fontSize+r.strokeThickness)/u;for(let _=0;_<n.length;_++){const w=s.lineHeight*_;for(let v=0;v<d.length;v++){let E=0;typeof f[v]=="number"?E=f[v]:E=v/d.length;const y=w/u+E*m;let C=Math.max(p,y);C=Math.min(C,1),a.addColorStop(C,d[v]),p=C}}}else{a=t.createLinearGradient(h,u/2,c+h,u/2);const p=d.length+1;let g=1;for(let m=0;m<d.length;m++){let _;typeof f[m]=="number"?_=f[m]:_=g/p,a.addColorStop(_,d[m]),g++}}return a}function zg(e,t,r,i,n,s,o){const a=r.text,l=r.fontProperties;t.translate(i,n),t.scale(s,s);const h=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=Vg(e,t,o,s,[a],r),t.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=o.dropShadowBlur*s,f=o.dropShadowDistance*s;t.shadowColor=vt.shared.setValue(u).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,h,c+r.lineHeight-l.descent),o.fill&&t.fillText(a,h,c+r.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function un(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function Gu(e){return Array.from?Array.from(e):e.split("")}function Xg(e){typeof e=="string"&&(e=[e]);const t=[];for(let r=0,i=e.length;r<i;r++){const n=e[r];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Gu(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Te=class{constructor(e,t,r){var h;const[i]=e.info,[n]=e.common,[s]=e.page,[o]=e.distanceField,a=Xe(s.file),l={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/a,this.chars={},this.pageTextures=l;for(let c=0;c<e.page.length;c++){const{id:u,file:d}=e.page[c];l[u]=t instanceof Array?t[c]:t[d],o!=null&&o.fieldType&&o.fieldType!=="none"&&(l[u].baseTexture.alphaMode=Vt.NO_PREMULTIPLIED_ALPHA,l[u].baseTexture.mipmap=ne.OFF)}for(let c=0;c<e.char.length;c++){const{id:u,page:d}=e.char[c];let{x:f,y:p,width:g,height:m,xoffset:_,yoffset:w,xadvance:v}=e.char[c];f/=a,p/=a,g/=a,m/=a,_/=a,w/=a,v/=a;const E=new pt(f+l[d].frame.x/a,p+l[d].frame.y/a,g,m);this.chars[u]={xOffset:_,yOffset:w,xAdvance:v,kerning:{},texture:new $(l[d].baseTexture,E),page:d}}for(let c=0;c<e.kerning.length;c++){let{first:u,second:d,amount:f}=e.kerning[c];u/=a,d/=a,f/=a,this.chars[d]&&(this.chars[d].kerning[u]=f)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=((h=o==null?void 0:o.fieldType)==null?void 0:h.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,r){let i;if(e instanceof Mn)i=e;else{const s=Hg(e);if(!s)throw new Error("Unrecognized data format for font.");i=s.parse(e)}t instanceof $&&(t=[t]);const n=new Te(i,t,r);return Te.available[n.font]=n,n}static uninstall(e){const t=Te.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete Te.available[e]}static from(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:s,textureWidth:o,textureHeight:a,...l}=Object.assign({},Te.defaultOptions,r),h=Xg(i),c=t instanceof $e?t:new $e(t),u=o,d=new Mn;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f=0,p=0,g,m,_,w=0;const v=[];for(let y=0;y<h.length;y++){g||(g=j.ADAPTER.createCanvas(),g.width=o,g.height=a,m=g.getContext("2d"),_=new ht(g,{resolution:s,...l}),v.push(new $(_)),d.page.push({id:v.length-1,file:""}));const C=h[y],x=Ut.measureText(C,c,!1,g),F=x.width,G=Math.ceil(x.height),k=Math.ceil((c.fontStyle==="italic"?2:1)*F);if(p>=a-G*s){if(p===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--y,g=null,m=null,_=null,p=0,f=0,w=0;continue}if(w=Math.max(G+x.fontProperties.descent,w),k*s+f>=u){if(f===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--y,p+=w*s,p=Math.ceil(p),f=0,w=0;continue}zg(g,m,x,f,p,s,c);const U=un(x.text);d.char.push({id:U,page:v.length-1,x:f/s,y:p/s,width:k,height:G,xoffset:0,yoffset:0,xadvance:F-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(k+2*n)*s,f=Math.ceil(f)}for(let y=0,C=h.length;y<C;y++){const x=h[y];for(let F=0;F<C;F++){const G=h[F],k=m.measureText(x).width,U=m.measureText(G).width,L=m.measureText(x+G).width-(k+U);L&&d.kerning.push({first:un(x),second:un(G),amount:L})}}const E=new Te(d,v,!0);return Te.available[e]!==void 0&&Te.uninstall(e),Te.available[e]=E,E}};let jt=Te;jt.ALPHA=[["a","z"],["A","Z"]," "];jt.NUMERIC=[["0","9"]];jt.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];jt.ASCII=[[" ","~"]];jt.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Te.ALPHANUMERIC};jt.available={};var jg=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Wg=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const hc=[],cc=[],uc=[],ku=class extends se{constructor(e,t={}){super();const{align:r,tint:i,maxWidth:n,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},ku.styleDefaults,t);if(!jt.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new vt(i),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Xt(()=>{this.dirty=!0},this,0,0),this._roundPixels=j.ROUND_PIXELS,this.dirty=!0,this._resolution=j.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var k;const e=jt.available[this._fontName],t=this.fontSize,r=t/e.size,i=new _t,n=[],s=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Gu(a),h=this._maxWidth*e.size/t,c=e.distanceFieldType==="none"?hc:cc;let u=null,d=0,f=0,p=0,g=-1,m=0,_=0,w=0,v=0;for(let U=0;U<l.length;U++){const I=l[U],L=un(I);if(/(?:\s)/.test(I)&&(g=U,m=d,v++),I==="\r"||I===`
`){s.push(d),o.push(-1),f=Math.max(f,d),++p,++_,i.x=0,i.y+=e.lineHeight,u=null,v=0;continue}const R=e.chars[L];if(!R)continue;u&&R.kerning[u]&&(i.x+=R.kerning[u]);const W=uc.pop()||{texture:$.EMPTY,line:0,charCode:0,prevSpaces:0,position:new _t};W.texture=R.texture,W.line=p,W.charCode=L,W.position.x=Math.round(i.x+R.xOffset+this._letterSpacing/2),W.position.y=Math.round(i.y+R.yOffset),W.prevSpaces=v,n.push(W),d=W.position.x+Math.max(R.xAdvance-R.xOffset,R.texture.orig.width),i.x+=R.xAdvance+this._letterSpacing,w=Math.max(w,R.yOffset+R.texture.height),u=L,g!==-1&&h>0&&i.x>h&&(++_,Tr(n,1+g-_,1+U-g),U=g,g=-1,s.push(m),o.push(n.length>0?n[n.length-1].prevSpaces:0),f=Math.max(f,m),p++,i.x=0,i.y+=e.lineHeight,u=null,v=0)}const E=l[l.length-1];E!=="\r"&&E!==`
`&&(/(?:\s)/.test(E)&&(d=m),s.push(d),f=Math.max(f,d),o.push(-1));const y=[];for(let U=0;U<=p;U++){let I=0;this._align==="right"?I=f-s[U]:this._align==="center"?I=(f-s[U])/2:this._align==="justify"&&(I=o[U]<0?0:(f-s[U])/o[U]),y.push(I)}const C=n.length,x={},F=[],G=this._activePagesMeshData;c.push(...G);for(let U=0;U<C;U++){const I=n[U].texture,L=I.baseTexture.uid;if(!x[L]){let R=c.pop();if(!R){const T=new _g;let A,b;e.distanceFieldType==="none"?(A=new oc($.EMPTY),b=at.NORMAL):(A=new oc($.EMPTY,{program:Gt.from(Wg,jg),uniforms:{uFWidth:0}}),b=at.NORMAL_NPM);const P=new Ko(T,A);P.blendMode=b,R={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:P,vertices:null,uvs:null,indices:null}}R.index=0,R.indexCount=0,R.vertexCount=0,R.uvsCount=0,R.total=0;const{_textureCache:W}=this;W[L]=W[L]||new $(I.baseTexture),R.mesh.texture=W[L],R.mesh.tint=this._tintColor.value,F.push(R),x[L]=R}x[L].total++}for(let U=0;U<G.length;U++)F.includes(G[U])||this.removeChild(G[U].mesh);for(let U=0;U<F.length;U++)F[U].mesh.parent!==this&&this.addChild(F[U].mesh);this._activePagesMeshData=F;for(const U in x){const I=x[U],L=I.total;if(!(((k=I.indices)==null?void 0:k.length)>6*L)||I.vertices.length<Ko.BATCHABLE_SIZE*2)I.vertices=new Float32Array(4*2*L),I.uvs=new Float32Array(4*2*L),I.indices=new Uint16Array(6*L);else{const R=I.total,W=I.vertices;for(let T=R*4*2;T<W.length;T++)W[T]=0}I.mesh.size=6*L}for(let U=0;U<C;U++){const I=n[U];let L=I.position.x+y[I.line]*(this._align==="justify"?I.prevSpaces:1);this._roundPixels&&(L=Math.round(L));const R=L*r,W=I.position.y*r,T=I.texture,A=x[T.baseTexture.uid],b=T.frame,P=T._uvs,S=A.index++;A.indices[S*6+0]=0+S*4,A.indices[S*6+1]=1+S*4,A.indices[S*6+2]=2+S*4,A.indices[S*6+3]=0+S*4,A.indices[S*6+4]=2+S*4,A.indices[S*6+5]=3+S*4,A.vertices[S*8+0]=R,A.vertices[S*8+1]=W,A.vertices[S*8+2]=R+b.width*r,A.vertices[S*8+3]=W,A.vertices[S*8+4]=R+b.width*r,A.vertices[S*8+5]=W+b.height*r,A.vertices[S*8+6]=R,A.vertices[S*8+7]=W+b.height*r,A.uvs[S*8+0]=P.x0,A.uvs[S*8+1]=P.y0,A.uvs[S*8+2]=P.x1,A.uvs[S*8+3]=P.y1,A.uvs[S*8+4]=P.x2,A.uvs[S*8+5]=P.y2,A.uvs[S*8+6]=P.x3,A.uvs[S*8+7]=P.y3}this._textWidth=f*r,this._textHeight=(i.y+e.lineHeight)*r;for(const U in x){const I=x[U];if(this.anchor.x!==0||this.anchor.y!==0){let T=0;const A=this._textWidth*this.anchor.x,b=this._textHeight*this.anchor.y;for(let P=0;P<I.total;P++)I.vertices[T++]-=A,I.vertices[T++]-=b,I.vertices[T++]-=A,I.vertices[T++]-=b,I.vertices[T++]-=A,I.vertices[T++]-=b,I.vertices[T++]-=A,I.vertices[T++]-=b}this._maxLineHeight=w*r;const L=I.mesh.geometry.getBuffer("aVertexPosition"),R=I.mesh.geometry.getBuffer("aTextureCoord"),W=I.mesh.geometry.getIndex();L.data=I.vertices,R.data=I.uvs,W.data=I.indices,L.update(),R.update(),W.update()}for(let U=0;U<n.length;U++)uc.push(n[U]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:r,size:i}=jt.available[this._fontName];if(r!=="none"){const{a:n,b:s,c:o,d:a}=this.worldTransform,l=Math.sqrt(n*n+s*s),h=Math.sqrt(o*o+a*a),c=(Math.abs(l)+Math.abs(h))/2,u=this.fontSize/i,d=e._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=jt.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!jt.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??jt.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=jt.available[this._fontName].distanceFieldType==="none"?hc:cc;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=$.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};let $g=ku;$g.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const qg=[".xml",".fnt"],Yg={extension:{type:q.LoadParser,priority:Ne.Normal},name:"loadBitmapFont",test(e){return qg.includes(kt.extname(e).toLowerCase())},async testParse(e){return cn.test(e)||ta.test(e)},async parse(e,t,r){const i=cn.test(e)?cn.parse(e):ta.parse(e),{src:n}=t,{page:s}=i,o=[];for(let h=0;h<s.length;++h){const c=s[h].file;let u=kt.join(kt.dirname(n),c);u=qo(u,n),o.push(u)}const a=await r.load(o),l=o.map(h=>a[h]);return jt.install(i,l,!0)},async load(e,t){return(await j.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};rt.add(Yg);const Hr=class extends $e{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new Hr(Object.keys(Hr.defaultOptions).reduce((t,r)=>({...t,[r]:e[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete Hr.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:r}=Hr;if(r[e]){const i=r[e];return this._fonts.push(i),i.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return j.ADAPTER.fetch(e).then(i=>i.blob()).then(async i=>new Promise((n,s)=>{const o=URL.createObjectURL(i),a=new FileReader;a.onload=()=>n([o,a.result]),a.onerror=s,a.readAsDataURL(i)})).then(async([i,n])=>{const s=Object.assign({family:kt.basename(e,kt.extname(e)),weight:"normal",style:"normal",src:i,dataSrc:n,refs:1,originalUrl:e,fontFace:null},t);r[e]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(r=>!this._overrides.includes(r));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(r=>this._overrides.includes(r));t.length>0&&(this._overrides=this._overrides.filter(r=>!t.includes(r)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=kc(e)),typeof e=="number"?Gc(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const n=`${r}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,Hr.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=j.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let _i=Hr;_i.availableFonts={};_i.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Vr=class extends ti{constructor(e="",t={}){super($.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const r=new Image,i=$.from(r,{scaleMode:j.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new pt,i.trim=new pt,this.texture=i;const n="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(n,"svg"),a=document.createElementNS(n,"foreignObject"),l=document.createElementNS(s,"div"),h=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Vr.defaultMaxWidth,this.maxHeight=Vr.defaultMaxHeight,this._domElement=l,this._styleElement=h,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(h),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=Vr.defaultAutoResolution,this._resolution=Vr.defaultResolution??j.RESOLUTION,this.text=e,this.style=t}measureText(e){var a,l;const{text:t,style:r,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:r.toCSS(i)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(n.width)),o=Math.min(this.maxHeight,Math.ceil(n.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(a=this._style)==null?void 0:a.toCSS(i)}),this._styleElement.textContent=(l=this._style)==null?void 0:l.toGlobalCSS()),{width:s+r.padding*2,height:o+r.padding*2}}async updateText(e=!0){const{style:t,_image:r,_loadImage:i}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:n,height:s}=this.measureText();r.width=i.width=Math.ceil(Math.max(1,n)),r.height=i.height=Math.ceil(Math.max(1,s)),this._loading||(this._loading=!0,await new Promise(o=>{i.onload=async()=>{await t.onBeforeDraw(),this._loading=!1,r.src=i.src,i.onload=null,i.src="",this.updateTexture(),o()};const a=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:r,resolution:i}=this,{padding:n}=e,{baseTexture:s}=t;t.trim.width=t._frame.width=r.width/i,t.trim.height=t._frame.height=r.height/i,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(r.width,r.height,i),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var r,i,n,s,o;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Vr.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=t,(i=this._svgRoot)==null||i.remove(),this._svgRoot=t,(n=this._domElement)==null||n.remove(),this._domElement=t,(s=this._foreignObject)==null||s.remove(),this._foreignObject=t,(o=this._styleElement)==null||o.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Ge(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Ge(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof _i?(this.ownsStyle=!1,this._style=e):e instanceof $e?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=_i.from(e)):(this.ownsStyle=!0,this._style=new _i(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Qn=Vr;Qn.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};Qn.defaultMaxWidth=2024;Qn.defaultMaxHeight=2024;Qn.defaultAutoResolution=!0;var It;(e=>{function t(r,i){return r[i]}e.get=t})(It||(It={}));var sr=(e=>(e[e.buffer=0]="buffer",e[e.json=1]="json",e[e.text=2]="text",e))(sr||{});class Hu{setLoaderResourceExtensionType(t,r){let i=LoaderResource.XHR_RESPONSE_TYPE.TEXT;r===sr.buffer?i=LoaderResource.XHR_RESPONSE_TYPE.BUFFER:r===sr.json&&(i=LoaderResource.XHR_RESPONSE_TYPE.JSON),LoaderResource.setExtensionXhrType(t,i)}getInteractionPlugin(t){return t.plugins.interaction}get assets(){}isRendererDestroyed(t){return!t.gl}installRendererPlugin(t,r){hr.registerPlugin(t,r)}installLoaderPlugin(t,r){Loader.registerPlugin(r)}render(t,r,i){t.render(r,i)}}class Vu extends Hu{render(t,r,i){t.render(r,{renderTexture:i})}}class zu extends Vu{installRendererPlugin(t,r){r.extension={type:It.get(St,"ExtensionType").RendererPlugin,name:t},It.get(St,"extensions").add(r)}installLoaderPlugin(t,r){r.extension={type:It.get(St,"ExtensionType").Loader,name:t},It.get(St,"extensions").add(r)}}class Kg extends zu{setLoaderResourceExtensionType(t,r){}getInteractionPlugin(t){}get assets(){return er}isRendererDestroyed(t){return"_systemsHash"in t?Object.keys(t._systemsHash).length===0:!1}installRendererPlugin(t,r){r.extension={type:[It.get(St,"ExtensionType").RendererPlugin],name:t},It.get(St,"extensions").add(r)}installLoaderPlugin(t,r){r.extension={type:[It.get(St,"ExtensionType").Loader,It.get(St,"ExtensionType").LoadParser],name:t},It.get(St,"extensions").add(r)}}const Qg="VERSION"in St&&It.get(St,"VERSION").startsWith("7"),Jg="extensions"in St,Zg="ArrayResource"in St,Tt=Qg?new Kg:Jg?new zu:Zg?new Vu:new Hu;class ee{constructor(t,r=[],i=[]){this.descriptor=t,this.buffers=r,this.images=i,this.textures=[]}static load(t,r,i){let n=new ee(t);return e_(t,s=>{s.forEach(o=>n.buffers.push(o)),dc(t,s,o=>{o.forEach(a=>n.images.push(a)),i&&i(n)},r)},r),n}static isValidBuffer(t){const r=new Uint32Array(t,0,3);return r[0]===1179937895&&r[1]===2}static isEmbeddedResource(t){return t&&t.startsWith("data:")}static fromBuffer(t,r){const i=[];let n=12;for(;n<t.byteLength;){const l=new Uint32Array(t,n,3);i.push({length:l[0],type:l[1],offset:n+2*4}),n+=l[0]+2*4}const s=new Uint8Array(t,i[0].offset,i[0].length),o=JSON.parse(new TextDecoder("utf-8").decode(s)),a=[];for(let l=1;l<i.length;l++)a.push(t.slice(i[l].offset,i[l].offset+i[l].length));dc(o,a,l=>{r(new ee(o,a,l))})}static async fromURL(t,r){if(!Tt.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const i=await j.ADAPTER.fetch(t,r);return new Promise(async n=>{if(t.includes(".glb")){let s=await i.arrayBuffer();ee.fromBuffer(s,o=>{n(o)})}else{let s=await i.json();ee.load(s,new t_(t),o=>{n(o)})}})}}class t_{constructor(t){this.parentURL=t}load(t,r){const i=this.parentURL.substring(0,this.parentURL.lastIndexOf("/")+1)+t;(async()=>{if(!Tt.assets)throw new Error("PIXI3D: Assets are not available in current version of PixiJS.");let s={};if(i.includes(".bin")){const o=await j.ADAPTER.fetch(i);s.data=await o.arrayBuffer()}else{let o=await Tt.assets.load(i);o&&(s.texture=o)}r(s)})()}}function dc(e,t,r,i){const n=[];if(!e.images||e.images.length===0)return r(n);let s=e.images.filter(d=>typeof d.bufferView!="number"&&ee.isEmbeddedResource(d.uri)).map((d,f)=>f),o=e.images.filter(d=>typeof d.bufferView!="number"&&!ee.isEmbeddedResource(d.uri)).map((d,f)=>f),a=e.images.filter(d=>typeof d.bufferView=="number").map((d,f)=>f);for(let d=0;d<s.length;d++){let f=s[d],p=e.images[f];n[f]=$.from(p.uri)}if(a.length===0&&o.length===0)return r(n);if(o.length>0&&!i)throw new Error("PIXI3D: A resource loader is required when image is external.");const l=(d,f,p)=>{i==null||i.load(d.uri,g=>{g.texture&&(n[f]=g.texture,p())})},h=(d,f,p)=>{r_(d,e,t,g=>{n[f]=g,p()})};let c=o.length,u=a.length;for(let d=0;d<o.length;d++){let f=o[d],p=e.images[f];l(p,f,()=>{--c===0&&u===0&&r(n)})}for(let d=0;d<a.length;d++){let f=a[d],p=e.images[f];h(p,f,()=>{--u===0&&c===0&&r(n)})}}function e_(e,t,r){const i=[],n=e.buffers.filter(l=>ee.isEmbeddedResource(l.uri)).map((l,h)=>h);for(let l=0;l<n.length;l++){let h=n[l],c=e.buffers[h];i[h]=i_(c.uri)}const s=e.buffers.filter(l=>!ee.isEmbeddedResource(l.uri)).map((l,h)=>h);if(s.length===0)return t(i);if(!r)throw new Error("PIXI3D: A resource loader is required when buffer is not embedded.");const o=(l,h,c)=>{r.load(l,u=>{i[h]=u.data,c()})};let a=s.length;for(let l=0;l<s.length;l++){let h=s[l],c=e.buffers[h];o(c.uri,h,()=>{--a===0&&t(i)})}}function r_(e,t,r,i){const n=t.bufferViews[e.bufferView],s=new Uint8Array(r[n.buffer],n.byteOffset,n.byteLength),o=new Blob([s],{type:e.mimeType}),a=new FileReader;a.onload=()=>{i($.from(a.result))},a.readAsDataURL(o)}function i_(e){return Uint8Array.from(atob(e.split(",")[1]),t=>t.charCodeAt(0)).buffer}const n_={use:function(e,t){if(e.extension!=="gltf")return t();let r=this;ee.load(e.data,new s_(r,e),i=>{Object.assign(e,{gltf:i}),t()})},add:function(){Tt.setLoaderResourceExtensionType("bin",sr.buffer),Tt.setLoaderResourceExtensionType("gltf",sr.json)},test(e){return e.includes(".gltf")||e.includes(".glb")},async load(e){return await ee.fromURL(e)}};Tt.installLoaderPlugin("gltf",n_);class s_{constructor(t,r){this._loader=t,this._resource=r}load(t,r){const i=this._resource.url.substring(0,this._resource.url.lastIndexOf("/")+1)+t;if(!this._loader.resources[i])this._loader.add({parentResource:this._resource,url:i,onComplete:r});else if(this._loader.resources[i].data)r(this._loader.resources[i]);else{let n=this._loader.onProgress.add((s,o)=>{o.url===i&&(r(o),n.detach())})}}}const o_={use:function(e,t){if(e.extension!=="glb")return t();if(ee.isValidBuffer(e.data))ee.fromBuffer(e.data,r=>{Object.assign(e,{gltf:r}),t()});else return t()},add:function(){Tt.setLoaderResourceExtensionType("glb",sr.buffer)}};Tt.installLoaderPlugin("cubemap",o_);var jr=1e-6,oe=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function a_(){var e=new oe(9);return oe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function l_(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=r[0],f=r[1],p=r[2],g=r[3],m=r[4],_=r[5],w=r[6],v=r[7],E=r[8];return e[0]=d*i+f*o+p*h,e[1]=d*n+f*a+p*c,e[2]=d*s+f*l+p*u,e[3]=g*i+m*o+_*h,e[4]=g*n+m*a+_*c,e[5]=g*s+m*l+_*u,e[6]=w*i+v*o+E*h,e[7]=w*n+v*a+E*c,e[8]=w*s+v*l+E*u,e}function h_(){var e=new oe(16);return oe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c_(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Xu(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u_(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function d_(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],w=r*a-i*o,v=r*l-n*o,E=r*h-s*o,y=i*l-n*a,C=i*h-s*a,x=n*h-s*l,F=c*g-u*p,G=c*m-d*p,k=c*_-f*p,U=u*m-d*g,I=u*_-f*g,L=d*_-f*m,R=w*L-v*I+E*U+y*k-C*G+x*F;return R?(R=1/R,e[0]=(a*L-l*I+h*U)*R,e[1]=(n*I-i*L-s*U)*R,e[2]=(g*x-m*C+_*y)*R,e[3]=(d*C-u*x-f*y)*R,e[4]=(l*k-o*L-h*G)*R,e[5]=(r*L-n*k+s*G)*R,e[6]=(m*E-p*x-_*v)*R,e[7]=(c*x-d*E+f*v)*R,e[8]=(o*I-a*k+h*F)*R,e[9]=(i*k-r*I-s*F)*R,e[10]=(p*C-g*E+_*w)*R,e[11]=(u*E-c*C-f*w)*R,e[12]=(a*G-o*U-l*F)*R,e[13]=(r*U-i*G+n*F)*R,e[14]=(g*v-p*y-m*w)*R,e[15]=(c*y-u*v+d*w)*R,e):null}function f_(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],w=t[15],v=r[0],E=r[1],y=r[2],C=r[3];return e[0]=v*i+E*a+y*u+C*g,e[1]=v*n+E*l+y*d+C*m,e[2]=v*s+E*h+y*f+C*_,e[3]=v*o+E*c+y*p+C*w,v=r[4],E=r[5],y=r[6],C=r[7],e[4]=v*i+E*a+y*u+C*g,e[5]=v*n+E*l+y*d+C*m,e[6]=v*s+E*h+y*f+C*_,e[7]=v*o+E*c+y*p+C*w,v=r[8],E=r[9],y=r[10],C=r[11],e[8]=v*i+E*a+y*u+C*g,e[9]=v*n+E*l+y*d+C*m,e[10]=v*s+E*h+y*f+C*_,e[11]=v*o+E*c+y*p+C*w,v=r[12],E=r[13],y=r[14],C=r[15],e[12]=v*i+E*a+y*u+C*g,e[13]=v*n+E*l+y*d+C*m,e[14]=v*s+E*h+y*f+C*_,e[15]=v*o+E*c+y*p+C*w,e}function p_(e,t,r){var i=r[0],n=r[1],s=r[2],o,a,l,h,c,u,d,f,p,g,m,_;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],h=t[3],c=t[4],u=t[5],d=t[6],f=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*i+c*n+p*s+t[12],e[13]=a*i+u*n+g*s+t[13],e[14]=l*i+d*n+m*s+t[14],e[15]=h*i+f*n+_*s+t[15]),e}function m_(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g_(e,t,r,i){var n=i[0],s=i[1],o=i[2],a=Math.hypot(n,s,o),l,h,c,u,d,f,p,g,m,_,w,v,E,y,C,x,F,G,k,U,I,L,R,W;return a<jr?null:(a=1/a,n*=a,s*=a,o*=a,l=Math.sin(r),h=Math.cos(r),c=1-h,u=t[0],d=t[1],f=t[2],p=t[3],g=t[4],m=t[5],_=t[6],w=t[7],v=t[8],E=t[9],y=t[10],C=t[11],x=n*n*c+h,F=s*n*c+o*l,G=o*n*c-s*l,k=n*s*c-o*l,U=s*s*c+h,I=o*s*c+n*l,L=n*o*c+s*l,R=s*o*c-n*l,W=o*o*c+h,e[0]=u*x+g*F+v*G,e[1]=d*x+m*F+E*G,e[2]=f*x+_*F+y*G,e[3]=p*x+w*F+C*G,e[4]=u*k+g*U+v*I,e[5]=d*k+m*U+E*I,e[6]=f*k+_*U+y*I,e[7]=p*k+w*U+C*I,e[8]=u*L+g*R+v*W,e[9]=d*L+m*R+E*W,e[10]=f*L+_*R+y*W,e[11]=p*L+w*R+C*W,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function __(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+h*i,e[5]=o*n+c*i,e[6]=a*n+u*i,e[7]=l*n+d*i,e[8]=h*n-s*i,e[9]=c*n-o*i,e[10]=u*n-a*i,e[11]=d*n-l*i,e}function v_(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],h=t[8],c=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-h*i,e[1]=o*n-c*i,e[2]=a*n-u*i,e[3]=l*n-d*i,e[8]=s*i+h*n,e[9]=o*i+c*n,e[10]=a*i+u*n,e[11]=l*i+d*n,e}function y_(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],h=t[4],c=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+h*i,e[1]=o*n+c*i,e[2]=a*n+u*i,e[3]=l*n+d*i,e[4]=h*n-s*i,e[5]=c*n-o*i,e[6]=u*n-a*i,e[7]=d*n-l*i,e}function x_(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b_(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T_(e,t,r){var i=r[0],n=r[1],s=r[2],o=Math.hypot(i,n,s),a,l,h;return o<jr?null:(o=1/o,i*=o,n*=o,s*=o,a=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=i*i*h+l,e[1]=n*i*h+s*a,e[2]=s*i*h-n*a,e[3]=0,e[4]=i*n*h-s*a,e[5]=n*n*h+l,e[6]=s*n*h+i*a,e[7]=0,e[8]=i*s*h+n*a,e[9]=n*s*h-i*a,e[10]=s*s*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function w_(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ju(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,o,a),e[2]=Math.hypot(l,h,c),e}function A_(e,t){var r=new oe(3);ju(r,t);var i=1/r[0],n=1/r[1],s=1/r[2],o=t[0]*i,a=t[1]*n,l=t[2]*s,h=t[4]*i,c=t[5]*n,u=t[6]*s,d=t[8]*i,f=t[9]*n,p=t[10]*s,g=o+c+p,m=0;return g>0?(m=Math.sqrt(g+1)*2,e[3]=.25*m,e[0]=(u-f)/m,e[1]=(d-l)/m,e[2]=(a-h)/m):o>c&&o>p?(m=Math.sqrt(1+o-c-p)*2,e[3]=(u-f)/m,e[0]=.25*m,e[1]=(a+h)/m,e[2]=(d+l)/m):c>p?(m=Math.sqrt(1+c-o-p)*2,e[3]=(d-l)/m,e[0]=(a+h)/m,e[1]=.25*m,e[2]=(u+f)/m):(m=Math.sqrt(1+p-o-c)*2,e[3]=(a-h)/m,e[0]=(d+l)/m,e[1]=(u+f)/m,e[2]=.25*m),e}function E_(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=t[3],l=n+n,h=s+s,c=o+o,u=n*l,d=n*h,f=n*c,p=s*h,g=s*c,m=o*c,_=a*l,w=a*h,v=a*c,E=i[0],y=i[1],C=i[2];return e[0]=(1-(p+m))*E,e[1]=(d+v)*E,e[2]=(f-w)*E,e[3]=0,e[4]=(d-v)*y,e[5]=(1-(u+m))*y,e[6]=(g+_)*y,e[7]=0,e[8]=(f+w)*C,e[9]=(g-_)*C,e[10]=(1-(u+p))*C,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function S_(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,h=r*o,c=i*o,u=i*a,d=n*o,f=n*a,p=n*l,g=s*o,m=s*a,_=s*l;return e[0]=1-u-p,e[1]=c+_,e[2]=d-m,e[3]=0,e[4]=c-_,e[5]=1-h-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C_(e,t,r,i,n){var s=1/Math.tan(t/2),o;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(o=1/(i-n),e[10]=(n+i)*o,e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e}var I_=C_;function R_(e,t,r,i,n,s,o){var a=1/(t-r),l=1/(i-n),h=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=(o+s)*h,e[15]=1,e}var M_=R_;function P_(e,t,r,i){var n,s,o,a,l,h,c,u,d,f,p=t[0],g=t[1],m=t[2],_=i[0],w=i[1],v=i[2],E=r[0],y=r[1],C=r[2];return Math.abs(p-E)<jr&&Math.abs(g-y)<jr&&Math.abs(m-C)<jr?Xu(e):(c=p-E,u=g-y,d=m-C,f=1/Math.hypot(c,u,d),c*=f,u*=f,d*=f,n=w*d-v*u,s=v*c-_*d,o=_*u-w*c,f=Math.hypot(n,s,o),f?(f=1/f,n*=f,s*=f,o*=f):(n=0,s=0,o=0),a=u*o-d*s,l=d*n-c*o,h=c*s-u*n,f=Math.hypot(a,l,h),f?(f=1/f,a*=f,l*=f,h*=f):(a=0,l=0,h=0),e[0]=n,e[1]=a,e[2]=c,e[3]=0,e[4]=s,e[5]=l,e[6]=u,e[7]=0,e[8]=o,e[9]=h,e[10]=d,e[11]=0,e[12]=-(n*p+s*g+o*m),e[13]=-(a*p+l*g+h*m),e[14]=-(c*p+u*g+d*m),e[15]=1,e)}function F_(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=i[0],l=i[1],h=i[2],c=n-r[0],u=s-r[1],d=o-r[2],f=c*c+u*u+d*d;f>0&&(f=1/Math.sqrt(f),c*=f,u*=f,d*=f);var p=l*d-h*u,g=h*c-a*d,m=a*u-l*c;return f=p*p+g*g+m*m,f>0&&(f=1/Math.sqrt(f),p*=f,g*=f,m*=f),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=u*m-d*g,e[5]=d*p-c*m,e[6]=c*g-u*p,e[7]=0,e[8]=c,e[9]=u,e[10]=d,e[11]=0,e[12]=n,e[13]=s,e[14]=o,e[15]=1,e}function qa(){var e=new oe(3);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Wu(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function ea(e,t,r){var i=new oe(3);return i[0]=e,i[1]=t,i[2]=r,i}function D_(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function N_(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function B_(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function O_(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function L_(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function U_(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function G_(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function k_(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function H_(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function V_(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function z_(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function $u(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function qu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dn(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2];return e[0]=n*l-s*a,e[1]=s*o-i*l,e[2]=i*a-n*o,e}function X_(e,t,r,i){var n=t[0],s=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=o+i*(r[2]-o),e}function j_(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,e}function W_(e,t,r){var i=r[0],n=r[1],s=r[2],o=r[3],a=t[0],l=t[1],h=t[2],c=n*h-s*l,u=s*a-i*h,d=i*l-n*a,f=n*d-s*u,p=s*c-i*d,g=i*u-n*c,m=o*2;return c*=m,u*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+c+f,e[1]=l+u+p,e[2]=h+d+g,e}var $_=Wu;(function(){var e=qa();return function(t,r,i,n,s,o){var a,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();function q_(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yu(e,t,r,i){var n=new oe(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Ku(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Y_(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=s*o,e}function K_(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,e}(function(){var e=q_();return function(t,r,i,n,s,o){var a,l;for(r||(r=4),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();function ra(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Q_(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function J_(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-i*a,e}function Z_(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=n*l+o*a,e[2]=s*l+i*a,e[3]=o*l-n*a,e}function t0(e,t,r){r*=.5;var i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e}function fn(e,t,r,i){var n=t[0],s=t[1],o=t[2],a=t[3],l=r[0],h=r[1],c=r[2],u=r[3],d,f,p,g,m;return f=n*l+s*h+o*c+a*u,f<0&&(f=-f,l=-l,h=-h,c=-c,u=-u),1-f>jr?(d=Math.acos(f),p=Math.sin(d),g=Math.sin((1-i)*d)/p,m=Math.sin(i*d)/p):(g=1-i,m=i),e[0]=g*n+m*l,e[1]=g*s+m*h,e[2]=g*o+m*c,e[3]=g*a+m*u,e}function e0(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function r0(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[o*3+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[s*3+o]-t[o*3+s])*i,e[s]=(t[s*3+n]+t[n*3+s])*i,e[o]=(t[o*3+n]+t[n*3+o])*i}return e}function i0(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var s=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),h=Math.sin(i),c=Math.cos(i);return e[0]=s*l*c-o*a*h,e[1]=o*a*c+s*l*h,e[2]=o*l*h-s*a*c,e[3]=o*l*c+s*a*h,e}var n0=Yu,s0=Ku,Ya=Y_,o0=function(){var e=qa(),t=ea(1,0,0),r=ea(0,1,0);return function(i,n,s){var o=qu(n,s);return o<-.999999?(dn(e,t,n),$_(e)<1e-6&&dn(e,r,n),$u(e,e),Q_(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(dn(e,n,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,Ya(i,i))}}();(function(){var e=ra(),t=ra();return function(r,i,n,s,o,a){return fn(e,i,o,a),fn(t,n,s,a),fn(r,e,t,2*a*(1-a)),r}})();(function(){var e=a_();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Ya(t,r0(t,e))}})();class ct{static set(t,r,i,n=new Float32Array(3)){return N_(n,t,r,i)}static fromValues(t,r,i){return ea(t,r,i)}static create(){return qa()}static add(t,r,i=new Float32Array(3)){return B_(i,t,r)}static transformQuat(t,r,i=new Float32Array(3)){return W_(i,t,r)}static subtract(t,r,i=new Float32Array(3)){return O_(i,t,r)}static scale(t,r,i=new Float32Array(3)){return U_(i,t,r)}static dot(t,r){return qu(t,r)}static normalize(t,r=new Float32Array(3)){return $u(r,t)}static cross(t,r,i=new Float32Array(3)){return dn(i,t,r)}static transformMat4(t,r,i=new Float32Array(3)){return j_(i,t,r)}static copy(t,r=new Float32Array(3)){return D_(r,t)}static magnitude(t){return Wu(t)}static squaredMagnitude(t){return H_(t)}static inverse(t,r=new Float32Array(3)){return z_(r,t)}static negate(t,r=new Float32Array(3)){return V_(r,t)}static multiply(t,r,i=new Float32Array(3)){return L_(i,t,r)}static distance(t,r){return G_(t,r)}static squaredDistance(t,r){return k_(t,r)}static lerp(t,r,i,n=new Float32Array(3)){return X_(n,t,r,i)}}class Ht{static set(t,r,i,n,s=new Float32Array(4)){return s0(s,t,r,i,n)}static fromValues(t,r,i,n){return n0(t,r,i,n)}static create(){return ra()}static normalize(t,r=new Float32Array(4)){return Ya(r,t)}static slerp(t,r,i,n=new Float32Array(4)){return fn(n,t,r,i)}static fromEuler(t,r,i,n=new Float32Array(4)){return i0(n,t,r,i)}static conjugate(t,r=new Float32Array(4)){return e0(r,t)}static rotateX(t,r,i=new Float32Array(4)){return J_(i,t,r)}static rotateY(t,r,i=new Float32Array(4)){return Z_(i,t,r)}static rotateZ(t,r,i=new Float32Array(4)){return t0(i,t,r)}static rotationTo(t,r,i=new Float32Array(4)){return o0(i,t,r)}}const pr=new Float32Array(4);class ae extends Xt{constructor(t=0,r=0,i=0,n=1,s=()=>{},o=void 0){super(s,o),this._array=new Float32Array(4),this._array.set([t,r,i,n])}get array(){return this._array}set array(t){this.setFrom(t)}get x(){return this._array[0]}set x(t){this._array[0]!==t&&(this._array[0]=t,this.cb.call(this.scope))}get y(){return this._array[1]}set y(t){this._array[1]!==t&&(this._array[1]=t,this.cb.call(this.scope))}get z(){return this._array[2]}set z(t){this._array[2]!==t&&(this._array[2]=t,this.cb.call(this.scope))}get w(){return this._array[3]}set w(t){this._array[3]!==t&&(this._array[3]=t,this.cb.call(this.scope))}setEulerAngles(t,r,i){Ht.fromEuler(t,r,i,this._array),this.cb.call(this.scope)}clone(t=this.cb,r=this.scope){return new ae(this.x,this.y,this.z,this.w,t,r)}copyFrom(t){return(this._array[0]!==t.x||this._array[1]!==t.y||this._array[2]!==t.z||this._array[3]!==t.w)&&(this._array[0]=t.x,this._array[1]=t.y,this._array[2]=t.z,this._array[3]=t.w,this.cb.call(this.scope)),this}copyTo(t){return t instanceof ae&&t.set(this.x,this.y,this.z,this.w),t}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}set(t,r=t,i=t,n=t){return(this._array[0]!==t||this._array[1]!==r||this._array[2]!==i||this._array[3]!==n)&&(this._array[0]=t,this._array[1]=r,this._array[2]=i,this._array[3]=n,this.cb.call(this.scope)),this}setFrom(t){return this.set(t[0],t[1],t[2],t[3]),this}normalize(t=new ae){return t.setFrom(Ht.normalize(this._array,pr))}static slerp(t,r,i,n=new ae){return n.setFrom(Ht.slerp(t.array,r.array,i,pr))}static fromEuler(t,r,i,n=new ae){return n.setFrom(Ht.fromEuler(t,r,i,pr))}static conjugate(t,r=new ae){return r.setFrom(Ht.conjugate(t.array,pr))}static rotateX(t,r,i=new ae){return i.setFrom(Ht.rotateX(t.array,r,pr))}static rotateY(t,r,i=new ae){return i.setFrom(Ht.rotateY(t.array,r,pr))}static rotateZ(t,r,i=new ae){return i.setFrom(Ht.rotateZ(t.array,r,pr))}}class lt{static getTranslation(t,r=new Float32Array(3)){return w_(r,t)}static create(){return h_()}static translate(t,r,i=new Float32Array(16)){return p_(i,t,r)}static getScaling(t,r=new Float32Array(3)){return ju(r,t)}static getRotation(t,r=new Float32Array(4)){return A_(r,t)}static copy(t,r=new Float32Array(16)){return c_(r,t)}static fromQuat(t,r=new Float32Array(16)){return S_(r,t)}static fromRotationTranslationScale(t,r,i,n=new Float32Array(16)){return E_(n,t,r,i)}static fromRotation(t,r,i=new Float32Array(16)){return T_(i,t,r)}static fromScaling(t,r=new Float32Array(16)){return b_(r,t)}static fromTranslation(t,r=new Float32Array(16)){return x_(r,t)}static multiply(t,r,i=new Float32Array(16)){return f_(i,t,r)}static lookAt(t,r,i,n=new Float32Array(16)){return P_(n,t,r,i)}static identity(t=new Float32Array(16)){return Xu(t)}static perspective(t,r,i,n,s=new Float32Array(16)){return I_(s,t,r,i,n)}static ortho(t,r,i,n,s,o,a=new Float32Array(16)){return M_(a,t,r,i,n,s,o)}static invert(t,r=new Float32Array(16)){return d_(r,t)}static transpose(t,r=new Float32Array(16)){return u_(r,t)}static targetTo(t,r,i,n=new Float32Array(16)){return F_(n,t,r,i)}static rotateX(t,r,i=new Float32Array(16)){return __(i,t,r)}static rotateY(t,r,i=new Float32Array(16)){return v_(i,t,r)}static rotateZ(t,r,i=new Float32Array(16)){return y_(i,t,r)}static rotate(t,r,i,n=new Float32Array(16)){return g_(n,t,r,i)}static scale(t,r,i=new Float32Array(16)){return m_(i,t,r)}}class le{constructor(t,r,i){this._parent=t,this._data=r,this._update=i}get data(){return this._id!==this._parent.transformId&&(this._update(this._data),this._id=this._parent.transformId),this._data}}const Nt=new Float32Array(16);class xt extends wt{constructor(t){super(),this._transformId=0,t?this.array=new Float32Array(t):this.array=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get transformId(){return this._transformId}toArray(t,r){return t?lt.transpose(this.array,r):r?lt.copy(this.array,r):this.array}get position(){return this._position||(this._position=new le(this,new mt,t=>{lt.getTranslation(this.array,t.array)})),this._position.data}get scaling(){return this._scaling||(this._scaling=new le(this,new mt,t=>{lt.getScaling(this.array,t.array)})),this._scaling.data}get rotation(){if(!this._rotation){let t=new Float32Array(16);this._rotation=new le(this,new ae,r=>{for(let i=0;i<3;i++)t[i+0]=this.array[i+0]/this.scaling.x,t[i+4]=this.array[i+4]/this.scaling.y,t[i+8]=this.array[i+8]/this.scaling.z;Ht.normalize(lt.getRotation(t,r.array),r.array)})}return this._rotation.data}get up(){return this._up||(this._up=new le(this,new mt,t=>{ct.normalize(ct.set(this.array[4],this.array[5],this.array[6],t.array),t.array)})),this._up.data}get down(){return this._down||(this._down=new le(this,new mt,t=>{ct.negate(this.up.array,t.array)})),this._down.data}get right(){return this._right||(this._right=new le(this,new mt,t=>{ct.negate(this.left.array,t.array)})),this._right.data}get left(){return this._left||(this._left=new le(this,new mt,t=>{ct.normalize(ct.cross(this.up.array,this.forward.array,t.array),t.array)})),this._left.data}get forward(){return this._forward||(this._forward=new le(this,new mt,t=>{ct.normalize(ct.set(this.array[8],this.array[9],this.array[10],t.array),t.array)})),this._forward.data}get backward(){return this._backward||(this._backward=new le(this,new mt,t=>{ct.negate(this.forward.array,t.array)})),this._backward.data}copyFrom(t){return t instanceof xt&&(lt.copy(t.array,this.array),this._transformId++),this}setFrom(t){return lt.copy(t,this.array),this._transformId++,this}setFromRotationPositionScale(t,r,i){lt.fromRotationTranslationScale(t.array,r.array,i.array,this.array),this._transformId++}multiply(t){lt.multiply(t.array,this.array,this.array),this._transformId++}static translate(t,r,i=new xt){return i.setFrom(lt.translate(t.array,r.array,Nt))}static fromQuaternion(t,r=new xt){return r.setFrom(lt.fromQuat(t.array,Nt))}static fromRotationTranslationScale(t,r,i,n=new xt){return n.setFrom(lt.fromRotationTranslationScale(t.array,r.array,i.array,Nt))}static fromRotation(t,r,i=new xt){return i.setFrom(lt.fromRotation(t,r.array,Nt))}static fromScaling(t,r=new xt){return r.setFrom(lt.fromScaling(t.array,Nt))}static fromTranslation(t,r=new xt){return r.setFrom(lt.fromTranslation(t.array,Nt))}static lookAt(t,r,i,n=new xt){return n.setFrom(lt.lookAt(t.array,r.array,i.array,Nt))}static identity(t=new xt){return t.setFrom(lt.identity(Nt))}static perspective(t,r,i,n,s=new xt){return s.setFrom(lt.perspective(t,r,i,n,Nt))}static ortho(t,r,i,n,s,o,a=new xt){return a.setFrom(lt.ortho(t,r,i,n,s,o,Nt))}static invert(t,r=new xt){return r.setFrom(lt.invert(t.array,Nt))}static transpose(t,r=new xt){return r.setFrom(lt.transpose(t.array,Nt))}static targetTo(t,r,i,n=new xt){return n.setFrom(lt.targetTo(t.array,r.array,i.array,Nt))}static rotateX(t,r,i=new xt){return i.setFrom(lt.rotateX(t.array,r,Nt))}static rotateY(t,r,i=new xt){return i.setFrom(lt.rotateY(t.array,r,Nt))}static rotateZ(t,r,i=new xt){return i.setFrom(lt.rotateZ(t.array,r,Nt))}static rotate(t,r,i,n=new xt){return n.setFrom(lt.rotate(t.array,r,i.array,Nt))}static scale(t,r,i=new xt){return i.setFrom(lt.scale(t.array,r.array,Nt))}}const ye=new Float32Array(3);class mt extends Xt{constructor(t=0,r=0,i=0,n=()=>{},s=void 0){super(n,s),this._array=new Float32Array(3),this._array.set([t,r,i])}get array(){return this._array}set array(t){this.setFrom(t)}get x(){return this._array[0]}set x(t){this._array[0]!==t&&(this._array[0]=t,this.cb.call(this.scope))}get y(){return this._array[1]}set y(t){this._array[1]!==t&&(this._array[1]=t,this.cb.call(this.scope))}get z(){return this._array[2]}set z(t){this._array[2]!==t&&(this._array[2]=t,this.cb.call(this.scope))}clone(t=this.cb,r=this.scope){return new mt(this.x,this.y,this.z,t,r)}copyFrom(t){return(this._array[0]!==t.x||this._array[1]!==t.y||this._array[2]!==t.z)&&(this._array[0]=t.x,this._array[1]=t.y,this._array[2]=t.z,this.cb.call(this.scope)),this}copyTo(t){return t instanceof mt&&t.set(this.x,this.y,this.z),t}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}set(t,r=t,i=t){return(this._array[0]!==t||this._array[1]!==r||this._array[2]!==i)&&(this._array[0]=t,this._array[1]=r,this._array[2]=i,this.cb.call(this.scope)),this}setFrom(t){return this.set(t[0],t[1],t[2]),this}normalize(t=new mt){return t.setFrom(ct.normalize(this._array,ye))}get magnitude(){return ct.magnitude(this._array)}static dot(t,r){return ct.dot(t._array,r._array)}static add(t,r,i=new mt){return i.setFrom(ct.add(t._array,r._array,ye))}static subtract(t,r,i=new mt){return i.setFrom(ct.subtract(t._array,r._array,ye))}static cross(t,r,i=new mt){return i.setFrom(ct.cross(t._array,r._array,ye))}static inverse(t,r=new mt){return r.setFrom(ct.inverse(t._array,ye))}static distance(t,r){return ct.distance(t._array,r._array)}static squaredDistance(t,r){return ct.squaredDistance(t._array,r._array)}static multiply(t,r,i=new mt){return i.setFrom(ct.multiply(t._array,r._array,ye))}static negate(t,r=new mt){return r.setFrom(ct.negate(t._array,ye))}static transform(t,r,i=new mt){return r instanceof xt?i.setFrom(ct.transformMat4(t._array,r.array,ye)):i.setFrom(ct.transformQuat(t._array,r.array,ye))}static lerp(t,r,i,n=new mt){return n.setFrom(ct.lerp(t._array,r._array,i,ye))}static scale(t,r,i=new mt){return i.setFrom(ct.scale(t._array,r,ye))}}class Ka extends Si{constructor(){super(...arguments),this.position=new mt(0,0,0,this.onChange,this),this.scale=new mt(1,1,1,this.onChange,this),this.rotationQuaternion=new ae(0,0,0,1,this.onChange,this),this.worldTransform=new xt,this.localTransform=new xt,this.inverseWorldTransform=new xt,this.normalTransform=new xt}updateLocalTransform(){this._localID!==this._currentLocalID&&(this.localTransform.setFromRotationPositionScale(this.rotationQuaternion,this.position,this.scale),this._parentID=-1,this._currentLocalID=this._localID)}setFromMatrix(t){this.localTransform.copyFrom(t),this.position.copyFrom(this.localTransform.position),this.scale.copyFrom(this.localTransform.scaling),this.rotationQuaternion.copyFrom(this.localTransform.rotation)}updateTransform(t){this.updateLocalTransform(),!(t&&this._parentID===t._worldID)&&(this.worldTransform.copyFrom(this.localTransform),t instanceof Ka&&this.worldTransform.multiply(t.worldTransform),lt.invert(this.worldTransform.array,this.inverseWorldTransform.array),lt.transpose(this.inverseWorldTransform.array,this.normalTransform.array),this._worldID++,t&&(this._parentID=t._worldID))}lookAt(t,r=new mt(0,1,0)){r instanceof mt&&(r=r.array);let i=lt.getRotation(lt.targetTo(t.array,this.worldTransform.position.array,r));this.rotationQuaternion.set(i[0],i[1],i[2],i[3])}}class ie extends se{constructor(){super(...arguments),this.transform=new Ka}set position(t){this.transform.position.copyFrom(t)}get position(){return this.transform.position}set scale(t){this.transform.scale.copyFrom(t)}get scale(){return this.transform.scale}set rotationQuaternion(t){this.transform.rotationQuaternion.copyFrom(t)}get rotationQuaternion(){return this.transform.rotationQuaternion}get z(){return this.transform.position.z}set z(t){this.transform.position.z=t}get localTransform(){return this.transform.localTransform}get worldTransform(){return this.transform.worldTransform}}class fc{constructor(t,r){this._direction=new mt,this._origin=new mt,this._origin.copyFrom(t),this._direction.copyFrom(r)}get origin(){return this._origin}get direction(){return this._direction}getPoint(t,r=new mt){return mt.add(this._origin,mt.scale(this._direction,t,r),r)}}class li{static set(t,r,i,n,s=new Float32Array(4)){return Ku(s,t,r,i,n)}static transformMat4(t,r,i=new Float32Array(4)){return K_(i,t,r)}static fromValues(t,r,i,n){return Yu(t,r,i,n)}}const a0=new Float32Array(3),l0=new Float32Array(16),hi=new Float32Array(4);class Ce extends ie{constructor(t){super(),this.renderer=t,this._transformId=0,this._orthographic=!1,this._orthographicSize=10,this._obliqueness=new Xt(()=>{this._transformId++},void 0),this._fieldOfView=60,this._near=.1,this._far=1e3;let r=t.width/t.height,i=-1;this.renderer.on("prerender",()=>{this._aspect||t.width/t.height!==r&&(this._transformId++,r=t.width/t.height),!this.parent&&i!==this.transform._localID&&(this.transform.updateTransform(),i=this.transform._localID)}),Ce.main||(Ce.main=this),this.transform.position.z=5,this.transform.rotationQuaternion.setEulerAngles(0,180,0)}get transformId(){return this.transform._worldID+this._transformId}get obliqueness(){return this._obliqueness}set obliqueness(t){this._obliqueness.copyFrom(t)}destroy(t){super.destroy(t),this===Ce.main&&(Ce.main=void 0)}get orthographicSize(){return this._orthographicSize}set orthographicSize(t){this._orthographicSize!==t&&(this._orthographicSize=t,this._transformId++)}get orthographic(){return this._orthographic}set orthographic(t){this._orthographic!==t&&(this._orthographic=t,this._transformId++)}screenToRay(t,r,i=this.renderer.screen){let n=this.screenToWorld(t,r,1,void 0,i);if(n)return this.orthographic?new fc(n,this.worldTransform.forward):new fc(this.worldTransform.position,mt.subtract(n,this.worldTransform.position))}screenToWorld(t,r,i,n=new mt,s=this.renderer.screen){var o;this.transform.updateTransform((o=this.parent)==null?void 0:o.transform);let a=this.far;this.far=i;let l=lt.invert(this.viewProjection.array,l0);if(l===null)return;let h=li.set(t/s.width*2-1,(r/s.height*2-1)*-1,1,1,hi);this.far=a;let c=li.transformMat4(h,l,hi);c[3]=1/c[3];for(let u=0;u<3;u++)c[u]*=c[3];return n.set(c[0],c[1],c[2])}worldToScreen(t,r,i,n=new _t,s=this.renderer.screen){var o;this.transform.updateTransform((o=this.parent)==null?void 0:o.transform);let a=li.set(t,r,i,1,hi),l=li.transformMat4(li.transformMat4(a,this.view.array,hi),this.projection.array,hi);if(l[3]!==0)for(let h=0;h<3;h++)l[h]/=l[3];return n.set((l[0]+1)/2*s.width,s.height-(l[1]+1)/2*s.height)}get aspect(){return this._aspect}set aspect(t){this._aspect!==t&&(this._aspect=t,this._transformId++)}get fieldOfView(){return this._fieldOfView}set fieldOfView(t){this._fieldOfView!==t&&(this._fieldOfView=t,this._transformId++)}get near(){return this._near}set near(t){this._near!==t&&(this._near=t,this._transformId++)}get far(){return this._far}set far(t){this._far!==t&&(this._far=t,this._transformId++)}get projection(){return this._projection||(this._projection=new le(this,new xt,t=>{const r=this._aspect||this.renderer.width/this.renderer.height;this._orthographic?lt.ortho(-this._orthographicSize*r,this._orthographicSize*r,-this._orthographicSize,this._orthographicSize,this._near,this._far,t.array):(lt.perspective(this._fieldOfView*Sr,r,this._near,this._far,t.array),t.array[8]=this._obliqueness.x,t.array[9]=this._obliqueness.y)})),this._projection.data}get view(){return this._view||(this._view=new le(this,new xt,t=>{const r=ct.add(this.worldTransform.position.array,this.worldTransform.forward.array,a0);lt.lookAt(this.worldTransform.position.array,r,this.worldTransform.up.array,t.array)})),this._view.data}get viewProjection(){return this._viewProjection||(this._viewProjection=new le(this,new xt,t=>{lt.multiply(this.projection.array,this.view.array,t.array)})),this._viewProjection.data}}Tt.installRendererPlugin("camera",Ce);class h0{constructor(t,r=Ce.main){this._autoUpdate=!0,this._allowControl=!0,this._camera=Ce.main,this._target={x:0,y:0,z:0},this._angles=new Xt(()=>{this._angles.x=Math.min(Math.max(-85,this._angles.x),85)},void 0,0,180),this._distance=5,this._enableDamping=!1,this._dampingFactor=.1,this._grabbed=!1,this._previousPinchDistance=0,this._previousClientX=0,this._previousClientY=0,this._dampingAngles={x:0,y:180},this._dampingDistance=5,this.onPointerDown=(i,n)=>{this._grabbed=!0,this._previousClientX=i,this._previousClientY=n},this.onPointerUp=()=>{this._grabbed=!1},this.onPointerMove=(i,n)=>{if(this._grabbed){const s=i-this._previousClientX,o=n-this._previousClientY;this.angles.x+=o*.5,this.angles.y-=s*.5,this.updateCamera(),this._previousClientX=i,this._previousClientY=n}},this.onPreRender=()=>{this.autoUpdate&&this.updateCamera()},this.onMouseDownInteraction=i=>{var n,s,o;if(this.allowControl&&!i.stopped){this._grabbed=!0;const a=i.data.originalEvent,l=a,h=a,c=(n=l==null?void 0:l.targetTouches)==null?void 0:n[0],u=(s=c==null?void 0:c.clientX)!=null?s:h==null?void 0:h.clientX,d=(o=c==null?void 0:c.clientY)!=null?o:h==null?void 0:h.clientY;this.onPointerDown(u,d)}},this.onMouseDown=i=>{this.allowControl&&this.onPointerDown(i.clientX,i.clientY)},this.onMouseMove=i=>{this.allowControl&&i.buttons===1&&this.onPointerMove(i.clientX,i.clientY)},this.onMouseUp=i=>{this.allowControl&&this.onPointerUp()},this.onWheel=i=>{this.allowControl&&(this.distance+=i.deltaY*.01,i.preventDefault(),this.updateCamera())},this.onTouchStart=i=>{var n;if(this.allowControl){const s=(n=i==null?void 0:i.targetTouches)==null?void 0:n[0];if(s){const o=s.clientX,a=s.clientY;this.onPointerDown(o,a)}i.touches.length===2&&(i.preventDefault(),this._previousPinchDistance=Math.hypot(i.touches[0].clientX-i.touches[1].clientX,i.touches[0].clientY-i.touches[1].clientY))}},this.onPinch=i=>{if(this.allowControl){i.preventDefault();const n=Math.hypot(i.touches[0].clientX-i.touches[1].clientX,i.touches[0].clientY-i.touches[1].clientY),s=n-this._previousPinchDistance;this.distance-=s*.1,this.updateCamera(),this._previousPinchDistance=n}},this.onTouchMove=i=>{var n;if(this.allowControl){const s=(n=i==null?void 0:i.targetTouches)==null?void 0:n[0];if(i.touches.length===1&&s){const o=s.clientX,a=s.clientY;this.onPointerMove(o,a)}i.touches.length===2&&this.onPinch(i)}},this.onTouchEnd=i=>{this.allowControl&&i.touches.length===0&&this.onPointerUp()},this._element=t,this._camera=r,this.bind()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate=t}get allowControl(){return this._allowControl}set allowControl(t){this._allowControl=t}get camera(){return this._camera}set camera(t){this._camera=t}get target(){return this._target}set target(t){this._target=t}get angles(){return this._angles}get distance(){return this._distance}set distance(t){this._distance=Math.min(Math.max(t,.01),Number.MAX_SAFE_INTEGER)}get enableDamping(){return this._enableDamping}set enableDamping(t){this._enableDamping=t}get dampingFactor(){return this._dampingFactor}set dampingFactor(t){this._dampingFactor=t}destroy(){this.unbind()}bind(){this.camera.renderer.on("prerender",this.onPreRender);let t=Tt.getInteractionPlugin(this.camera.renderer);t&&t.on("mousedown",this.onMouseDownInteraction),this._element.addEventListener("mousedown",this.onMouseDown),this._element.addEventListener("touchstart",this.onTouchStart),this._element.addEventListener("wheel",this.onWheel),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd)}unbind(){this._element.removeEventListener("mousedown",this.onMouseDown),this._element.removeEventListener("touchstart",this.onTouchStart),this._element.removeEventListener("wheel",this.onWheel),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}updateCamera(){this.enableDamping&&(this._dampingAngles.x+=(this.angles.x-this._dampingAngles.x)*this.dampingFactor,this._dampingAngles.y+=(this.angles.y-this._dampingAngles.y)*this.dampingFactor,this._dampingDistance+=(this.distance-this._dampingDistance)*this.dampingFactor);const t=this.enableDamping?this._dampingAngles:this.angles,r=this.enableDamping?this._dampingDistance:this.distance,i=Ht.fromEuler(t.x,t.y,0,new Float32Array(4)),n=ct.transformQuat(ct.set(0,0,1,new Float32Array(3)),i,new Float32Array(3)),s=ct.subtract(ct.set(this.target.x,this.target.y,this.target.z,new Float32Array(3)),ct.scale(n,r,new Float32Array(3)),new Float32Array(3));this.camera.position.set(s[0],s[1],s[2]),this.camera.rotationQuaternion.set(i[0],i[1],i[2],i[3])}}class Ir{constructor(){this._shaderGeometry={}}getShaderGeometry(t){return this._shaderGeometry[t.name]}addShaderGeometry(t,r){this._shaderGeometry[t.name]=t.createShaderGeometry(this,r)}hasShaderGeometry(t,r){return this._shaderGeometry[t.name]?!r||r&&this._shaderGeometry[t.name].instanced:!1}destroy(){for(let t in this._shaderGeometry)this._shaderGeometry[t].destroy();this._shaderGeometry={}}}var ia;(e=>{function t(){return Object.assign(new Ir,{positions:{buffer:new Float32Array([-1,0,1,1,0,-1,-1,0,-1,1,0,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1])},normals:{buffer:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([0,1,1,0,0,0,1,1])}]})}e.create=t})(ia||(ia={}));var na;(e=>{function t(){return Object.assign(new Ir,{positions:{buffer:new Float32Array([-1,1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,13,14,12,15,13,16,17,18,16,19,17,20,21,22,20,23,21])},normals:{buffer:new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([.625,1,.375,.75,.375,1,.625,.75,.625,.75,.375,.5,.375,.75,.625,.5,.625,.5,.375,.25,.375,.5,.625,.25,.625,.25,.375,0,.375,.25,.625,0,.375,.25,.125,.5,.375,.5,.125,.25,.875,.25,.625,.5,.875,.5,.625,.25])}],tangents:{buffer:new Float32Array([0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1])}})}e.create=t})(na||(na={}));var sa;(e=>{function t(){return Object.assign(new Ir,{positions:{buffer:new Float32Array([-1,1,0,1,-1,0,-1,-1,0,1,1,0])},indices:{buffer:new Uint8Array([0,2,1,0,1,3])},normals:{buffer:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},uvs:[{buffer:new Float32Array([0,0,1,1,0,1,1,0])}]})}e.create=t})(sa||(sa={}));class c0 extends ie{constructor(t,r){super(),this.mesh=t,this.material=r}destroy(t){super.destroy(t),this.mesh.removeInstance(this)}}var Re=(e=>(e.spot="spot",e.directional="directional",e.point="point",e))(Re||{}),ir=(e=>(e.opaque="opaque",e.mask="mask",e.blend="blend",e))(ir||{}),Qe=(e=>(e.alpha="alpha",e.emissive="emissive",e.f0="f0",e.metallic="metallic",e.normal="normal",e.occlusion="occlusion",e.roughness="roughness",e))(Qe||{}),de;(e=>{let t;function r(p){if(t!==void 0)return t;const g=p.gl;return t=g.getParameter(g.MAX_VERTEX_UNIFORM_VECTORS),t}e.getMaxVertexUniformVectors=r;let i;function n(p){return p.context.webGLVersion===2?!0:(i!==void 0||(i=!!p.gl.getExtension("OES_texture_float")),i)}e.isFloatingPointTextureSupported=n;let s;function o(p){if(p.context.webGLVersion===2)return!0;if(s!==void 0)return s;const g=p.gl,m=g.getExtension("OES_texture_half_float");if(!m)return!1;const _=g.createTexture();g.bindTexture(g.TEXTURE_2D,_),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,8,8,0,g.RGBA,m.HALF_FLOAT_OES,null);const w=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,w);const v=g.COLOR_ATTACHMENT0;return g.framebufferTexture2D(g.FRAMEBUFFER,v,g.TEXTURE_2D,_,0),s=g.checkFramebufferStatus(g.FRAMEBUFFER)===g.FRAMEBUFFER_COMPLETE,s}e.isHalfFloatFramebufferSupported=o;let a;function l(p){if(p.context.webGLVersion===2)return!0;if(a!==void 0)return a;const g=p.gl;if(!g.getExtension("OES_texture_float"))return!1;const _=g.createTexture();g.bindTexture(g.TEXTURE_2D,_),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,8,8,0,g.RGBA,g.FLOAT,null);const w=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,w);const v=g.COLOR_ATTACHMENT0;return g.framebufferTexture2D(g.FRAMEBUFFER,v,g.TEXTURE_2D,_,0),a=g.checkFramebufferStatus(g.FRAMEBUFFER)===g.FRAMEBUFFER_COMPLETE,a}e.isFloatFramebufferSupported=l;let h;function c(p){return h!==void 0||(h=p.gl.getExtension("OES_texture_float_linear")!==null),h}e.supportsFloatLinear=c;function u(p){return p.context.webGLVersion===2?!0:p.gl.getExtension("EXT_shader_texture_lod")!==null}e.isShaderTextureLodSupported=u;let d;function f(p){return d!==void 0||(d=p.gl.getExtension("ANGLE_instanced_arrays")!==void 0),d}e.isInstancingSupported=f})(de||(de={}));const Qa=It.get(St,"BufferResource")||It.get(St,"resources").BufferResource;class Kr extends ${constructor(t){let r=new Float32Array(t*16),i=new Qa(r,{width:4,height:t});super(new ht(i,{mipmap:ne.OFF,wrapMode:Wt.CLAMP,scaleMode:Zt.NEAREST,format:X.RGBA,type:Q.FLOAT,alphaMode:Vt.NO_PREMULTIPLIED_ALPHA,resolution:1})),this._buffer=r}static isSupported(t){return de.isFloatingPointTextureSupported(t)}updateBuffer(t){this._buffer.set(t),this.baseTexture.resource.update()}}var rr;(e=>{const t=[],r=new lr;function i(a,l,h){r.on(a,l,h)}e.on=i;function n(a,l){if(!t.includes(a)){t.push(a);let h=o(a,l);console.warn(`PIXI3D: ${h}`),r.emit("warn",h)}}e.warn=n;function s(a,l){if(!t.includes(a)){t.push(a);let h=o(a,l);console.error(`PIXI3D: ${h}`),r.emit("error",h)}}e.error=s;function o(a,l){let h=a,c;for(;(c=/{(\w*)}/g.exec(h))!==null&&l;)h=h.replace(c[0],l[c[1]]);return h}})(rr||(rr={}));var br=(e=>(e.meshVertexSkinningFloatingPointTexturesNotSupported='Mesh is using vertex skinning but floating point textures is not supported on this device/environment. In case of errors, try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',e.meshVertexSkinningNumberOfJointsNotSupported="Mesh is using vertex skinning but the number of joints ({joints}) is not supported on this device/environment. Max number of supported joints is {maxJoints}, try reducing the number of joints.",e.imageBasedLightingShaderTextureLodNotSupported='Image based lighting is used but shader texture lod is not supported on this device/environment, the material may not be displayed correctly. Try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',e))(br||{}),Jn=(e=>(e.ldr="ldr",e.rgbe8="rgbe8",e))(Jn||{}),Pn;(e=>{function t(n,s,o,a,l){let h=[];if(s.instances.length>0&&h.push("USE_INSTANCING 1"),n.context.webGLVersion===1&&h.push("WEBGL1 1"),n.context.webGLVersion===2&&h.push("WEBGL2 1"),o.colors&&(o.colors.componentCount===3?h.push("HAS_VERTEX_COLOR_VEC3 1"):h.push("HAS_VERTEX_COLOR_VEC4 1")),o.normals&&h.push("HAS_NORMALS 1"),o.uvs&&o.uvs[0]&&h.push("HAS_UV_SET1 1"),o.uvs&&o.uvs[1]&&h.push("HAS_UV_SET2 1"),o.tangents&&h.push("HAS_TANGENTS 1"),o.targets){for(let c=0;c<o.targets.length;c++)o.targets[c].positions&&h.push("HAS_TARGET_POSITION"+c),o.targets[c].normals&&h.push("HAS_TARGET_NORMAL"+c),o.targets[c].tangents&&h.push("HAS_TARGET_TANGENT"+c);s.targetWeights&&s.targetWeights.length>0&&(h.push(`WEIGHT_COUNT ${s.targetWeights.length}`),h.push("USE_MORPHING 1"))}if(o.joints&&h.push("HAS_JOINT_SET1 1"),o.weights&&h.push("HAS_WEIGHT_SET1 1"),s.skin&&r(s,h,n),a.unlit&&h.push("MATERIAL_UNLIT 1"),h.push("MATERIAL_METALLICROUGHNESS 1"),l.fog&&h.push("USE_FOG 1"),l.lights.length>0&&(h.push(`LIGHT_COUNT ${l.lights.length}`),h.push("USE_PUNCTUAL 1")),l.imageBasedLighting){if(!l.imageBasedLighting.valid)return;de.isShaderTextureLodSupported(n)?h.push("USE_TEX_LOD 1"):rr.warn(br.imageBasedLightingShaderTextureLodNotSupported),h.push("USE_IBL 1"),l.imageBasedLighting.diffuse.cubemapFormat===Jn.rgbe8&&h.push("USE_RGBE 1")}if(a.shadowCastingLight&&h.push("USE_SHADOW_MAPPING 1"),a.baseColorTexture){if(!a.baseColorTexture.valid)return;a.baseColorTexture.transform&&h.push("HAS_BASECOLOR_UV_TRANSFORM 1"),h.push("HAS_BASE_COLOR_MAP 1")}if(a.emissiveTexture){if(!a.emissiveTexture.valid)return;a.emissiveTexture.transform&&h.push("HAS_EMISSIVE_UV_TRANSFORM 1"),h.push("HAS_EMISSIVE_MAP 1")}if(a.normalTexture){if(!a.normalTexture.valid)return;a.normalTexture.transform&&h.push("HAS_NORMAL_UV_TRANSFORM 1"),h.push("HAS_NORMAL_MAP 1")}if(a.metallicRoughnessTexture){if(!a.metallicRoughnessTexture.valid)return;a.metallicRoughnessTexture.transform&&h.push("HAS_METALLICROUGHNESS_UV_TRANSFORM 1"),h.push("HAS_METALLIC_ROUGHNESS_MAP 1")}if(a.occlusionTexture){if(!a.occlusionTexture.valid)return;a.occlusionTexture.transform&&h.push("HAS_OCCLUSION_UV_TRANSFORM 1"),h.push("HAS_OCCLUSION_MAP 1")}switch(a.alphaMode){case ir.opaque:{h.push("ALPHAMODE_OPAQUE 1");break}case ir.mask:{h.push("ALPHAMODE_MASK 1");break}}switch(a.debugMode&&h.push("DEBUG_OUTPUT 1"),a.debugMode){case Qe.alpha:{h.push("DEBUG_ALPHA 1");break}case Qe.emissive:{h.push("DEBUG_EMISSIVE 1");break}case Qe.f0:{h.push("DEBUG_F0 1");break}case Qe.metallic:{h.push("DEBUG_METALLIC 1");break}case Qe.normal:{h.push("DEBUG_NORMAL 1");break}case Qe.occlusion:{h.push("DEBUG_OCCLUSION 1");break}case Qe.roughness:{h.push("DEBUG_ROUGHNESS 1");break}}return h}e.build=t;function r(n,s,o){if(!n.skin)return;let l=de.getMaxVertexUniformVectors(o)-20,c=Math.floor(l/8),u=n.skin.joints.length<=c;const d=()=>{var p;s.push("USE_SKINNING 1"),s.push(`JOINT_COUNT ${(p=n.skin)==null?void 0:p.joints.length}`)},f=()=>{var p;s.push("USE_SKINNING 1"),s.push(`JOINT_COUNT ${(p=n.skin)==null?void 0:p.joints.length}`),s.push("USE_SKINNING_TEXTURE 1")};if(j.PREFER_UNIFORMS_WHEN_UPLOADING_SKIN_JOINTS){if(u){d();return}if(Kr.isSupported(o)){f();return}else rr.error(br.meshVertexSkinningNumberOfJointsNotSupported,{joints:n.skin.joints.length,maxJoints:c})}else{if(Kr.isSupported(o)){f();return}rr.warn(br.meshVertexSkinningFloatingPointTexturesNotSupported),u?d():rr.error(br.meshVertexSkinningNumberOfJointsNotSupported,{joints:n.skin.joints.length,maxJoints:c})}}function i(n){return n.includes("USE_SKINNING_TEXTURE 1")}e.hasSkinningTextureFeature=i})(Pn||(Pn={}));class Ni extends Fe{constructor(){super(...arguments),this._state=Object.assign(new $t,{culling:!0,clockwiseFrontFace:!1,depthTest:!0})}get name(){return"mesh-shader"}createShaderGeometry(t,r){let i=new Me;return t.indices&&(t.indices.buffer.BYTES_PER_ELEMENT===1?i.addIndex(new ot(new Uint16Array(t.indices.buffer))):i.addIndex(new ot(t.indices.buffer))),t.positions&&i.addAttribute("a_Position",new ot(t.positions.buffer),3,t.positions.normalized,t.positions.componentType,t.positions.stride),t.uvs&&t.uvs[0]&&i.addAttribute("a_UV1",new ot(t.uvs[0].buffer),2,t.uvs[0].normalized,t.uvs[0].componentType,t.uvs[0].stride),t.normals&&i.addAttribute("a_Normal",new ot(t.normals.buffer),3,t.normals.normalized,t.normals.componentType,t.normals.stride),t.tangents&&i.addAttribute("a_Tangent",new ot(t.tangents.buffer),4,t.tangents.normalized,t.tangents.componentType,t.tangents.stride),t.colors&&i.addAttribute("a_Color",new ot(t.colors.buffer),t.colors.componentCount,t.colors.normalized,t.colors.componentType,t.colors.stride),i}render(t,r,i=this._state,n=Jt.TRIANGLES){const s=t.instances.filter(l=>l.worldVisible&&l.renderable).length,o=t.instances.length>0;t.geometry.hasShaderGeometry(this,o)||t.geometry.addShaderGeometry(this,o);let a=t.geometry.getShaderGeometry(this);r.shader.bind(this,!1),r.state.set(i),r.geometry.bind(a,this),r.geometry.draw(n,void 0,void 0,s)}}class u0{constructor(){this._maxInstances=200,this._modelMatrix=[new ot,new ot,new ot,new ot],this._normalMatrix=[new ot,new ot,new ot,new ot],this._baseColor=new ot,this.expandBuffers(this._maxInstances)}expandBuffers(t){for(;t>this._maxInstances;)this._maxInstances+=Math.floor(this._maxInstances*.5);for(let r=0;r<4;r++)this._modelMatrix[r].update(new Float32Array(4*this._maxInstances)),this._normalMatrix[r].update(new Float32Array(4*this._maxInstances));this._baseColor.update(new Float32Array(4*this._maxInstances))}updateBuffers(t){t.length>this._maxInstances&&this.expandBuffers(t.length);let r=0;for(let i=0;i<t.length;i++){const n=t[i].transform.normalTransform.array;for(let a=0;a<4;a++)this._normalMatrix[a].data.set(n.slice(a*4,a*4+4),r*4);const s=t[i].worldTransform.array;for(let a=0;a<4;a++)this._modelMatrix[a].data.set(s.slice(a*4,a*4+4),r*4);const o=t[i].material;this._baseColor.data.set(o.baseColor.rgba,r*4),r++}for(let i=0;i<4;i++)this._modelMatrix[i].update(),this._normalMatrix[i].update();this._baseColor.update()}addGeometryAttributes(t){for(let r=0;r<4;r++)t.addAttribute(`a_ModelMatrix${r}`,this._modelMatrix[r],4,!1,void 0,0,void 0,!0);for(let r=0;r<4;r++)t.addAttribute(`a_NormalMatrix${r}`,this._normalMatrix[r],4,!1,void 0,0,void 0,!0);t.addAttribute("a_BaseColorFactor",this._baseColor,4,!1,void 0,0,void 0,!0)}}var or;(e=>{function t(r,i,n){return n.context.webGLVersion===1&&(r=r.replace(/VERSION/,"100").replace(/VERT_IN/g,"attribute").replace(/VERT_OUT/g,"varying").replace(/FRAG_COLOR/g,"gl_FragColor").replace(/FRAG_IN/g,"varying")),n.context.webGLVersion===2&&(r=r.replace(/VERSION/,"300 es").replace(/VERT_IN/g,"in").replace(/VERT_OUT/g,"out").replace(/FRAG_COLOR/g,"g_finalColor").replace(/FRAG_IN/g,"in")),r.replace(/#define FEATURES/,i.map(s=>`#define ${s}`).join(`
`))}e.build=t})(or||(or={}));var d0={source:`#version VERSION

//
// This fragment shader defines a reference implementation for Physically Based Shading of
// a microfacet surface material defined by a glTF model.
//
// References:
// [1] Real Shading in Unreal Engine 4
//     http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf
// [2] Physically Based Shading at Disney
//     http://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf
// [3] README.md - Environment Maps
//     https://github.com/KhronosGroup/glTF-WebGL-PBR/#environment-maps
// [4] "An Inexpensive BRDF Model for Physically based Rendering" by Christophe Schlick
//     https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf

#define FEATURES

#if defined(WEBGL1) //&& defined(USE_TEX_LOD)
#extension GL_EXT_shader_texture_lod : enable
#endif

#if defined(WEBGL1)
#extension GL_OES_standard_derivatives : enable
#endif

#if defined(WEBGL1) && defined(USE_HDR)
#extension GL_OES_texture_float : enable
#extension GL_OES_texture_float_linear : enable
#endif

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}
vec4 _textureLod(sampler2D sampler, vec2 coord, float lod)
{
#ifdef WEBGL2
    return textureLod(sampler, coord, lod);
#endif
#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) 
    return texture2DLodEXT(sampler, coord, lod);
#endif
    return vec4(0.0);
}

vec4 _textureLod(samplerCube sampler, vec3 coord, float lod)
{
#ifdef WEBGL2
    return textureLod(sampler, coord, lod);
#endif
#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) 
    return textureCubeLodEXT(sampler, coord, lod);
#endif
    return vec4(0.0);
}
vec3 _dFdx(vec3 coord)
{
#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    return dFdx(coord);
#endif
    return vec3(0.0);
}

vec3 _dFdy(vec3 coord)
{
#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    return dFdy(coord);
#endif
    return vec3(0.0);
}
FRAG_IN vec2 v_UVCoord1;
FRAG_IN vec2 v_UVCoord2;

// General Material
#ifdef HAS_NORMAL_MAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
uniform int u_NormalUVSet;
uniform mat3 u_NormalUVTransform;
#endif

#ifdef HAS_EMISSIVE_MAP
uniform sampler2D u_EmissiveSampler;
uniform int u_EmissiveUVSet;
uniform vec3 u_EmissiveFactor;
uniform mat3 u_EmissiveUVTransform;
#endif

#ifdef HAS_OCCLUSION_MAP
uniform sampler2D u_OcclusionSampler;
uniform int u_OcclusionUVSet;
uniform float u_OcclusionStrength;
uniform mat3 u_OcclusionUVTransform;
#endif

// Metallic Roughness Material
#ifdef HAS_BASE_COLOR_MAP
uniform sampler2D u_BaseColorSampler;
uniform int u_BaseColorUVSet;
uniform mat3 u_BaseColorUVTransform;
#endif

#ifdef HAS_METALLIC_ROUGHNESS_MAP
uniform sampler2D u_MetallicRoughnessSampler;
uniform int u_MetallicRoughnessUVSet;
uniform mat3 u_MetallicRoughnessUVTransform;
#endif

// Specular Glossiness Material
#ifdef HAS_DIFFUSE_MAP
uniform sampler2D u_DiffuseSampler;
uniform int u_DiffuseUVSet;
uniform mat3 u_DiffuseUVTransform;
#endif

#ifdef HAS_SPECULAR_GLOSSINESS_MAP
uniform sampler2D u_SpecularGlossinessSampler;
uniform int u_SpecularGlossinessUVSet;
uniform mat3 u_SpecularGlossinessUVTransform;
#endif

// IBL
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
#endif

#ifdef USE_SHADOW_MAPPING
uniform sampler2D u_ShadowSampler;
#endif

vec2 getNormalUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_NORMAL_MAP
    uv.xy = u_NormalUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_NORMAL_UV_TRANSFORM
    uv = u_NormalUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getEmissiveUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_EMISSIVE_MAP
    uv.xy = u_EmissiveUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_EMISSIVE_UV_TRANSFORM
    uv = u_EmissiveUVTransform * uv;
    #endif
#endif

    return uv.xy;
}

vec2 getOcclusionUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_OCCLUSION_MAP
    uv.xy = u_OcclusionUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_OCCLUSION_UV_TRANSFORM
    uv = u_OcclusionUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getBaseColorUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_BASE_COLOR_MAP
    uv.xy = u_BaseColorUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_BASECOLOR_UV_TRANSFORM
    uv = u_BaseColorUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getMetallicRoughnessUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_METALLIC_ROUGHNESS_MAP
    uv.xy = u_MetallicRoughnessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_METALLICROUGHNESS_UV_TRANSFORM
    uv = u_MetallicRoughnessUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getSpecularGlossinessUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_SPECULAR_GLOSSINESS_MAP
    uv.xy = u_SpecularGlossinessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_SPECULARGLOSSINESS_UV_TRANSFORM
    uv = u_SpecularGlossinessUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getDiffuseUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_DIFFUSE_MAP
    uv.xy = u_DiffuseUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_DIFFUSE_UV_TRANSFORM
    uv = u_DiffuseUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

// textures.glsl needs to be included

const float M_PI = 3.141592653589793;
const float c_MinReflectance = 0.04;

FRAG_IN vec3 v_Position;
FRAG_IN vec3 v_ModelViewPosition;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
FRAG_IN mat3 v_TBN;
#else
FRAG_IN vec3 v_Normal;
#endif
#endif

#ifdef HAS_VERTEX_COLOR_VEC3
FRAG_IN vec3 v_Color;
#endif
#ifdef HAS_VERTEX_COLOR_VEC4
FRAG_IN vec4 v_Color;
#endif

struct AngularInfo
{
    float NdotL;                  // cos angle between normal and light direction
    float NdotV;                  // cos angle between normal and view direction
    float NdotH;                  // cos angle between normal and half vector
    float LdotH;                  // cos angle between light direction and half vector

    float VdotH;                  // cos angle between view direction and half vector

    vec3 padding;
};

vec4 getVertexColor()
{
   vec4 color = vec4(1.0, 1.0, 1.0, 1.0);

#ifdef HAS_VERTEX_COLOR_VEC3
    color.rgb = v_Color;
#endif
#ifdef HAS_VERTEX_COLOR_VEC4
    color = v_Color;
#endif

   return color;
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
    vec2 UV = getNormalUV();

    // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
    vec3 pos_dx = _dFdx(v_Position);
    vec3 pos_dy = _dFdy(v_Position);
    vec3 tex_dx = _dFdx(vec3(UV, 0.0));
    vec3 tex_dy = _dFdy(vec3(UV, 0.0));
    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
    vec3 ng = normalize(v_Normal);
#else
    vec3 ng = cross(pos_dx, pos_dy);
#endif

    t = normalize(t - ng * dot(ng, t));
    vec3 b = normalize(cross(ng, t));
    mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
    mat3 tbn = v_TBN;
#endif

#ifdef HAS_NORMAL_MAP
    vec3 n = _texture(u_NormalSampler, UV).rgb;
    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
    // The tbn matrix is linearly interpolated, so we need to re-normalize
    vec3 n = normalize(tbn[2].xyz);
#endif

    return n;
}

float getPerceivedBrightness(vec3 vector)
{
    return sqrt(0.299 * vector.r * vector.r + 0.587 * vector.g * vector.g + 0.114 * vector.b * vector.b);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/examples/convert-between-workflows/js/three.pbrUtilities.js#L34
float solveMetallic(vec3 diffuse, vec3 specular, float oneMinusSpecularStrength) {
    float specularBrightness = getPerceivedBrightness(specular);

    if (specularBrightness < c_MinReflectance) {
        return 0.0;
    }

    float diffuseBrightness = getPerceivedBrightness(diffuse);

    float a = c_MinReflectance;
    float b = diffuseBrightness * oneMinusSpecularStrength / (1.0 - c_MinReflectance) + specularBrightness - 2.0 * c_MinReflectance;
    float c = c_MinReflectance - specularBrightness;
    float D = b * b - 4.0 * a * c;

    return clamp((-b + sqrt(D)) / (2.0 * a), 0.0, 1.0);
}

AngularInfo getAngularInfo(vec3 pointToLight, vec3 normal, vec3 view)
{
    // Standard one-letter names
    vec3 n = normalize(normal);           // Outward direction of surface point
    vec3 v = normalize(view);             // Direction from surface point to view
    vec3 l = normalize(pointToLight);     // Direction from surface point to light
    vec3 h = normalize(l + v);            // Direction of the vector between l and v

    float NdotL = clamp(dot(n, l), 0.0, 1.0);
    float NdotV = clamp(dot(n, v), 0.0, 1.0);
    float NdotH = clamp(dot(n, h), 0.0, 1.0);
    float LdotH = clamp(dot(l, h), 0.0, 1.0);
    float VdotH = clamp(dot(v, h), 0.0, 1.0);

    return AngularInfo(
        NdotL,
        NdotV,
        NdotH,
        LdotH,
        VdotH,
        vec3(0, 0, 0)
    );
}

#ifdef USE_SHADOW_MAPPING
FRAG_IN vec4 v_PositionLightSpace;
#endif

float linstep(float low, float high, float v)
{
    return clamp((v-low) / (high-low), 0.0, 1.0);
}

#ifdef USE_SHADOW_MAPPING
float getShadowContribution()
{
    vec3 coords = v_PositionLightSpace.xyz / v_PositionLightSpace.w * 0.5 + 0.5;
    if (coords.z < 0.01 || coords.z > 0.99 || coords.x < 0.01 || coords.x > 0.99 || coords.y < 0.01 || coords.y > 0.99) {
        return 1.0;
    }
    vec2 moments = vec2(1.0) - _texture(u_ShadowSampler, coords.xy).xy;
    float p = step(coords.z, moments.x);
    float variance = max(moments.y - moments.x * moments.x, 0.00002);
    float d = coords.z - moments.x;
    float pMax = linstep(0.2, 1.0, variance / (variance + d*d));
    return min(max(p, pMax), 1.0);
}
#endif
uniform float u_Exposure;

const float GAMMA = 2.2;
const float INV_GAMMA = 1.0 / GAMMA;

// linear to sRGB approximation
// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
vec3 LINEARtoSRGB(vec3 color)
{
    return pow(color, vec3(INV_GAMMA));
}

// sRGB to linear approximation
// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
    return vec4(pow(srgbIn.xyz, vec3(GAMMA)), srgbIn.w);
}

// Uncharted 2 tone map
// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 toneMapUncharted2Impl(vec3 color)
{
    const float A = 0.15;
    const float B = 0.50;
    const float C = 0.10;
    const float D = 0.20;
    const float E = 0.02;
    const float F = 0.30;
    return ((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;
}

vec3 toneMapUncharted(vec3 color)
{
    const float W = 11.2;
    color = toneMapUncharted2Impl(color * 2.0);
    vec3 whiteScale = 1.0 / toneMapUncharted2Impl(vec3(W));
    return LINEARtoSRGB(color * whiteScale);
}

// Hejl Richard tone map
// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 toneMapHejlRichard(vec3 color)
{
    color = max(vec3(0.0), color - vec3(0.004));
    return (color*(6.2*color+.5))/(color*(6.2*color+1.7)+0.06);
}

// ACES tone map
// see: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/
vec3 toneMapACES(vec3 color)
{
    const float A = 2.51;
    const float B = 0.03;
    const float C = 2.43;
    const float D = 0.59;
    const float E = 0.14;
    return LINEARtoSRGB(clamp((color * (A * color + B)) / (color * (C * color + D) + E), 0.0, 1.0));
}

vec3 toneMap(vec3 color)
{
    color *= u_Exposure;

#ifdef TONEMAP_UNCHARTED
    return toneMapUncharted(color);
#endif

#ifdef TONEMAP_HEJLRICHARD
    return toneMapHejlRichard(color);
#endif

#ifdef TONEMAP_ACES
    return toneMapACES(color);
#endif

    return LINEARtoSRGB(color);
}

vec4 encodeRGBE(vec3 rgb) {
  vec4 vEncoded;
  float maxComponent = max(max(rgb.r, rgb.g), rgb.b);
  float fExp = ceil(log2(maxComponent));
  vEncoded.rgb = rgb / exp2(fExp);
  vEncoded.a = (fExp + 128.0) / 255.0;
  return vEncoded;
}

vec3 decodeRGBE(vec4 rgbe) {
  vec3 vDecoded;
  float fExp = rgbe.a * 255.0 - 128.0;
  vDecoded = rgbe.rgb * exp2(fExp);
  return vDecoded;
}

// KHR_lights_punctual extension.
// see https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual

struct Light
{
    vec3 direction;
    float range;

    vec3 color;
    float intensity;

    vec3 position;
    float innerConeCos;

    float outerConeCos;
    int type;

    vec2 padding;
};

const int LightType_Directional = 0;
const int LightType_Point = 1;
const int LightType_Spot = 2;

#ifdef USE_PUNCTUAL
uniform Light u_Lights[LIGHT_COUNT];
#endif

#ifdef USE_FOG
uniform float u_FogNear;
uniform float u_FogFar;
uniform vec3 u_FogColor;
#endif

#if defined(MATERIAL_SPECULARGLOSSINESS) || defined(MATERIAL_METALLICROUGHNESS)
uniform float u_MetallicFactor;
uniform float u_RoughnessFactor;
uniform vec4 u_BaseColorFactor;
#endif

#ifdef USE_INSTANCING
FRAG_IN vec4 v_BaseColorFactor;
#endif

#ifdef MATERIAL_SPECULARGLOSSINESS
uniform vec3 u_SpecularFactor;
uniform vec4 u_DiffuseFactor;
uniform float u_GlossinessFactor;
#endif

#ifdef ALPHAMODE_MASK
uniform float u_AlphaCutoff;
#endif

#ifdef USE_SHADOW_MAPPING
uniform int u_ShadowLightIndex;
#endif

uniform vec3 u_Camera;

uniform int u_MipCount;

struct MaterialInfo
{
    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
    vec3 reflectance0;            // full reflectance color (normal incidence angle)

    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
    vec3 diffuseColor;            // color contribution from diffuse lighting

    vec3 reflectance90;           // reflectance color at grazing angle
    vec3 specularColor;           // color contribution from specular lighting
};

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(MaterialInfo materialInfo, vec3 n, vec3 v)
{
    float NdotV = clamp(dot(n, v), 0.0, 1.0);

    float lod = clamp(materialInfo.perceptualRoughness * float(u_MipCount), 0.0, float(u_MipCount));
    vec3 reflection = normalize(reflect(-v, n));

    vec2 brdfSamplePoint = clamp(vec2(NdotV, materialInfo.perceptualRoughness), vec2(0.0, 0.0), vec2(1.0, 1.0));
    // retrieve a scale and bias to F0. See [1], Figure 3
    vec2 brdf = _texture(u_brdfLUT, brdfSamplePoint).rg;

    vec4 diffuseSample = _texture(u_DiffuseEnvSampler, n);

#ifdef USE_TEX_LOD
    vec4 specularSample = _textureLod(u_SpecularEnvSampler, reflection, lod);
#else
    vec4 specularSample = _texture(u_SpecularEnvSampler, reflection);
#endif

#if defined(USE_HDR)
    // Already linear.
    vec3 diffuseLight = diffuseSample.rgb;
    vec3 specularLight = specularSample.rgb;
#elif defined(USE_RGBE)
    vec3 diffuseLight = decodeRGBE(diffuseSample);
    vec3 specularLight = decodeRGBE(specularSample);
#else
    vec3 diffuseLight = SRGBtoLINEAR(diffuseSample).rgb;
    vec3 specularLight = SRGBtoLINEAR(specularSample).rgb;
#endif

    vec3 diffuse = diffuseLight * materialInfo.diffuseColor;
    vec3 specular = specularLight * (materialInfo.specularColor * brdf.x + brdf.y);

    return diffuse + specular;
}
#endif

// Lambert lighting
// see https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/
vec3 diffuse(MaterialInfo materialInfo)
{
    return materialInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    return materialInfo.reflectance0 + (materialInfo.reflectance90 - materialInfo.reflectance0) * pow(clamp(1.0 - angularInfo.VdotH, 0.0, 1.0), 5.0);
}

// Smith Joint GGX
// Note: Vis = G / (4 * NdotL * NdotV)
// see Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs. Journal of Computer Graphics Techniques, 3
// see Real-Time Rendering. Page 331 to 336.
// see https://google.github.io/filament/Filament.md.html#materialsystem/specularbrdf/geometricshadowing(specularg)
float visibilityOcclusion(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    float NdotL = angularInfo.NdotL;
    float NdotV = angularInfo.NdotV;
    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;

    float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
    float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);

    float GGX = GGXV + GGXL;
    if (GGX > 0.0)
    {
        return 0.5 / GGX;
    }
    return 0.0;
}

// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.
float microfacetDistribution(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;
    float f = (angularInfo.NdotH * alphaRoughnessSq - angularInfo.NdotH) * angularInfo.NdotH + 1.0;
    return alphaRoughnessSq / (M_PI * f * f);
}

vec3 getPointShade(vec3 pointToLight, MaterialInfo materialInfo, vec3 normal, vec3 view)
{
    AngularInfo angularInfo = getAngularInfo(pointToLight, normal, view);

    if (angularInfo.NdotL > 0.0 || angularInfo.NdotV > 0.0)
    {
        // Calculate the shading terms for the microfacet specular shading model
        vec3 F = specularReflection(materialInfo, angularInfo);
        float Vis = visibilityOcclusion(materialInfo, angularInfo);
        float D = microfacetDistribution(materialInfo, angularInfo);

        // Calculation of analytical lighting contribution
        vec3 diffuseContrib = (1.0 - F) * diffuse(materialInfo);
        vec3 specContrib = F * Vis * D;

        // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
        return angularInfo.NdotL * (diffuseContrib + specContrib);
    }

    return vec3(0.0, 0.0, 0.0);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#range-property
float getRangeAttenuation(float range, float distance)
{
    if (range <= 0.0)
    {
        // negative range means unlimited
        return 1.0;
    }
    return max(min(1.0 - pow(distance / range, 4.0), 1.0), 0.0) / pow(distance, 2.0);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#inner-and-outer-cone-angles
float getSpotAttenuation(vec3 pointToLight, vec3 spotDirection, float outerConeCos, float innerConeCos)
{
    float actualCos = dot(normalize(spotDirection), normalize(-pointToLight));
    if (actualCos > outerConeCos)
    {
        if (actualCos < innerConeCos)
        {
            return smoothstep(outerConeCos, innerConeCos, actualCos);
        }
        return 1.0;
    }
    return 0.0;
}

vec3 applyDirectionalLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)
{
    vec3 pointToLight = -light.direction;
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;
    return light.intensity * light.color * shade;
}

vec3 applyPointLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view)
{
    vec3 pointToLight = light.position - v_Position;
    float distance = length(pointToLight);
    float attenuation = getRangeAttenuation(light.range, distance);
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view);
    return attenuation * light.intensity * light.color * shade;
}

vec3 applySpotLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)
{
    vec3 pointToLight = light.position - v_Position;
    float distance = length(pointToLight);
    float rangeAttenuation = getRangeAttenuation(light.range, distance);
    float spotAttenuation = getSpotAttenuation(pointToLight, light.direction, light.outerConeCos, light.innerConeCos);
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;
    return rangeAttenuation * spotAttenuation * light.intensity * light.color * shade;
}

#ifdef WEBGL2
    out vec4 FRAG_COLOR;
#endif

void main()
{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = 0.0;
    float metallic = 0.0;
    vec4 baseColor = vec4(0.0, 0.0, 0.0, 1.0);
    vec3 diffuseColor = vec3(0.0);
    vec3 specularColor= vec3(0.0);
    vec3 f0 = vec3(0.04);

#ifdef MATERIAL_SPECULARGLOSSINESS

#ifdef HAS_SPECULAR_GLOSSINESS_MAP
    vec4 sgSample = SRGBtoLINEAR(_texture(u_SpecularGlossinessSampler, getSpecularGlossinessUV()));
    perceptualRoughness = (1.0 - sgSample.a * u_GlossinessFactor); // glossiness to roughness
    f0 = sgSample.rgb * u_SpecularFactor; // specular
#else
    f0 = u_SpecularFactor;
    perceptualRoughness = 1.0 - u_GlossinessFactor;
#endif // ! HAS_SPECULAR_GLOSSINESS_MAP

#ifdef HAS_DIFFUSE_MAP
    baseColor = SRGBtoLINEAR(_texture(u_DiffuseSampler, getDiffuseUV())) * u_DiffuseFactor;
#else
    baseColor = u_DiffuseFactor;
#endif // !HAS_DIFFUSE_MAP

    baseColor *= getVertexColor();

    // f0 = specular
    specularColor = f0;
    float oneMinusSpecularStrength = 1.0 - max(max(f0.r, f0.g), f0.b);
    diffuseColor = baseColor.rgb * oneMinusSpecularStrength;

#ifdef DEBUG_METALLIC
    // do conversion between metallic M-R and S-G metallic
    metallic = solveMetallic(baseColor.rgb, specularColor, oneMinusSpecularStrength);
#endif // ! DEBUG_METALLIC

#endif // ! MATERIAL_SPECULARGLOSSINESS

#ifdef MATERIAL_METALLICROUGHNESS

#ifdef HAS_METALLIC_ROUGHNESS_MAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = _texture(u_MetallicRoughnessSampler, getMetallicRoughnessUV());
    perceptualRoughness = mrSample.g * u_RoughnessFactor;
    metallic = mrSample.b * u_MetallicFactor;
#else
    metallic = u_MetallicFactor;
    perceptualRoughness = u_RoughnessFactor;
#endif

    vec4 baseColorFactor = u_BaseColorFactor;
#ifdef USE_INSTANCING
    baseColorFactor = v_BaseColorFactor;
#endif

    // The albedo may be defined from a base texture or a flat color
#if defined(HAS_BASE_COLOR_MAP) && defined(MATERIAL_UNLIT)
    baseColor = _texture(u_BaseColorSampler, getBaseColorUV()) * baseColorFactor;
#elif defined(HAS_BASE_COLOR_MAP)
    baseColor = SRGBtoLINEAR(_texture(u_BaseColorSampler, getBaseColorUV())) * baseColorFactor;
#else
    baseColor = baseColorFactor;
#endif

    baseColor *= getVertexColor();

    diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);

    specularColor = mix(f0, baseColor.rgb, metallic);

#endif // ! MATERIAL_METALLICROUGHNESS

#ifdef ALPHAMODE_MASK
    if(baseColor.a < u_AlphaCutoff)
    {
        discard;
    }
    baseColor.a = 1.0;
#endif

#ifdef ALPHAMODE_OPAQUE
    baseColor.a = 1.0;
#endif

#ifdef MATERIAL_UNLIT
    FRAG_COLOR = vec4(baseColor.rgb * baseColor.a, baseColor.a);
    return;
#endif

    perceptualRoughness = clamp(perceptualRoughness, 0.0, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    vec3 specularEnvironmentR0 = specularColor.rgb;
    // Anything less than 2% is physically impossible and is instead considered to be shadowing. Compare to "Real-Time-Rendering" 4th editon on page 325.
    vec3 specularEnvironmentR90 = vec3(clamp(reflectance * 50.0, 0.0, 1.0));

    MaterialInfo materialInfo = MaterialInfo(
        perceptualRoughness,
        specularEnvironmentR0,
        alphaRoughness,
        diffuseColor,
        specularEnvironmentR90,
        specularColor
    );

    // LIGHTING

    vec3 color = vec3(0.0, 0.0, 0.0);
    vec3 normal = getNormal();
    vec3 view = normalize(u_Camera - v_Position);

    float shadow = 1.0;
    #ifdef USE_SHADOW_MAPPING
        shadow = getShadowContribution();
    #endif

#ifdef USE_PUNCTUAL
    for (int i = 0; i < LIGHT_COUNT; ++i)
    {
        float shadowContribution = shadow;
        #ifdef USE_SHADOW_MAPPING
        if (u_ShadowLightIndex != i) 
        {
            shadowContribution = 1.0;
        }
        #endif
        Light light = u_Lights[i];
        if (light.type == LightType_Directional)
        {
            color += applyDirectionalLight(light, materialInfo, normal, view, shadowContribution);
        }
        else if (light.type == LightType_Point)
        {
            color += applyPointLight(light, materialInfo, normal, view);
        }
        else if (light.type == LightType_Spot)
        {
            color += applySpotLight(light, materialInfo, normal, view, shadowContribution);
        }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    color += getIBLContribution(materialInfo, normal, view);
#endif

    float ao = 1.0;
    // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSION_MAP
    ao = _texture(u_OcclusionSampler,  getOcclusionUV()).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

    vec3 emissive = vec3(0);
#ifdef HAS_EMISSIVE_MAP
    emissive = SRGBtoLINEAR(_texture(u_EmissiveSampler, getEmissiveUV())).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifndef DEBUG_OUTPUT // no debug

    vec3 toneMappedColor = toneMap(color);

    #ifdef USE_FOG
        float fogDepth = -v_ModelViewPosition.z;
        float fogFactor = smoothstep(u_FogNear, u_FogFar, fogDepth);
        toneMappedColor = mix(toneMappedColor, u_FogColor, fogFactor);
    #endif

    // regular shading
    FRAG_COLOR = vec4(toneMappedColor * baseColor.a, baseColor.a);

#else // debug output

    #ifdef DEBUG_METALLIC
        FRAG_COLOR.rgb = vec3(metallic);
    #endif

    #ifdef DEBUG_ROUGHNESS
        FRAG_COLOR.rgb = vec3(perceptualRoughness);
    #endif

    #ifdef DEBUG_NORMAL
        #ifdef HAS_NORMAL_MAP
            FRAG_COLOR.rgb = _texture(u_NormalSampler, getNormalUV()).rgb;
        #else
            FRAG_COLOR.rgb = vec3(0.5, 0.5, 1.0);
        #endif
    #endif

    #ifdef DEBUG_BASECOLOR
        FRAG_COLOR.rgb = LINEARtoSRGB(baseColor.rgb);
    #endif

    #ifdef DEBUG_OCCLUSION
        FRAG_COLOR.rgb = vec3(ao);
    #endif

    #ifdef DEBUG_EMISSIVE
        FRAG_COLOR.rgb = LINEARtoSRGB(emissive);
    #endif

    #ifdef DEBUG_F0
        FRAG_COLOR.rgb = vec3(f0);
    #endif

    #ifdef DEBUG_ALPHA
        FRAG_COLOR.rgb = vec3(baseColor.a);
    #endif

    FRAG_COLOR.a = 1.0;

#endif // !DEBUG_OUTPUT
}
`},f0={source:`#version VERSION

#define FEATURES

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}
#ifdef HAS_TARGET_POSITION0
VERT_IN vec3 a_Target_Position0;
#endif

#ifdef HAS_TARGET_POSITION1
VERT_IN vec3 a_Target_Position1;
#endif

#ifdef HAS_TARGET_POSITION2
VERT_IN vec3 a_Target_Position2;
#endif

#ifdef HAS_TARGET_POSITION3
VERT_IN vec3 a_Target_Position3;
#endif

#ifdef HAS_TARGET_POSITION4
VERT_IN vec3 a_Target_Position4;
#endif

#ifdef HAS_TARGET_POSITION5
VERT_IN vec3 a_Target_Position5;
#endif

#ifdef HAS_TARGET_POSITION6
VERT_IN vec3 a_Target_Position6;
#endif

#ifdef HAS_TARGET_POSITION7
VERT_IN vec3 a_Target_Position7;
#endif

#ifdef HAS_TARGET_NORMAL0
VERT_IN vec3 a_Target_Normal0;
#endif

#ifdef HAS_TARGET_NORMAL1
VERT_IN vec3 a_Target_Normal1;
#endif

#ifdef HAS_TARGET_NORMAL2
VERT_IN vec3 a_Target_Normal2;
#endif

#ifdef HAS_TARGET_NORMAL3
VERT_IN vec3 a_Target_Normal3;
#endif

#ifdef HAS_TARGET_TANGENT0
VERT_IN vec3 a_Target_Tangent0;
#endif

#ifdef HAS_TARGET_TANGENT1
VERT_IN vec3 a_Target_Tangent1;
#endif

#ifdef HAS_TARGET_TANGENT2
VERT_IN vec3 a_Target_Tangent2;
#endif

#ifdef HAS_TARGET_TANGENT3
VERT_IN vec3 a_Target_Tangent3;
#endif

#ifdef USE_MORPHING
uniform float u_morphWeights[WEIGHT_COUNT];
#endif

#ifdef HAS_JOINT_SET1
VERT_IN vec4 a_Joint1;
#endif

#ifdef HAS_JOINT_SET2
VERT_IN vec4 a_Joint2;
#endif

#ifdef HAS_WEIGHT_SET1
VERT_IN vec4 a_Weight1;
#endif

#ifdef HAS_WEIGHT_SET2
VERT_IN vec4 a_Weight2;
#endif

#ifdef USE_SKINNING
#ifdef USE_SKINNING_TEXTURE
uniform sampler2D u_jointMatrixSampler;
uniform sampler2D u_jointNormalMatrixSampler;
#else
uniform mat4 u_jointMatrix[JOINT_COUNT];
uniform mat4 u_jointNormalMatrix[JOINT_COUNT];
#endif
#endif

// these offsets assume the texture is 4 pixels across
#define ROW0_U ((0.5 + 0.0) / 4.0)
#define ROW1_U ((0.5 + 1.0) / 4.0)
#define ROW2_U ((0.5 + 2.0) / 4.0)
#define ROW3_U ((0.5 + 3.0) / 4.0)

#ifdef USE_SKINNING
mat4 getJointMatrix(float boneNdx) {
    #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(JOINT_COUNT);
    return mat4(
        _texture(u_jointMatrixSampler, vec2(ROW0_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW1_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW2_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW3_U, v))
    );
    #else
    return u_jointMatrix[int(boneNdx)];
    #endif
}

mat4 getJointNormalMatrix(float boneNdx) {
    #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(JOINT_COUNT);
    return mat4(
        _texture(u_jointNormalMatrixSampler, vec2(ROW0_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW1_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW2_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW3_U, v))
    );
    #else
    return u_jointNormalMatrix[int(boneNdx)];
    #endif
}

mat4 getSkinningMatrix()
{
    mat4 skin = mat4(0);

    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)
    skin +=
        a_Weight1.x * getJointMatrix(a_Joint1.x) +
        a_Weight1.y * getJointMatrix(a_Joint1.y) +
        a_Weight1.z * getJointMatrix(a_Joint1.z) +
        a_Weight1.w * getJointMatrix(a_Joint1.w);
    #endif

    return skin;
}

mat4 getSkinningNormalMatrix()
{
    mat4 skin = mat4(0);

    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)
    skin +=
        a_Weight1.x * getJointNormalMatrix(a_Joint1.x) +
        a_Weight1.y * getJointNormalMatrix(a_Joint1.y) +
        a_Weight1.z * getJointNormalMatrix(a_Joint1.z) +
        a_Weight1.w * getJointNormalMatrix(a_Joint1.w);
    #endif

    return skin;
}
#endif // !USE_SKINNING

#ifdef USE_MORPHING
vec4 getTargetPosition()
{
    vec4 pos = vec4(0);

#ifdef HAS_TARGET_POSITION0
    pos.xyz += u_morphWeights[0] * a_Target_Position0;
#endif

#ifdef HAS_TARGET_POSITION1
    pos.xyz += u_morphWeights[1] * a_Target_Position1;
#endif

#ifdef HAS_TARGET_POSITION2
    pos.xyz += u_morphWeights[2] * a_Target_Position2;
#endif

#ifdef HAS_TARGET_POSITION3
    pos.xyz += u_morphWeights[3] * a_Target_Position3;
#endif

#ifdef HAS_TARGET_POSITION4
    pos.xyz += u_morphWeights[4] * a_Target_Position4;
#endif

    return pos;
}

vec4 getTargetNormal()
{
    vec4 normal = vec4(0);

#ifdef HAS_TARGET_NORMAL0
    normal.xyz += u_morphWeights[0] * a_Target_Normal0;
#endif

#ifdef HAS_TARGET_NORMAL1
    normal.xyz += u_morphWeights[1] * a_Target_Normal1;
#endif

#ifdef HAS_TARGET_NORMAL2
    normal.xyz += u_morphWeights[2] * a_Target_Normal2;
#endif

#ifdef HAS_TARGET_NORMAL3
    normal.xyz += u_morphWeights[3] * a_Target_Normal3;
#endif

#ifdef HAS_TARGET_NORMAL4
    normal.xyz += u_morphWeights[4] * a_Target_Normal4;
#endif

    return normal;
}

vec4 getTargetTangent()
{
    vec4 tangent = vec4(0);

#ifdef HAS_TARGET_TANGENT0
    tangent.xyz += u_morphWeights[0] * a_Target_Tangent0;
#endif

#ifdef HAS_TARGET_TANGENT1
    tangent.xyz += u_morphWeights[1] * a_Target_Tangent1;
#endif

#ifdef HAS_TARGET_TANGENT2
    tangent.xyz += u_morphWeights[2] * a_Target_Tangent2;
#endif

#ifdef HAS_TARGET_TANGENT3
    tangent.xyz += u_morphWeights[3] * a_Target_Tangent3;
#endif

#ifdef HAS_TARGET_TANGENT4
    tangent.xyz += u_morphWeights[4] * a_Target_Tangent4;
#endif

    return tangent;
}

#endif // !USE_MORPHING


VERT_IN vec4 a_Position;
VERT_OUT vec3 v_Position;

VERT_OUT vec3 v_ModelViewPosition;

#ifdef USE_INSTANCING
VERT_IN vec4 a_ModelMatrix0;
VERT_IN vec4 a_ModelMatrix1;
VERT_IN vec4 a_ModelMatrix2;
VERT_IN vec4 a_ModelMatrix3;
#endif

#ifdef USE_INSTANCING
VERT_IN vec4 a_BaseColorFactor;
VERT_OUT vec4 v_BaseColorFactor;
#endif

#ifdef USE_INSTANCING
VERT_IN vec4 a_NormalMatrix0;
VERT_IN vec4 a_NormalMatrix1;
VERT_IN vec4 a_NormalMatrix2;
VERT_IN vec4 a_NormalMatrix3;
#endif

#ifdef HAS_NORMALS
VERT_IN vec4 a_Normal;
#endif

#ifdef HAS_TANGENTS
VERT_IN vec4 a_Tangent;
#endif

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
VERT_OUT mat3 v_TBN;
#else
VERT_OUT vec3 v_Normal;
#endif
#endif

#ifdef HAS_UV_SET1
VERT_IN vec2 a_UV1;
#endif

#ifdef HAS_UV_SET2
VERT_IN vec2 a_UV2;
#endif

VERT_OUT vec2 v_UVCoord1;
VERT_OUT vec2 v_UVCoord2;

#ifdef HAS_VERTEX_COLOR_VEC3
VERT_IN vec3 a_Color;
VERT_OUT vec3 v_Color;
#endif

#ifdef HAS_VERTEX_COLOR_VEC4
VERT_IN vec4 a_Color;
VERT_OUT vec4 v_Color;
#endif

uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_ViewMatrix;
uniform mat4 u_NormalMatrix;

#ifdef USE_SHADOW_MAPPING
uniform mat4 u_LightViewProjectionMatrix;
VERT_OUT vec4 v_PositionLightSpace;
#endif

vec4 getPosition()
{
    vec4 pos = a_Position;

#ifdef USE_MORPHING
    pos += getTargetPosition();
#endif

#ifdef USE_SKINNING
    pos = getSkinningMatrix() * pos;
#endif

    return pos;
}

#ifdef HAS_NORMALS
vec4 getNormal()
{
    vec4 normal = a_Normal;

#ifdef USE_MORPHING
    normal += getTargetNormal();
#endif

#ifdef USE_SKINNING
    normal = getSkinningNormalMatrix() * normal;
#endif

    return normalize(normal);
}
#endif

#ifdef HAS_TANGENTS
vec4 getTangent()
{
    vec4 tangent = a_Tangent;

#ifdef USE_MORPHING
    tangent += getTargetTangent();
#endif

#ifdef USE_SKINNING
    tangent = getSkinningMatrix() * tangent;
#endif

    return normalize(tangent);
}
#endif

void main()
{
    mat4 modelMatrix = u_ModelMatrix;
    #ifdef USE_INSTANCING
        modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
    #endif
    vec4 pos = modelMatrix * getPosition();
    v_Position = vec3(pos.xyz) / pos.w;

    vec4 modelViewPosition = u_ViewMatrix * pos;
    v_ModelViewPosition = vec3(modelViewPosition.xyz) / modelViewPosition.w;

    mat4 normalMatrix = u_NormalMatrix;
    #ifdef USE_INSTANCING
        normalMatrix = mat4(a_NormalMatrix0, a_NormalMatrix1, a_NormalMatrix2, a_NormalMatrix3);
    #endif

    #ifdef HAS_NORMALS
    #ifdef HAS_TANGENTS
    vec4 tangent = getTangent();
    vec3 normalW = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));
    vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangent.xyz, 0.0)));
    vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
    v_TBN = mat3(tangentW, bitangentW, normalW);
    #else // !HAS_TANGENTS
    v_Normal = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));
    #endif
    #endif // !HAS_NORMALS

    v_UVCoord1 = vec2(0.0, 0.0);
    v_UVCoord2 = vec2(0.0, 0.0);

    #ifdef HAS_UV_SET1
    v_UVCoord1 = a_UV1;
    #endif

    #ifdef HAS_UV_SET2
    v_UVCoord2 = a_UV2;
    #endif

    #if defined(HAS_VERTEX_COLOR_VEC3) || defined(HAS_VERTEX_COLOR_VEC4)
    v_Color = a_Color;
    #endif

    #ifdef USE_SHADOW_MAPPING
    v_PositionLightSpace = u_LightViewProjectionMatrix * pos;
    #endif

    #ifdef USE_INSTANCING
    v_BaseColorFactor = a_BaseColorFactor;
    #endif

    gl_Position = u_ViewProjectionMatrix * pos;
}
`};class Ja extends Ni{constructor(){super(...arguments),this._instancing=new u0}static build(t,r){let i=Gt.from(or.build(f0.source,r,t),or.build(d0.source,r,t));return new Ja(i)}get name(){return"standard-shader"}createShaderGeometry(t,r){let i=super.createShaderGeometry(t,r);if(r&&this._instancing.addGeometryAttributes(i),t.targets)for(let n=0;n<t.targets.length;n++){let s=t.targets[n].positions;s&&i.addAttribute(`a_Target_Position${n}`,new ot(s.buffer),3,s.normalized,s.componentType,s.stride);let o=t.targets[n].normals;o&&i.addAttribute(`a_Target_Normal${n}`,new ot(o.buffer),3,o.normalized,o.componentType,o.stride);let a=t.targets[n].tangents;a&&i.addAttribute(`a_Target_Tangent${n}`,new ot(a.buffer),3,a.normalized,a.componentType,a.stride)}return t.uvs&&t.uvs[1]&&i.addAttribute("a_UV2",new ot(t.uvs[1].buffer),2,t.uvs[1].normalized,t.uvs[1].componentType,t.uvs[1].stride),t.joints&&i.addAttribute("a_Joint1",new ot(t.joints.buffer),4,t.joints.normalized,t.joints.componentType,t.joints.stride),t.weights&&i.addAttribute("a_Weight1",new ot(t.weights.buffer),4,t.weights.normalized,t.weights.componentType,t.weights.stride),i}render(t,r,i,n){if(t.instances.length>0){const s=t.instances.filter(o=>o.worldVisible&&o.renderable);if(s.length===0)return;this._instancing.updateBuffers(s)}super.render(t,r,i,n)}}var Ai=(e=>(e.opaque="opaque",e.transparent="transparent",e))(Ai||{});class Za{constructor(){this._renderSortType=Ai.opaque,this.state=Object.assign(new $t,{culling:!0,clockwiseFrontFace:!1,depthTest:!0}),this.drawMode=Jt.TRIANGLES,this.renderSortType=Ai.opaque}get depthMask(){return this.state.depthMask}set depthMask(t){this.state.depthMask=t}get doubleSided(){return!this.state.culling}set doubleSided(t){this.state.culling=!t}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}createShader(t,r){}updateUniforms(t,r){}destroy(){}get isInstancingSupported(){return!1}createInstance(){}render(t,r){!this._shader&&(this._shader=this.createShader(t,r),!this._shader)||(this.updateUniforms&&this.updateUniforms(t,this._shader),this._shader.render(t,r,this.state,this.drawMode))}static from(t,r,i){return Object.assign(new Za,{updateUniforms:i||(()=>{}),_shader:new Ni(Gt.from(t,r))})}}class ze{constructor(t,r){this.renderer=t,this.lights=[],this.renderer.on("prerender",()=>{for(let i of this.lights)i.parent||i.transform.updateTransform()}),ze.main||(ze.main=this),this.imageBasedLighting=r}destroy(){}get valid(){return!this.imageBasedLighting||this.imageBasedLighting.valid}}Tt.installRendererPlugin("lighting",ze);class p0{enableJointMatrixTextures(t){this._jointMatrixTexture||(this._jointMatrixTexture=new Kr(t)),this._jointNormalTexture||(this._jointNormalTexture=new Kr(t))}destroy(){var t,r;(t=this._jointNormalTexture)==null||t.destroy(!0),(r=this._jointMatrixTexture)==null||r.destroy(!0)}update(t,r){t.skin&&(this._jointMatrixTexture?(this._jointMatrixTexture.updateBuffer(t.skin.jointMatrices),r.uniforms.u_jointMatrixSampler=this._jointMatrixTexture):r.uniforms.u_jointMatrix=t.skin.jointMatrices,this._jointNormalTexture?(this._jointNormalTexture.updateBuffer(t.skin.jointNormalMatrices),r.uniforms.u_jointNormalMatrixSampler=this._jointNormalTexture):r.uniforms.u_jointNormalMatrix=t.skin.jointNormalMatrices)}}class pe{constructor(t=0,r=0,i=0,n=1){this._array4=new Float32Array([t,r,i,n]),this._array3=this._array4.subarray(0,3)}static fromBytes(t=0,r=0,i=0,n=255){return new pe(t/255,r/255,i/255,n/255)}static fromHex(t){return typeof t=="string"&&(t=parseInt(t.replace(/[^0-9A-F]/gi,""),16)),pe.fromBytes(t>>16&255,t>>8&255,t&255)}get rgb(){return this._array3}get rgba(){return this._array4}get r(){return this._array4[0]}set r(t){this._array4[0]=t}get g(){return this._array4[1]}set g(t){this._array4[1]=t}get b(){return this._array4[2]}set b(t){this._array4[2]=t}get a(){return this._array4[3]}set a(t){this._array4[3]=t}static from(t){return new pe(...t)}}class m0{constructor(t){this.baseColor=new pe(...t.baseColor.rgba)}}class Qu{constructor(){this.alphaCutoff=.5,this.alphaMode="OPAQUE",this.doubleSided=!1,this.roughness=1,this.metallic=1,this.emissiveFactor=[0,0,0],this.baseColor=[1,1,1,1],this.unlit=!1}}class pc{static multiply(t,r,i=new Float32Array(9)){return l_(i,t,r)}}class tr{constructor(){this._rotation=0,this._array=new Float32Array(9),this._dirty=!0,this._translation=new Float32Array([1,0,0,0,1,0,0,0,1]),this._scaling=new Float32Array([1,0,0,0,1,0,0,0,1]),this._rotate=new Float32Array([Math.cos(0),-Math.sin(0),0,Math.sin(0),Math.cos(0),0,0,0,1]),this.offset=new Xt(()=>{this._translation.set([1,0,0,0,1,0,this.offset.x,this.offset.y,1]),this._dirty=!0},void 0),this.scale=new Xt(()=>{this._scaling.set([this.scale.x,0,0,0,this.scale.y,0,0,0,1]),this._dirty=!0},void 0,1,1)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotate.set([Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]),this._dirty=!0}get array(){return this._dirty&&(pc.multiply(pc.multiply(this._translation,this._rotate,this._array),this._scaling,this._array),this._dirty=!1),this._array}static fromTexture(t){const r=new tr;if(!t.frame||t.noFrame)return r;let{x:i,y:n,width:s,height:o}=t.frame;return t.rotate===0&&(r.offset.set(i/t.baseTexture.width,n/t.baseTexture.height),r.scale.set(s/t.baseTexture.width,o/t.baseTexture.height)),t.rotate===2&&(i=t.frame.x+t.frame.width,r.offset.set(i/t.baseTexture.width,n/t.baseTexture.height),r.scale.set(o/t.baseTexture.height,s/t.baseTexture.width),r.rotation=-90*Sr),r}}class vi extends ${constructor(t,r){super(t),this.uvSet=r}}class g0 extends vi{constructor(t,r,i){super(t,i),this.scale=r,this.uvSet=i}}class _0 extends vi{constructor(t,r,i){super(t,i),this.strength=r,this.uvSet=i}}class Ju{create(t){let r=new Ue;if(!(t instanceof Qu))return r;switch(r.baseColor=pe.from(t.baseColor),t.baseColorTexture&&(r.baseColorTexture=new vi(t.baseColorTexture.baseTexture,t.baseColorTexture.texCoord),r.baseColorTexture.transform=this.createTextureTransform(t.baseColorTexture)),r.metallic=t.metallic,r.roughness=t.roughness,t.metallicRoughnessTexture&&(r.metallicRoughnessTexture=new vi(t.metallicRoughnessTexture.baseTexture,t.metallicRoughnessTexture.texCoord),r.metallicRoughnessTexture.transform=this.createTextureTransform(t.metallicRoughnessTexture)),r.emissive=pe.from(t.emissiveFactor),t.emissiveTexture&&(r.emissiveTexture=new vi(t.emissiveTexture.baseTexture,t.emissiveTexture.texCoord),r.emissiveTexture.transform=this.createTextureTransform(t.emissiveTexture)),t.alphaMode){case"BLEND":{r.alphaMode=ir.blend,r.renderSortType=Ai.transparent;break}case"MASK":{r.alphaMode=ir.mask;break}case"OPAQUE":{r.alphaMode=ir.blend;break}}return r.unlit=t.unlit,r.doubleSided=t.doubleSided,r.alphaCutoff=t.alphaCutoff,t.normalTexture&&(r.normalTexture=new g0(t.normalTexture.baseTexture,t.normalTexture.scale,t.normalTexture.texCoord),r.normalTexture.transform=this.createTextureTransform(t.normalTexture)),t.occlusionTexture&&(r.occlusionTexture=new _0(t.occlusionTexture.baseTexture,t.occlusionTexture.strength,t.occlusionTexture.texCoord),r.occlusionTexture.transform=this.createTextureTransform(t.occlusionTexture)),r}createTextureTransform(t){if(t.transform){const r=new tr;return t.transform.offset&&(r.offset.x=t.transform.offset[0],r.offset.y=t.transform.offset[1]),t.transform.rotation!==void 0&&(r.rotation=t.transform.rotation),t.transform.scale&&(r.scale.x=t.transform.scale[0],r.scale.y=t.transform.scale[1]),r}}}var v0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAADAFBMVEX/AACvAwC4BgC1BQD7AAD3AQDzAQD+AAD9AAD8AQDpAQC/CACxAwD5BgDACwCtAwDxAQC9CADDEQCrAwC7BwC4AQDfAQB+AADvAQD1AQD7AwB7AABrAADHAQDCDgDiAQCyBQCRAQD5AAC1AQDYAQDNAQCpAQCUAQCeAQB0AABhAAD3BwCnAQDCBwCMAACOAAD6BABvAADFAgDsAQD4AACIAADEDADKAQDnAQCfAQCoAwDuEADqFACAAACFAACKAADzCwCCAAC/AQCbAgDKDQDwDgC9AQDBAgCiAAC7AQCkAADlAQD0CACzAQDjGwBoAADEFgB4AAD2CADGEQDGDADQAQDbAQDGCADSAQDNCwDWAQDdAQDUAQBlAAB2AADJCADBGgCVAgDOEADtAQBxAADSDADBFgCZAADnGADXDADcIgDKEgDDAQBcAADQLQCkAwDSEADPCADfHgClAgDXBwDTCADkDACYAAC9IACxLgCiAwCZAgDIFgDINgDdDADxCgDuCACSAQDnEADqCgCPAQBYAAC+HADYJgDLMACWAADOFgDbEQCtMwDSGwCGAADLBgC4JwDbGADaDADBIACoVQDRIQCgAgCxTQDHGwDVKQC6IwDCPACRbADGIQDMGwBUAADgEQDgBwDXEgDkFQDkBgCHdgDnCQDSFQC1KgDWFwDgFwDgDACaRwDCJwCcAADLKAC4LwC2RwDELwCYZADLIACkPQDcBgC9KACFXgDrEAB/ZQCoOgDGKAC+LgDYHACpTwC6QwCWTQB5bQCiWwCcAgCfQgBxdACMVgCzNAB9fwCeYADXIQC4NwC+NgCxOgCHbQCRUQDDNwCrOQDRJwCnRQCYWQCuQQBnfQC+QACNZABziwBskAAY4QCXAgB4hQBghgBllwC1QACtSACfTgBfngCPXABYpQChSAC7PAB/dwCeVABTkQBKnABRrABBuwA4wwBcjgBKtAByfAAxywBApQA3sAAo1QBshgAK8QAY0QBXmgAkxgBPpAAqugBFrgA1uwB98tmWAAAOvklEQVR4nO3Ye1jW5RnA8d+Wtmmews2yJTlXrVWUmUNLt5xSVrpygqJZQShMwqWYOHSWhvMwkSESRRaej5hT8ZiJpCvDI5annGYecmpaOWdhHnff93O6n+f3exFc17yubTfG1V9+P8/9/F54X73Tp/fs+fqfX37xj8///um+3X/bu27GjDfeWLT+ry+//OqrC9/56PXXX3hh9HPPvTZq1LPP9u//2GO9e7du3bpVq1YPPtimTZuOHTvfAVO7dtOmN9xwQ40aNb6P8z01XqXm/4DTp09//b+9gT2n91zZDezZc6U3sOcKb+CbKw745hvo/7cALkcAgLNwA198fsUAZ8+epUfg8081YNF/EnD2/NmzX14UN3AZG+j8LQDOn7948YsLdAO7964jwHof4DUOeKuSgEoJCPDVhQvn5CPgXsEHLqD3twy4eP4rGAM4OqNMAEqqBGgaCKiM4KLsnzvz7wIucwUIOHXqFAD2nagS4EEGCHkHlSBcwPypc8fPnDmxu7xcAtZXFtAxEFClS7iA/ePHj585se+T8r0nsY+vQgQsrAqA/zC2VnApwgXKHz9z7MSJ8vKT66oM6GwDggQVE85h/tgx6H+iALvoVVgJQBsNqOAOLiUAwLHj1P+k/OTJo0fLynYtWrQdAQeCAI+FBFyu4MyZYzjQ37lTAbYDoAQ28M47RwAw2g94CwFD1UMQBHAFoQ0EOCH7a9dAf9eu7ds/gwUcsAGjLEArDehMAHEHFQpCIPadwDr2d0IfF4B9Adh/5MgmDdggANM4IPAOKhIEMPbp/tq1a9esWbFr1yEEHATA/v1HPpKArQLQXwBaM4C6g6oILM1umRf9MgUoEYAjHPCsAfCHwFqBJagMwSsvL9+p+2tWLN91CAEHAbBDAIoAsHXraxsUYFqGfQfOCmzBpQme6K8V+1+xAvqH8AYObyPAJgLMl4DC/oUIyNCAoXwFwYJLGby9J+HhXyvPv2L58kOHtsACDpZs2wGAjQgoQsDWDRtWwQYKC6dN660BQ4cGrUAIOKEihLdO9CmP/fcPbVl9EBagAEVFRfMBkEeAQgRMQwAKhqKAraBJU74DhxBK4a07KvKiv/z997cA4DABNm+0AatyJECuYJgEKEETJahWrUYIQ8DviaNH1xwVedO3ASsJkAeA/oV0BxkZGbiCYQgY2rGjuITqtWs3byIJ1aoZQqCBabwZKi/6CFgt+wgoFhvII0COWIEGGAEAqtdurgRNqlmEChFeWVkZy8u+BhQX0wbmWwApGNbKABre0bB69eYkAEITIbAMoRQIKMO6Of+bb7733ra3P9y8uXTjgmIQrFzpBwzPGP7WMLaChjDVDQG/BRkCJN4b8MtH1k1/yRIDmAeAxQDIQgAIJtMGADA8tEBMtWqhERri7cI5dEjkZf+9JW8DoLR0AQDm+QCTBQBGCOoRoaEhMINBhHJ4i/Bnn8xTXy6AAxYbQM5kAAy0BTBXw4Qg2Agfw4O3PyDYIvK6//aHY0s5YPHEvKw5c1YJwOSBAwcKAAmuB0A9LQgkuAhG8dZvhxF1kRcLGDsW+wuWLQNAAQDysrJAAIBMIcjImKkFQ68fWq/j1RaBDC4iEEKA1dtlXpyfFjB2EADGIaAAARMJMDUnM1OtYOZMtoJ6MA4hpMF2eJ/hrD64+k19fNEfO2jQbAUAwcSJCJgzNVMLZhoBGhwCM4RU0CDgIIy/X0p9CZgoATlCMHeuLbgepp5LEAaFCKXwXj5Ygj/7Dx+WeeiPpfMPmj2bALkCkJU1a9asOVMVgAvu9RG0QSK0ws/wSkpKDsu+yBNA9MdNWJaeC4D8fNjAmFlZCEDBi3O1gAj39uw5rKcmuAaFMAoOAcDhkm0wS7aZvOqPW5aePk8DxsAKJEAKpmsBEHoSga+BIwzDcjRv7h04cIDnqY8PIC1gQjpuIB8BYyyAEExHQc2ZNYfXvNclaIOFYAwlQcCBHdu2URx+/snzE2CCAOQCYIjcQD8QjM8cLwXTpxNhZs2aKDAEaTAIR8Eh3sIDO2g+xBlr+uNEHwDxCBgyhlbQDwTJ48cLwZQpStByuCHYBoYIYMB4C/djfbPKD1LHFxcAgHgBSEFAPwAkJyvBlCmS0KFlSyS4Bo2wFI7D2w+zGWdsqdtHwMj43PhO0EdAQgIA+iVrwZQpFqGmJAiDD+EyJEQD4HdPqcrLPgBGjoyPj+/UCQEpCQkkSHQE02k6KEKAwVK4DO/Ikf0bN5ZSvlTl9QNAfQB0QoAUJCrB0qVLzQ46dCACM0iEUVgMDQHARhwSLJhtHV8vQAJIkJjIBZJwUwiDQjCF65CABTSiLvoT0kdCHwBJkDeAxEQlGCAE0nCTFDCDi7AZyuFtwllAgtnjFjh57Cc5G0BDWlryABwh6IEAmg7GIBFKwRi2w/sA+8ViAzovnj8EJBEgOjoaAVHqDkCQNmDAeC3o0aBBkEEhtIIzeirAB5uKN8Gb3+JlOLpu+hKAhKjuOImpBEgbwJeAhgYNLINEaIVhcAcAioqpD4IJSEhPF4+f6gMgDPPRKVFRJEhNlQJJ6Np1aVcUEEEaNEIpDIM5UOLBR6+i4iK5gGWyrvpiA2FhtIGoaFcgAANuvrkrInr0sPbAEEEM5fBeQME8GpkXdXX+pKQwBaDpLgmpaS4Bpoe7CEuhGRzijSZA0Tx46wNf6bmqD6cfqfpCEBMVowipqZrw5JNCoAwMYRQWgzlaImD0ShzcQK6Yker1Z/oIiIkhQTYTkOFJmCeeGPDEzS7Cp3AcAuKNnj9aAApyhSCeJkn35QoiY3DioqLi4rKzu2cLQrfULt26pXUTBhhmsBUWw3J48Nl7PgDgnWeBvy/rYeFhkTAkoMmmIUOXLmDoRgaDcBWKYTsI4j1HggI58fG5/PyqHx4eKQWxcUEEMrgIo1AM7WAQbyv0F8+nem5BfH7g+RUgMiYWhgGyb7lFAAIQUsEY2mEgDQAAAvjotbgA3/zmF+R3gt9++vxJ4bB904+MlWMbYCyEUIRkMAhIALB1MU1BPgri8/F3j9p+nSTR9wli+UU4CEshGcphQ1Di4T+ACUE+Tic58vEPNxPpGgSiRYsW2dktblHTJZihHBqiJd7WPCGYKABKIG6/TlIditP3iIjICJjY2AgJaNSoURz810JNgEIytENDtMTLy8P+RBx895vP+2EyXocmIjxCT7NmzWLhT2xss0Y0LfwKy6Egfok3Ko+GBPDecwjrh1t9EKiJlQY9jVwGdwRCtMTbkLdB5qkP7770+cOsvEWQ06dPAIM7QkI0xduwAf/1JcsIojtFq3yS069zjRxot2/fnr6179PHZgQ6LIhFAQDk87LGjNEAGHMBTllPe3f6WJBG1rSowOKtWoWCiVn42S8lRfSjzQOg+9daQ4i2OMESzWlUEaWFAKzCKxCAISkKEM4X4NTlPKSmbVsfpY89AVtRGASskn3YgALwPo/+gM0j1z7ykG/asgm09HHuCAFz5mTNmiUBKSkuILgO/aCpqqZPMy8HAXMMgG2g6v2KOG2DOV5OjgCAIIEAQAiL9PV1+Lt8fhhiqgACQI4AzEpIUBuAXzl2P6BdUb/SJHB4hQYgriAK+5G8789fJeYnlZlLoDiANhAVHRPQ97Vxfl3ZqciFgBwCwOfOlAT4+BWjAeb4/vhVVzWmv7tx48Y8VUtO5WUEmDp1zqx++MlX98PVj5+gfGM1svadKkwtNmTwCguhP3Vqv34JQIhiC3D6dtzXrRtybEBd+aUHATkCADcAnz8V4Bp1Ab48a/NQ/VBzq/1Vt775ql+/LgIy3Q3wBZi8rNttq1T1qX8rADIlICGKAGwBvM/PbrXZX3e/nDsrnkfpjxxvWmFmjtpAlAbQr1+nz+tW3G0+b+bRS443bbLeALsBp6/zfOsmjak7Te/hwLlPfuEfNgTI1IAYC8D7Tp7i+rR9+wZkX1Fznzu34cj/B8BkAUhM6C5fhE6/sezrPB1dxfv27Tt48GAryiowf6lg2rVrpwGJGhBBAKtv57Eu44NpXnnlYRW+ze62k/PbkCMByQDorgF6AVaf8verel9ZV2dmXTf5ezEfq/kTHwFITsYFdKfXAFuA7rt5FtdtWeZRlntGzE/VvKTGBsQhIIIWENCnZ17nRR3K74q2KausSb7E5sdq/kjDAVEAiBU3IBeg+ip/P+bl4eno78KoY4u0DPMqy8m5W85dd92FgBcJQDcA/Yg61gJ438qr+h9UW6RNmVdVTs8DarwMAIxXgFi2AKtv52Ud4jAyTm23zLM6+cDP+ViAOPjszxbg9k2ezi7qIq7OrdIm7Eb/bOaXOA5APIJiAVZfHV/m6fCmzto6bYWtJs6v1HgZAzUgLk7dgLwA3rfydHiqO3GTtsJu9RdmADCXAKnyBtgC3D48eioPh6ezm7qImzYvO9nr+AQC1AU4fXr0VF5unuombtqs7O/+yIwNiIyANwJsAbIv13+buHuZ99V13LSdsMn+Rs3TEpAGAHoEQvX18Vle1dXRVdzfdsNPi/kZjA2I4AC8ANaX2w/KO3HetsumK6dXLw2AF4F4BCrq06On825dxe12ULmXmHtgHIBeAF2A24cXXnDe1EO07fI9em68UQFSu2drAFuA7os89WXeqeujO20rzcJqLIC5AbmA55+nPj++P8/PruPs3Fb6RjaP4xgAPoNqAbVUv29AXyyf8vrwvjo7tz/9uJqnnnrKG64B4gbEAswFqP4zKn+3nXfr+uSBbVamuf12CUjkAL2Avub+nzHHD8izuj65G/elxTgbEDeACxAPQIi+P8/q5ujB7dutEYC0tNTsuKAFsH6IvDy8r27HA9q/EyMBiRyAL4FL9HneHN49Oo8HtGFGjCBAMgPQDcAC6ALg5w/vh8zze684ztJiFKA7/RTAR4BugBaALwDTt4+v887hWd2N+9ojRkyaNIkAA+gZjIiQN0ALUBfg9HX+OjsfWPfHrTYNB4gbkAugC4D+x9QX128f38mHrPvik/gogH4EGtfSC4ALkH08v1y/yYu77+XmA+vBcZx/AeDdATn/vA1ZAAAAAElFTkSuQmCC";class tl{get diffuse(){return this._diffuse}get specular(){return this._specular}constructor(t,r){this._diffuse=t,this._specular=r}get valid(){return this._diffuse.valid&&this._specular.valid&&(!this.lookupBrdf||this.lookupBrdf.valid)}}tl.defaultLookupBrdf=$.from(v0,{mipmap:ne.OFF});const Mo={},mc=e=>e?e.lights.length+(e.imageBasedLighting?.5:0):0;class Ue extends Za{constructor(){super(...arguments),this._lightingEnvironmentConfigId=0,this._unlit=!1,this._alphaMode=ir.blend,this._baseColorFactor=new Float32Array(4),this._instancingEnabled=!1,this._skinUniforms=new p0,this.roughness=1,this.metallic=1,this.baseColor=new pe(1,1,1,1),this.alphaCutoff=.5,this.emissive=new pe(0,0,0),this.exposure=1}get baseColorTexture(){return this._baseColorTexture}set baseColorTexture(t){t!==this._baseColorTexture&&(this.invalidateShader(),!(t!=null&&t.transform)&&(t!=null&&t.frame)&&!(t!=null&&t.noFrame)&&(t.transform=tr.fromTexture(t)),this._baseColorTexture=t)}get metallicRoughnessTexture(){return this._metallicRoughnessTexture}set metallicRoughnessTexture(t){t!==this._metallicRoughnessTexture&&(this.invalidateShader(),!(t!=null&&t.transform)&&(t!=null&&t.frame)&&!(t!=null&&t.noFrame)&&(t.transform=tr.fromTexture(t)),this._metallicRoughnessTexture=t)}get normalTexture(){return this._normalTexture}set normalTexture(t){t!==this._normalTexture&&(this.invalidateShader(),!(t!=null&&t.transform)&&(t!=null&&t.frame)&&!(t!=null&&t.noFrame)&&(t.transform=tr.fromTexture(t)),this._normalTexture=t)}get occlusionTexture(){return this._occlusionTexture}set occlusionTexture(t){t!==this._occlusionTexture&&(this.invalidateShader(),!(t!=null&&t.transform)&&(t!=null&&t.frame)&&!(t!=null&&t.noFrame)&&(t.transform=tr.fromTexture(t)),this._occlusionTexture=t)}get emissiveTexture(){return this._emissiveTexture}set emissiveTexture(t){t!==this._emissiveTexture&&(this.invalidateShader(),!(t!=null&&t.transform)&&(t!=null&&t.frame)&&!(t!=null&&t.noFrame)&&(t.transform=tr.fromTexture(t)),this._emissiveTexture=t)}get alphaMode(){return this._alphaMode}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.invalidateShader())}get shadowCastingLight(){return this._shadowCastingLight}set shadowCastingLight(t){t!==this._shadowCastingLight&&(this.invalidateShader(),this._shadowCastingLight=t)}get debugMode(){return this._debugMode}set debugMode(t){this._debugMode!==t&&(this.invalidateShader(),this._debugMode=t)}get lightingEnvironment(){return this._lightingEnvironment}set lightingEnvironment(t){t!==this._lightingEnvironment&&(this.invalidateShader(),this._lightingEnvironmentConfigId=mc(t),this._lightingEnvironment=t)}get unlit(){return this._unlit}set unlit(t){this._unlit!==t&&(this._unlit=t,this.invalidateShader())}destroy(){var t,r,i,n,s;(t=this._baseColorTexture)==null||t.destroy(),(r=this._normalTexture)==null||r.destroy(),(i=this._emissiveTexture)==null||i.destroy(),(n=this._occlusionTexture)==null||n.destroy(),(s=this._metallicRoughnessTexture)==null||s.destroy(),this._skinUniforms.destroy()}invalidateShader(){this._shader=void 0}static create(t){return new Ju().create(t)}render(t,r){!this._instancingEnabled&&t.instances.length>0&&(this.invalidateShader(),this._instancingEnabled=!0),this._instancingEnabled&&t.instances.length===0&&(this.invalidateShader(),this._instancingEnabled=!1);let i=this.lightingEnvironment||ze.main,n=mc(i);n!==this._lightingEnvironmentConfigId&&(this.invalidateShader(),this._lightingEnvironmentConfigId=n),super.render(t,r)}get isInstancingSupported(){return!0}createInstance(){return new m0(this)}createShader(t,r){if(r.context.webGLVersion===1){let o=["EXT_shader_texture_lod","OES_standard_derivatives"];for(let a of o)r.gl.getExtension(a)}let i=this.lightingEnvironment||ze.main,n=Pn.build(r,t,t.geometry,this,i);if(!n)return;t.skin&&Pn.hasSkinningTextureFeature(n)&&this._skinUniforms.enableJointMatrixTextures(t.skin.joints.length);let s=n.join(",");return Mo[s]||(Mo[s]=Ja.build(r,n)),Mo[s]}updateUniforms(t,r){var i,n,s,o,a;for(let u=0;u<3;u++)this._baseColorFactor[u]=this.baseColor.rgba[u];this._baseColorFactor[3]=this.baseColor.a*t.worldAlpha;let l=this.camera||Ce.main;t.skin&&this._skinUniforms.update(t,r),r.uniforms.u_Camera=l.worldTransform.position.array,r.uniforms.u_ViewProjectionMatrix=l.viewProjection.array,r.uniforms.u_ViewMatrix=l.view.array,r.uniforms.u_Exposure=this.exposure,r.uniforms.u_MetallicFactor=this.metallic,r.uniforms.u_RoughnessFactor=this.roughness,r.uniforms.u_BaseColorFactor=this._baseColorFactor,r.uniforms.u_ModelMatrix=t.worldTransform.array,r.uniforms.u_NormalMatrix=t.transform.normalTransform.array,this._alphaMode===ir.mask&&(r.uniforms.u_AlphaCutoff=this.alphaCutoff),t.targetWeights&&t.targetWeights.length>0&&(r.uniforms.u_morphWeights=t.targetWeights),(i=this.baseColorTexture)!=null&&i.valid&&(r.uniforms.u_BaseColorSampler=this.baseColorTexture,r.uniforms.u_BaseColorUVSet=this.baseColorTexture.uvSet||0,this.baseColorTexture.transform&&(r.uniforms.u_BaseColorUVTransform=this.baseColorTexture.transform.array));let h=this.lightingEnvironment||ze.main;for(let u=0;u<h.lights.length;u++){let d=h.lights[u],f=0;switch(d.type){case Re.point:f=1;break;case Re.directional:f=0;break;case Re.spot:f=2;break}r.uniforms[`u_Lights[${u}].type`]=f,r.uniforms[`u_Lights[${u}].position`]=d.worldTransform.position.array,r.uniforms[`u_Lights[${u}].direction`]=d.worldTransform.forward.array,r.uniforms[`u_Lights[${u}].range`]=d.range,r.uniforms[`u_Lights[${u}].color`]=d.color.rgb,r.uniforms[`u_Lights[${u}].intensity`]=d.intensity,r.uniforms[`u_Lights[${u}].innerConeCos`]=Math.cos(d.innerConeAngle*Sr),r.uniforms[`u_Lights[${u}].outerConeCos`]=Math.cos(d.outerConeAngle*Sr)}h.fog&&(r.uniforms.u_FogNear=h.fog.near,r.uniforms.u_FogFar=h.fog.far,r.uniforms.u_FogColor=h.fog.color.rgb),this._shadowCastingLight&&(r.uniforms.u_ShadowSampler=this._shadowCastingLight.shadowTexture,r.uniforms.u_LightViewProjectionMatrix=this._shadowCastingLight.lightViewProjection,r.uniforms.u_ShadowLightIndex=h.lights.indexOf(this._shadowCastingLight.light));let c=h.imageBasedLighting;c!=null&&c.valid&&(r.uniforms.u_DiffuseEnvSampler=c.diffuse,r.uniforms.u_SpecularEnvSampler=c.specular,r.uniforms.u_brdfLUT=c.lookupBrdf||tl.defaultLookupBrdf,r.uniforms.u_MipCount=c.specular.levels-1),(n=this.emissiveTexture)!=null&&n.valid&&(r.uniforms.u_EmissiveSampler=this.emissiveTexture,r.uniforms.u_EmissiveUVSet=this.emissiveTexture.uvSet||0,r.uniforms.u_EmissiveFactor=this.emissive.rgb,this.emissiveTexture.transform&&(r.uniforms.u_EmissiveUVTransform=this.emissiveTexture.transform.array)),(s=this.normalTexture)!=null&&s.valid&&(r.uniforms.u_NormalSampler=this.normalTexture,r.uniforms.u_NormalScale=this.normalTexture.scale||1,r.uniforms.u_NormalUVSet=this.normalTexture.uvSet||0,this.normalTexture.transform&&(r.uniforms.u_NormalUVTransform=this.normalTexture.transform.array)),(o=this.metallicRoughnessTexture)!=null&&o.valid&&(r.uniforms.u_MetallicRoughnessSampler=this.metallicRoughnessTexture,r.uniforms.u_MetallicRoughnessUVSet=this.metallicRoughnessTexture.uvSet||0,this.metallicRoughnessTexture.transform&&(r.uniforms.u_MetallicRoughnessUVTransform=this.metallicRoughnessTexture.transform.array)),(a=this.occlusionTexture)!=null&&a.valid&&(r.uniforms.u_OcclusionSampler=this.occlusionTexture,r.uniforms.u_OcclusionStrength=this.occlusionTexture.strength||1,r.uniforms.u_OcclusionUVSet=this.occlusionTexture.uvSet||0,this.occlusionTexture.transform&&(r.uniforms.u_OcclusionUVTransform=this.occlusionTexture.transform.array))}}class Zn{constructor(){this._onChanged=()=>{this._center.set((this._min.x+this._max.x)/2,(this._min.y+this._max.y)/2,(this._min.z+this._max.z)/2),this._extents.set(Math.abs(this._max.x-this._center.x),Math.abs(this._max.y-this._center.y),Math.abs(this._max.z-this._center.z)),this._size.set(this._extents.x*2,this._extents.y*2,this._extents.z*2)},this._min=new mt(0,0,0,this._onChanged,this),this._max=new mt(0,0,0,this._onChanged,this),this._center=new mt(0,0,0,()=>{},this),this._size=new mt(0,0,0,()=>{},this),this._extents=new mt(0,0,0,()=>{},this)}get min(){return this._min}set min(t){this._min.copyFrom(t)}get max(){return this._max}set max(t){this._max.copyFrom(t)}get center(){return this._center}get size(){return this._size}get extents(){return this._extents}static from(t){let r=new Zn;return r.min.setFrom(t.min),r.max.setFrom(t.max),r}encapsulate(t){this._min.x=Math.min(this._min.x,t.x),this._min.y=Math.min(this._min.y,t.y),this._min.z=Math.min(this._min.z,t.z),this._max.x=Math.max(this._max.x,t.x),this._max.y=Math.max(this._max.y,t.y),this._max.z=Math.max(this._max.z,t.z)}}class y0{static create(t={}){var r,i,n,s;const o=(r=t==null?void 0:t.radius)!=null?r:1,a=Math.max(3,Math.floor((i=t==null?void 0:t.segments)!=null?i:32)),l=(n=t==null?void 0:t.thetaStart)!=null?n:0,h=(s=t==null?void 0:t.thetaLength)!=null?s:Math.PI*2,c=[],u=[],d=[],f=[],p=ct.create(),g=ct.create();u.push(0,0,0),d.push(0,0,1),f.push(.5,.5);for(let m=0,_=3;m<=a;m+=1,_+=3){const w=l+m/a*h;p[0]=o*Math.cos(w),p[1]=o*Math.sin(w),u.push(p[0],p[1],p[2]),d.push(0,0,1),g[0]=(u[_]/o+1)/2,g[1]=(u[_+1]/o+1)/2,f.push(g[0],g[1])}for(let m=1;m<=a;m+=1)c.push(m,m+1,0);return Object.assign(new Ir,{normals:{buffer:new Float32Array(d)},uvs:[{buffer:new Float32Array(f)}],indices:{buffer:new Uint16Array(c)},positions:{buffer:new Float32Array(u)}})}}class x0{static create(t={}){var r,i,n,s,o,a,l,h;const c=(r=t==null?void 0:t.radiusTop)!=null?r:1,u=(i=t==null?void 0:t.radiusBottom)!=null?i:1,d=(n=t==null?void 0:t.height)!=null?n:1,f=Math.floor((s=t==null?void 0:t.radialSegments)!=null?s:32),p=Math.floor((o=t==null?void 0:t.heightSegments)!=null?o:1),g=(a=t==null?void 0:t.openEnded)!=null?a:!1,m=(l=t==null?void 0:t.thetaStart)!=null?l:0,_=(h=t==null?void 0:t.thetaLength)!=null?h:Math.PI*2,w=[],v=[],E=[],y=[];let C=0;const x=[],F=d/2,G=()=>{const U=(u-c)/d;for(let I=0;I<=p;I+=1){const L=[],R=I/p,W=R*(u-c)+c;for(let T=0;T<=f;T+=1){const A=T/f,b=A*_+m,P=Math.sin(b),S=Math.cos(b),M=W*P,B=-R*d+F,D=W*S;v.push(M,B,D);const H=P,V=U,Y=S,K=ct.normalize(ct.fromValues(H,V,Y));y.push(K[0],K[1],K[2]),E.push(A,1-R),L.push(C),C+=1}x.push(L)}for(let I=0;I<f;I+=1)for(let L=0;L<p;L+=1){const R=x[L][I],W=x[L+1][I],T=x[L+1][I+1],A=x[L][I+1];w.push(R,W,A),w.push(W,T,A)}},k=U=>{const I=C,L=U===!0?c:u,R=U===!0?1:-1;for(let T=1;T<=f;T+=1)v.push(0,F*R,0),y.push(0,R,0),E.push(.5,.5),C+=1;const W=C;for(let T=0;T<=f;T+=1){const b=T/f*_+m,P=Math.cos(b),S=Math.sin(b),M=L*S,B=F*R,D=L*P;v.push(M,B,D),y.push(0,R,0);const H=P*.5+.5,V=S*.5*R+.5;E.push(H,V),C+=1}for(let T=0;T<f;T+=1){const A=I+T,b=W+T;U===!0?w.push(b,b+1,A):w.push(b+1,b,A)}};return G(),g===!1&&(c>0&&k(!0),u>0&&k(!1)),Object.assign(new Ir,{normals:{buffer:new Float32Array(y)},uvs:[{buffer:new Float32Array(E)}],indices:{buffer:new Uint16Array(w)},positions:{buffer:new Float32Array(v)}})}}var oa;(e=>{function t(r={}){const{radius:i=1,segments:n=32,rings:s=16}=r,o=[],a=[],l=[],h=[],c=[];let u=0;for(let d=0;d<=s;d++){const f=[],p=d/s;let g=0;d==0?g=.5/n:d==s&&(g=-.5/n);for(let m=0;m<=n;m++){const _=m/n;let w=-i*Math.cos(_*Math.PI*2)*Math.sin(p*Math.PI),v=i*Math.cos(p*Math.PI),E=i*Math.sin(_*Math.PI*2)*Math.sin(p*Math.PI),y=ct.fromValues(w,v,E);l.push(w,v,E),c.push(...ct.normalize(y)),h.push(_+g,1-p),f.push(u++)}o.push(f)}for(let d=0;d<s;d++)for(let f=0;f<n;f++){const p=o[d][f+1],g=o[d][f],m=o[d+1][f],_=o[d+1][f+1];d!==0&&a.push(p,g,_),d!==s-1&&a.push(g,m,_)}return Object.assign(new Ir,{normals:{buffer:new Float32Array(c)},uvs:[{buffer:new Float32Array(h)}],indices:{buffer:new Uint16Array(a)},positions:{buffer:new Float32Array(l)}})}e.create=t})(oa||(oa={}));class Ee extends ie{constructor(t,r){if(super(),this.geometry=t,this.material=r,this.pluginName="pipeline",this.enabledRenderPasses={material:{}},this.renderSortOrder=0,this._instances=[],!t)throw new Error("PIXI3D: Geometry is required when creating a mesh.")}get instances(){return this._instances}createInstance(){var t;if(this.material&&!this.material.isInstancingSupported)throw new Error("PIXI3D: Can't create instance of mesh, material does not support instancing.");return this._instances[this._instances.push(new c0(this,(t=this.material)==null?void 0:t.createInstance()))-1]}removeInstance(t){const r=this._instances.indexOf(t);r>=0&&this._instances.splice(r,1)}enableRenderPass(t,r){this.enabledRenderPasses[t]||(this.enabledRenderPasses[t]=r||{})}disableRenderPass(t){this.enabledRenderPasses[t]&&delete this.enabledRenderPasses[t]}isRenderPassEnabled(t){return!!this.enabledRenderPasses[t]}destroy(t){(t===!0||t&&t.geometry)&&this.geometry.destroy(),(t===!0||t&&t.material)&&this.material&&this.material.destroy(),super.destroy(t)}_render(t){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.skin&&this.skin.calculateJointMatrices(),t.plugins[this.pluginName].render(this)}getBoundingBox(){var t,r;if(!((t=this.geometry.positions)!=null&&t.min)||!((r=this.geometry.positions)!=null&&r.max))return;let i=ct.transformMat4(this.geometry.positions.min,this.worldTransform.array),n=ct.transformMat4(this.geometry.positions.max,this.worldTransform.array);for(let s=0;s<3;s++){let o=i[s];i[s]=Math.min(i[s],n[s]),n[s]=Math.max(o,n[s])}return Zn.from({min:i,max:n})}static createQuad(t=new Ue){return new Ee(sa.create(),t)}static createCube(t=new Ue){return new Ee(na.create(),t)}static createPlane(t=new Ue){return new Ee(ia.create(),t)}static createSphere(t=new Ue,r){return new Ee(oa.create(r),t)}static createCircle(t=new Ue,r={}){return new Ee(y0.create(r),t)}static createCylinder(t=new Ue,r={}){return new Ee(x0.create(r),t)}}class b0 extends lr{constructor(t){super(),this.name=t,this.speed=1,this.loop=!1}play(t=Ft.shared){this.position=0,this._ticker||(this._update=()=>{this.update(t.deltaMS/1e3*this.speed)},this._ticker=t.add(this._update))}stop(){this._ticker&&this._update&&(this._ticker.remove(this._update),this._ticker=this._update=void 0)}update(t){this.position+=t,!(this.position<this.duration)&&(this.loop?this.position>this.duration&&(this.position=this.position%this.duration):(this.position=this.duration,this.stop()),this.emit("complete"))}}class T0 extends b0{constructor(t,r){super(r),this._duration=0,this._position=0,this._channels=[];for(let i of t)this._duration=Math.max(this._duration,i.duration);this._channels=t}get duration(){return this._duration}get position(){return this._position}set position(t){this._position=t;for(let r of this._channels)r.position=this._position}}class Je{constructor(t,r,i=0,n,s=!1,o,a){this.buffer=t,this.componentType=r,this.stride=i,this.componentCount=n,this.normalized=s,this.min=o,this.max=a}static from(t,r,i,n,s,o,a=!1,l,h){switch(t){case 5125:return new Je(new Uint32Array(i,n,s),t,o,r,a,l,h);case 5126:return new Je(new Float32Array(i,n,s),t,o,r,a,l,h);case 5120:return new Je(new Int8Array(i,n,s),t,o,r,a,l,h);case 5121:return new Je(new Uint8Array(i,n,s),t,o,r,a,l,h);case 5122:return new Je(new Int16Array(i,n,s),t,o,r,a,l,h);case 5123:return new Je(new Uint16Array(i,n,s),t,o,r,a,l,h);default:throw new Error(`PIXI3D: Unknown component type "${t}".`)}}}class w0{constructor(t,r){this.parent=t,this.joints=r,this._jointMatrices=[],this._jointNormalMatrices=[],this._transformIds=[],this.jointNormalMatrices=new Float32Array(this.joints.length*16),this.jointMatrices=new Float32Array(this.joints.length*16);for(let i=0;i<r.length;i++)this._transformIds.push(-1),this._jointMatrices.push(new Float32Array(this.jointMatrices.buffer,16*4*i,16)),this._jointNormalMatrices.push(new Float32Array(this.jointNormalMatrices.buffer,16*4*i,16))}calculateJointMatrices(){for(let t=0;t<this.joints.length;t++)this.joints[t].transform._worldID!==this._transformIds[t]&&(this._transformIds[t]=this.joints[t].transform._worldID,lt.multiply(this.joints[t].worldTransform.array,this.joints[t].inverseBindMatrix,this._jointMatrices[t]),lt.multiply(this.parent.transform.inverseWorldTransform.array,this._jointMatrices[t],this._jointMatrices[t]),lt.invert(this._jointMatrices[t],this._jointNormalMatrices[t]),lt.transpose(this._jointNormalMatrices[t],this._jointNormalMatrices[t]))}}class A0 extends ie{constructor(t){super(),this.inverseBindMatrix=t}}function el(e,t){switch(e.constructor){case Float32Array:return r=>r;case Uint32Array:return r=>{for(let i=0;i<t;i++)r[i]=r[i]/4294967295;return r};case Uint16Array:return r=>{for(let i=0;i<t;i++)r[i]=r[i]/65535;return r};case Uint8Array:return r=>{for(let i=0;i<t;i++)r[i]=r[i]/255;return r};case Int32Array:return r=>{for(let i=0;i<t;i++)r[i]=Math.max(r[i]/2147483647,-1);return r};case Int16Array:return r=>{for(let i=0;i<t;i++)r[i]=Math.max(r[i]/32767,-1);return r};case Int8Array:return r=>{for(let i=0;i<t;i++)r[i]=Math.max(r[i]/127,-1);return r};default:throw new Error("Invalid component type.")}}class E0{constructor(t,r){this._output=t,this._stride=r,this._data=new Float32Array(r),this._denormalize=el(this._output,this._stride)}interpolate(t,r){let i=(t+0)*this._stride,n=(t+1)*this._stride;for(let s=0;s<this._stride;s++)this._output.length>n?this._data[s]=(1-r)*this._output[i+s]+r*this._output[n+s]:this._data[s]=this._output[i+s];return this._denormalize(this._data)}}class rl{constructor(t,r,i){this._input=t,this._output=r,this._stride=i,this._data=new Float32Array(i),this._denormalize=el(this._output,this._stride)}interpolate(t,r){const i=this._input[t+1]-this._input[t],n=(t+0)*this._stride*3,s=(t+1)*this._stride*3;for(let o=0;o<this._stride;o++)this._data[o]=rl.calculate(r,this._output[n+o+1*this._stride],this._output[s+o+1*this._stride],i*this._output[s+o],i*this._output[n+o+2*this._stride]);return this._denormalize(this._data)}static calculate(t,r,i,n,s){return(2*t**3-3*t**2+1)*r+(t**3-2*t**2+t)*n+(-2*t**3+3*t**2)*i+(t**3-t**2)*s}}class S0{constructor(t,r){this._output=t,this._stride=r,this._data=new Float32Array(r),this._denormalize=el(this._output,this._stride)}interpolate(t){for(let r=0;r<this._stride;r++)this._data[r]=this._output[t*this._stride+r];return this._denormalize(this._data)}}class nn{static create(t,r,i,n){switch(t){case"LINEAR":return new E0(i,n);case"CUBICSPLINE":return new rl(r,i,n);case"STEP":return new S0(i,n)}throw new Error(`PIXI3D: Unknown interpolation type "${t}"`)}}class ts{constructor(t,r){this._position=0,this._frame=0,this._input=t,this._interpolation=r}get position(){return this._position}set position(t){this.setPosition(t)}get duration(){return this._input[this._input.length-1]}get frame(){return this._frame}get length(){return this._input.length}setPosition(t){this._position=t,this._frame=this.calculateFrame(this._position),this.updateTarget(this._interpolation.interpolate(this._frame,this.calculateFramePosition(this._frame,this._position)))}update(t){this.position+=t}calculateFramePosition(t,r){return t===this._input.length-1?1:(r-this._input[t])/(this._input[t+1]-this._input[t])}calculateFrame(t){if(t<this._input[0])return 0;for(let r=0;r<this._input.length-1;r++)if(t>=this._input[r]&&t<this._input[r+1])return r;return this._input.length-1}}class gc extends ts{constructor(t,r,i){super(r,i),this._transform=t}updateTarget(t){this._transform.rotationQuaternion.set(t[0],t[1],t[2],t[3])}}class C0 extends ts{constructor(t,r,i){super(r,i),this._transform=t}updateTarget(t){this._transform.scale.set(t[0],t[1],t[2])}}class I0{constructor(t){this._output=t,this._data=new Float32Array(4)}interpolate(t,r){let i=(t+0)*4,n=(t+1)*4,s=Ht.set(this._output[i],this._output[i+1],this._output[i+2],this._output[i+3],new Float32Array(4));if(this._output.length<=n)return Ht.normalize(s,this._data);let o=Ht.set(this._output[n],this._output[n+1],this._output[n+2],this._output[n+3],new Float32Array(4));return Ht.normalize(Ht.slerp(s,o,r,this._data),this._data)}}class R0 extends ts{constructor(t,r,i){super(r,i),this._transform=t}updateTarget(t){this._transform.position.set(t[0],t[1],t[2])}}class M0 extends ts{constructor(t,r,i){super(r,i),this._weights=t}updateTarget(t){for(let r=0;r<t.length;r++)this._weights[r]=t[r]}}class P0{static create(t,r,i,n,s){if(n==="translation")return new R0(s.transform,t,nn.create(i,t,r,3));if(n==="scale")return new C0(s.transform,t,nn.create(i,t,r,3));if(n==="rotation")return i==="LINEAR"?new gc(s.transform,t,new I0(r)):new gc(s.transform,t,nn.create(i,t,r,4));if(n==="weights"){let o=s.children[0].targetWeights;return o?new M0(o,t,nn.create(i,t,r,o.length)):void 0}throw new Error(`PIXI3D: Unknown channel path "${n}"`)}}class Fn{constructor(t,r){var i;if(this._asset=t,this._materialFactory=r||new Ju,this._descriptor=this._asset.descriptor,t.textures.length===0)for(let n=0;n<((i=this._descriptor.textures)==null?void 0:i.length);n++)t.textures.push(this.parseTexture(n))}static createModel(t,r){return new Fn(t,r).parseModel()}static createMesh(t,r,i=0){return new Fn(t,r).parseMesh(i)}parseBuffer(t){if(t===void 0)return;typeof t=="number"&&(t=this._asset.descriptor.accessors[t]);let r=this._descriptor.bufferViews[t.bufferView||0],i=t.byteOffset||0;r.byteOffset!==void 0&&(i+=r.byteOffset);let n=t.count*Po[t.type];r.byteStride!==void 0&&r.byteStride!==0&&(n=r.byteStride/F0[t.componentType]*(t.count-1)+Po[t.type]);let s=this._asset.buffers[r.buffer];const o=t.normalized===!0;return Je.from(t.componentType,Po[t.type],s,i,n,r.byteStride,o,t.min,t.max)}parseAnimation(t,r){typeof t=="number"&&(t=this._asset.descriptor.animations[t]);let i=[];for(let n of t.channels){let s=t.samplers[n.sampler],o=this.parseBuffer(s.input);if(o===void 0)continue;let a=this.parseBuffer(s.output);if(a===void 0)continue;let l=P0.create(o.buffer,a.buffer,s.interpolation||"LINEAR",n.target.path,r[n.target.node]);l&&i.push(l)}return new T0(i,t.name)}parseMaterial(t){typeof t=="number"&&(t=this._asset.descriptor.materials[t]);let r=new Qu;if(!t)return this._materialFactory.create(r);t.occlusionTexture!==void 0&&(r.occlusionTexture=this._asset.textures[t.occlusionTexture.index].clone(),r.occlusionTexture.strength=t.occlusionTexture.strength,r.occlusionTexture.texCoord=t.occlusionTexture.texCoord,t.occlusionTexture.extensions&&t.occlusionTexture.extensions.KHR_texture_transform&&(r.occlusionTexture.transform=t.occlusionTexture.extensions.KHR_texture_transform,t.occlusionTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(r.occlusionTexture.texCoord=t.occlusionTexture.extensions.KHR_texture_transform.texCoord))),t.normalTexture!==void 0&&(r.normalTexture=this._asset.textures[t.normalTexture.index].clone(),r.normalTexture.scale=t.normalTexture.scale||1,r.normalTexture.texCoord=t.normalTexture.texCoord,t.normalTexture.extensions&&t.normalTexture.extensions.KHR_texture_transform&&(r.normalTexture.transform=t.normalTexture.extensions.KHR_texture_transform,t.normalTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(r.normalTexture.texCoord=t.normalTexture.extensions.KHR_texture_transform.texCoord))),t.emissiveTexture!==void 0&&(r.emissiveTexture=this._asset.textures[t.emissiveTexture.index].clone(),r.emissiveTexture.texCoord=t.emissiveTexture.texCoord,t.emissiveTexture.extensions&&t.emissiveTexture.extensions.KHR_texture_transform&&(r.emissiveTexture.transform=t.emissiveTexture.extensions.KHR_texture_transform,t.emissiveTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(r.emissiveTexture.texCoord=t.emissiveTexture.extensions.KHR_texture_transform.texCoord))),t.doubleSided!==void 0&&(r.doubleSided=t.doubleSided),t.emissiveFactor&&(r.emissiveFactor=t.emissiveFactor),t.alphaMode&&(r.alphaMode=t.alphaMode),t.alphaCutoff!==void 0&&(r.alphaCutoff=t.alphaCutoff);let i=t.pbrMetallicRoughness;return(i==null?void 0:i.metallicRoughnessTexture)!==void 0&&(r.metallicRoughnessTexture=this._asset.textures[i.metallicRoughnessTexture.index].clone(),r.metallicRoughnessTexture.texCoord=i.metallicRoughnessTexture.texCoord,i.metallicRoughnessTexture.extensions&&i.metallicRoughnessTexture.extensions.KHR_texture_transform&&(r.metallicRoughnessTexture.transform=i.metallicRoughnessTexture.extensions.KHR_texture_transform,i.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(r.metallicRoughnessTexture.texCoord=i.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord))),i!=null&&i.baseColorFactor&&(r.baseColor=i.baseColorFactor),(i==null?void 0:i.baseColorTexture)!==void 0&&(r.baseColorTexture=this._asset.textures[i.baseColorTexture.index].clone(),r.baseColorTexture.texCoord=i.baseColorTexture.texCoord,i.baseColorTexture.extensions&&i.baseColorTexture.extensions.KHR_texture_transform&&(r.baseColorTexture.transform=i.baseColorTexture.extensions.KHR_texture_transform,i.baseColorTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(r.baseColorTexture.texCoord=i.baseColorTexture.extensions.KHR_texture_transform.texCoord))),(i==null?void 0:i.metallicFactor)!==void 0&&(r.metallic=i.metallicFactor),(i==null?void 0:i.roughnessFactor)!==void 0&&(r.roughness=i.roughnessFactor),t.extensions&&(r.unlit=t.extensions.KHR_materials_unlit!==void 0),this._materialFactory.create(r)}parseTexture(t){const r=this._descriptor.textures[t],i=this._asset.images[r.source],n=new $(new ht(i.baseTexture.resource,{wrapMode:Wt.REPEAT,alphaMode:Vt.NO_PREMULTIPLIED_ALPHA}));if(this._descriptor.samplers&&r.sampler!==void 0)switch(this._descriptor.samplers[r.sampler].wrapS){case 10497:n.baseTexture.wrapMode=Wt.REPEAT;break;case 33648:n.baseTexture.wrapMode=Wt.MIRRORED_REPEAT;break;case 33071:n.baseTexture.wrapMode=Wt.CLAMP;break}return n}parseMesh(t){typeof t=="number"&&(t=this._asset.descriptor.meshes[t]);let r=t.weights||[];return t.primitives.map(i=>Object.assign(this.parsePrimitive(i),{name:t.name,targetWeights:r}))}parseSkin(t,r,i){return typeof t=="number"&&(t=this._asset.descriptor.skins[t]),new w0(r,t.joints.map(n=>i[n]))}parsePrimitive(t){let{attributes:r,targets:i}=t,n=Object.assign(new Ir,{indices:this.parseBuffer(t.indices),positions:this.parseBuffer(r.POSITION),normals:this.parseBuffer(r.NORMAL),tangents:this.parseBuffer(r.TANGENT),joints:this.parseBuffer(r.JOINTS_0),weights:this.parseBuffer(r.WEIGHTS_0),colors:this.parseBuffer(r.COLOR_0)});for(let o=0;;o++){let a=this.parseBuffer(r[`TEXCOORD_${o}`]);if(a===void 0)break;n.uvs=n.uvs||[],n.uvs.push(a)}if(i)for(let o=0;o<i.length;o++)n.targets=n.targets||[],n.targets.push({positions:this.parseBuffer(i[o].POSITION),normals:this.parseBuffer(i[o].NORMAL),tangents:this.parseBuffer(i[o].TANGENT)});let s;return t.material!==void 0?s=this.parseMaterial(this._asset.descriptor.materials[t.material]):s=this.parseMaterial(),new Ee(n,s)}parseNode(t){const r=this._asset.descriptor.nodes[t];let i;for(let s of this._asset.descriptor.skins||[]){const o=s.joints.indexOf(t);if(o>=0){const a=this.parseBuffer(s.inverseBindMatrices),l=a==null?void 0:a.buffer.slice(o*16,o*16+16);i=Object.assign(new A0(l),{name:r.name})}}let n=i||Object.assign(new ie,{name:r.name});return r.translation&&n.position.set(r.translation[0],r.translation[1],r.translation[2]),r.rotation&&n.rotationQuaternion.set(r.rotation[0],r.rotation[1],r.rotation[2],r.rotation[3]),r.scale&&n.scale.set(r.scale[0],r.scale[1],r.scale[2]),r.matrix&&n.transform.setFromMatrix(new xt(r.matrix)),n}parseModel(){let t=this._descriptor.nodes.map((s,o)=>this.parseNode(o)),r=this._descriptor.scenes[this._asset.descriptor.scene||0],i=new Dn,n=(s,o)=>{let a=this._asset.descriptor.nodes[o].mesh,l;if(this._asset.descriptor.nodes[o].skin!==void 0&&(l=this.parseSkin(this._asset.descriptor.nodes[o].skin,t[o],t)),a!==void 0)for(let h of this.parseMesh(a))i.meshes.push(t[o].addChild(h)),i.meshes[i.meshes.length-1].skin=l;if(s.addChild(t[o]),!!this._asset.descriptor.nodes[o].children)for(let h of this._asset.descriptor.nodes[o].children)n(t[o],h)};for(let s of r.nodes)n(i,s);if(this._asset.descriptor.animations)for(let s of this._asset.descriptor.animations)i.animations.push(this.parseAnimation(s,t));return i}}const Po={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F0={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};function Zu(e,t,r){for(let i of e.children)if(i instanceof Ee){const n=i.createInstance();n.name=i.name,r.push(t.addChild(n))}else if(i instanceof ie){const n=t.addChild(new ie);n.name=e.name,n.position=i.position,n.scale=i.scale,n.rotationQuaternion=i.rotationQuaternion,Zu(i,n,r)}}class D0 extends ie{constructor(t){super(),this.meshes=[],Zu(t,this,this.meshes)}}class Dn extends ie{constructor(){super(...arguments),this.animations=[],this.meshes=[]}static from(t,r){return Fn.createModel(t,r)}createInstance(){return new D0(this)}getBoundingBox(){this.updateTransform();let t=new Zn,r=this.meshes[0].getBoundingBox();r&&(t.min=r.min,t.max=r.max);for(let i=1;i<this.meshes.length;i++){let n=this.meshes[i].getBoundingBox();n&&(t.encapsulate(n.min),t.encapsulate(n.max))}return t}}class N0 extends ie{constructor(){super(...arguments),this.type=Re.point,this.color=new pe(1,1,1),this.range=10,this.intensity=10,this.innerConeAngle=0,this.outerConeAngle=45}}class B0{constructor(t,r){this.renderer=t,this.name=r,this.clearColor=new pe(0,0,0,0)}get renderTexture(){return this._renderTexture}set renderTexture(t){this._renderTexture=t}clear(){if(this._renderTexture&&this.clearColor){const t=this.renderer.renderTexture.current;this.renderer.renderTexture.bind(this._renderTexture),this.renderer.renderTexture.clear(Array.from(this.clearColor.rgba)),this.renderer.renderTexture.bind(t||void 0)}}render(t){const r=this.renderer.renderTexture.current;this._renderTexture&&this.renderer.renderTexture.bind(this._renderTexture);for(let i of t)i.material&&i.material.render(i,this.renderer);this._renderTexture&&this.renderer.renderTexture.bind(r||void 0)}}var O0={source:`#version VERSION

VERT_IN vec3 a_Position;
VERT_IN vec2 a_UV1;

VERT_OUT vec2 v_UV1;

void main() {
  v_UV1 = a_UV1;
  gl_Position = vec4(a_Position, 1.0);
}`},L0={source:`#version VERSION

#define FEATURES

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

#ifdef WEBGL2
  out vec4 FRAG_COLOR;
#endif

FRAG_IN vec2 v_UV1;

uniform vec2 u_BlurScale;
uniform sampler2D u_FilterSampler;

void main() {
  vec4 color = vec4(0.0);

  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-3.0) * u_BlurScale.xy)) * (1.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-2.0) * u_BlurScale.xy)) * (6.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-1.0) * u_BlurScale.xy)) * (15.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+0.0) * u_BlurScale.xy)) * (20.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+1.0) * u_BlurScale.xy)) * (15.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+2.0) * u_BlurScale.xy)) * (6.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+3.0) * u_BlurScale.xy)) * (1.0/64.0);

  FRAG_COLOR = color;
}`};class U0{constructor(t){this.renderer=t,this._mesh=Ee.createQuad(),this._gaussianBlurShader=new Ni(Gt.from(or.build(O0.source,[],t),or.build(L0.source,[],t)))}applyGaussianBlur(t){this.applyBlurScale(t.shadowTexture,t.filterTexture,new Float32Array([0,t.softness/t.shadowTexture.height])),this.applyBlurScale(t.filterTexture,t.shadowTexture,new Float32Array([t.softness/t.shadowTexture.width,0]))}applyBlurScale(t,r,i){this.renderer.renderTexture.bind(r),this.renderer.renderTexture.clear(),this._gaussianBlurShader.uniforms.u_FilterSampler=t,this._gaussianBlurShader.uniforms.u_BlurScale=i,this._gaussianBlurShader.render(this._mesh,this.renderer),this.renderer.renderTexture.bind(void 0)}}var G0={source:`#version VERSION

#define FEATURES

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}

VERT_IN vec3 a_Position;

#ifdef USE_SKINNING
  VERT_IN vec4 a_Joint1;
  VERT_IN vec4 a_Weight1;
#endif

uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;

#ifdef USE_SKINNING
  #ifdef USE_SKINNING_TEXTURE
    uniform sampler2D u_jointMatrixSampler;
  #else
    uniform mat4 u_jointMatrix[MAX_JOINT_COUNT];
  #endif
#endif

#ifdef USE_INSTANCING
  VERT_IN vec4 a_ModelMatrix0;
  VERT_IN vec4 a_ModelMatrix1;
  VERT_IN vec4 a_ModelMatrix2;
  VERT_IN vec4 a_ModelMatrix3;
#endif

// these offsets assume the texture is 4 pixels across
#define ROW0_U ((0.5 + 0.0) / 4.0)
#define ROW1_U ((0.5 + 1.0) / 4.0)
#define ROW2_U ((0.5 + 2.0) / 4.0)
#define ROW3_U ((0.5 + 3.0) / 4.0)

#ifdef USE_SKINNING
mat4 getJointMatrix(float boneNdx) {
  #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(MAX_JOINT_COUNT);
    return mat4(
      _texture(u_jointMatrixSampler, vec2(ROW0_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW1_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW2_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW3_U, v))
    );
  #else
    return u_jointMatrix[int(boneNdx)];
  #endif
}

mat4 getSkinningMatrix() {
  mat4 skin = mat4(0);
  skin += 
    a_Weight1.x * getJointMatrix(a_Joint1.x) +
    a_Weight1.y * getJointMatrix(a_Joint1.y) +
    a_Weight1.z * getJointMatrix(a_Joint1.z) +
    a_Weight1.w * getJointMatrix(a_Joint1.w);
  return skin;
}
#endif

void main() {
  mat4 modelMatrix = u_ModelMatrix;
  #ifdef USE_INSTANCING
    modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
  #endif
  vec4 pos = vec4(a_Position, 1.0);
  #ifdef USE_SKINNING
    pos = getSkinningMatrix() * pos;
  #endif
  gl_Position = u_ViewProjectionMatrix * modelMatrix * pos;
}`},k0={source:`#version VERSION

#define FEATURES

#if defined(WEBGL1)
  #extension GL_OES_standard_derivatives : enable
#endif

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

#ifdef WEBGL2
  out vec4 FRAG_COLOR;
#endif

void main() {
  float depth = gl_FragCoord.z;
  float dx = 0.0;
  float dy = 0.0;

  #if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    dx = dFdx(depth);
    dy = dFdy(depth);
  #endif

  float moment2 = depth * depth + 0.25 * (dx * dx + dy * dy);
  FRAG_COLOR = vec4(1.0 - depth, 1.0 - moment2, 0.0, 0.0);
}`};class H0{constructor(){this._maxInstances=20,this._modelMatrix=[new ot,new ot,new ot,new ot],this.expandBuffers(this._maxInstances)}expandBuffers(t){for(;t>this._maxInstances;)this._maxInstances+=Math.floor(this._maxInstances*.5);for(let r=0;r<4;r++)this._modelMatrix[r].update(new Float32Array(4*this._maxInstances))}updateBuffers(t){t.length>this._maxInstances&&this.expandBuffers(t.length);for(let r=0;r<t.length;r++){const i=t[r].worldTransform.array;for(let n=0;n<4;n++)this._modelMatrix[n].data.set(i.slice(n*4,n*4+4),r*4)}for(let r=0;r<4;r++)this._modelMatrix[r].update()}addGeometryAttributes(t){for(let r=0;r<4;r++)t.addAttribute(`a_ModelMatrix${r}`,this._modelMatrix[r],4,!1,void 0,0,void 0,!0)}}var aa;(e=>{function t(r,i=[]){return r.context.webGLVersion===1&&i.push("WEBGL1 1"),r.context.webGLVersion===2&&i.push("WEBGL2 1"),i}e.build=t})(aa||(aa={}));class Nn extends Ni{constructor(t,r=[]){r=aa.build(t,r),super(Gt.from(or.build(G0.source,r,t),or.build(k0.source,r,t))),this._instancing=new H0}get maxSupportedJoints(){return 0}createShaderGeometry(t,r){let i=new Me;return t.indices&&(t.indices.buffer.BYTES_PER_ELEMENT===1?i.addIndex(new ot(new Uint16Array(t.indices.buffer))):i.addIndex(new ot(t.indices.buffer))),t.positions&&i.addAttribute("a_Position",new ot(t.positions.buffer),3,!1,t.positions.componentType,t.positions.stride),r&&this._instancing.addGeometryAttributes(i),i}get name(){return"shadow-shader"}render(t,r,i){if(t.instances.length>0){const n=t.instances.filter(s=>s.worldVisible&&s.renderable);if(n.length===0)return;this._instancing.updateBuffers(n)}super.render(t,r,i)}updateUniforms(t,r){this.uniforms.u_ModelMatrix=t.worldTransform.array,this.uniforms.u_ViewProjectionMatrix=r.lightViewProjection}}class il extends Nn{constructor(t){const r=il.getMaxJointCount(t)-1;super(t,["USE_SKINNING 1","MAX_JOINT_COUNT "+r]),this._maxSupportedJoints=r}get maxSupportedJoints(){return this._maxSupportedJoints}static getMaxJointCount(t){let i=de.getMaxVertexUniformVectors(t)-8;return Math.floor(i/4)}createShaderGeometry(t,r){let i=super.createShaderGeometry(t,r);return t.joints&&i.addAttribute("a_Joint1",new ot(t.joints.buffer),4,!1,t.joints.componentType,t.joints.stride),t.weights&&i.addAttribute("a_Weight1",new ot(t.weights.buffer),4,!1,t.weights.componentType,t.weights.stride),i}get name(){return"skinned-shadow-shader"}updateUniforms(t,r){super.updateUniforms(t,r),t.skin&&(this.uniforms.u_jointMatrix=t.skin.jointMatrices)}}const Fo=256;class _c extends Nn{constructor(t){super(t,["USE_SKINNING 1","USE_SKINNING_TEXTURE 1","MAX_JOINT_COUNT "+Fo]),this._jointMatrixTexture=new Kr(Fo)}static isSupported(t){return Kr.isSupported(t)}get maxSupportedJoints(){return Fo}createShaderGeometry(t,r){let i=super.createShaderGeometry(t,r);return t.joints&&i.addAttribute("a_Joint1",new ot(t.joints.buffer),4,!1,t.joints.componentType,t.joints.stride),t.weights&&i.addAttribute("a_Weight1",new ot(t.weights.buffer),4,!1,t.weights.componentType,t.weights.stride),i}get name(){return"skinned-shadow-shader"}updateUniforms(t,r){super.updateUniforms(t,r),t.skin&&(this._jointMatrixTexture.updateBuffer(t.skin.jointMatrices),this.uniforms.u_jointMatrixSampler=this._jointMatrixTexture)}}class V0{constructor(t){this.renderer=t,this._state=Object.assign(new $t,{depthTest:!0,clockwiseFrontFace:!1,culling:!0,blendMode:at.NONE}),this._shadowShader=new Nn(this.renderer),this._instancedShadowShader=new Nn(this.renderer,["USE_INSTANCING 1"])}getSkinningShader(){return this._textureShader||this._skinningShader?this._textureShader||this._skinningShader:(_c.isSupported(this.renderer)?this._textureShader=new _c(this.renderer):(rr.warn(br.meshVertexSkinningFloatingPointTexturesNotSupported),this._skinningShader=new il(this.renderer)),this._textureShader||this._skinningShader)}render(t,r){let n=t.instances.length>0?this._instancedShadowShader:this._shadowShader;if(t.skin){let s=this.getSkinningShader();s&&t.skin.joints.length>s.maxSupportedJoints?rr.error(br.meshVertexSkinningNumberOfJointsNotSupported,{joints:t.skin.joints.length,maxJoints:s.maxSupportedJoints}):n=s}n&&(n.updateUniforms(t,r),n.render(t,this.renderer,this._state))}}class z0{constructor(t,r="shadow"){this.renderer=t,this.name=r,this._lights=[],this._filter=new U0(t),this._shadow=new V0(t)}addShadowCastingLight(t){this._lights.indexOf(t)<0&&this._lights.push(t)}removeShadowCastingLight(t){const r=this._lights.indexOf(t);r>=0&&this._lights.splice(r,1)}clear(){for(let t of this._lights)t.clear()}render(t){if(t.length===0||this._lights.length===0)return;const r=this.renderer.renderTexture.current;for(let i of this._lights){this.renderer.renderTexture.bind(i.shadowTexture),i.updateLightViewProjection();for(let n of t)this._shadow.render(n,i);i.softness>0&&this._filter.applyGaussianBlur(i)}this.renderer.renderTexture.bind(r||void 0)}}class X0 extends Vn{constructor(){super(),this.addAttribute("aMatrix0",this._buffer,4,!1,Q.FLOAT),this.addAttribute("aMatrix1",this._buffer,4,!1,Q.FLOAT),this.addAttribute("aMatrix2",this._buffer,4,!1,Q.FLOAT),this.addAttribute("aMatrix3",this._buffer,4,!1,Q.FLOAT)}}var j0={source:`precision highp float;

attribute vec2 aVertexPosition;

attribute vec4 aMatrix0;
attribute vec4 aMatrix1;
attribute vec4 aMatrix2;
attribute vec4 aMatrix3;

attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void) {
  mat4 modelMatrix = mat4(aMatrix0, aMatrix1, aMatrix2, aMatrix3);

  gl_Position = modelMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);

  vTextureCoord = vec2(aTextureCoord.x, aTextureCoord.y);
  vTextureId = aTextureId;
  vColor = aColor * tint;
}`},W0={source:`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = vColor * vec4(color.rgb, color.a);
}`};const $0=It.get(St,"BatchRenderer")||It.get(St,"AbstractBatchRenderer");class td extends $0{constructor(t){super(t),this.shaderGenerator=new ma(j0.source,W0.source),this.geometryClass=X0,this.vertexSize=22,Object.assign(this.state,{culling:!1,clockwiseFrontFace:!1,depthTest:!0})}packInterleavedGeometry(t,r,i,n,s){const{uint32View:o,float32View:a}=r,l=n/this.vertexSize,h=t.uvs,c=t.indices,u=t.vertexData,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),p=f<1&&t._texture.baseTexture.alphaMode?Hc(t._tintRGB,f):t._tintRGB+(f*255<<24);for(let g=0;g<u.length;g+=2){a[n++]=u[g],a[n++]=u[g+1],a[n++]=h[g],a[n++]=h[g+1],o[n++]=p,a[n++]=d;let m=t.modelViewProjection.array;for(let _=0;_<16;_++)a[n++]=m[_]}for(let g=0;g<c.length;g++)i[s++]=l+c[g]}}Tt.installRendererPlugin("sprite3d",td);class q0 extends Zr{constructor(t){super(t),this.renderer=t,this._meshes=[],this._sprites=[],this.materialPass=new B0(this.renderer,"material"),this.shadowPass=new z0(this.renderer,"shadow"),this.renderPasses=[this.shadowPass,this.materialPass],t.on("prerender",()=>{for(let r of this.renderPasses)r.clear&&r.clear()}),this._spriteRenderer=new td(t)}render(t){t.isSprite?this._sprites.push(t):this._meshes.push(t)}flush(){this.sort();for(let t of this.renderPasses)t.render(this._meshes.filter(r=>r.isRenderPassEnabled(t.name)));if(this._meshes=[],this._sprites.length>0){this._spriteRenderer.start();for(let t of this._sprites)this._spriteRenderer.render(t);this._spriteRenderer.stop(),this._sprites=[]}}sort(){this._meshes.sort((t,r)=>!t.material||!r.material?0:t.material.renderSortType!==r.material.renderSortType?t.material.renderSortType===Ai.transparent?1:-1:t.renderSortOrder===r.renderSortOrder?0:t.renderSortOrder<r.renderSortOrder?-1:1),this._sprites.sort((t,r)=>t.zIndex!==r.zIndex?t.zIndex-r.zIndex:r.distanceFromCamera-t.distanceFromCamera)}enableShadows(t,r){let i=t instanceof Dn?t.meshes:[t];for(let n of i)r&&n.material instanceof Ue&&(n.material.shadowCastingLight=r),n.enableRenderPass(this.shadowPass.name);r&&this.shadowPass.addShadowCastingLight(r)}disableShadows(t){let r=t instanceof Dn?t.meshes:[t];for(let i of r)i.material instanceof Ue&&(i.material.shadowCastingLight=void 0),i.disableRenderPass(this.shadowPass.name)}}Tt.installRendererPlugin("pipeline",q0);const Y0=It.get(St,"ArrayResource")||It.get(St,"resources").ArrayResource,K0=It.get(St,"BaseImageResource")||It.get(St,"resources").BaseImageResource;class vc extends Y0{constructor(t,r){super(t),this.target=r}upload(t,r){t.gl.pixelStorei(t.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===Vt.UNPACK);for(let i=0;i<this.items.length;i++){const n=this.items[i].resource;n instanceof Qa&&t.gl.texImage2D(this.target,i,r.format,n.width,n.height,0,r.format,r.type,n.data),n instanceof K0&&t.gl.texImage2D(this.target,i,r.format,r.format,r.type,n.source)}return!0}}const Q0=It.get(St,"CubeResource")||It.get(St,"resources").CubeResource;class yc extends Q0{constructor(t,r=1){super(t),this.levels=r}style(t){let r=t.gl;return r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.levels>1?r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR):r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),!0}}class ke extends ht{constructor(){super(...arguments),this.cubemapFormat=Jn.ldr}static get faces(){return["posx","negx","posy","negy","posz","negz"]}get levels(){return this.resource.levels}static fromFaces(t){const r=Array.isArray(t)?t:[t],i=ke.faces.map((n,s)=>new vc(r.map(o=>o[n]),He.TEXTURE_CUBE_MAP_POSITIVE_X+s));return new ke(new yc(i,r.length))}static fromColors(t,r=t,i=t,n=t,s=t,o=t){const a=[],l=[t,r,i,n,s,o];for(let h=0;h<l.length;h++){let c=new Qa(new Uint8Array(l[h].rgba.map(d=>d*255)),{width:1,height:1}),u=new $(new ht(c,{type:Q.UNSIGNED_BYTE,format:X.RGB,alphaMode:Vt.NO_PREMULTIPLIED_ALPHA}));a.push(new vc([u],He.TEXTURE_CUBE_MAP_POSITIVE_X+h))}return new ke(new yc(a,1))}}class J0{constructor(t){this.json=t}get format(){return Jn.ldr}get mipmaps(){return this.json}}class Z0{constructor(t){this.json=t}get format(){return this.json.format}get mipmaps(){return this.json.mipmaps}}var Bn;(e=>{function t(r){return r.version===2?new Z0(r):new J0(r)}e.getFileVersion=t})(Bn||(Bn={}));const tv={use:function(e,t){if(e.extension!=="cubemap")return t();const r=this,i=Bn.getFileVersion(e.data),n=i.mipmaps.map(l=>ke.faces.map(h=>e.url.substring(0,e.url.lastIndexOf("/")+1)+l.replace("{{face}}",h)));let s=n.reduce((l,h)=>l.concat(h),[]);r.add(s.filter(l=>!r.resources[l]).map(l=>({parentResource:e,url:l})));let o=0,a=r.onLoad.add((l,h)=>{if(s.includes(h.url)&&++o===s.length){const c=n.map(d=>({posx:$.from(d[0]),negx:$.from(d[1]),posy:$.from(d[2]),negy:$.from(d[3]),posz:$.from(d[4]),negz:$.from(d[5])}));let u=ke.fromFaces(c);u.cubemapFormat=i.format,e.cubemap=u,a.detach(),t()}})},add:function(){Tt.setLoaderResourceExtensionType("cubemap",sr.json)},test(e){return e.includes(".cubemap")},async load(e){if(!Tt.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const r=await(await j.ADAPTER.fetch(e)).json(),i=Bn.getFileVersion(r),n=i.mipmaps.map(a=>ke.faces.map(l=>e.substring(0,e.lastIndexOf("/")+1)+a.replace("{{face}}",l))),s=[];for(let a of n){let l={posx:await Tt.assets.load(a[0]),negx:await Tt.assets.load(a[1]),posy:await Tt.assets.load(a[2]),negy:await Tt.assets.load(a[3]),posz:await Tt.assets.load(a[4]),negz:await Tt.assets.load(a[5])};s.push(l)}let o=ke.fromFaces(s);return o.cubemapFormat=i.format,o}};Tt.installLoaderPlugin("cubemap",tv);const ev=["glsl","vert","frag"],rv={use:(e,t)=>{t()},add:function(){for(let e of ev)Tt.setLoaderResourceExtensionType(e,sr.text)},test(e){return e.includes(".glsl")||e.includes(".vert")||e.includes(".frag")},async load(e){return await(await j.ADAPTER.fetch(e)).text()}};Tt.installLoaderPlugin("shader",rv);var iv={source:`#version 100

attribute vec3 a_Position;

uniform mat4 u_ModelViewProjection;

void main() {
  gl_Position = u_ModelViewProjection * vec4(a_Position, 1.0);
}`},nv={source:`#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

uniform vec3 u_Id;

void main() {
  gl_FragColor = vec4(u_Id / 255.0, 1.0);
}`};class sv{constructor(t,r){this._renderer=t,this._update=0,this._matrix=new Float32Array(16),this._pixels=new Uint8Array(r*r*4),this._output=De.create({width:r,height:r,resolution:1}),this._shader=new Ni(Gt.from(iv.source,nv.source)),this._output.framebuffer.addDepthTexture()}destroy(){this._output.destroy(!0),this._shader.destroy()}resizeToAspect(){const t=this._renderer.width/this._renderer.height,r=Math.floor(this._output.height*t);this._output.width!==r&&(this._pixels=new Uint8Array(r*this._output.height*4),this._output.resize(r,this._output.height))}containsId(t,r,i){const{width:n,height:s}=this._renderer.screen;t=Math.floor(t/n*this._output.width),r=Math.floor((s-r)/s*this._output.height);for(let o=0;o<3;o++)if(i[o]!==this._pixels[(r*this._output.width+t)*4+o])return!1;return!0}update(t){if(this._renderer.renderTexture.bind(this._output),this._update++%2===0){this._renderer.renderTexture.clear();for(let r of t)this.renderHitArea(r)}else{const r=this._renderer.gl;r.readPixels(0,0,this._output.width,this._output.height,r.RGBA,r.UNSIGNED_BYTE,this._pixels)}this._renderer.renderTexture.bind(void 0)}renderHitArea(t){const r=this._shader.uniforms,i=t.object instanceof Ee?[t.object]:t.object.meshes,n=t.camera||Ce.main;for(let s of i)r.u_Id=t.id,r.u_ModelViewProjection=lt.multiply(n.viewProjection.array,s.transform.worldTransform.array,this._matrix),this._shader.render(s,this._renderer)}}class zr{constructor(t){this.renderer=t,this._hitAreas=[],this._map=new sv(this.renderer,128),Ft.shared.add(this._update,this,We.LOW),zr.main||(zr.main=this)}_update(){if(!this.renderer.plugins)return;let t=Tt.getInteractionPlugin(this.renderer);t&&t.hitTest(new _t(0,0)),this._hitAreas.length>0&&(this._map.resizeToAspect(),this._map.update(this._hitAreas),this._hitAreas=[])}destroy(){this===zr.main&&(zr.main=void 0),Ft.shared.remove(this._update,this)}containsHitArea(t,r,i){return this._hitAreas.indexOf(i)<0&&this._hitAreas.push(i),this._map.containsId(t,r,i.id)}}Tt.installRendererPlugin("picking",zr);var xc;(e=>{let t=0;function r(){return t++,new Uint8Array([t>>16&255,t>>8&255,t&255])}e.next=r})(xc||(xc={}));var Ei=(e=>(e.low="low",e.medium="medium",e.high="high",e))(Ei||{}),On;(e=>{function t(n,s,o){let a=i(n,o);return De.create({width:s,height:s,type:a,scaleMode:r(n)})}e.create=t;function r(n){return de.supportsFloatLinear(n)?Zt.LINEAR:Zt.NEAREST}function i(n,s){if(s===Ei.high){if(de.isFloatFramebufferSupported(n))return Q.FLOAT;if(de.isHalfFloatFramebufferSupported(n))return Q.HALF_FLOAT}return s===Ei.medium&&de.isHalfFloatFramebufferSupported(n)?Q.HALF_FLOAT:Q.UNSIGNED_BYTE}})(On||(On={}));var Ln;(e=>{const t=new Float32Array(16),r=new Float32Array(16),i=new Float32Array(4),n=new Float32Array(3),s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3);function l(c){if(c.light.type!==Re.directional)return;let u=c.shadowArea/2,d=u*2/c.shadowArea,f=lt.ortho(-u,u,-u,u,-u,u,t),p=c.light,g=c.camera||Ce.main;g&&c.followCamera?(ct.scale(g.worldTransform.forward.array,u,a),ct.add(g.worldTransform.position.array,a,o),ct.transformQuat(o,Ht.conjugate(c.light.worldTransform.rotation.array,i),n),n[0]=d*Math.floor(n[0]/d),n[1]=d*Math.floor(n[1]/d),ct.transformQuat(n,p.worldTransform.rotation.array,n),ct.add(n,p.worldTransform.forward.array,s),lt.lookAt(n,s,p.worldTransform.up.array,r),lt.multiply(f,r,c.lightViewProjection)):(ct.add(p.worldTransform.position.array,c.light.worldTransform.forward.array,o),lt.lookAt(p.worldTransform.position.array,o,p.worldTransform.up.array,r),lt.multiply(f,r,c.lightViewProjection))}e.calculateDirectionalLightViewProjection=l;function h(c){if(c.light.type!==Re.spot)return;let u=c.light;lt.perspective(u.outerConeAngle*Sr*2,1,2,u.range,t),ct.add(u.worldTransform.position.array,u.worldTransform.forward.array,o),lt.lookAt(u.worldTransform.position.array,o,u.worldTransform.up.array,r),lt.multiply(t,r,c.lightViewProjection)}e.calculateSpotLightViewProjection=h})(Ln||(Ln={}));class ov{constructor(t,r,i){if(this.renderer=t,this.light=r,this._lightViewProjection=new Float32Array(16),this.softness=0,this.shadowArea=50,this.followCamera=!0,r.type===Re.point)throw new Error("PIXI3D: Only directional and spot lights are supported as shadow casters.");const{shadowTextureSize:n=1024,quality:s=Ei.medium}=i||{};this._shadowTexture=On.create(t,n,s),this._shadowTexture.baseTexture.framebuffer.addDepthTexture(),this._filterTexture=On.create(t,n,s)}get lightViewProjection(){return this._lightViewProjection}get shadowTexture(){return this._shadowTexture}get filterTexture(){return this._filterTexture}destroy(){this._shadowTexture.destroy(!0),this._filterTexture.destroy(!0)}clear(){this.renderer.renderTexture.bind(this._shadowTexture),this.renderer.renderTexture.clear([0,0,0,0],this.renderer.gl.COLOR_BUFFER_BIT|this.renderer.gl.DEPTH_BUFFER_BIT),this.renderer.renderTexture.bind(void 0)}updateLightViewProjection(){this.light.type===Re.directional?Ln.calculateDirectionalLightViewProjection(this):this.light.type===Re.spot&&Ln.calculateSpotLightViewProjection(this)}static isMediumQualitySupported(t){return de.isHalfFloatFramebufferSupported(t)}static isHighQualitySupported(t){return de.isFloatFramebufferSupported(t)}}class av{async Init(t,r){let i=new tl(ke.fromColors(new pe(1,1,1,1)),r.specular);ze.main.imageBasedLighting=i;let n=new N0;n.intensity=2,n.type=Re.directional,n.rotationQuaternion.setEulerAngles(25,120,0),ze.main.lights.push(n);let s=new ov(t.renderer,n,{shadowTextureSize:1024,quality:Ei.medium});s.softness=1,s.shadowArea=15;let o=new $t;o.culling=!0,t.renderer.state.set(o);let l=new ie;t.stage.addChild(l);let h=new ie;l.addChild(h),await this.InstantiateModel("assets/3d/scene_reduced.glb",h);let c=new ie;await this.InstantiateModel("assets/3d/t_table_BG.glb",c),await this.InstantiateModel("assets/3d/t_table_main.glb",c);let u=new wi;u.text="1.3",u.style.fontSize=100,t.stage.addChild(u);let d=t.view.width;t.view.height;let f=new Di;f.beginFill(16777215),f.drawRect(-.1*d,-.06*d,.2*d,.12*d),f.endFill(),f.x=d-.12*d,f.y=.08*d,t.stage.addChild(f),f.eventMode="static",f.on("pointertap",g=>{h.parent===l?(l.removeChild(h),l.addChild(c)):(l.removeChild(c),l.addChild(h))});let p=new wi;p.text="switch",p.style.fontSize=24,p.anchor.set(.5),f.addChild(p)}async InstantiateModel(t,r){let i=await er.load(t);return r.addChild(Dn.from(i))}}const lv={bundles:[{name:"assets",assets:[{name:"diffuse",srcs:"assets/unity_skybox/skybox.cubemap"},{name:"specular",srcs:"assets/unity_skybox/specular.cubemap"},{name:"specular2",srcs:"assets/room_cubemap/specular.cubemap"},{name:"teapot",srcs:"assets/teapot/teapot.gltf"},{name:"sphere",srcs:"assets/3d/rangerover.glb"},{name:"spark",srcs:"assets/3d/Spark.glb"},{name:"dull",srcs:"assets/textures/dull.png"}]}]};class hv{constructor(){this.app=new Xa({backgroundColor:3355477,resizeTo:window,antialias:!0}),document.body.appendChild(this.app.view),window.GameApp=this.app,globalThis.__PIXI_APP__=this.app,this.controller=new av}async Init(){await er.init({manifest:lv});let t=await er.loadBundle("assets");await this.controller.Init(this.app,t),new h0(this.app.view)}}(async()=>await new hv().Init())();
